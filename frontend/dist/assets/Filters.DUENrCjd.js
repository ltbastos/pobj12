import{r as b,e as I,b as me,m as M,o as D,R as Pe,v as W,B as Z,j as ne,g as Re,k as te,S as re,y as Ke,w as Ye,q as l,t as _,u as o,x as ae,C as ue,E as Le}from"./vendor.iNPlSTaR.js";import{u as He}from"./vue-router.BQVFLPdy.js";import{I as j,_ as ve}from"./index.oIu47dWK.js";import{u as je}from"./useInitCache.c9IJUsbI.js";import{u as ce}from"./useGlobalFilters.DGbadgZS.js";import{c as We}from"./useResumoData.DGwzMgLj.js";import{c as Ze}from"./useDetalhesData.Cesx8RDR.js";import{S as w}from"./SelectSearch.BR0CuZUt.js";import{S as ge}from"./SelectInput.Dm0rI0ZS.js";import"./pdf-vendor.jXUlHPMi.js";import"./icons-vendor.pg7b-e9c.js";const r=e=>e==null||e===""?"":String(e).trim(),qe=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,Je=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,x=(e,t)=>{const s=String(e.nome??e.label??"").trim();let m="",f;return t==="ggestao"||t==="gerente"?(f=r(e.funcional??""),m=r(e.id??"")):(m=r(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),f=e.funcional?r(e.funcional):void 0),{id:m,nome:t==="ggestao"||t==="gerente"?Je(f||m,s):qe(m,s),id_segmento:r(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:r(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:r(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:r(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:r(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:f}};function Xe(e){const t={segmento:b(""),diretoria:b(""),gerencia:b(""),agencia:b(""),ggestao:b(""),gerente:b("")},s=I(()=>e.value?{segmentos:(e.value.segmentos??[]).map(a=>x(a,"segmento")),diretorias:(e.value.diretorias??[]).map(a=>x(a,"diretoria")),regionais:(e.value.regionais??[]).map(a=>x(a,"regional")),agencias:(e.value.agencias??[]).map(a=>x(a,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(a=>x(a,"ggestao")),gerentes:(e.value.gerentes??[]).map(a=>x(a,"gerente"))}:null),m=I(()=>{if(!s.value)return null;const a=c=>Object.fromEntries((c??[]).map(d=>[r(d.id),d]));return{segmento:a(s.value.segmentos),diretoria:a(s.value.diretorias),gerencia:a(s.value.regionais),agencia:a(s.value.agencias),ggestao:a(s.value.ggestoes),gerente:a(s.value.gerentes)}}),f={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},g={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function v(a,c){if(!c)return;const d=g[a],C=f[a];if(!d||!C)return;const h=m.value?.[a]?.[r(c)];if(!h)return;const F=r(h[C]??"");if(!F)return;const $=m.value?.[d]?.[F];$&&(t[d].value=$.id,console.debug("[hierarchy] autoFillParent:",{childField:a,childValue:c,parentField:d,parentId:F}),v(d,$.id))}const T=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function p(a){let c=!1;for(const d of T)c&&(t[d].value=""),d===a&&(c=!0)}function u(a,c){t[a].value=r(c),p(a),v(a,t[a].value)}const A=I(()=>s.value?.segmentos??[]),B=I(()=>{const a=s.value?.diretorias??[];if(!t.segmento.value)return a;const c=r(t.segmento.value);return a.filter(d=>r(d.id_segmento)===c)}),N=I(()=>{const a=s.value?.regionais??[];if(!t.diretoria.value)return a;const c=r(t.diretoria.value);return a.filter(d=>r(d.id_diretoria)===c)}),z=I(()=>{const a=s.value?.agencias??[];if(!t.gerencia.value)return a;const c=r(t.gerencia.value);return a.filter(d=>r(d.id_regional)===c)}),E=I(()=>{const a=s.value?.ggestoes??[];if(t.agencia.value){const c=r(t.agencia.value);return a.filter(d=>r(d.id_agencia)===c)}if(t.gerencia.value){const c=r(t.gerencia.value),C=(s.value?.agencias??[]).filter(h=>r(h.id_regional)===c).map(h=>h.id);return a.filter(h=>{const F=r(h.id_agencia??"");return C.includes(F)})}return a}),P=I(()=>{const a=s.value?.gerentes??[];if(t.ggestao.value){const c=r(t.ggestao.value);return a.filter(d=>r(d.id_gestor)===c)}if(t.agencia.value){const c=r(t.agencia.value),C=(s.value?.ggestoes??[]).filter(h=>r(h.id_agencia)===c).map(h=>h.id);return a.filter(h=>{const F=r(h.id_gestor??"");return C.includes(F)})}if(t.gerencia.value){const c=E.value.map(d=>d.id);return a.filter(d=>{const C=r(d.id_gestor??"");return c.includes(C)})}return a});return{...t,segmentos:A,diretorias:B,regionais:N,agencias:z,gerentesGestao:E,gerentes:P,handleSegmentoChange:a=>u("segmento",a),handleDiretoriaChange:a=>u("diretoria",a),handleGerenciaChange:a=>u("gerencia",a),handleAgenciaChange:a=>u("agencia",a),handleGerenteGestaoChange:a=>u("ggestao",a),handleGerenteChange:a=>u("gerente",a),clearAll:()=>{for(const a of T)t[a].value=""}}}const fe=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function Qe(e,t){const m=new Date().toISOString().split("T")[0],f=t||m,g=new Date(f+"T00:00:00Z");if(isNaN(g.getTime())){const u=new Date,A=u.toISOString().split("T")[0];return{start:`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-01`,end:A||`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`}}let v;if(e==="anual")v=new Date(Date.UTC(g.getUTCFullYear(),0,1));else if(e==="mensal")v=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),1));else{const u=fe.find(A=>A.value===e)?.monthsBack||5;v=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth()-u,1))}const T=v.toISOString().split("T")[0]||"",p=g.toISOString().split("T")[0]||"";return{start:T,end:p}}function oe(e,t,s){if(e==="mensal"){const m=new Date().toISOString().split("T")[0]||"",g=s||t.end||m||m,v=new Date(g+"T00:00:00Z");return{start:new Date(Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:g}}return Qe(e,s||t.end)}function ea(e,t){const s=b("mensal");return{accumulatedView:s,handleViewChange:g=>{s.value=g;const v=oe(g,e.value);t(v)},resetToMensal:()=>{s.value="mensal"},options:fe}}const aa=["type","disabled","aria-busy","aria-disabled"],ia={key:0,class:"btn__spinner","aria-hidden":"true"},na={key:3},ta={key:4,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},oa=me({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},iconName:{},loading:{type:Boolean,default:!1}},setup(e){const t=e,s=b(null),m=f=>{if(t.disabled||t.loading)return;const g=f.currentTarget,v=document.createElement("span"),T=Math.max(g.clientWidth,g.clientHeight),p=T/2,u=g.getBoundingClientRect();v.style.width=v.style.height=`${T}px`,v.style.left=`${f.clientX-u.left-p}px`,v.style.top=`${f.clientY-u.top-p}px`,v.classList.add("ripple");const A=g.getElementsByClassName("ripple")[0];A&&A.remove(),g.appendChild(v),setTimeout(()=>{v.remove()},600)};return(f,g)=>(D(),M("button",Pe({ref_key:"buttonRef",ref:s,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},f.$attrs,{onClick:m,onKeydown:[g[0]||(g[0]=W(Z(v=>!e.disabled&&!e.loading&&m(v),["prevent"]),["enter"])),g[1]||(g[1]=W(Z(v=>!e.disabled&&!e.loading&&m(v),["prevent"]),["space"]))]}),[e.loading?(D(),M("span",ia)):ne("",!0),e.icon&&!e.loading?(D(),M("i",{key:1,class:te(e.icon),"aria-hidden":"true"},null,2)):e.iconName&&!e.loading?(D(),Re(j,{key:2,name:e.iconName,size:16,"aria-hidden":"true"},null,8,["name"])):ne("",!0),e.loading?(D(),M("span",ta,[re(f.$slots,"default",{},void 0)])):(D(),M("span",na,[re(f.$slots,"default",{},void 0)]))],16,aa))}}),ie=ve(oa,[["__scopeId","data-v-2eacfed4"]]),la={class:"card card--filters"},sa={class:"filters"},da={class:"filters__group"},ra={class:"filters__group"},ua={class:"filters__group"},ca={class:"filters__actions"},ga={key:0,class:"filters__more filters__more--center"},ma=["aria-hidden"],va={class:"adv__grid"},fa={class:"filters__group"},pa={class:"filters__group"},ba={class:"filters__group"},ha={class:"filters__group"},_a={class:"filters__group"},Sa={class:"filters__group"},Ia={class:"filters__group"},ya={class:"filters__group"},Ca=me({__name:"Filters",setup(e){const t=He(),s=I(()=>t.name==="Simuladores"),m=b(!1),f=b(!0),{initData:g,isLoading:v,loadInit:T}=je(),p=v,{updateFilter:u,clearFilters:A,triggerFilter:B}=ce(),{segmento:N,diretoria:z,gerencia:E,agencia:P,ggestao:q,gerente:a,segmentos:c,diretorias:d,regionais:C,agencias:h,gerentesGestao:F,gerentes:$,handleSegmentoChange:pe,handleDiretoriaChange:be,handleGerenciaChange:he,handleAgenciaChange:_e,handleGerenteGestaoChange:Se,handleGerenteChange:Ie,clearAll:ye}=Xe(g),R=b([]),G=b([]),J=b([]),Ce=b([]),V=b(""),y=b(""),U=b(""),K=b("todos"),Te=I(()=>{if(!V.value)return G.value;const i=String(V.value).trim();return G.value.filter(n=>(n.id_familia?String(n.id_familia).trim():"")===i)}),le=I(()=>{if(!y.value)return[];const i=String(y.value).trim();return J.value.filter(n=>(n.id_indicador?String(n.id_indicador).trim():"")===i)}),Ae=I(()=>le.value.length>0),Y=(i,n)=>{if(!i)return null;const S=String(i).trim();return n.find(O=>String(O.id).trim()===S)||null},Fe=i=>{if(V.value=i,!i)y.value="",U.value="";else if(y.value){const n=Y(y.value,G.value),S=String(i).trim();(n?.id_familia?String(n.id_familia).trim():"")!==S&&(y.value="",U.value="")}},Ve=i=>{if(y.value=i,U.value="",i){const n=Y(i,G.value);if(n?.id_familia){const S=String(n.id_familia).trim();R.value.some(k=>String(k.id).trim()===S)&&(V.value=S)}}else y.value="",U.value=""},Ue=i=>{if(U.value=i,i){const n=Y(i,J.value);if(n?.id_indicador){const S=String(n.id_indicador).trim();if(G.value.some(k=>String(k.id).trim()===S)){y.value=S;const k=Y(S,G.value);if(k?.id_familia){const ee=String(k.id_familia).trim();R.value.some(ze=>String(ze.id).trim()===ee)&&(V.value=ee)}}}}else U.value=""},ke=i=>{const n=String(i.id||i.codigo||i.id_diretoria||i.id_regional||i.id_agencia||i.funcional||i.subId||i.subindicadorId||"").trim(),S=String(i.label||i.nome||n).trim(),O=i.id_familia??i.idFamilia??i.familia_id??i.familiaId,k=i.id_indicador??i.idIndicador??i.indicador_id??i.indicadorId??i.produtoId??i.produto_id;return{id:n,nome:S,id_familia:O?String(O).trim():void 0,id_indicador:k?String(k).trim():void 0}},L=i=>Array.isArray(i)?i.map(ke).filter(n=>n.id):[],we=async()=>{try{const i=await T();i&&(R.value=L(i.familias||[]),G.value=L(i.indicadores||[]),J.value=L(i.subindicadores||[]),Ce.value=L(i.status_indicadores||[]))}catch(i){console.error("Erro ao carregar estrutura:",i)}},{period:X,updatePeriod:se}=ce(),{accumulatedView:H,handleViewChange:De,resetToMensal:Ge,options:Oe}=ea(X,se),Me=I(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),$e=I(()=>Oe.map(i=>({id:i.value,nome:i.label}))),xe=i=>{K.value=i},Be=i=>{De(i)};Ke(()=>{we(),de(),B()}),Ye(()=>X.value,i=>{if(H.value!=="mensal"){const n=oe(H.value,i,i.end);(n.start!==i.start||n.end!==i.end)&&Ge()}},{deep:!0});const Q=()=>{m.value=!m.value},Ee=()=>{de(),B()},de=()=>{u("segmento",N.value),u("diretoria",z.value),u("gerencia",E.value),u("agencia",P.value),u("ggestao",q.value),u("gerente",a.value),u("familia",V.value),u("indicador",y.value),u("subindicador",U.value),u("status",K.value)},Ne=()=>{ye(),V.value="",y.value="",U.value="",K.value="todos",H.value="mensal";const i=oe("mensal",X.value);A(),We(),Ze(),se(i),B()};return(i,n)=>(D(),M("section",la,[n[13]||(n[13]=l("header",{class:"card__header"},[l("div",{class:"filters-hero"},[l("div",{class:"title-subtitle"},[l("h2",null,"POBJ Produções"),l("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),l("div",sa,[l("div",da,[n[0]||(n[0]=l("label",null,"Segmento",-1)),_(w,{id:"f-segmento","model-value":o(N),options:[{id:"",nome:"Todos"},...Array.isArray(o(c))?o(c):[]],placeholder:"Todos",label:"Segmento",disabled:o(p),"onUpdate:modelValue":o(pe)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ra,[n[1]||(n[1]=l("label",null,"Diretoria",-1)),_(w,{id:"f-diretoria","model-value":o(z),options:[{id:"",nome:"Todas"},...Array.isArray(o(d))?o(d):[]],placeholder:"Todas",label:"Diretoria",disabled:o(p),"onUpdate:modelValue":o(be)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ua,[n[2]||(n[2]=l("label",null,"Regional",-1)),_(w,{id:"f-gerencia","model-value":o(E),options:[{id:"",nome:"Todas"},...Array.isArray(o(C))?o(C):[]],placeholder:"Todas",label:"Regional",disabled:o(p),"onUpdate:modelValue":o(he)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ca,[_(ie,{id:"btn-filtrar",variant:"primary",disabled:s.value,onClick:Ee},{default:ae(()=>[_(j,{name:"search",size:16,color:"white"}),n[3]||(n[3]=ue(" Filtrar ",-1))]),_:1},8,["disabled"]),_(ie,{id:"btn-limpar",variant:"secondary",onClick:Ne},{default:ae(()=>[_(j,{name:"x",size:16}),n[4]||(n[4]=ue(" Limpar filtros ",-1))]),_:1})])]),f.value?(D(),M("div",ga,[_(ie,{id:"btn-abrir-filtros",variant:"info","aria-expanded":m.value,"aria-controls":"advanced-filters",onClick:Q,onKeydown:[W(Z(Q,["prevent"]),["enter"]),W(Z(Q,["prevent"]),["space"])]},{default:ae(()=>[_(j,{name:"chevron-down",size:16,class:te({rotated:m.value})},null,8,["class"]),l("span",null,Le(m.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):ne("",!0),l("section",{id:"advanced-filters",class:te(["adv",{"is-open":m.value}]),"aria-hidden":!m.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[l("div",va,[l("div",fa,[n[5]||(n[5]=l("label",null,"Agência",-1)),_(w,{id:"f-agencia","model-value":o(P),options:[{id:"",nome:"Todas"},...Array.isArray(o(h))?o(h):[]],placeholder:"Todas",label:"Agência",disabled:o(p),"onUpdate:modelValue":o(_e)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",pa,[n[6]||(n[6]=l("label",null,"Gerente de gestão",-1)),_(w,{id:"f-gerente-gestao","model-value":o(q),options:[{id:"",nome:"Todos"},...Array.isArray(o(F))?o(F):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:o(p),"onUpdate:modelValue":o(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ba,[n[7]||(n[7]=l("label",null,"Gerente",-1)),_(w,{id:"f-gerente","model-value":o(a),options:[{id:"",nome:"Todos"},...Array.isArray(o($))?o($):[]],placeholder:"Todos",label:"Gerente",disabled:o(p),"onUpdate:modelValue":o(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ha,[n[8]||(n[8]=l("label",null,"Família",-1)),_(w,{id:"f-secao","model-value":V.value,options:[{id:"",nome:"Selecione..."},...R.value],placeholder:"Selecione...",label:"Família",disabled:o(p),"onUpdate:modelValue":Fe},null,8,["model-value","options","disabled"])]),l("div",_a,[n[9]||(n[9]=l("label",null,"Indicadores",-1)),_(w,{id:"f-familia","model-value":y.value,options:[{id:"",nome:"Selecione..."},...Te.value],placeholder:"Selecione...",label:"Indicadores",disabled:o(p)||!V.value,"onUpdate:modelValue":Ve},null,8,["model-value","options","disabled"])]),l("div",Sa,[n[10]||(n[10]=l("label",null,"Subindicador",-1)),_(w,{id:"f-produto","model-value":U.value,options:[{id:"",nome:"Selecione..."},...le.value],placeholder:"Selecione...",label:"Subindicador",disabled:o(p)||!y.value||!Ae.value,"onUpdate:modelValue":Ue},null,8,["model-value","options","disabled"])]),l("div",Ia,[n[11]||(n[11]=l("label",null,"Status dos indicadores",-1)),_(ge,{id:"f-status-kpi","model-value":K.value,options:Me.value,placeholder:"Todos",label:"Status dos indicadores",disabled:o(p),"onUpdate:modelValue":xe},null,8,["model-value","options","disabled"])]),l("div",ya,[n[12]||(n[12]=l("label",null,"Visão acumulada",-1)),_(ge,{id:"f-visao","model-value":o(H),options:$e.value,placeholder:"Mensal",label:"Visão acumulada",disabled:o(p),"onUpdate:modelValue":Be},null,8,["model-value","options","disabled"])])])],10,ma)]))}}),Ba=ve(Ca,[["__scopeId","data-v-9947db72"]]);export{Ba as default};
