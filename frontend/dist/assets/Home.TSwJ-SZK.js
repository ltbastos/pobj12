import{b as Q,r as I,w as ga,y as ea,m as k,q as a,k as R,o as x,e as T,n as fa,j as q,u as n,t as S,C as B,E as d,L as O,M as ya,F as j,D as aa,A as ua,v as ra,B as _a}from"./vendor.Mb-DmQZ9.js";import{_ as W,a as ba,A as $a,I as U}from"./index._pwAkkZ8.js";import{u as J}from"./useGlobalFilters.CgxjVgBC.js";import{f as ka,a as F,b as xa,c as wa,d as L,e as E,g as Ma,h as Z}from"./formatUtils.SsKD9Isb.js";import{u as za}from"./useCalendarioCache.BBlvdAj_.js";import{f as ma}from"./calendarioService.CWAO-pW1.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./vue-router.BEbJbLaE.js";const Aa={class:"resumo-mode"},Pa={class:"resumo-mode__toggle",role:"group","aria-label":"Alterar visão do resumo"},Fa={class:"segmented"},Ra=["aria-pressed"],Ta=["aria-pressed"],Na=Q({__name:"ResumoModeToggle",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:c}){const u=l,v=c,$=I(u.modelValue||"cards");ga(()=>u.modelValue,i=>{i&&(i==="cards"||i==="legacy")&&($.value=i)});const z=i=>{$.value=i,v("update:modelValue",i),typeof window<"u"&&localStorage.setItem("resumo-mode",i)};return ea(()=>{if(typeof window<"u"&&!u.modelValue){const i=localStorage.getItem("resumo-mode");i&&(i==="cards"||i==="legacy")&&($.value=i,v("update:modelValue",i))}else u.modelValue&&($.value=u.modelValue)}),(i,y)=>(x(),k("div",Aa,[a("div",Pa,[a("div",Fa,[a("button",{type:"button",class:R(["seg-btn",{"is-active":$.value==="cards"}]),"aria-pressed":$.value==="cards",onClick:y[0]||(y[0]=f=>z("cards"))}," Visão por cards ",10,Ra),a("button",{type:"button",class:R(["seg-btn",{"is-active":$.value==="legacy"}]),"aria-pressed":$.value==="legacy",onClick:y[1]||(y[1]=f=>z("legacy"))}," Visão clássica ",10,Ta)])])]))}}),Sa=W(Na,[["__scopeId","data-v-446d22e4"]]);async function Ca(l){const c={};l&&(l.segmento&&(c.segmento=l.segmento),l.diretoria&&(c.diretoria=l.diretoria),l.regional&&(c.regional=l.regional),l.agencia&&(c.agencia=l.agencia),l.gerenteGestao&&(c.gerenteGestao=l.gerenteGestao),l.gerente&&(c.gerente=l.gerente),l.familia&&(c.familia=l.familia),l.indicador&&(c.indicador=l.indicador),l.subindicador&&(c.subindicador=l.subindicador),l.dataInicio&&(c.dataInicio=l.dataInicio),l.dataFim&&(c.dataFim=l.dataFim),l.status&&(c.status=l.status));const u=await ba($a.RESUMO,c);return u.success&&u.data?u.data:(console.error("Erro ao buscar resumo:",u.error),null)}const K=I(null),ta=I(!1),oa=I(null),ha=I(null);let pa=!1;const Va={total:0,elapsed:0,remaining:0,monthStart:"",monthEnd:"",today:""};function D(l){if(!l)return;const c=l.trim();if(!c)return;const u=c.toLowerCase();if(!(u==="todos"||u==="todas"))return c}function da(l,c){const u={};if(l){const v=D(l.segmento),$=D(l.diretoria),z=D(l.gerencia),i=D(l.agencia),y=D(l.ggestao),f=D(l.gerente),b=D(l.familia),_=D(l.indicador),m=D(l.subindicador);let r;l.status&&l.status!=="todos"&&(l.status==="atingidos"?r="01":l.status==="nao"&&(r="02")),v&&(u.segmento=v),$&&(u.diretoria=$),z&&(u.regional=z),i&&(u.agencia=i),y&&(u.gerenteGestao=y),f&&(u.gerente=f),b&&(u.familia=b),_&&(u.indicador=_),m&&(u.subindicador=m),r&&(u.status=r)}return c?.start&&(u.dataInicio=c.start),c?.end&&(u.dataFim=c.end),u}async function va(l){if(!ta.value){ha.value=l,ta.value=!0,oa.value=null;try{const c=await Ca(l);c?K.value=c:oa.value="Não foi possível carregar o resumo"}catch(c){console.error("Erro ao carregar resumo:",c),oa.value=c instanceof Error?c.message:"Erro desconhecido"}finally{ta.value=!1}}}function ia(l,c){if(!pa){pa=!0;const{filterTrigger:v,filterState:$,period:z}=J();ga(v,async()=>{await fa();const i=da($.value,z.value);va(i)},{immediate:!0})}const u=async()=>{const v=ha.value??da(l.value,c.value);await va(v)};return{resumo:T(()=>K.value),produtos:T(()=>K.value?.cards??[]),produtosMensais:T(()=>K.value?.classifiedCards??[]),variavel:T(()=>K.value?.variableCard??[]),businessSnapshot:T(()=>K.value?.businessSnapshot??Va),loading:T(()=>ta.value),error:T(()=>oa.value),loadResumo:u,buildFilters:()=>da(l.value,c.value)}}function ca(l,c){const u=ia(l,c),v=T(()=>u.buildFilters()),$=T(()=>{const z=new Map;return u.produtos.value.forEach(i=>{const y=i.id_familia||"sem-familia",f=i.familia||"Sem Família",b=i.id_indicador||i.id;if(!b)return;z.has(y)||z.set(y,new Map);const _=z.get(y);if(_.has(b)){const m=_.get(b);m.meta=(m.meta||0)+(i.meta||0),m.realizado=(m.realizado||0)+(i.realizado||0),m.pontos=(m.pontos||0)+(i.pontos||0),m.pontosMeta=(m.pontosMeta||0)+(i.pontos_meta||i.peso||0),i.ultima_atualizacao&&(!m.ultimaAtualizacao||i.ultima_atualizacao>m.ultimaAtualizacao)&&(m.ultimaAtualizacao=i.ultima_atualizacao);const r=m.meta||0,h=m.realizado||0;m.ating=r>0?h/r:0,m.atingido=r>0?h/r>=1:!1}else{const m=i.meta||0,r=i.realizado||0,h={id:b,nome:i.indicador||"Indicador",familiaId:y,familiaNome:f,indicadorId:b,indicadorNome:i.indicador||"Indicador",metrica:i.metrica||"valor",peso:i.peso||0,pontosMeta:i.pontos_meta||i.peso||0,meta:m,realizado:r,pontos:i.pontos||0,atingido:m>0?r/m>=1:!1,ating:m>0?r/m:0,ultimaAtualizacao:i.ultima_atualizacao};_.set(b,h)}}),Array.from(z.entries()).map(([i,y])=>{const f=Array.from(y.values()),b=f.reduce((t,s)=>t+(s.pontosMeta||0),0),_=f.reduce((t,s)=>t+Math.max(0,s.pontos||0),0),m=f.reduce((t,s)=>t+(s.meta||0),0),r=f.reduce((t,s)=>t+(s.realizado||0),0),h=m>0?r/m*100:0;return{id:i,label:f[0]?.familiaNome||"Sem Família",items:f,totals:{pontosTotal:b,pontosHit:_,metaTotal:m,realizadoTotal:r,atingPct:h}}})});return{produtos:u.produtos,produtosPorFamilia:$,loading:u.loading,error:u.error,loadProdutos:u.loadResumo,produtoFilters:v}}function Ia(l,c){const{produtosPorFamilia:u}=ca(l,c),v=ia(l,c),$=T(()=>{const i=v.variavel.value||[];if(!i.length)return{varPossivel:null,varAtingido:null};const y=i.reduce((f,b)=>{const _=Number(b.variavel_meta)||0,m=Number(b.variavel_real)||0;return f.meta+=_,f.real+=m,f},{meta:0,real:0});return{varPossivel:y.meta,varAtingido:y.real}});return{summary:T(()=>{const i=u.value||[];let y=0,f=0,b=0,_=0;return i.forEach(m=>{m.items.forEach(r=>{f++,r.atingido&&y++;const h=r.pontosMeta||0,t=Math.max(0,r.pontos||0);_+=h,b+=Math.min(t,h)})}),{indicadoresAtingidos:y,indicadoresTotal:f,pontosAtingidos:b,pontosPossiveis:_,varPossivel:$.value.varPossivel,varAtingido:$.value.varAtingido}})}}const Da={id:"kpi-summary",class:"kpi-summary"},Ea={key:0,class:"kpi-pill"},Ba={class:"kpi-strip__main"},La={class:"kpi-icon"},ja={class:"kpi-strip__text"},Ha={class:"kpi-strip__stats"},qa={class:"kpi-stat"},Ua={class:"kpi-stat"},Ga=["aria-valuenow","aria-label","aria-valuetext"],Ka={class:"hitbar__thumb"},Oa={class:"hitbar__pct"},Qa={key:1,class:"kpi-pill"},Wa={class:"kpi-strip__main"},Ja={class:"kpi-icon"},Xa={class:"kpi-strip__text"},Ya={class:"kpi-strip__stats"},Za={class:"kpi-stat"},as={class:"kpi-stat"},ss=["aria-valuenow"],es={class:"hitbar__thumb"},ts={class:"hitbar__pct"},os={class:"kpi-pill"},is={class:"kpi-strip__main"},ls={class:"kpi-icon"},ns={class:"kpi-strip__text"},rs={class:"kpi-strip__stats"},ds={class:"kpi-stat"},cs={class:"kpi-stat"},us=["aria-valuenow","aria-valuetext"],_s={class:"hitbar__thumb"},ms={class:"hitbar__pct"},ps=Q({__name:"ResumoKPI",setup(l){const{filterState:c,period:u}=J(),{summary:v}=Ia(c,u),$=(b,_)=>b==="brl"?ka(_):b==="pts"?F(_):xa(_),z=b=>b<50?"hitbar--low":b<100?"hitbar--warn":"hitbar--ok",i=T(()=>v.value.indicadoresTotal===0?0:v.value.indicadoresAtingidos/v.value.indicadoresTotal*100),y=T(()=>v.value.pontosPossiveis===0?0:v.value.pontosAtingidos/v.value.pontosPossiveis*100),f=T(()=>{const b=v.value.varPossivel??0,_=v.value.varAtingido??0;if(b===0||!Number.isFinite(b)||!Number.isFinite(_))return 0;const m=_/b*100;return Math.max(0,Math.min(100,m))});return(b,_)=>(x(),k("div",Da,[n(v).indicadoresTotal>0||n(v).pontosPossiveis>0?(x(),k("div",Ea,[a("div",Ba,[a("span",La,[S(U,{name:"list-check",size:22})]),a("div",ja,[_[2]||(_[2]=a("span",{class:"kpi-strip__label"},"Indicadores",-1)),a("div",Ha,[a("span",qa,[_[0]||(_[0]=B(" Atg: ",-1)),a("strong",null,d($("int",n(v).indicadoresAtingidos)),1)]),a("span",Ua,[_[1]||(_[1]=B(" Total: ",-1)),a("strong",null,d($("int",n(v).indicadoresTotal)),1)])])])]),a("div",{class:R(["hitbar",z(i.value)]),role:"progressbar","aria-valuenow":i.value,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Atingimento de indicadores: ${i.value.toFixed(1)}%`,"aria-valuetext":`${i.value.toFixed(1)}% (${n(v).indicadoresAtingidos} de ${n(v).indicadoresTotal} indicadores)`},[a("span",{class:"hitbar__track",style:O({"--target":`${i.value.toFixed(2)}%`,"--thumb":`${i.value.toFixed(2)}%`})},[_[3]||(_[3]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Ka,[a("span",Oa,d(i.value.toFixed(1))+"%",1)])],4)],10,Ga)])):q("",!0),n(v).pontosPossiveis>0?(x(),k("div",Qa,[a("div",Wa,[a("span",Ja,[S(U,{name:"medal",size:22})]),a("div",Xa,[_[6]||(_[6]=a("span",{class:"kpi-strip__label"},"Pontos",-1)),a("div",Ya,[a("span",Za,[_[4]||(_[4]=B(" Atg: ",-1)),a("strong",null,d($("pts",n(v).pontosAtingidos)),1)]),a("span",as,[_[5]||(_[5]=B(" Total: ",-1)),a("strong",null,d($("pts",n(v).pontosPossiveis)),1)])])])]),a("div",{class:R(["hitbar",z(y.value)]),role:"progressbar","aria-valuenow":y.value,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:O({"--target":`${y.value.toFixed(2)}%`,"--thumb":`${y.value.toFixed(2)}%`})},[_[7]||(_[7]=a("span",{class:"hitbar__fill"},null,-1)),a("span",es,[a("span",ts,d(y.value.toFixed(1))+"%",1)])],4)],10,ss)])):q("",!0),a("div",os,[a("div",is,[a("span",ls,[S(U,{name:"cash",size:22})]),a("div",ns,[_[10]||(_[10]=a("span",{class:"kpi-strip__label"},[B(" Variável "),a("span",{class:"kpi-label-emphasis"},"Estimada")],-1)),a("div",rs,[a("span",ds,[_[8]||(_[8]=B(" Atg: ",-1)),a("strong",null,d($("brl",n(v).varAtingido||0)),1)]),a("span",cs,[_[9]||(_[9]=B(" Total: ",-1)),a("strong",null,d($("brl",n(v).varPossivel||0)),1)])])])]),a("div",{class:R(["hitbar",z(f.value)]),role:"progressbar","aria-valuenow":f.value,"aria-valuetext":`Variável Estimada: ${f.value.toFixed(1)}%`,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:O({"--target":`${Math.max(0,Math.min(100,f.value)).toFixed(2)}%`,"--thumb":`${Math.max(0,Math.min(100,f.value)).toFixed(2)}%`})},[_[11]||(_[11]=a("span",{class:"hitbar__fill"},null,-1)),a("span",_s,[a("span",ms,d(f.value.toFixed(1))+"%",1)])],4)],10,us)])]))}}),vs=W(ps,[["__scopeId","data-v-4c8697b0"]]);function gs(){const l=I([]),{filterState:c,period:u}=J(),v=ia(c,u),$=async()=>{await v.loadResumo()},z=T(()=>v.businessSnapshot.value);return{calendario:l,loading:v.loading,loadCalendario:$,getCurrentMonthBusinessSnapshot:z}}const hs={id:"grid-familias"},fs={key:0,class:"produtos-skeleton"},ys={key:0,class:"error-state"},bs={class:"fam-section__header"},$s={class:"fam-section__title"},ks={key:0,class:"fam-section__meta"},xs=["title"],ws={class:"fam-section__grid"},Ms=["data-prod-id","data-familia-id","data-familia-label","aria-label","onKeydown"],zs={class:"prod-card__title"},As=["title"],Ps=["aria-label","title","onMouseenter","onClick","onTouchstart"],Fs={class:"prod-card__meta"},Rs={class:"pill"},Ts={class:"pill"},Ns={class:"pill"},Ss={class:"prod-card__kpis"},Cs={class:"kv"},Vs=["title"],Is={class:"kv"},Ds=["title"],Es={class:"prod-card__var"},Bs={class:"prod-card__var-body"},Ls=["title"],js=["data-ratio","aria-valuenow","aria-label","aria-valuetext"],Hs=["title"],qs={class:"prod-card__var-value"},Us={class:"prod-card__foot"},Gs={key:0,class:"kpi-tip is-open",role:"dialog","aria-label":"Detalhes do indicador"},Ks={class:"row"},Os={class:"row"},Qs={class:"row"},Ws={class:"row"},Js={class:"row"},Xs={class:"row"},Ys={class:"row"},Zs={key:2,class:"empty-state"},ae=Q({__name:"ProdutosCards",setup(l){const{filterState:c,period:u}=J(),{produtosPorFamilia:v,loading:$,error:z}=ca(c,u),{getCurrentMonthBusinessSnapshot:i}=gs(),{loadCalendario:y}=za(),f=I(null);ea(async()=>{await y()});const b=g=>{const e=p=>{p.target.closest(".prod-card")||g()};ea(()=>{document.addEventListener("click",e)}),ua(()=>{document.removeEventListener("click",e)})},_=g=>{const e=p=>{p.key==="Escape"&&g()};ea(()=>{document.addEventListener("keydown",e)}),ua(()=>{document.removeEventListener("keydown",e)})};b(()=>{f.value=null}),_(()=>{f.value=null});const m=(g,e)=>{Number.isFinite(e)||(e=0);const p=g?.toLowerCase()||"valor";return p==="perc"?`${e.toFixed(1)}%`:p==="qtd"?new Intl.NumberFormat("pt-BR",{maximumFractionDigits:0}).format(Math.round(e)):Ma(Math.round(e))},r=g=>{const e=i.value,{total:p,elapsed:o,remaining:w}=e;let H=g.meta||0;const X=g.realizado||0;g.metrica?.toLowerCase()==="perc"&&(H=100);const Y=Math.max(0,H-X),la=w>0?Y/w:0,G=(o>0?X/o:0)*(p||0),sa=p>0?H/p*o:0;return{diasTotais:p,diasDecorridos:o,diasRestantes:w,faltaTotal:m(g.metrica||"valor",Y),necessarioPorDia:w>0?m(g.metrica||"valor",la):"—",referenciaHoje:o>0?m(g.metrica||"valor",sa):"—",projecaoRitmoAtual:m(g.metrica||"valor",G)}},h=(g,e)=>{const p=g.closest(".prod-card");if(!p)return;const o=g.getBoundingClientRect(),w=p.getBoundingClientRect(),H=e.offsetWidth||320,X=e.offsetHeight||200,Y=window.innerWidth,la=window.innerHeight;let na=o.bottom-w.top+8;o.bottom+X+12>la&&(na=o.top-w.top-X-8);let G=w.width-H-12;const sa=w.left+G;sa<12&&(G=12),sa+H>Y-12&&(G=Math.max(12,Y-12-w.left-H)),e.style.top=`${na}px`,e.style.left=`${G}px`},t=(g,e)=>{e.stopPropagation(),f.value=g,requestAnimationFrame(()=>{const p=document.querySelector(`[data-prod-id="${g}"]`);if(!p)return;const o=p.querySelector(".badge"),w=p.querySelector(".kpi-tip");o&&w&&h(o,w)})},s=()=>{f.value=null},N=(g,e)=>{e.stopPropagation(),f.value===g?s():t(g,e)},P=g=>g<50?"badge--low":g<100?"badge--warn":"badge--ok",V=g=>g<50?"var--low":g<100?"var--warn":"var--ok",M=g=>{const e=g.meta||0,p=g.realizado||0;return e<=0?0:p/e*100},A=g=>{const e=g.pontosMeta||0,p=g.pontos||0;return e>0?p/e*100:0},C=g=>{if(!g)return"Valor";const e=g.toLowerCase();return e==="valor"?"Valor":e==="qtd"||e==="quantidade"?"Quantidade":"Percentual"};return(g,e)=>(x(),k("div",hs,[n($)?(x(),k("div",fs,[...e[0]||(e[0]=[ya('<div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-e8be31a6></div><div class="cards-grid" data-v-e8be31a6><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div></div><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin:32px 0 16px;border-radius:6px;" data-v-e8be31a6></div><div class="cards-grid" data-v-e8be31a6><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-e8be31a6></div></div>',4)])])):(x(),k(j,{key:1},[n(z)?(x(),k("div",ys,[a("p",null,d(n(z)),1)])):n(v).length>0?(x(!0),k(j,{key:1},aa(n(v),p=>(x(),k("div",{key:p.id,class:"fam-section"},[a("header",bs,[a("div",$s,[a("span",null,d(p.label),1),p.totals?(x(),k("small",ks,[a("span",{class:"fam-section__meta-item",title:`Pontos: ${n(F)(p.totals.pontosHit,{withUnit:!0})} / ${n(F)(p.totals.pontosTotal,{withUnit:!0})}`}," Pontos: "+d(n(F)(p.totals.pontosHit))+" / "+d(n(F)(p.totals.pontosTotal)),9,xs)])):q("",!0)])]),a("div",ws,[(x(!0),k(j,null,aa(p.items,o=>(x(),k("article",{key:o.id,class:R(["prod-card",{"is-tip-open":f.value===o.id}]),"data-prod-id":o.id,"data-familia-id":o.familiaId,"data-familia-label":o.familiaNome,role:"article","aria-label":`Produto: ${o.nome}`,tabindex:"0",onMouseleave:s,onKeydown:[ra(_a(w=>t(o.id,w),["prevent"]),["enter"]),ra(_a(w=>t(o.id,w),["prevent"]),["space"]),ra(s,["escape"])]},[a("div",zs,[S(U,{name:"chart-line",size:22,color:"#b30000",class:"prod-card__icon"}),a("span",{class:"prod-card__name has-ellipsis",title:o.nome},d(o.nome),9,As),a("span",{class:R(["badge",P(M(o))]),"aria-label":`Atingimento: ${M(o).toFixed(1)}%`,title:`${M(o).toFixed(1)}%`,onMouseenter:w=>{w.stopPropagation(),t(o.id,w)},onClick:w=>{w.stopPropagation(),N(o.id,w)},onTouchstart:w=>{w.stopPropagation(),N(o.id,w)}},d(M(o)>=100?`${Math.round(M(o))}%`:`${M(o).toFixed(1)}%`),43,Ps)]),a("div",Fs,[a("span",Rs," Pontos: "+d(n(F)(o.pontos||0))+" / "+d(n(F)(o.pontosMeta||0)),1),a("span",Ts,"Peso: "+d(n(wa)(o.peso||0)),1),a("span",Ns,d(C(o.metrica)),1)]),a("div",Ss,[a("div",Cs,[e[1]||(e[1]=a("small",null,"Meta",-1)),a("strong",{class:"has-ellipsis",title:n(L)(o.metrica,o.meta)},d(n(E)(o.metrica,o.meta)),9,Vs)]),a("div",Is,[e[2]||(e[2]=a("small",null,"Realizado",-1)),a("strong",{class:"has-ellipsis",title:n(L)(o.metrica,o.realizado)},d(n(E)(o.metrica,o.realizado)),9,Ds)])]),a("div",Es,[e[3]||(e[3]=a("div",{class:"prod-card__var-head"},[a("small",null,"Atingimento de pontos")],-1)),a("div",Bs,[a("span",{class:"prod-card__var-goal",title:n(F)(o.pontosMeta||0,{withUnit:!0})},d(n(F)(o.pontosMeta||0,{withUnit:!0})),9,Ls),a("div",{class:R(["prod-card__var-track",V(A(o))]),"data-ratio":A(o).toFixed(2),role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":Math.round(A(o)),"aria-label":`Atingimento de pontos: ${A(o).toFixed(1)}%`,"aria-valuetext":`${A(o).toFixed(1)}% (${n(F)(o.pontos||0)} de ${n(F)(o.pontosMeta||0)})`},[a("span",{class:"prod-card__var-fill",style:O({"--target":`${A(o)}%`})},null,4),a("span",{class:"prod-card__var-label",style:O({"--target":`${A(o)}%`}),title:`Atingido: ${n(F)(o.pontos||0,{withUnit:!0})} · ${A(o).toFixed(1)}%`},[a("span",qs,d(A(o).toFixed(1))+"%",1)],12,Hs)],10,js)])]),a("div",Us," Atualizado em "+d(o.ultimaAtualizacao||"N/A"),1),f.value===o.id?(x(),k("div",Gs,[r(o)?(x(),k(j,{key:0},[e[11]||(e[11]=a("h5",null,"Projeção e metas",-1)),a("div",Ks,[e[4]||(e[4]=a("span",null,"Quantidade de dias úteis no mês",-1)),a("span",null,d(new Intl.NumberFormat("pt-BR").format(r(o).diasTotais)),1)]),a("div",Os,[e[5]||(e[5]=a("span",null,"Dias úteis trabalhados",-1)),a("span",null,d(new Intl.NumberFormat("pt-BR").format(r(o).diasDecorridos)),1)]),a("div",Qs,[e[6]||(e[6]=a("span",null,"Dias úteis que faltam",-1)),a("span",null,d(new Intl.NumberFormat("pt-BR").format(r(o).diasRestantes)),1)]),a("div",Ws,[e[7]||(e[7]=a("span",null,"Falta para a meta",-1)),a("span",null,d(r(o).faltaTotal),1)]),a("div",Js,[e[8]||(e[8]=a("span",null,"Referência para hoje",-1)),a("span",null,d(r(o).referenciaHoje),1)]),a("div",Xs,[e[9]||(e[9]=a("span",null,"Meta diária necessária",-1)),a("span",null,d(r(o).necessarioPorDia),1)]),a("div",Ys,[e[10]||(e[10]=a("span",null,"Projeção (ritmo atual)",-1)),a("span",null,d(r(o).projecaoRitmoAtual),1)])],64)):q("",!0)])):q("",!0)],42,Ms))),128))])]))),128)):(x(),k("div",Zs,[...e[12]||(e[12]=[a("p",null,"Nenhum produto encontrado",-1)])]))],64))]))}}),se=W(ae,[["__scopeId","data-v-e8be31a6"]]);function ee(){const{filterState:l,period:c}=J(),u=ia(l,c),v=u.produtosMensais,$=u.loading,z=u.error,i=u.businessSnapshot,y=T(()=>{const f=new Map;v.value.forEach(s=>{const N=s.id_familia||"sem-familia",P=s.id_indicador||s.id;if(!P)return;f.has(N)||f.set(N,new Map);const V=f.get(N);if(V.has(P)){const M=V.get(P);!M.peso&&s.peso&&(M.peso=Number(s.peso)||0,M.pontosMeta=Number(s.pontos_meta??s.peso)||0),M.meta=(M.meta||0)+(s.meta||0),M.realizado=(M.realizado||0)+(s.realizado||0);const A=new Map;M.months.forEach(e=>{A.set(e.mes,{meta:e.meta,realizado:e.realizado})}),s.meses.forEach(e=>{const p=A.get(e.mes)||{meta:0,realizado:0};A.set(e.mes,{meta:p.meta+e.meta,realizado:p.realizado+e.realizado})}),M.months=Array.from(A.entries()).map(([e,p])=>({mes:e,meta:p.meta,realizado:p.realizado,atingimento:p.meta>0?p.realizado/p.meta*100:0}));const C=new Date().toISOString().slice(0,7),g=M.months.find(e=>e.mes===C);if(M.monthMeta=g?.meta||0,M.monthReal=g?.realizado||0,s.id_subindicador&&s.subindicador){M.children||(M.children=[]);const e={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:g?.meta||0,monthReal:g?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};M.children.push(e)}}else{const M=new Date().toISOString().slice(0,7),A=s.meses.find(g=>g.mes===M),C={id:P,nome:s.indicador||"Indicador",metrica:s.metrica||"valor",peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:A?.meta||0,monthReal:A?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses,children:[]};if(s.id_subindicador&&s.subindicador){const g={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:A?.meta||0,monthReal:A?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};C.children.push(g)}V.set(P,C)}});const b=new Map;v.value.forEach(s=>{s.id_familia&&!b.has(s.id_familia)&&b.set(s.id_familia,s.familia||"Sem Família")});const _=i.value,m=_.total||1,r=_.elapsed||0,h=_.remaining||0,t=s=>{const N=s.meta||0,P=s.realizado||0,V=s.pontosMeta||s.peso||0,M=m>0?N/m*r:0,A=Math.max(0,N-P),C=h>0?A/h:0,g=r>0?P/r*h+P:P;let e,p;s.pontosBackend!==void 0?(e=s.pontosBackend,p=e):(p=Math.min(V,P),e=Math.max(0,Math.min(V,p)));const o=N>0?P/N:0,w={...s,referenciaHoje:M,projecao:g,metaDiariaNecessaria:C,pontos:e,pontosBrutos:p,ating:o};return s.children&&s.children.length>0&&(w.children=s.children.map(t)),w};return Array.from(f.entries()).map(([s,N])=>{const P=Array.from(N.values()).map(t),V=P.reduce((e,p)=>e+(p.pontosMeta||0),0),M=P.reduce((e,p)=>e+(p.pontos||0),0),A=P.reduce((e,p)=>e+(p.meta||0),0),C=P.reduce((e,p)=>e+(p.realizado||0),0),g=A>0?C/A*100:0;return{id:s,label:b.get(s)||"Sem Família",items:P,totals:{pontosTotal:V,pontosHit:M,metaTotal:A,realizadoTotal:C,atingPct:g}}})});return{produtos:v,produtosPorFamilia:y,loading:$,error:z,loadProdutos:u.loadResumo}}const te={class:"resumo-legacy"},oe={key:0,class:"resumo-legacy__loading"},ie={key:1,class:"resumo-legacy__error"},le={key:2,class:"resumo-legacy__empty"},ne={class:"resumo-legacy__head"},re={class:"resumo-legacy__heading"},de={class:"resumo-legacy__title-row"},ce={class:"resumo-legacy__name"},ue={class:"resumo-legacy__section-actions"},_e=["disabled","onClick"],me={class:"resumo-legacy__section-toggle-label"},pe={class:"resumo-legacy__chips"},ve={class:"resumo-legacy__chip"},ge=["title"],he={class:"resumo-legacy__stats"},fe={class:"resumo-legacy__stat"},ye={class:"resumo-legacy__stat-value"},be={key:0,class:"resumo-legacy__stat"},$e={class:"resumo-legacy__stat-value"},ke={class:"resumo-legacy__stat"},xe={class:"resumo-legacy__stat-value"},we={class:"resumo-legacy__table-wrapper"},Me={class:"resumo-legacy__table"},ze=["data-row-id"],Ae={class:"resumo-legacy__col--prod"},Pe={class:"resumo-legacy__prod"},Fe=["aria-expanded","onClick"],Re=["title"],Te={key:1,class:"resumo-legacy__prod-name-wrapper"},Ne=["title"],Se={class:"resumo-legacy__col--peso"},Ce=["title"],Ve=["title"],Ie=["title"],De=["title"],Ee=["title"],Be=["title"],Le=["title"],je={class:"resumo-legacy__col--ating"},He={class:"resumo-legacy__ating",title:"Atingimento"},qe=["aria-valuenow"],Ue={class:"resumo-legacy__ating-value"},Ge={class:"resumo-legacy__col--update"},Ke=["data-row-id"],Oe={class:"resumo-legacy__col--prod"},Qe={class:"resumo-legacy__prod"},We=["title"],Je=["title"],Xe=["title"],Ye=["title"],Ze={class:"resumo-legacy__col--update"},at=Q({__name:"ResumoLegacy",setup(l){const{filterState:c,period:u}=J();ca(c,u);const{produtosPorFamilia:v,loading:$,error:z}=ee(),i=I(new Set),y=I(new Set),f=m=>{i.value.has(m)?i.value.delete(m):i.value.add(m)},b=m=>{y.value.has(m)?y.value.delete(m):y.value.add(m)},_=m=>m.items.some(r=>r.children&&r.children.length>0);return(m,r)=>(x(),k("div",te,[n($)?(x(),k("div",oe," Carregando... ")):n(z)?(x(),k("div",ie," Erro: "+d(n(z)),1)):!n(v)||n(v).length===0?(x(),k("div",le," Nenhum dado disponível ")):(x(!0),k(j,{key:3},aa(n(v),h=>(x(),k("section",{key:h.id,class:"resumo-legacy__section resumo-legacy__section--annual card card--legacy"},[a("header",ne,[a("div",re,[a("div",de,[a("span",ce,d(h.label),1),a("div",ue,[a("button",{type:"button",class:R(["resumo-legacy__section-toggle",{"is-disabled":!_(h)},{"is-expanded":y.value.has(h.id)}]),disabled:!_(h),onClick:t=>b(h.id)},[S(U,{name:"filter",size:16}),a("span",me,d(y.value.has(h.id)?"Recolher filtros":"Abrir todos os filtros"),1)],10,_e)])]),a("div",pe,[a("span",ve,[S(U,{name:"box-multiple",size:16}),B(" "+d(n(Z)(h.items.length||0))+" indicadores ",1)]),a("span",{class:"resumo-legacy__chip",title:`Pontos: ${n(F)(h.totals.pontosHit,{withUnit:!0})} / ${n(F)(h.totals.pontosTotal,{withUnit:!0})}`}," Pontos "+d(n(Z)(Math.round(h.totals.pontosHit)))+" / "+d(n(Z)(Math.round(h.totals.pontosTotal))),9,ge)])]),a("div",he,[a("div",fe,[r[0]||(r[0]=a("span",{class:"resumo-legacy__stat-label"},"Peso total",-1)),a("strong",ye,d(n(Z)(Math.round(h.totals.pontosTotal))),1)]),h.totals.realizadoTotal>0?(x(),k("div",be,[r[1]||(r[1]=a("span",{class:"resumo-legacy__stat-label"},"Realizado",-1)),a("strong",$e,d(n(E)("valor",h.totals.realizadoTotal)),1)])):q("",!0),a("div",ke,[r[2]||(r[2]=a("span",{class:"resumo-legacy__stat-label"},"Atingimento",-1)),a("strong",xe,d(h.totals.metaTotal>0?`${Math.max(0,Math.min(200,h.totals.atingPct)).toFixed(1)}%`:"—"),1)])])]),a("div",we,[a("table",Me,[r[10]||(r[10]=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Subindicador"),a("th",{scope:"col",class:"resumo-legacy__col--peso"},"Peso"),a("th",{scope:"col"},"Métrica"),a("th",{scope:"col",class:"resumo-legacy__col--meta"},"Meta"),a("th",{scope:"col",class:"resumo-legacy__col--real"},"Realizado"),a("th",{scope:"col",class:"resumo-legacy__col--ref"},"Ref. do dia"),a("th",{scope:"col",class:"resumo-legacy__col--forecast"},"Forecast"),a("th",{scope:"col",class:"resumo-legacy__col--meta-dia"},"Meta diária nec."),a("th",{scope:"col",class:"resumo-legacy__col--pontos"},"Pontos"),a("th",{scope:"col",class:"resumo-legacy__col--ating"},"Ating."),a("th",{scope:"col",class:"resumo-legacy__col--update"},"Atualização")])],-1)),a("tbody",null,[(x(!0),k(j,null,aa(h.items,t=>(x(),k(j,{key:t.id},[a("tr",{class:R(["resumo-legacy__row",{"is-expanded":i.value.has(`${h.id}-${t.id}`)||y.value.has(h.id)}]),"data-row-id":`${h.id}-${t.id}`},[a("td",Ae,[a("div",Pe,[t.children&&t.children.length>0?(x(),k("button",{key:0,type:"button",class:"resumo-legacy__prod-toggle","aria-expanded":i.value.has(`${h.id}-${t.id}`)||y.value.has(h.id),onClick:s=>f(`${h.id}-${t.id}`)},[S(U,{name:"chevron-right",class:R(["resumo-legacy__prod-toggle-icon",{"is-expanded":i.value.has(`${h.id}-${t.id}`)||y.value.has(h.id)}]),size:16},null,8,["class"]),a("span",{class:"resumo-legacy__prod-name",title:t.nome},d(t.nome),9,Re)],8,Fe)):(x(),k("div",Te,[r[3]||(r[3]=a("span",{class:"resumo-legacy__prod-toggle-icon resumo-legacy__prod-toggle-icon--placeholder","aria-hidden":"true"},null,-1)),a("span",{class:"resumo-legacy__prod-name",title:t.nome},d(t.nome),9,Ne)]))])]),a("td",Se,d(n(Z)(t.pontosMeta||t.peso||0)),1),a("td",null,[a("span",{class:R(["resumo-legacy__metric",`resumo-legacy__metric--${t.metrica==="valor"?"valor":t.metrica==="qtd"?"qtd":t.metrica==="perc"?"perc":""}`]),title:`Métrica: ${t.metrica}`},d(t.metrica==="valor"?"Valor":t.metrica==="qtd"?"Quantidade":t.metrica==="perc"?"Percentual":t.metrica),11,Ce)]),a("td",{class:"resumo-legacy__col--meta",title:n(L)(t.metrica,t.meta)},d(n(E)(t.metrica,t.meta)),9,Ve),a("td",{class:"resumo-legacy__col--real",title:n(L)(t.metrica,t.realizado)},d(n(E)(t.metrica,t.realizado)),9,Ie),a("td",{class:"resumo-legacy__col--ref",title:n(L)(t.metrica,t.referenciaHoje)},d(t.referenciaHoje!=null?n(E)(t.metrica,t.referenciaHoje):"—"),9,De),a("td",{class:"resumo-legacy__col--forecast",title:n(L)(t.metrica,t.projecao)},d(t.projecao!=null?n(E)(t.metrica,t.projecao):"—"),9,Ee),a("td",{class:"resumo-legacy__col--meta-dia",title:n(L)(t.metrica,t.metaDiariaNecessaria)},d(t.metaDiariaNecessaria!=null?n(E)(t.metrica,t.metaDiariaNecessaria):"—"),9,Be),a("td",{class:"resumo-legacy__col--pontos",title:n(F)(t.pontos,{withUnit:!0})},d(n(F)(t.pontos,{withUnit:!0})),9,Le),a("td",je,[a("div",He,[a("div",{class:R(["resumo-legacy__ating-meter",(t.ating||0)>=1?"is-ok":(t.ating||0)>=.5?"is-warn":"is-low"]),style:O({"--fill":Math.max(0,Math.min(1,t.ating||0))}),role:"progressbar","aria-valuemin":0,"aria-valuemax":200,"aria-valuenow":Math.max(0,Math.min(200,(t.ating||0)*100))},[a("span",Ue,d(t.meta>0?`${Math.max(0,Math.min(200,(t.ating||0)*100)).toFixed(1)}%`:"—"),1)],14,qe)])]),a("td",Ge,d(t.ultimaAtualizacao?t.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?n(ma)(t.ultimaAtualizacao):t.ultimaAtualizacao:"—"),1)],10,ze),t.children&&t.children.length>0?(x(!0),k(j,{key:0},aa(t.children,s=>(x(),k("tr",{key:s.id,class:R(["resumo-legacy__row resumo-legacy__row--child",{"is-visible":i.value.has(`${h.id}-${t.id}`)||y.value.has(h.id)}]),"data-row-id":`${h.id}-${t.id}-${s.id}`},[a("td",Oe,[a("div",Qe,[a("span",{class:"resumo-legacy__prod-name resumo-legacy__prod-name--child",title:s.nome},d(s.nome),9,We)])]),r[4]||(r[4]=a("td",{class:"resumo-legacy__col--peso"}," — ",-1)),a("td",null,[a("span",{class:R(["resumo-legacy__metric",`resumo-legacy__metric--${s.metrica==="valor"?"valor":s.metrica==="qtd"?"qtd":s.metrica==="perc"?"perc":""}`]),title:`Métrica: ${s.metrica}`},d(s.metrica==="valor"?"Valor":s.metrica==="qtd"?"Quantidade":s.metrica==="perc"?"Percentual":s.metrica),11,Je)]),r[5]||(r[5]=a("td",{class:"resumo-legacy__col--meta"}," — ",-1)),a("td",{class:"resumo-legacy__col--real",title:n(L)(s.metrica,s.realizado)},d(n(E)(s.metrica,s.realizado)),9,Xe),r[6]||(r[6]=a("td",{class:"resumo-legacy__col--ref"}," — ",-1)),r[7]||(r[7]=a("td",{class:"resumo-legacy__col--forecast"}," — ",-1)),r[8]||(r[8]=a("td",{class:"resumo-legacy__col--meta-dia"}," — ",-1)),a("td",{class:"resumo-legacy__col--pontos",title:n(F)(s.pontos,{withUnit:!0})},d("-"),8,Ye),r[9]||(r[9]=a("td",{class:"resumo-legacy__col--ating"}," — ",-1)),a("td",Ze,d(s.ultimaAtualizacao?s.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?n(ma)(s.ultimaAtualizacao):s.ultimaAtualizacao:"—"),1)],10,Ke))),128)):q("",!0)],64))),128))])])])]))),128))]))}}),st=W(at,[["__scopeId","data-v-e5f7ff11"]]),et={id:"view-cards",class:"view-section"},tt={id:"resumo-summary",class:"resumo-summary"},ot=Q({__name:"ResumoView",setup(l){const c=I("cards");return(u,v)=>(x(),k("section",et,[S(Sa,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=$=>c.value=$)},null,8,["modelValue"]),a("div",tt,[S(vs)]),a("div",{id:"resumo-cards",class:R(["resumo-mode__view",{hidden:c.value!=="cards"}])},[S(se)],2),a("div",{id:"resumo-legacy",class:R(["resumo-mode__view",{hidden:c.value!=="legacy"}]),"aria-live":"polite"},[S(st)],2)]))}}),it=W(ot,[["__scopeId","data-v-2c87ba87"]]),lt={class:"home-wrapper"},nt=Q({__name:"Home",setup(l){return(c,u)=>(x(),k("div",lt,[S(it)]))}}),ht=W(nt,[["__scopeId","data-v-904e3431"]]);export{ht as default};
