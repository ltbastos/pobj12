import{b as K,r as X,w as _a,y as aa,m as y,q as a,k as P,o as h,e as E,j,u as l,t as N,C as I,E as r,L as U,M as ia,F as D,g as ra,D as J,A as na,v as oa,B as da}from"./vendor.iNPlSTaR.js";import{_ as Q,I as L}from"./index.CzyV3kJY.js";import{u as sa}from"./useResumoData.CqGGzpQw.js";import{u as Y,f as ca}from"./useGlobalFilters.BzbMdXpC.js";import{f as ma,a as F,b as pa,E as va,c as ga,d as B,e as C,g as ha,h as G}from"./EmptyState.vue_vue_type_style_index_0_scoped_9c857fd5_lang.BGePB7Pa.js";import{u as fa}from"./useBusinessDays.93bdBjm8.js";import{u as ya}from"./useCalendarioCache.BAHZ6dUm.js";import{E as ba}from"./EmptyState.DE1pgZeF.js";import"./pdf-vendor.jXUlHPMi.js";import"./icons-vendor.pg7b-e9c.js";import"./vue-router.BQVFLPdy.js";const $a={class:"resumo-mode"},ka={class:"resumo-mode__toggle",role:"group","aria-label":"Alterar visão do resumo"},xa={class:"segmented"},wa=["aria-pressed"],Ma=["aria-pressed"],za=K({__name:"ResumoModeToggle",props:{modelValue:{}},emits:["update:modelValue"],setup(R,{emit:M}){const b=R,v=M,k=X(b.modelValue||"cards");_a(()=>b.modelValue,o=>{o&&(o==="cards"||o==="legacy")&&(k.value=o)});const z=o=>{k.value=o,v("update:modelValue",o),typeof window<"u"&&localStorage.setItem("resumo-mode",o)};return aa(()=>{if(typeof window<"u"&&!b.modelValue){const o=localStorage.getItem("resumo-mode");o&&(o==="cards"||o==="legacy")&&(k.value=o,v("update:modelValue",o))}else b.modelValue&&(k.value=b.modelValue)}),(o,p)=>(h(),y("div",$a,[a("div",ka,[a("div",xa,[a("button",{type:"button",class:P(["seg-btn",{"is-active":k.value==="cards"}]),"aria-pressed":k.value==="cards",onClick:p[0]||(p[0]=g=>z("cards"))}," Visão por cards ",10,wa),a("button",{type:"button",class:P(["seg-btn",{"is-active":k.value==="legacy"}]),"aria-pressed":k.value==="legacy",onClick:p[1]||(p[1]=g=>z("legacy"))}," Visão clássica ",10,Ma)])])]))}}),ua=Q(za,[["__scopeId","data-v-446d22e4"]]);function la(R,M){const b=sa(R,M),v=E(()=>b.buildFilters()),k=E(()=>{const z=new Map;return b.produtos.value.forEach(o=>{const p=o.id_familia||"sem-familia",g=o.familia||"Sem Família",f=o.id_indicador||o.id;if(!f)return;z.has(p)||z.set(p,new Map);const c=z.get(p);if(c.has(f)){const _=c.get(f);_.meta=(_.meta||0)+(o.meta||0),_.realizado=(_.realizado||0)+(o.realizado||0),_.pontos=(_.pontos||0)+(o.pontos||0),_.pontosMeta=(_.pontosMeta||0)+(o.pontos_meta||o.peso||0),o.ultima_atualizacao&&(!_.ultimaAtualizacao||o.ultima_atualizacao>_.ultimaAtualizacao)&&(_.ultimaAtualizacao=o.ultima_atualizacao);const n=_.meta||0,m=_.realizado||0;_.ating=n>0?m/n:0,_.atingido=n>0?m/n>=1:!1}else{const _=o.meta||0,n=o.realizado||0,m={id:f,nome:o.indicador||"Indicador",familiaId:p,familiaNome:g,indicadorId:f,indicadorNome:o.indicador||"Indicador",metrica:o.metrica||"valor",peso:o.peso||0,pontosMeta:o.pontos_meta||o.peso||0,meta:_,realizado:n,pontos:o.pontos||0,atingido:_>0?n/_>=1:!1,ating:_>0?n/_:0,ultimaAtualizacao:o.ultima_atualizacao};c.set(f,m)}}),Array.from(z.entries()).map(([o,p])=>{const g=Array.from(p.values()),f=g.reduce((t,s)=>t+(s.pontosMeta||0),0),c=g.reduce((t,s)=>t+Math.max(0,s.pontos||0),0),_=g.reduce((t,s)=>t+(s.meta||0),0),n=g.reduce((t,s)=>t+(s.realizado||0),0),m=_>0?n/_*100:0;return{id:o,label:g[0]?.familiaNome||"Sem Família",items:g,totals:{pontosTotal:f,pontosHit:c,metaTotal:_,realizadoTotal:n,atingPct:m}}})});return{produtos:b.produtos,produtosPorFamilia:k,loading:b.loading,error:b.error,loadProdutos:b.loadResumo,produtoFilters:v}}function Aa(R,M){const{produtosPorFamilia:b}=la(R,M),v=sa(R,M),k=E(()=>{const o=v.variavel.value||[];if(!o.length)return{varPossivel:null,varAtingido:null};const p=o.reduce((g,f)=>{const c=Number(f.variavel_meta)||0,_=Number(f.variavel_real)||0;return g.meta+=c,g.real+=_,g},{meta:0,real:0});return{varPossivel:p.meta,varAtingido:p.real}});return{summary:E(()=>{const o=b.value||[];let p=0,g=0,f=0,c=0;return o.forEach(_=>{_.items.forEach(n=>{g++,n.atingido&&p++;const m=n.pontosMeta||0,t=Math.max(0,n.pontos||0);c+=m,f+=Math.min(t,m)})}),{indicadoresAtingidos:p,indicadoresTotal:g,pontosAtingidos:f,pontosPossiveis:c,varPossivel:k.value.varPossivel,varAtingido:k.value.varAtingido}})}}const Pa={id:"kpi-summary",class:"kpi-summary"},Fa={key:0,class:"kpi-pill"},Ra={class:"kpi-strip__main"},Ta={class:"kpi-icon"},Na={class:"kpi-strip__text"},Va={class:"kpi-strip__stats"},Sa={class:"kpi-stat"},Ca={class:"kpi-stat"},Da=["aria-valuenow","aria-label","aria-valuetext"],Ia={class:"hitbar__thumb"},Ba={class:"hitbar__pct"},Ea={key:1,class:"kpi-pill"},ja={class:"kpi-strip__main"},Ha={class:"kpi-icon"},La={class:"kpi-strip__text"},qa={class:"kpi-strip__stats"},Ua={class:"kpi-stat"},Ka={class:"kpi-stat"},Qa=["aria-valuenow"],Oa={class:"hitbar__thumb"},Wa={class:"hitbar__pct"},Ga={key:2,class:"kpi-pill"},Ja={class:"kpi-strip__main"},Xa={class:"kpi-icon"},Ya={class:"kpi-strip__text"},Za={class:"kpi-strip__stats"},as={class:"kpi-stat"},ss={class:"kpi-stat"},es=["aria-valuenow","aria-valuetext"],ts={class:"hitbar__thumb"},os={class:"hitbar__pct"},is=K({__name:"ResumoKPI",setup(R){const{filterState:M,period:b}=Y(),{summary:v}=Aa(M,b),k=(f,c)=>f==="brl"?ma(c):f==="pts"?F(c):pa(c),z=f=>f<50?"hitbar--low":f<100?"hitbar--warn":"hitbar--ok",o=E(()=>v.value.indicadoresTotal===0?0:v.value.indicadoresAtingidos/v.value.indicadoresTotal*100),p=E(()=>v.value.pontosPossiveis===0?0:v.value.pontosAtingidos/v.value.pontosPossiveis*100),g=E(()=>{const f=v.value.varPossivel??0,c=v.value.varAtingido??0;if(f===0||!Number.isFinite(f)||!Number.isFinite(c))return 0;const _=c/f*100;return Math.max(0,Math.min(100,_))});return(f,c)=>(h(),y("div",Pa,[l(v).indicadoresTotal>0||l(v).pontosPossiveis>0?(h(),y("div",Fa,[a("div",Ra,[a("span",Ta,[N(L,{name:"list-check",size:22})]),a("div",Na,[c[2]||(c[2]=a("span",{class:"kpi-strip__label"},"Indicadores",-1)),a("div",Va,[a("span",Sa,[c[0]||(c[0]=I(" Atg: ",-1)),a("strong",null,r(k("int",l(v).indicadoresAtingidos)),1)]),a("span",Ca,[c[1]||(c[1]=I(" Total: ",-1)),a("strong",null,r(k("int",l(v).indicadoresTotal)),1)])])])]),a("div",{class:P(["hitbar",z(o.value)]),role:"progressbar","aria-valuenow":o.value,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Atingimento de indicadores: ${o.value.toFixed(1)}%`,"aria-valuetext":`${o.value.toFixed(1)}% (${l(v).indicadoresAtingidos} de ${l(v).indicadoresTotal} indicadores)`},[a("span",{class:"hitbar__track",style:U({"--target":`${o.value.toFixed(2)}%`,"--thumb":`${o.value.toFixed(2)}%`})},[c[3]||(c[3]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Ia,[a("span",Ba,r(o.value.toFixed(1))+"%",1)])],4)],10,Da)])):j("",!0),l(v).pontosPossiveis>0?(h(),y("div",Ea,[a("div",ja,[a("span",Ha,[N(L,{name:"medal",size:22})]),a("div",La,[c[6]||(c[6]=a("span",{class:"kpi-strip__label"},"Pontos",-1)),a("div",qa,[a("span",Ua,[c[4]||(c[4]=I(" Atg: ",-1)),a("strong",null,r(k("pts",l(v).pontosAtingidos)),1)]),a("span",Ka,[c[5]||(c[5]=I(" Total: ",-1)),a("strong",null,r(k("pts",l(v).pontosPossiveis)),1)])])])]),a("div",{class:P(["hitbar",z(p.value)]),role:"progressbar","aria-valuenow":p.value,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${p.value.toFixed(2)}%`,"--thumb":`${p.value.toFixed(2)}%`})},[c[7]||(c[7]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Oa,[a("span",Wa,r(p.value.toFixed(1))+"%",1)])],4)],10,Qa)])):j("",!0),(l(v).varPossivel??0)>0?(h(),y("div",Ga,[a("div",Ja,[a("span",Xa,[N(L,{name:"cash",size:22})]),a("div",Ya,[c[10]||(c[10]=a("span",{class:"kpi-strip__label"},[I(" Variável "),a("span",{class:"kpi-label-emphasis"},"Estimada")],-1)),a("div",Za,[a("span",as,[c[8]||(c[8]=I(" Atg: ",-1)),a("strong",null,r(k("brl",l(v).varAtingido||0)),1)]),a("span",ss,[c[9]||(c[9]=I(" Total: ",-1)),a("strong",null,r(k("brl",l(v).varPossivel||0)),1)])])])]),a("div",{class:P(["hitbar",z(g.value)]),role:"progressbar","aria-valuenow":g.value,"aria-valuetext":`Variável Estimada: ${g.value.toFixed(1)}%`,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${Math.max(0,Math.min(100,g.value)).toFixed(2)}%`,"--thumb":`${Math.max(0,Math.min(100,g.value)).toFixed(2)}%`})},[c[11]||(c[11]=a("span",{class:"hitbar__fill"},null,-1)),a("span",ts,[a("span",os,r(g.value.toFixed(1))+"%",1)])],4)],10,es)])):j("",!0)]))}}),ls=Q(is,[["__scopeId","data-v-33b03f40"]]),rs={id:"grid-familias"},ns={key:0,class:"produtos-skeleton"},ds={class:"fam-section__header"},cs={class:"fam-section__title"},us={key:0,class:"fam-section__meta"},_s=["title"],ms={class:"fam-section__grid"},ps=["data-prod-id","data-familia-id","data-familia-label","aria-label","onKeydown"],vs={class:"prod-card__title"},gs=["title"],hs=["aria-label","title","onMouseenter","onClick","onTouchstart"],fs={class:"prod-card__meta"},ys={class:"pill"},bs={class:"pill"},$s={class:"pill"},ks={class:"prod-card__kpis"},xs={class:"kv"},ws=["title"],Ms={class:"kv"},zs=["title"],As={class:"prod-card__var"},Ps={class:"prod-card__var-body"},Fs=["title"],Rs=["data-ratio","aria-valuenow","aria-label","aria-valuetext"],Ts=["title"],Ns={class:"prod-card__var-value"},Vs={class:"prod-card__foot"},Ss={key:0,class:"kpi-tip is-open",role:"dialog","aria-label":"Detalhes do indicador"},Cs={class:"row"},Ds={class:"row"},Is={class:"row"},Bs={class:"row"},Es={class:"row"},js={class:"row"},Hs={class:"row"},Ls=K({__name:"ProdutosCards",setup(R){const{filterState:M,period:b}=Y(),{produtosPorFamilia:v,loading:k,error:z}=la(M,b),{getCurrentMonthBusinessSnapshot:o}=fa(),{loadCalendario:p}=ya(),g=X(null);aa(async()=>{await p()});const f=u=>{const e=d=>{d.target.closest(".prod-card")||u()};aa(()=>{document.addEventListener("click",e)}),na(()=>{document.removeEventListener("click",e)})},c=u=>{const e=d=>{d.key==="Escape"&&u()};aa(()=>{document.addEventListener("keydown",e)}),na(()=>{document.removeEventListener("keydown",e)})};f(()=>{g.value=null}),c(()=>{g.value=null});const _=(u,e)=>{Number.isFinite(e)||(e=0);const d=u?.toLowerCase()||"valor";return d==="perc"?`${e.toFixed(1)}%`:d==="qtd"?new Intl.NumberFormat("pt-BR",{maximumFractionDigits:0}).format(Math.round(e)):ha(Math.round(e))},n=u=>{const e=o.value,{total:d,elapsed:i,remaining:$}=e;let H=u.meta||0;const O=u.realizado||0;u.metrica?.toLowerCase()==="perc"&&(H=100);const W=Math.max(0,H-O),ea=$>0?W/$:0,q=(i>0?O/i:0)*(d||0),Z=d>0?H/d*i:0;return{diasTotais:d,diasDecorridos:i,diasRestantes:$,faltaTotal:_(u.metrica||"valor",W),necessarioPorDia:$>0?_(u.metrica||"valor",ea):"—",referenciaHoje:i>0?_(u.metrica||"valor",Z):"—",projecaoRitmoAtual:_(u.metrica||"valor",q)}},m=(u,e)=>{const d=u.closest(".prod-card");if(!d)return;const i=u.getBoundingClientRect(),$=d.getBoundingClientRect(),H=e.offsetWidth||320,O=e.offsetHeight||200,W=window.innerWidth,ea=window.innerHeight;let ta=i.bottom-$.top+8;i.bottom+O+12>ea&&(ta=i.top-$.top-O-8);let q=$.width-H-12;const Z=$.left+q;Z<12&&(q=12),Z+H>W-12&&(q=Math.max(12,W-12-$.left-H)),e.style.top=`${ta}px`,e.style.left=`${q}px`},t=(u,e)=>{e.stopPropagation(),g.value=u,requestAnimationFrame(()=>{const d=document.querySelector(`[data-prod-id="${u}"]`);if(!d)return;const i=d.querySelector(".badge"),$=d.querySelector(".kpi-tip");i&&$&&m(i,$)})},s=()=>{g.value=null},T=(u,e)=>{e.stopPropagation(),g.value===u?s():t(u,e)},A=u=>u<50?"badge--low":u<100?"badge--warn":"badge--ok",S=u=>u<50?"var--low":u<100?"var--warn":"var--ok",x=u=>{const e=u.meta||0,d=u.realizado||0;return e<=0?0:d/e*100},w=u=>{const e=u.pontosMeta||0,d=u.pontos||0;return e>0?d/e*100:0},V=u=>{if(!u)return"Valor";const e=u.toLowerCase();return e==="valor"?"Valor":e==="qtd"||e==="quantidade"?"Quantidade":"Percentual"};return(u,e)=>(h(),y("div",rs,[l(k)?(h(),y("div",ns,[...e[0]||(e[0]=[ia('<div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-60616541></div><div class="cards-grid" data-v-60616541><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div></div><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin:32px 0 16px;border-radius:6px;" data-v-60616541></div><div class="cards-grid" data-v-60616541><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-60616541></div></div>',4)])])):(h(),y(D,{key:1},[l(z)?(h(),ra(va,{key:0,message:l(z)},null,8,["message"])):l(v).length>0?(h(!0),y(D,{key:1},J(l(v),d=>(h(),y("div",{key:d.id,class:"fam-section"},[a("header",ds,[a("div",cs,[a("span",null,r(d.label),1),d.totals?(h(),y("small",us,[a("span",{class:"fam-section__meta-item",title:`Pontos: ${l(F)(d.totals.pontosHit,{withUnit:!0})} / ${l(F)(d.totals.pontosTotal,{withUnit:!0})}`}," Pontos: "+r(l(F)(d.totals.pontosHit))+" / "+r(l(F)(d.totals.pontosTotal)),9,_s)])):j("",!0)])]),a("div",ms,[(h(!0),y(D,null,J(d.items,i=>(h(),y("article",{key:i.id,class:P(["prod-card",{"is-tip-open":g.value===i.id}]),"data-prod-id":i.id,"data-familia-id":i.familiaId,"data-familia-label":i.familiaNome,role:"article","aria-label":`Produto: ${i.nome}`,tabindex:"0",onMouseleave:s,onKeydown:[oa(da($=>t(i.id,$),["prevent"]),["enter"]),oa(da($=>t(i.id,$),["prevent"]),["space"]),oa(s,["escape"])]},[a("div",vs,[N(L,{name:"chart-line",size:22,color:"#b30000",class:"prod-card__icon"}),a("span",{class:"prod-card__name has-ellipsis",title:i.nome},r(i.nome),9,gs),a("span",{class:P(["badge",A(x(i))]),"aria-label":`Atingimento: ${x(i).toFixed(1)}%`,title:`${x(i).toFixed(1)}%`,onMouseenter:$=>{$.stopPropagation(),t(i.id,$)},onClick:$=>{$.stopPropagation(),T(i.id,$)},onTouchstart:$=>{$.stopPropagation(),T(i.id,$)}},r(x(i)>=100?`${Math.round(x(i))}%`:`${x(i).toFixed(1)}%`),43,hs)]),a("div",fs,[a("span",ys," Pontos: "+r(l(F)(i.pontos||0))+" / "+r(l(F)(i.pontosMeta||0)),1),a("span",bs,"Peso: "+r(l(ga)(i.peso||0)),1),a("span",$s,r(V(i.metrica)),1)]),a("div",ks,[a("div",xs,[e[1]||(e[1]=a("small",null,"Meta",-1)),a("strong",{class:"has-ellipsis",title:l(B)(i.metrica,i.meta)},r(l(C)(i.metrica,i.meta)),9,ws)]),a("div",Ms,[e[2]||(e[2]=a("small",null,"Realizado",-1)),a("strong",{class:"has-ellipsis",title:l(B)(i.metrica,i.realizado)},r(l(C)(i.metrica,i.realizado)),9,zs)])]),a("div",As,[e[3]||(e[3]=a("div",{class:"prod-card__var-head"},[a("small",null,"Atingimento de pontos")],-1)),a("div",Ps,[a("span",{class:"prod-card__var-goal",title:l(F)(i.pontosMeta||0,{withUnit:!0})},r(l(F)(i.pontosMeta||0,{withUnit:!0})),9,Fs),a("div",{class:P(["prod-card__var-track",S(w(i))]),"data-ratio":w(i).toFixed(2),role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":Math.round(w(i)),"aria-label":`Atingimento de pontos: ${w(i).toFixed(1)}%`,"aria-valuetext":`${w(i).toFixed(1)}% (${l(F)(i.pontos||0)} de ${l(F)(i.pontosMeta||0)})`},[a("span",{class:"prod-card__var-fill",style:U({"--target":`${w(i)}%`})},null,4),a("span",{class:"prod-card__var-label",style:U({"--target":`${w(i)}%`}),title:`Atingido: ${l(F)(i.pontos||0,{withUnit:!0})} · ${w(i).toFixed(1)}%`},[a("span",Ns,r(w(i).toFixed(1))+"%",1)],12,Ts)],10,Rs)])]),a("div",Vs," Atualizado em "+r(i.ultimaAtualizacao||"N/A"),1),g.value===i.id?(h(),y("div",Ss,[n(i)?(h(),y(D,{key:0},[e[11]||(e[11]=a("h5",null,"Projeção e metas",-1)),a("div",Cs,[e[4]||(e[4]=a("span",null,"Quantidade de dias úteis no mês",-1)),a("span",null,r(new Intl.NumberFormat("pt-BR").format(n(i).diasTotais)),1)]),a("div",Ds,[e[5]||(e[5]=a("span",null,"Dias úteis trabalhados",-1)),a("span",null,r(new Intl.NumberFormat("pt-BR").format(n(i).diasDecorridos)),1)]),a("div",Is,[e[6]||(e[6]=a("span",null,"Dias úteis que faltam",-1)),a("span",null,r(new Intl.NumberFormat("pt-BR").format(n(i).diasRestantes)),1)]),a("div",Bs,[e[7]||(e[7]=a("span",null,"Falta para a meta",-1)),a("span",null,r(n(i).faltaTotal),1)]),a("div",Es,[e[8]||(e[8]=a("span",null,"Referência para hoje",-1)),a("span",null,r(n(i).referenciaHoje),1)]),a("div",js,[e[9]||(e[9]=a("span",null,"Meta diária necessária",-1)),a("span",null,r(n(i).necessarioPorDia),1)]),a("div",Hs,[e[10]||(e[10]=a("span",null,"Projeção (ritmo atual)",-1)),a("span",null,r(n(i).projecaoRitmoAtual),1)])],64)):j("",!0)])):j("",!0)],42,ps))),128))])]))),128)):(h(),ra(ba,{key:2,title:"Nenhum produto encontrado",message:"Nenhum produto encontrado para os filtros selecionados."}))],64))]))}}),qs=Q(Ls,[["__scopeId","data-v-60616541"]]);function Us(){const{filterState:R,period:M}=Y(),b=sa(R,M),v=b.produtosMensais,k=b.loading,z=b.error,o=b.businessSnapshot,p=E(()=>{const g=new Map;v.value.forEach(s=>{const T=s.id_familia||"sem-familia",A=s.id_indicador||s.id;if(!A)return;g.has(T)||g.set(T,new Map);const S=g.get(T);if(S.has(A)){const x=S.get(A);!x.peso&&s.peso&&(x.peso=Number(s.peso)||0,x.pontosMeta=Number(s.pontos_meta??s.peso)||0),x.meta=(x.meta||0)+(s.meta||0),x.realizado=(x.realizado||0)+(s.realizado||0);const w=new Map;x.months.forEach(e=>{w.set(e.mes,{meta:e.meta,realizado:e.realizado})}),s.meses.forEach(e=>{const d=w.get(e.mes)||{meta:0,realizado:0};w.set(e.mes,{meta:d.meta+e.meta,realizado:d.realizado+e.realizado})}),x.months=Array.from(w.entries()).map(([e,d])=>({mes:e,meta:d.meta,realizado:d.realizado,atingimento:d.meta>0?d.realizado/d.meta*100:0}));const V=new Date().toISOString().slice(0,7),u=x.months.find(e=>e.mes===V);if(x.monthMeta=u?.meta||0,x.monthReal=u?.realizado||0,s.id_subindicador&&s.subindicador){x.children||(x.children=[]);const e={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:u?.meta||0,monthReal:u?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};x.children.push(e)}}else{const x=new Date().toISOString().slice(0,7),w=s.meses.find(u=>u.mes===x),V={id:A,nome:s.indicador||"Indicador",metrica:s.metrica||"valor",peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:w?.meta||0,monthReal:w?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses,children:[]};if(s.id_subindicador&&s.subindicador){const u={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:w?.meta||0,monthReal:w?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};V.children.push(u)}S.set(A,V)}});const f=new Map;v.value.forEach(s=>{s.id_familia&&!f.has(s.id_familia)&&f.set(s.id_familia,s.familia||"Sem Família")});const c=o.value,_=c.total||1,n=c.elapsed||0,m=c.remaining||0,t=s=>{const T=s.meta||0,A=s.realizado||0,S=s.pontosMeta||s.peso||0,x=_>0?T/_*n:0,w=Math.max(0,T-A),V=m>0?w/m:0,u=n>0?A/n*m+A:A;let e,d;s.pontosBackend!==void 0?(e=s.pontosBackend,d=e):(d=Math.min(S,A),e=Math.max(0,Math.min(S,d)));const i=T>0?A/T:0,$={...s,referenciaHoje:x,projecao:u,metaDiariaNecessaria:V,pontos:e,pontosBrutos:d,ating:i};return s.children&&s.children.length>0&&($.children=s.children.map(t)),$};return Array.from(g.entries()).map(([s,T])=>{const A=Array.from(T.values()).map(t),S=A.reduce((e,d)=>e+(d.pontosMeta||0),0),x=A.reduce((e,d)=>e+(d.pontos||0),0),w=A.reduce((e,d)=>e+(d.meta||0),0),V=A.reduce((e,d)=>e+(d.realizado||0),0),u=w>0?V/w*100:0;return{id:s,label:f.get(s)||"Sem Família",items:A,totals:{pontosTotal:S,pontosHit:x,metaTotal:w,realizadoTotal:V,atingPct:u}}})});return{produtos:v,produtosPorFamilia:p,loading:k,error:z,loadProdutos:b.loadResumo}}const Ks={class:"resumo-legacy"},Qs={key:0,class:"resumo-legacy__loading"},Os={key:1,class:"resumo-legacy__error"},Ws={key:2,class:"resumo-legacy__empty"},Gs={class:"resumo-legacy__head"},Js={class:"resumo-legacy__heading"},Xs={class:"resumo-legacy__title-row"},Ys={class:"resumo-legacy__name"},Zs={class:"resumo-legacy__section-actions"},ae=["disabled","onClick"],se={class:"resumo-legacy__section-toggle-label"},ee={class:"resumo-legacy__chips"},te={class:"resumo-legacy__chip"},oe=["title"],ie={class:"resumo-legacy__stats"},le={class:"resumo-legacy__stat"},re={class:"resumo-legacy__stat-value"},ne={key:0,class:"resumo-legacy__stat"},de={class:"resumo-legacy__stat-value"},ce={class:"resumo-legacy__stat"},ue={class:"resumo-legacy__stat-value"},_e={class:"resumo-legacy__table-wrapper"},me={class:"resumo-legacy__table"},pe=["data-row-id"],ve={class:"resumo-legacy__col--prod"},ge={class:"resumo-legacy__prod"},he=["aria-expanded","onClick"],fe=["title"],ye={key:1,class:"resumo-legacy__prod-name-wrapper"},be=["title"],$e={class:"resumo-legacy__col--peso"},ke=["title"],xe=["title"],we=["title"],Me=["title"],ze=["title"],Ae=["title"],Pe=["title"],Fe={class:"resumo-legacy__col--ating"},Re={class:"resumo-legacy__ating",title:"Atingimento"},Te=["aria-valuenow"],Ne={class:"resumo-legacy__ating-value"},Ve={class:"resumo-legacy__col--update"},Se=["data-row-id"],Ce={class:"resumo-legacy__col--prod"},De={class:"resumo-legacy__prod"},Ie=["title"],Be=["title"],Ee=["title"],je=["title"],He={class:"resumo-legacy__col--update"},Le=K({__name:"ResumoLegacy",setup(R){const{filterState:M,period:b}=Y();la(M,b);const{produtosPorFamilia:v,loading:k,error:z}=Us(),o=X(new Set),p=X(new Set),g=_=>{o.value.has(_)?o.value.delete(_):o.value.add(_)},f=_=>{p.value.has(_)?p.value.delete(_):p.value.add(_)},c=_=>_.items.some(n=>n.children&&n.children.length>0);return(_,n)=>(h(),y("div",Ks,[l(k)?(h(),y("div",Qs," Carregando... ")):l(z)?(h(),y("div",Os," Erro: "+r(l(z)),1)):!l(v)||l(v).length===0?(h(),y("div",Ws," Nenhum dado disponível ")):(h(!0),y(D,{key:3},J(l(v),m=>(h(),y("section",{key:m.id,class:"resumo-legacy__section resumo-legacy__section--annual card card--legacy"},[a("header",Gs,[a("div",Js,[a("div",Xs,[a("span",Ys,r(m.label),1),a("div",Zs,[a("button",{type:"button",class:P(["resumo-legacy__section-toggle",{"is-disabled":!c(m)},{"is-expanded":p.value.has(m.id)}]),disabled:!c(m),onClick:t=>f(m.id)},[N(L,{name:"filter",size:16}),a("span",se,r(p.value.has(m.id)?"Recolher filtros":"Abrir todos os filtros"),1)],10,ae)])]),a("div",ee,[a("span",te,[N(L,{name:"box-multiple",size:16}),I(" "+r(l(G)(m.items.length||0))+" indicadores ",1)]),a("span",{class:"resumo-legacy__chip",title:`Pontos: ${l(F)(m.totals.pontosHit,{withUnit:!0})} / ${l(F)(m.totals.pontosTotal,{withUnit:!0})}`}," Pontos "+r(l(G)(Math.round(m.totals.pontosHit)))+" / "+r(l(G)(Math.round(m.totals.pontosTotal))),9,oe)])]),a("div",ie,[a("div",le,[n[0]||(n[0]=a("span",{class:"resumo-legacy__stat-label"},"Peso total",-1)),a("strong",re,r(l(G)(Math.round(m.totals.pontosTotal))),1)]),m.totals.realizadoTotal>0?(h(),y("div",ne,[n[1]||(n[1]=a("span",{class:"resumo-legacy__stat-label"},"Realizado",-1)),a("strong",de,r(l(C)("valor",m.totals.realizadoTotal)),1)])):j("",!0),a("div",ce,[n[2]||(n[2]=a("span",{class:"resumo-legacy__stat-label"},"Atingimento",-1)),a("strong",ue,r(m.totals.metaTotal>0?`${Math.max(0,Math.min(200,m.totals.atingPct)).toFixed(1)}%`:"—"),1)])])]),a("div",_e,[a("table",me,[n[10]||(n[10]=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Subindicador"),a("th",{scope:"col",class:"resumo-legacy__col--peso"},"Peso"),a("th",{scope:"col"},"Métrica"),a("th",{scope:"col",class:"resumo-legacy__col--meta"},"Meta"),a("th",{scope:"col",class:"resumo-legacy__col--real"},"Realizado"),a("th",{scope:"col",class:"resumo-legacy__col--ref"},"Ref. do dia"),a("th",{scope:"col",class:"resumo-legacy__col--forecast"},"Forecast"),a("th",{scope:"col",class:"resumo-legacy__col--meta-dia"},"Meta diária nec."),a("th",{scope:"col",class:"resumo-legacy__col--pontos"},"Pontos"),a("th",{scope:"col",class:"resumo-legacy__col--ating"},"Ating."),a("th",{scope:"col",class:"resumo-legacy__col--update"},"Atualização")])],-1)),a("tbody",null,[(h(!0),y(D,null,J(m.items,t=>(h(),y(D,{key:t.id},[a("tr",{class:P(["resumo-legacy__row",{"is-expanded":o.value.has(`${m.id}-${t.id}`)||p.value.has(m.id)}]),"data-row-id":`${m.id}-${t.id}`},[a("td",ve,[a("div",ge,[t.children&&t.children.length>0?(h(),y("button",{key:0,type:"button",class:"resumo-legacy__prod-toggle","aria-expanded":o.value.has(`${m.id}-${t.id}`)||p.value.has(m.id),onClick:s=>g(`${m.id}-${t.id}`)},[N(L,{name:"chevron-right",class:P(["resumo-legacy__prod-toggle-icon",{"is-expanded":o.value.has(`${m.id}-${t.id}`)||p.value.has(m.id)}]),size:16},null,8,["class"]),a("span",{class:"resumo-legacy__prod-name",title:t.nome},r(t.nome),9,fe)],8,he)):(h(),y("div",ye,[n[3]||(n[3]=a("span",{class:"resumo-legacy__prod-toggle-icon resumo-legacy__prod-toggle-icon--placeholder","aria-hidden":"true"},null,-1)),a("span",{class:"resumo-legacy__prod-name",title:t.nome},r(t.nome),9,be)]))])]),a("td",$e,r(l(G)(t.pontosMeta||t.peso||0)),1),a("td",null,[a("span",{class:P(["resumo-legacy__metric",`resumo-legacy__metric--${t.metrica==="valor"?"valor":t.metrica==="qtd"?"qtd":t.metrica==="perc"?"perc":""}`]),title:`Métrica: ${t.metrica}`},r(t.metrica==="valor"?"Valor":t.metrica==="qtd"?"Quantidade":t.metrica==="perc"?"Percentual":t.metrica),11,ke)]),a("td",{class:"resumo-legacy__col--meta",title:l(B)(t.metrica,t.meta)},r(l(C)(t.metrica,t.meta)),9,xe),a("td",{class:"resumo-legacy__col--real",title:l(B)(t.metrica,t.realizado)},r(l(C)(t.metrica,t.realizado)),9,we),a("td",{class:"resumo-legacy__col--ref",title:l(B)(t.metrica,t.referenciaHoje)},r(t.referenciaHoje!=null?l(C)(t.metrica,t.referenciaHoje):"—"),9,Me),a("td",{class:"resumo-legacy__col--forecast",title:l(B)(t.metrica,t.projecao)},r(t.projecao!=null?l(C)(t.metrica,t.projecao):"—"),9,ze),a("td",{class:"resumo-legacy__col--meta-dia",title:l(B)(t.metrica,t.metaDiariaNecessaria)},r(t.metaDiariaNecessaria!=null?l(C)(t.metrica,t.metaDiariaNecessaria):"—"),9,Ae),a("td",{class:"resumo-legacy__col--pontos",title:l(F)(t.pontos,{withUnit:!0})},r(l(F)(t.pontos,{withUnit:!0})),9,Pe),a("td",Fe,[a("div",Re,[a("div",{class:P(["resumo-legacy__ating-meter",(t.ating||0)>=1?"is-ok":(t.ating||0)>=.5?"is-warn":"is-low"]),style:U({"--fill":Math.max(0,Math.min(1,t.ating||0))}),role:"progressbar","aria-valuemin":0,"aria-valuemax":200,"aria-valuenow":Math.max(0,Math.min(200,(t.ating||0)*100))},[a("span",Ne,r(t.meta>0?`${Math.max(0,Math.min(200,(t.ating||0)*100)).toFixed(1)}%`:"—"),1)],14,Te)])]),a("td",Ve,r(t.ultimaAtualizacao?t.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(ca)(t.ultimaAtualizacao):t.ultimaAtualizacao:"—"),1)],10,pe),t.children&&t.children.length>0?(h(!0),y(D,{key:0},J(t.children,s=>(h(),y("tr",{key:s.id,class:P(["resumo-legacy__row resumo-legacy__row--child",{"is-visible":o.value.has(`${m.id}-${t.id}`)||p.value.has(m.id)}]),"data-row-id":`${m.id}-${t.id}-${s.id}`},[a("td",Ce,[a("div",De,[a("span",{class:"resumo-legacy__prod-name resumo-legacy__prod-name--child",title:s.nome},r(s.nome),9,Ie)])]),n[4]||(n[4]=a("td",{class:"resumo-legacy__col--peso"}," — ",-1)),a("td",null,[a("span",{class:P(["resumo-legacy__metric",`resumo-legacy__metric--${s.metrica==="valor"?"valor":s.metrica==="qtd"?"qtd":s.metrica==="perc"?"perc":""}`]),title:`Métrica: ${s.metrica}`},r(s.metrica==="valor"?"Valor":s.metrica==="qtd"?"Quantidade":s.metrica==="perc"?"Percentual":s.metrica),11,Be)]),n[5]||(n[5]=a("td",{class:"resumo-legacy__col--meta"}," — ",-1)),a("td",{class:"resumo-legacy__col--real",title:l(B)(s.metrica,s.realizado)},r(l(C)(s.metrica,s.realizado)),9,Ee),n[6]||(n[6]=a("td",{class:"resumo-legacy__col--ref"}," — ",-1)),n[7]||(n[7]=a("td",{class:"resumo-legacy__col--forecast"}," — ",-1)),n[8]||(n[8]=a("td",{class:"resumo-legacy__col--meta-dia"}," — ",-1)),a("td",{class:"resumo-legacy__col--pontos",title:l(F)(s.pontos,{withUnit:!0})},r("-"),8,je),n[9]||(n[9]=a("td",{class:"resumo-legacy__col--ating"}," — ",-1)),a("td",He,r(s.ultimaAtualizacao?s.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(ca)(s.ultimaAtualizacao):s.ultimaAtualizacao:"—"),1)],10,Se))),128)):j("",!0)],64))),128))])])])]))),128))]))}}),qe=Q(Le,[["__scopeId","data-v-1d9b61e4"]]),Ue={id:"view-cards",class:"view-section"},Ke={key:0,class:"resumo-skeleton"},Qe={id:"resumo-summary",class:"resumo-summary"},Oe=K({__name:"ResumoView",setup(R){const M=X("cards"),{filterState:b,period:v}=Y(),{loading:k}=sa(b,v);return(z,o)=>(h(),y("section",Ue,[l(k)?(h(),y("div",Ke,[N(ua,{modelValue:M.value,"onUpdate:modelValue":o[0]||(o[0]=p=>M.value=p)},null,8,["modelValue"]),o[4]||(o[4]=ia('<div id="resumo-summary" class="resumo-summary" data-v-18d15f9e><div class="kpi-summary" data-v-18d15f9e><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div></div></div>',1)),a("div",{id:"resumo-cards",class:P(["resumo-mode__view",{hidden:M.value!=="cards"}])},[...o[2]||(o[2]=[ia('<div class="produtos-skeleton" data-v-18d15f9e><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-18d15f9e></div><div class="cards-grid" data-v-18d15f9e><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div></div></div>',1)])],2),a("div",{id:"resumo-legacy",class:P(["resumo-mode__view",{hidden:M.value!=="legacy"}])},[...o[3]||(o[3]=[a("div",{class:"skeleton skeleton--legacy",style:{height:"400px","border-radius":"12px"}},null,-1)])],2)])):(h(),y(D,{key:1},[N(ua,{modelValue:M.value,"onUpdate:modelValue":o[1]||(o[1]=p=>M.value=p)},null,8,["modelValue"]),a("div",Qe,[N(ls)]),a("div",{id:"resumo-cards",class:P(["resumo-mode__view",{hidden:M.value!=="cards"}])},[N(qs)],2),a("div",{id:"resumo-legacy",class:P(["resumo-mode__view",{hidden:M.value!=="legacy"}]),"aria-live":"polite"},[N(qe)],2)],64))]))}}),We=Q(Oe,[["__scopeId","data-v-18d15f9e"]]),Ge={class:"home-wrapper"},Je=K({__name:"Home",setup(R){return(M,b)=>(h(),y("div",Ge,[N(We)]))}}),nt=Q(Je,[["__scopeId","data-v-904e3431"]]);export{nt as default};
