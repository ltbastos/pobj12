import{r as E,e as T,y as ke,w as de,b as X,J as Pe,m as l,o as i,F as L,q as e,j,k as N,t as A,E as v,D as F,B as ne,u as B,g as Y,v as be,G as $e,H as Ce,N as Ie,M as Ue,C as he}from"./vendor.iNPlSTaR.js";import{u as Je,a as qe}from"./vue-router.BQVFLPdy.js";import{I as D,_ as Z}from"./index.mT9_goUm.js";import{g as He,f as fe,u as xe}from"./useGlobalFilters.BuA1oYH7.js";import{u as Ke}from"./useCalendarioCache.B0vVf7lc.js";import{u as We}from"./useDetalhesData.BoUSpHZC.js";import{i as K,f as W,b as re,g as Q,h as ee,E as Qe,j as ye}from"./EmptyState.vue_vue_type_style_index_0_scoped_69c25b95_lang.DOMA17eF.js";import{E as we}from"./EmptyState.Ti8JQ5hh.js";import"./pdf-vendor.jXUlHPMi.js";import"./icons-vendor.pg7b-e9c.js";function Ye(){const s=Je(),{loadCalendario:u}=Ke(),S=E(He()),f=T(()=>s.name==="Simuladores"),R=T(()=>fe(S.value.start)),g=T(()=>fe(S.value.end)),h=_=>{S.value=_};return ke(()=>u()),de(()=>s.name,()=>{}),{period:S,isSimuladoresPage:f,startFormatted:R,endFormatted:g,updatePeriod:h}}const Xe={class:"tree-cell"},Ze={key:1,class:"toggle toggle--placeholder","aria-hidden":"true"},ea={class:"label-strong"},aa={key:0,class:"col-number"},ta=["title"],na=["title"],oa={key:1,class:"cell-content"},ia={class:"actions-cell"},sa={class:"actions-group"},la={key:0,class:"tree-row tree-detail-row"},ra=["colspan"],da={class:"contract-detail-card"},ca={class:"contract-detail-card__actions"},ua={key:0,class:"contract-detail-card__warning"},_a={class:"contract-detail-card__warning-content"},ma={class:"contract-detail-card__warning-text"},va={class:"contract-detail-card__warning-details"},pa={class:"contract-detail-card__table-wrapper"},ga={class:"contract-detail-card__table"},ba=X({__name:"TreeTableRow",props:{node:{},level:{},expanded:{type:Boolean},expandedRows:{default:()=>new Set},detailOpen:{type:Boolean,default:!1},activeColumns:{default:()=>[]}},emits:["toggle","action"],setup(s,{emit:u}){const S=s,f=u,R=T(()=>S.node.children.length>0),g=T(()=>S.node.summary.atingimento_p||0),h=T(()=>{const w=g.value;return w>=100?"text-success":w>=80?"text-warning":"text-danger"});function _(w){const r=S.node.summary;switch(w){case"realizado":return W(r.valor_realizado);case"meta":return W(r.valor_meta);case"atingimento_p":return`${re(r.atingimento_p)}%`;case"meta_diaria":return W(r.meta_diaria);case"referencia_hoje":return W(r.referencia_hoje);case"pontos":return`${re(r.pontos)} pts`;case"meta_diaria_necessaria":return W(r.meta_diaria_necessaria);case"peso":return`${re(r.peso)} pts`;case"projecao":return W(r.projecao);case"data":return K(r.data);default:return"—"}}function y(w){const r=S.node.summary;switch(w){case"realizado":return Q(r.valor_realizado);case"meta":return Q(r.valor_meta);case"atingimento_p":return`${ee(r.atingimento_p)}%`;case"meta_diaria":return Q(r.meta_diaria);case"referencia_hoje":return Q(r.referencia_hoje);case"pontos":return`${ee(r.pontos)} pts`;case"meta_diaria_necessaria":return Q(r.meta_diaria_necessaria);case"peso":return`${ee(r.peso)} pts`;case"projecao":return Q(r.projecao);case"data":return K(r.data);default:return""}}const G=T(()=>!!S.node.detail?.dt_cancelamento);return(w,r)=>{const $=Pe("TreeTableRow",!0);return i(),l(L,null,[e("tr",{class:N(["tree-row","lvl-"+s.level,{"tree-row--expanded":s.expanded}])},[e("td",null,[e("div",Xe,[R.value||s.node.level==="contrato"?(i(),l("button",{key:0,type:"button",class:N(["toggle",{"is-expanded":s.expanded||s.node.level==="contrato"&&s.expanded}]),onClick:r[0]||(r[0]=z=>f("toggle",s.node.id))},[A(D,{name:s.expanded||s.node.level==="contrato"&&s.expanded?"chevron-down":"chevron-right",size:16},null,8,["name"])],2)):(i(),l("span",Ze)),e("span",ea,v(s.node.label||"—"),1)])]),(i(!0),l(L,null,F(s.activeColumns,z=>(i(),l(L,{key:z},[z==="atingimento_p"?(i(),l("td",aa,[e("span",{class:N([h.value,"cell-content"]),title:y(z)},v(_(z)),11,ta)])):(i(),l("td",{key:1,class:N(z==="data"?"col-number col-date":"col-number")},[z!=="data"?(i(),l("span",{key:0,title:y(z),class:"cell-content"},v(_(z)),9,na)):(i(),l("span",oa,v(_(z)),1))],2))],64))),128)),e("td",ia,[e("span",sa,[e("button",{type:"button",class:"icon-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:r[1]||(r[1]=ne(z=>f("action",{type:"ticket",node:s.node}),["stop"]))},[A(D,{name:"ticket",size:16})]),s.node.level!=="contrato"?(i(),l("button",{key:0,type:"button",class:"icon-btn",title:"Ver oportunidades","aria-label":"Ver oportunidades",onClick:r[2]||(r[2]=ne(z=>f("action",{type:"opportunities",node:s.node}),["stop"]))},[A(D,{name:"bulb",size:16})])):j("",!0)])])],2),s.node.level==="contrato"&&s.expanded?(i(),l("tr",la,[e("td",{colspan:s.activeColumns.length+2,class:"tree-detail-cell"},[e("div",da,[e("div",ca,[e("button",{type:"button",class:"contract-detail-card__action-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:r[3]||(r[3]=ne(z=>f("action",{type:"ticket",node:s.node}),["stop"]))},[A(D,{name:"ticket",size:18}),r[6]||(r[6]=e("span",null,"Abrir chamado",-1))])]),G.value?(i(),l("div",ua,[e("div",_a,[A(D,{name:"alert-triangle",class:"contract-detail-card__warning-icon",size:20}),e("div",ma,[r[7]||(r[7]=e("strong",{class:"contract-detail-card__warning-title"},"Venda cancelada",-1)),e("p",va," Cancelado em "+v(B(K)(s.node.detail?.dt_cancelamento||""))+". "+v(s.node.detail?.motivo_cancelamento||"Solicitação do cliente"),1)])])])):j("",!0),e("div",pa,[e("table",ga,[r[8]||(r[8]=e("thead",null,[e("tr",null,[e("th",null,"Canal da venda"),e("th",null,"Tipo da venda"),e("th",null,"Gerente"),e("th",null,"Condição de pagamento"),e("th",null,"Data de vencimento"),e("th",null,"Data de cancelamento"),e("th",null,"Motivo do cancelamento")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,v(s.node.detail?.canal_venda||"—"),1),e("td",null,v(s.node.detail?.tipo_venda||"—"),1),e("td",null,v(s.node.detail?.gerente||"—"),1),e("td",null,v(s.node.detail?.modalidade_pagamento||"—"),1),e("td",null,v(s.node.detail?.dt_vencimento?B(K)(s.node.detail.dt_vencimento):"—"),1),e("td",null,v(s.node.detail?.dt_cancelamento?B(K)(s.node.detail.dt_cancelamento):"—"),1),e("td",null,v(s.node.detail?.motivo_cancelamento||"—"),1)])])])])])],8,ra)])):j("",!0),s.expanded&&R.value?(i(!0),l(L,{key:1},F(s.node.children,z=>(i(),Y($,{key:z.id,node:z,level:s.level+1,expanded:s.expandedRows?.has(z.id)||!1,"expanded-rows":s.expandedRows,"detail-open":!1,"active-columns":s.activeColumns,onToggle:r[4]||(r[4]=O=>f("toggle",O)),onAction:r[5]||(r[5]=O=>f("action",O))},null,8,["node","level","expanded","expanded-rows","active-columns"]))),128)):j("",!0)],64)}}}),ha=Z(ba,[["__scopeId","data-v-ee95ffe0"]]),fa={class:"chipbar"},ya=["data-view","onClick"],wa=X({__name:"TableViewChips",props:{views:{},activeView:{}},emits:["viewChange"],setup(s,{emit:u}){const S=s,f=u,R=g=>{g!==S.activeView&&f("viewChange",g)};return(g,h)=>(i(),l("div",fa,[(i(!0),l(L,null,F(s.views,_=>(i(),l("button",{key:_.id,type:"button",class:N(["chip",{"is-active":_.id===s.activeView}]),"data-view":_.id,onClick:y=>R(_.id)},v(_.label),11,ya))),128))]))}}),ka=Z(wa,[["__scopeId","data-v-d6322d2c"]]),$a={class:"detail-view-bar"},Ca={class:"detail-view-bar__left"},xa={class:"detail-view-chips"},Va=["onClick"],Sa=X({__name:"DetailViewBar",props:{views:{},activeViewId:{}},emits:["viewChange"],setup(s,{emit:u}){const S=s,f=u,R=g=>{g!==S.activeViewId&&f("viewChange",g)};return(g,h)=>(i(),l("div",$a,[e("div",Ca,[h[0]||(h[0]=e("span",{class:"detail-view-bar__label"},"Visões da tabela",-1)),e("div",xa,[(i(!0),l(L,null,F(s.views,_=>(i(),l("button",{key:_.id,type:"button",class:N(["detail-chip",{"is-active":_.id===s.activeViewId}]),onClick:y=>R(_.id)},[e("span",null,v(_.name),1)],10,Va))),128))])])]))}}),Ra=Z(Sa,[["__scopeId","data-v-52dcd004"]]),za={key:0,class:"applied-bar"},Aa={class:"k"},Da={class:"v"},ja=["aria-label","onClick"],Ta=X({__name:"AppliedFiltersBar",setup(s){const{filterState:u,clearFilter:S}=xe(),f=T(()=>{const g=[];return u.value.segmento&&u.value.segmento!=="Todos"&&g.push({key:"segmento",label:"Segmento",value:u.value.segmento}),u.value.diretoria&&u.value.diretoria!=="Todas"&&g.push({key:"diretoria",label:"Diretoria",value:u.value.diretoria}),u.value.gerencia&&u.value.gerencia!=="Todas"&&g.push({key:"gerencia",label:"Gerência",value:u.value.gerencia}),u.value.agencia&&u.value.agencia!=="Todas"&&g.push({key:"agencia",label:"Agência",value:u.value.agencia}),u.value.ggestao&&u.value.ggestao!=="Todos"&&g.push({key:"ggestao",label:"Gerente de gestão",value:u.value.ggestao}),u.value.gerente&&u.value.gerente!=="Todos"&&g.push({key:"gerente",label:"Gerente",value:u.value.gerente}),u.value.familia&&u.value.familia!=="Todas"&&g.push({key:"familia",label:"Família",value:u.value.familia}),u.value.indicador&&u.value.indicador!=="Todos"&&g.push({key:"indicador",label:"Indicador",value:u.value.indicador}),u.value.subindicador&&u.value.subindicador!=="Todos"&&g.push({key:"subindicador",label:"Subindicador",value:u.value.subindicador}),g}),R=g=>{S(g)};return(g,h)=>f.value.length>0?(i(),l("div",za,[(i(!0),l(L,null,F(f.value,_=>(i(),l("div",{key:_.key,class:"applied-chip"},[e("span",Aa,v(_.label),1),e("span",Da,v(_.value),1),e("button",{type:"button",title:"Limpar",class:"applied-x","aria-label":`Remover ${_.label}`,onClick:y=>R(_.key)},[A(D,{name:"x",size:14})],8,ja)]))),128))])):j("",!0)}}),La=Z(Ta,[["__scopeId","data-v-dba2fb80"]]),Ea={class:"detail-designer__panel",role:"dialog","aria-modal":"true","aria-labelledby":"detail-designer-title"},Ma={class:"detail-designer__head"},Ba={key:0,class:"detail-designer__feedback",role:"alert"},Na={key:1,class:"detail-designer__views"},Fa={class:"detail-designer__views-list"},Ga=["onClick"],Oa=["aria-label","onClick"],Pa={class:"detail-designer__lists"},Ia={class:"detail-designer__list detail-designer__list--available"},Ua={class:"detail-designer__items"},Ja={class:"detail-item__handle","aria-hidden":"true"},qa={class:"detail-item__label"},Ha=["aria-label","onClick"],Ka={key:0,class:"detail-designer__empty"},Wa={class:"detail-designer__list detail-designer__list--selected"},Qa={class:"detail-designer__items"},Ya={class:"detail-item__handle","aria-hidden":"true"},Xa={class:"detail-item__label"},Za=["disabled","aria-label","onClick"],et={key:0,class:"detail-designer__empty"},at={class:"detail-designer__foot"},tt={class:"detail-designer__save"},nt={class:"detail-designer__input-wrapper"},ot=["disabled"],it={class:"detail-designer__actions"},st=["disabled"],lt=X({__name:"DetailColumnDesigner",props:{modelValue:{type:Boolean},selectedColumns:{},views:{},activeViewId:{}},emits:["update:modelValue","apply","save","load-view","delete-view"],setup(s,{emit:u}){const S=[{id:"realizado",label:"Realizado no período (R$)"},{id:"meta",label:"Meta no período (R$)"},{id:"atingimento_p",label:"Atingimento (%)"},{id:"meta_diaria",label:"Meta diária total (R$)"},{id:"referencia_hoje",label:"Referência para hoje (R$)"},{id:"pontos",label:"Pontos no período (pts)"},{id:"meta_diaria_necessaria",label:"Meta diária necessária (R$)"},{id:"peso",label:"Peso (pts)"},{id:"projecao",label:"Projeção (R$)"},{id:"data",label:"Data"}],f=s,R=u,g=T({get:()=>f.modelValue,set:m=>R("update:modelValue",m)}),h=E([...f.selectedColumns]),_=E(""),y=E(""),G=T(()=>S.filter(m=>!h.value.includes(m.id))),w=T(()=>h.value.length>1),r=m=>{h.value.includes(m)||(h.value.push(m),y.value="")},$=m=>{if(h.value.length<=1){y.value="Mantenha pelo menos uma coluna visível.";return}h.value=h.value.filter(x=>x!==m),y.value=""},z=()=>{if(h.value.length===0){y.value="Adicione ao menos uma coluna.";return}R("apply",[...h.value]),g.value=!1,y.value=""},O=()=>{const m=_.value.trim();if(h.value.length===0){y.value="Adicione ao menos uma coluna antes de salvar.";return}if(m.length<3){y.value="Use um nome com pelo menos 3 caracteres.";return}R("save",m,[...h.value]),_.value="",y.value="Visão salva com sucesso."},P=m=>{const x=f.views?.find(k=>k.id===m);x&&(h.value=[...x.columns],y.value=""),R("load-view",m)},I=m=>{m!=="default"&&R("delete-view",m)},q=()=>{g.value=!1,h.value=[...f.selectedColumns],_.value="",y.value=""};return de(()=>f.selectedColumns,m=>{h.value=[...m]},{immediate:!0}),de(()=>f.modelValue,m=>{m&&(h.value=[...f.selectedColumns],_.value="",y.value="")}),(m,x)=>(i(),Y(Ie,{to:"body"},[g.value?(i(),l("div",{key:0,class:N(["detail-designer",{"is-open":g.value}]),onKeydown:be(q,["escape"])},[e("div",{class:"detail-designer__overlay",onClick:q}),e("div",Ea,[e("header",Ma,[x[1]||(x[1]=e("div",null,[e("h4",{id:"detail-designer-title"},"Personalizar colunas"),e("p",{class:"detail-designer__subtitle"}," Arraste as colunas para montar a visão da tabela e salve até 5 configurações preferidas. A coluna de ações continua fixa no final da grade. ")],-1)),e("button",{type:"button",class:"icon-btn detail-designer__close","aria-label":"Fechar personalização",onClick:q},[A(D,{name:"x",size:18})])]),y.value?(i(),l("div",Ba,v(y.value),1)):j("",!0),f.views&&f.views.length>0?(i(),l("section",Na,[x[2]||(x[2]=e("div",{class:"detail-designer__views-head"},[e("span",null,"VISÕES SALVAS"),e("span",{class:"detail-designer__views-hint"},"Carregue para ajustar ou excluir.")],-1)),e("div",Fa,[(i(!0),l(L,null,F(f.views,k=>(i(),l("div",{key:k.id,class:"detail-view-chip-wrapper"},[e("button",{type:"button",class:N(["detail-view-chip",{"is-active":f.activeViewId===k.id}]),onClick:U=>P(k.id)},v(k.name),11,Ga),k.id!=="default"?(i(),l("button",{key:0,type:"button",class:"detail-view-chip__delete","aria-label":`Remover visão ${k.name}`,onClick:ne(U=>I(k.id),["stop"])},[A(D,{name:"trash",size:16})],8,Oa)):j("",!0)]))),128))])])):j("",!0),e("section",Pa,[e("div",Ia,[x[3]||(x[3]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas disponíveis"),e("p",null,"Arraste para incluir ou clique para adicionar.")],-1)),e("div",Ua,[(i(!0),l(L,null,F(G.value,k=>(i(),l("div",{key:k.id,class:"detail-item detail-item--available"},[e("span",Ja,[A(D,{name:"grip-vertical",size:16})]),e("span",qa,v(k.label),1),e("button",{type:"button",class:"detail-item__add","aria-label":`Adicionar ${k.label}`,onClick:U=>r(k.id)},[A(D,{name:"plus",size:16})],8,Ha)]))),128)),G.value.length===0?(i(),l("p",Ka," Todas as colunas já estão na tabela. ")):j("",!0)])]),e("div",Wa,[x[4]||(x[4]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas na tabela"),e("p",null,"Arraste para reorganizar ou clique para remover.")],-1)),e("div",Qa,[(i(!0),l(L,null,F(h.value,k=>(i(),l("div",{key:k,class:N(["detail-item",{"is-disabled":!w.value}])},[e("span",Ya,[A(D,{name:"grip-vertical",size:16})]),e("span",Xa,v(S.find(U=>U.id===k)?.label||k),1),e("button",{type:"button",class:N(["detail-item__remove",{"is-disabled":!w.value}]),disabled:!w.value,"aria-label":`Remover ${S.find(U=>U.id===k)?.label||k}`,onClick:U=>$(k)},[A(D,{name:"x",size:18})],10,Za)],2))),128)),h.value.length===0?(i(),l("p",et," Escolha ao menos uma coluna. ")):j("",!0)])])]),e("footer",at,[e("div",tt,[x[5]||(x[5]=e("label",{for:"detail-view-name",class:"detail-designer__save-label"}," SALVAR NOVA VISÃO ",-1)),e("div",nt,[$e(e("input",{id:"detail-view-name","onUpdate:modelValue":x[0]||(x[0]=k=>_.value=k),type:"text",class:"input input--sm detail-designer__input",maxlength:"48",placeholder:"Ex.: Indicadores priorizados",onKeyup:be(O,["enter"])},null,544),[[Ce,_.value]]),e("button",{type:"button",class:"btn btn--primary detail-designer__save-btn",disabled:!_.value.trim()||_.value.trim().length<3,onClick:O}," Salvar visão ",8,ot)]),x[6]||(x[6]=e("small",{class:"detail-designer__save-hint"}," Você pode guardar até 5 visões personalizadas. ",-1))]),e("div",it,[e("button",{type:"button",class:"btn btn--secondary detail-designer__action-btn",onClick:q}," Cancelar "),e("button",{type:"button",class:"btn btn--primary detail-designer__action-btn",disabled:h.value.length===0,onClick:z}," Aplicar ",8,st)])])])],34)):j("",!0)]))}}),rt=Z(lt,[["__scopeId","data-v-97d15039"]]),dt={class:"detalhes-wrapper"},ct={class:"detalhes-view"},ut={class:"card card--detalhes"},_t={class:"card__header"},mt={class:"card__actions"},vt={class:"search-box"},pt={class:"table-controls"},gt={class:"table-controls__main"},bt={class:"table-controls__chips"},ht={class:"table-toolbar-wrapper"},ft={class:"table-toolbar"},yt={class:"table-toolbar__icon"},wt={class:"table-toolbar__icon"},kt={class:"table-toolbar__icon"},$t={key:0,class:"detalhes-skeleton"},Ct={key:3,class:"contratos-grid"},xt={class:"contrato-card__header"},Vt={class:"contrato-card__title"},St={class:"contrato-card__body"},Rt={class:"contrato-card__info"},zt={class:"contrato-card__info-item"},At={class:"contrato-card__value"},Dt={key:0,class:"contrato-card__info-item"},jt={class:"contrato-card__value"},Tt={class:"contrato-card__info-item"},Lt={class:"contrato-card__value"},Et={class:"contrato-card__info-item"},Mt={class:"contrato-card__value"},Bt={class:"contrato-card__info-item"},Nt={class:"contrato-card__value"},Ft={class:"contrato-card__metrics"},Gt={class:"contrato-card__metric"},Ot={class:"contrato-card__metric-value"},Pt={class:"contrato-card__metric"},It={class:"contrato-card__metric-value"},Ut={class:"contrato-card__metric"},Jt={class:"contrato-card__metric-value"},qt={class:"contrato-card__metric"},Ht={class:"contrato-card__metric-value"},Kt={key:0,class:"contrato-card__dates"},Wt={class:"contrato-card__date-item"},Qt={class:"contrato-card__date-value"},Yt={key:0,class:"contrato-card__date-item"},Xt={class:"contrato-card__date-value"},Zt={key:1,class:"contrato-card__cancelamento"},en={class:"contrato-card__cancelamento-value"},an={key:4,class:"table-wrapper"},tn={class:"tree-table"},nn=["aria-pressed"],on={class:"tree-sort__icon"},sn=["aria-pressed","onClick"],ln={class:"tree-sort__icon"},rn=X({__name:"Detalhes",setup(s){const u=qe(),{filterState:S}=xe(),{period:f}=Ye(),{detalhes:R,loading:g,error:h}=We(S,f),_=E(new Set),y=E(""),G=E("diretoria"),w=E("default"),r=E(!1),$=E({id:null,direction:null}),z=["realizado","meta","atingimento_p","meta_diaria","referencia_hoje","pontos","meta_diaria_necessaria","peso","projecao","data"],O=[...z];function P(n){const t=new Set,a=n.filter(o=>!z.includes(o)||t.has(o)?!1:(t.add(o),!0));return a.length?a:[...O]}const I=E(P(O)),q=[{id:"diretoria",label:"Diretoria",key:"diretoria"},{id:"gerencia",label:"Regional",key:"gerenciaRegional"},{id:"agencia",label:"Agência",key:"agencia"},{id:"gGestao",label:"Gerente de gestão",key:"gerenteGestao"},{id:"gerente",label:"Gerente",key:"gerente"},{id:"secao",label:"Família",key:"secao"},{id:"familia",label:"Indicador",key:"familia"},{id:"prodsub",label:"Subindicador",key:"prodOrSub"},{id:"contrato",label:"Contratos",key:"contrato"}],m=E([{id:"default",name:"Visão padrão",columns:P(O)}]),x={diretoria:["diretoria","regional","agencia","gGestao","gerente","familia","indicador","subindicador","contrato"],gerencia:["regional","agencia","gGestao","gerente","familia","indicador","subindicador","contrato"],agencia:["agencia","gGestao","gerente","familia","indicador","subindicador","contrato"],gGestao:["gGestao","gerente","familia","indicador","subindicador","contrato"],gerente:["gerente","familia","indicador","subindicador","contrato"],secao:["familia","indicador","subindicador","contrato"],familia:["indicador","subindicador","contrato"],prodsub:["subindicador","contrato"],contrato:["contrato"]};function k(n,t){if(t==="__label__")return n.label||"";const a=n.summary;switch(t){case"realizado":return a.valor_realizado||0;case"meta":return a.valor_meta||0;case"atingimento_v":return a.atingimento_v||0;case"atingimento_p":return a.atingimento_p||0;case"meta_diaria":return a.meta_diaria||0;case"referencia_hoje":return a.referencia_hoje||0;case"pontos":return a.pontos||0;case"meta_diaria_necessaria":return a.meta_diaria_necessaria||0;case"peso":return a.peso||0;case"projecao":return a.projecao||0;case"data":return a.data||"";default:return 0}}function U(n){return!$.value.id||!$.value.direction?n:[...n].sort((a,o)=>{const d=k(a,$.value.id),c=k(o,$.value.id);let b=0;return typeof d=="number"&&typeof c=="number"?b=d-c:b=String(d).localeCompare(String(c),"pt-BR"),$.value.direction==="asc"?b:-b}).map(a=>({...a,children:U(a.children)}))}const ce=T(()=>{if(!y.value.trim()||!R.value.length)return[];const n=y.value.toLowerCase().trim(),t=R.value.filter(d=>d.id_contrato?.toLowerCase().includes(n)||d.registro_id?.toLowerCase().includes(n)||d.gerente_nome?.toLowerCase().includes(n)||d.familia_nome?.toLowerCase().includes(n)||d.ds_indicador?.toLowerCase().includes(n)),a=new Map;t.forEach(d=>{const c=d.id_contrato||d.registro_id||"sem-contrato";a.has(c)||a.set(c,[]),a.get(c).push(d)});const o=[];return a.forEach((d,c)=>{const b=d[0];b&&o.push({id:`contrato-${c}`,contratoId:c,items:d,summary:ie(d),detail:{canal_venda:b.canal_venda,tipo_venda:b.tipo_venda,gerente:b.gerente_nome,gerente_gestao:b.gerente_gestao_nome,modalidade_pagamento:b.modalidade_pagamento,dt_vencimento:b.dt_vencimento,dt_cancelamento:b.dt_cancelamento,motivo_cancelamento:b.motivo_cancelamento}})}),$.value.id&&$.value.direction&&o.sort((d,c)=>{let b=0,p=0;if($.value.id==="__label__")b=d.contratoId,p=c.contratoId;else{const C=$.value.id;b=d.summary[C]??0,p=c.summary[C]??0}let V=0;return typeof b=="number"&&typeof p=="number"?V=b-p:V=String(b).localeCompare(String(p),"pt-BR"),$.value.direction==="asc"?V:-V}),o}),ae=T(()=>{if(!R.value.length||y.value.trim())return[];const n=x[G.value]||x.diretoria;let t=[];if(G.value==="contrato"){const a=new Map;R.value.forEach(o=>{const d=o.id_contrato||o.registro_id||"sem-contrato";a.has(d)||a.set(d,[]),a.get(d).push(o)}),a.forEach((o,d)=>{const c=o[0];c&&t.push({id:`contrato-${d}`,label:d,level:"contrato",children:[],data:o,summary:ie(o),detail:{canal_venda:c.canal_venda,tipo_venda:c.tipo_venda,gerente:c.gerente_nome,gerente_gestao:c.gerente_gestao_nome,modalidade_pagamento:c.modalidade_pagamento,dt_vencimento:c.dt_vencimento,dt_cancelamento:c.dt_cancelamento,motivo_cancelamento:c.motivo_cancelamento}})})}else{const a=n||x.diretoria;t=_e(R.value,a,0)}return U(t)}),oe=T(()=>y.value.trim().length>0);function ue(n){if(n.children.forEach(t=>ue(t)),n.children.length>0){const t=n.children.reduce((o,d)=>o+(d.summary.pontos||0),0),a=n.children.reduce((o,d)=>o+(d.summary.peso||0),0);n.summary.pontos=t,n.summary.peso=a}}function _e(n,t,a){if(a>=t.length||n.length===0)return[];const o=t[a],d=t[a+1],c=new Map;n.forEach(p=>{let V;switch(o){case"diretoria":V=p.diretoria_id||"sem-diretoria",p.diretoria_nome;break;case"regional":V=p.gerencia_id||"sem-regional",p.gerencia_nome;break;case"agencia":V=p.agencia_id||"sem-agencia",p.agencia_nome;break;case"gGestao":V=p.gerente_gestao_id||"sem-gerente-gestao",p.gerente_gestao_nome;break;case"gerente":V=p.gerente_id||"sem-gerente",p.gerente_nome;break;case"familia":V=p.familia_id||"sem-familia",p.familia_nome;break;case"indicador":V=p.id_indicador||"sem-indicador",p.ds_indicador;break;case"subindicador":V=p.id_subindicador||"sem-subindicador",p.subindicador;break;case"contrato":V=p.id_contrato||p.registro_id||"sem-contrato";break;default:V="unknown"}c.has(V)||c.set(V,[]),c.get(V).push(p)});const b=[];return c.forEach((p,V)=>{const C=p[0];if(!C)return;let M=C.diretoria_nome||"Sem label";switch(o){case"diretoria":M=C.diretoria_nome||"Sem diretoria";break;case"regional":M=C.gerencia_nome||"Sem regional";break;case"agencia":M=C.agencia_nome||"Sem agência";break;case"gGestao":M=C.gerente_gestao_nome||"Sem gerente de gestão";break;case"gerente":M=C.gerente_nome||"Sem gerente";break;case"familia":M=C.familia_nome||"Sem família";break;case"indicador":M=C.ds_indicador||"Sem indicador";break;case"subindicador":M=C.subindicador||"Sem subindicador";break;case"contrato":M=C.id_contrato||C.registro_id||"Sem contrato";break}const te={id:`${o}-${V}`,label:M,level:o,children:d?_e(p,t,a+1):[],data:p,summary:ie(p)};o==="contrato"&&(te.detail={canal_venda:C.canal_venda||void 0,tipo_venda:C.tipo_venda||void 0,gerente:C.gerente_nome||void 0,modalidade_pagamento:C.modalidade_pagamento||void 0,dt_vencimento:C.dt_vencimento||void 0,dt_cancelamento:C.dt_cancelamento||void 0,motivo_cancelamento:C.motivo_cancelamento||void 0}),b.push(te)}),b.forEach(p=>ue(p)),b}function ie(n){const t=n.reduce((H,J)=>H+(J.valor_realizado||0),0),a=n.reduce((H,J)=>H+(J.valor_meta||J.meta_mensal||0),0),o=n.reduce((H,J)=>H+(J.peso||0),0),d=n.reduce((H,J)=>H+(J.peso||0),0),c=30,b=new Date().getDate(),p=Math.max(1,c-b),V=a/c,C=b>0?Math.min(a,V*b):0,M=p>0?Math.max(0,(a-t)/p):0,te=b>0?t/Math.max(b,1)*c:t,Fe=t-a,Ge=a>0?t/a*100:0,le=n.length>0?n[0]:null,Oe=le&&(le.data||le.competencia)||"";return{valor_realizado:t,valor_meta:a,atingimento_v:Fe,atingimento_p:Ge,meta_diaria:V,referencia_hoje:C,pontos:o,meta_diaria_necessaria:M,peso:d,projecao:te,data:Oe}}const se=E(new Set);function Ve(n){if(n.type==="ticket"){const t=Se(n.node),a=new URLSearchParams({openDrawer:"true",intent:"new-ticket",preferredQueue:"POBJ",queue:"POBJ",observation:t}),o=u.resolve({name:"Omega",query:Object.fromEntries(a)});window.open(o.href,"_blank")}else n.type==="opportunities"&&console.log("Abrir oportunidades para:",n.node)}function Se(n){const t=[];if(n.label&&t.push(`Item: ${n.label}`),n.level&&t.push(`Nível: ${n.level}`),n.summary){const a=n.summary;a.valor_realizado&&t.push(`Realizado: R$ ${a.valor_realizado.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.valor_meta&&t.push(`Meta: R$ ${a.valor_meta.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.atingimento_p!==void 0&&t.push(`Atingimento: ${a.atingimento_p.toFixed(1)}%`)}if(n.detail){const a=n.detail;a.gerente&&t.push(`Gerente: ${a.gerente}`),a.canal_venda&&t.push(`Canal: ${a.canal_venda}`),a.tipo_venda&&t.push(`Tipo de venda: ${a.tipo_venda}`)}return t.join(`
`)}function Re(n){const a=me(ae.value,n)?.level==="contrato";_.value.has(n)?(_.value.delete(n),a&&se.value.delete(n)):(_.value.add(n),a&&se.value.add(n))}function me(n,t){for(const a of n){if(a.id===t)return a;const o=me(a.children,t);if(o)return o}return null}const ze=T(()=>{const n=q.find(t=>t.id===G.value);return n?n.label:"Item"});function Ae(n){return{realizado:"Realizado no período (R$)",meta:"Meta no período (R$)",atingimento_p:"Atingimento (%)",meta_diaria:"Meta diária total (R$)",referencia_hoje:"Referência para hoje (R$)",pontos:"Pontos no período (pts)",meta_diaria_necessaria:"Meta diária necessária (R$)",peso:"Peso (pts)",projecao:"Projeção (R$)",data:"Data"}[n]||n}function ve(n){return $.value.id!==n||!$.value.direction?"arrows-up-down":$.value.direction==="asc"?"arrow-up":"arrow-down"}function pe(n){const t=$.value,o=n==="__label__"?"asc":"desc",d=o==="asc"?"desc":"asc";let c;t.id!==n||!t.direction?c=o:t.direction===o?c=d:c=null,c?$.value={id:n,direction:c}:$.value={id:null,direction:null}}function De(n){return _.value.has(n)}function je(){const n=[];function t(a){a.forEach(o=>{o.children.length>0&&(n.push(o.id),t(o.children))})}t(ae.value),_.value=new Set(n)}function Te(){_.value.clear()}function Le(n){G.value=n}function ge(n){w.value=n;const t=m.value.find(a=>a.id===n);if(t){const a=P(t.columns);t.columns=a,I.value=[...a]}}function Ee(){r.value=!0}function Me(n,t){const a=P(t),o=m.value.find(d=>d.name.toLowerCase()===n.toLowerCase()&&d.id!=="default");if(o)o.columns=[...a],w.value=o.id;else{if(m.value.filter(b=>b.id!=="default").length>=5){alert("Você já possui 5 visões personalizadas. Exclua uma antes de criar outra.");return}const c={id:`custom-${Date.now()}`,name:n,columns:[...a]};m.value.push(c),w.value=c.id}I.value=[...a],localStorage.setItem("pobj3:detailViews",JSON.stringify(m.value.filter(d=>d.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",w.value)}function Be(n){if(n==="default")return;const t=m.value.findIndex(a=>a.id===n);if(t>-1){if(m.value.splice(t,1),w.value===n){w.value="default";const a=m.value.find(o=>o.id==="default");if(a){const o=P(a.columns);a.columns=o,I.value=[...o]}}localStorage.setItem("pobj3:detailViews",JSON.stringify(m.value.filter(a=>a.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",w.value)}}function Ne(n){const t=P(n);if(I.value=[...t],w.value==="__custom__"||w.value.startsWith("custom-")){const a=m.value.find(o=>o.id===w.value);a&&(a.columns=[...t],localStorage.setItem("pobj3:detailViews",JSON.stringify(m.value.filter(o=>o.id!=="default"))))}localStorage.setItem("pobj3:detailActiveView",w.value)}return ke(()=>{try{const n=localStorage.getItem("pobj3:detailViews");if(n){const a=JSON.parse(n);Array.isArray(a)&&(m.value=[...m.value,...a.map(o=>({id:o.id||`custom-${Date.now()}`,name:o.name||"Visão personalizada",columns:P(Array.isArray(o.columns)?o.columns:[])}))])}const t=localStorage.getItem("pobj3:detailActiveView");if(t){const a=m.value.find(o=>o.id===t);if(a){w.value=t;const o=P(a.columns);a.columns=o,I.value=[...o]}}}catch(n){console.error("Erro ao carregar visões salvas:",n)}}),(n,t)=>(i(),l("div",dt,[e("div",ct,[e("div",ut,[e("header",_t,[t[4]||(t[4]=e("div",{class:"title-subtitle"},[e("h3",null,"Detalhamento"),e("p",{class:"muted"},"Visualize os contratos em uma estrutura hierárquica")],-1)),e("div",mt,[e("div",vt,[$e(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),type:"text",placeholder:"Contrato (Ex.: 999999)",class:"input input--search"},null,512),[[Ce,y.value]])])])]),A(La),e("div",pt,[e("div",gt,[e("div",bt,[A(ka,{views:q,"active-view":G.value,onViewChange:Le},null,8,["active-view"])]),t[5]||(t[5]=e("div",{class:"table-controls__search"},null,-1))])]),A(Ra,{views:m.value,"active-view-id":w.value,onViewChange:ge},null,8,["views","active-view-id"]),e("div",ht,[e("div",ft,[e("button",{type:"button",class:"table-toolbar__btn",onClick:je},[e("span",yt,[A(D,{name:"chevrons-down",size:16})]),t[6]||(t[6]=e("span",{class:"table-toolbar__text"},"Expandir tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn",onClick:Te},[e("span",wt,[A(D,{name:"chevrons-up",size:16})]),t[7]||(t[7]=e("span",{class:"table-toolbar__text"},"Recolher tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn detail-view-manage",title:"Personalizar colunas da tabela",onClick:Ee},[e("span",kt,[A(D,{name:"columns",size:16})]),t[8]||(t[8]=e("span",{class:"table-toolbar__text"},"Personalizar colunas",-1))])])]),B(g)?(i(),l("div",$t,[...t[9]||(t[9]=[Ue('<div class="skeleton skeleton--table-header" style="height:40px;width:100%;margin-bottom:12px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-8c3fa486></div>',10)])])):(i(),l(L,{key:1},[B(h)?(i(),Y(Qe,{key:0,message:B(h)},null,8,["message"])):oe.value&&ce.value.length===0?(i(),Y(we,{key:1,title:"Nenhum contrato encontrado",message:"Nenhum contrato encontrado para a busca."})):!oe.value&&ae.value.length===0?(i(),Y(we,{key:2,title:"Nenhum dado encontrado",message:"Nenhum dado encontrado para os filtros selecionados."})):oe.value?(i(),l("div",Ct,[(i(!0),l(L,null,F(ce.value,a=>(i(),l("div",{key:a.id,class:"contrato-card"},[e("div",xt,[e("h4",Vt,v(a.contratoId),1),e("div",{class:N(["contrato-card__badge",{"is-success":a.summary.atingimento_p>=100,"is-warning":a.summary.atingimento_p>=50&&a.summary.atingimento_p<100,"is-danger":a.summary.atingimento_p<50}])},v(a.summary.atingimento_p.toFixed(1))+"% ",3)]),e("div",St,[e("div",Rt,[e("div",zt,[t[10]||(t[10]=e("span",{class:"contrato-card__label"},"Gerente:",-1)),e("span",At,v(a.detail.gerente||"—"),1)]),a.detail.gerente_gestao?(i(),l("div",Dt,[t[11]||(t[11]=e("span",{class:"contrato-card__label"},"Gerente de gestão:",-1)),e("span",jt,v(a.detail.gerente_gestao),1)])):j("",!0),e("div",Tt,[t[12]||(t[12]=e("span",{class:"contrato-card__label"},"Canal:",-1)),e("span",Lt,v(a.detail.canal_venda||"—"),1)]),e("div",Et,[t[13]||(t[13]=e("span",{class:"contrato-card__label"},"Tipo:",-1)),e("span",Mt,v(a.detail.tipo_venda||"—"),1)]),e("div",Bt,[t[14]||(t[14]=e("span",{class:"contrato-card__label"},"Modalidade:",-1)),e("span",Nt,v(a.detail.modalidade_pagamento||"—"),1)])]),e("div",Ft,[e("div",Gt,[t[15]||(t[15]=e("span",{class:"contrato-card__metric-label"},"Realizado",-1)),e("span",Ot,v(B(ye)(a.summary.valor_realizado)),1)]),e("div",Pt,[t[16]||(t[16]=e("span",{class:"contrato-card__metric-label"},"Meta",-1)),e("span",It,v(B(ye)(a.summary.valor_meta)),1)]),e("div",Ut,[t[17]||(t[17]=e("span",{class:"contrato-card__metric-label"},"Pontos",-1)),e("span",Jt,v(B(ee)(a.summary.pontos)),1)]),e("div",qt,[t[18]||(t[18]=e("span",{class:"contrato-card__metric-label"},"Peso",-1)),e("span",Ht,v(B(ee)(a.summary.peso)),1)])]),a.detail.dt_vencimento?(i(),l("div",Kt,[e("div",Wt,[t[19]||(t[19]=e("span",{class:"contrato-card__date-label"},"Vencimento:",-1)),e("span",Qt,v(B(K)(a.detail.dt_vencimento)),1)]),a.detail.dt_cancelamento?(i(),l("div",Yt,[t[20]||(t[20]=e("span",{class:"contrato-card__date-label"},"Cancelamento:",-1)),e("span",Xt,v(B(K)(a.detail.dt_cancelamento)),1)])):j("",!0)])):j("",!0),a.detail.motivo_cancelamento?(i(),l("div",Zt,[t[21]||(t[21]=e("span",{class:"contrato-card__cancelamento-label"},"Motivo:",-1)),e("span",en,v(a.detail.motivo_cancelamento),1)])):j("",!0)])]))),128))])):(i(),l("div",an,[e("table",tn,[e("thead",null,[e("tr",null,[e("th",null,[e("button",{type:"button",class:"tree-sort","aria-pressed":$.value.id==="__label__"&&$.value.direction?"true":"false",onClick:t[1]||(t[1]=a=>pe("__label__"))},[he(v(ze.value)+" ",1),e("span",on,[A(D,{name:ve("__label__"),size:16},null,8,["name"])])],8,nn)]),(i(!0),l(L,null,F(I.value,a=>(i(),l("th",{key:a,class:"col-number"},[e("button",{type:"button",class:"tree-sort","aria-pressed":$.value.id===a&&$.value.direction?"true":"false",onClick:o=>pe(a)},[he(v(Ae(a))+" ",1),e("span",ln,[A(D,{name:ve(a),size:16},null,8,["name"])])],8,sn)]))),128))])]),e("tbody",null,[(i(!0),l(L,null,F(ae.value,a=>(i(),Y(ha,{key:a.id,node:a,level:0,expanded:De(a.id),"expanded-rows":_.value,"detail-open":se.value.has(a.id),"active-columns":I.value,onToggle:t[2]||(t[2]=o=>Re(o)),onAction:Ve},null,8,["node","expanded","expanded-rows","detail-open","active-columns"]))),128))])])]))],64))])]),A(rt,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=a=>r.value=a),"selected-columns":I.value,views:m.value,"active-view-id":w.value,onApply:Ne,onSave:Me,onLoadView:ge,onDeleteView:Be},null,8,["modelValue","selected-columns","views","active-view-id"])]))}}),fn=Z(rn,[["__scopeId","data-v-8c3fa486"]]);export{fn as default};
