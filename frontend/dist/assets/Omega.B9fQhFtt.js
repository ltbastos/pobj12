import{_ as Ke}from"./pdf-vendor.BFzd3waL.js";import{e as F,r as O,b as oe,w as G,g as _e,m as S,j as L,q as e,t as x,B as he,G as K,H as W,F as Z,D as ae,N as ye,o as w,E as I,k as ie,C as me,n as te,y as Ue,P as We,x as Ze,Q as et,u as j}from"./vendor.Mb-DmQZ9.js";import{u as tt}from"./vue-router.BEbJbLaE.js";import{b as pe,a as ue,I as M,_ as ne}from"./index.Dr26WDVJ.js";import{S as ge}from"./SelectInput.CNcITHn6.js";import{S as at}from"./SelectSearch.Bunzz3_B.js";import"./icons-vendor.vP8HAgRq.js";function Ne(a){let m="usuario";a.admin?m="admin":a.supervisor?m="supervisor":a.analista&&(m="analista");const l={usuario:a.usuario||!1,analista:a.analista||!1,supervisor:a.supervisor||!1,admin:a.admin||!1},h=[];return a.encarteiramento&&h.push("encarteiramento"),a.meta&&h.push("Metas"),a.orcamento&&h.push("Orçamento"),a.pobj&&h.push("pobj"),a.matriz&&h.push("Matriz"),a.outros&&h.push("Outros"),{id:a.id,name:a.nome,role:m,roles:l,matrixAccess:!1,avatar:null,position:a.cargo,junction:"",functional:a.funcional,queues:h,defaultQueue:h.length>0&&h[0]||null,teamId:null}}function ot(a){if(!a||typeof a!="string")return[];const m=[],l=a.split("||");for(const h of l){const n=h.split("::");if(n.length>=5)try{m.push({date:n[0]||"",actorId:n[1]||"",action:n[2]||"",comment:n[3]||"",status:n[4]||"",attachments:n[5]?typeof n[5]=="string"?JSON.parse(n[5]):n[5]:void 0})}catch{m.push({date:n[0]||"",actorId:n[1]||"",action:n[2]||"",comment:n[3]||"",status:n[4]||""})}}return m}function Ve(a,m){const h=m.find(z=>z.id===a.requester_id)?.name||"Desconhecido",n={diretoria:a.diretoria||"",gerencia:a.gerencia||"",agencia:a.agencia||"",ggestao:a.gerente_gestao||"",gerente:a.gerente||"",familia:a.family||"",secao:a.section||"",prodsub:a.product_id||""},k=[];return a.attachment&&k.push(a.attachment),{id:a.id,subject:a.subject,company:a.company,requesterName:h,productId:a.product_id,product:a.product_label,family:a.family,section:a.section,queue:a.queue,status:a.status,category:a.category,priority:a.priority,opened:a.opened,updated:a.updated,dueDate:a.due_date,requesterId:a.requester_id,ownerId:a.owner_id,teamId:a.team_id,context:n,history:ot(a.history),credit:a.credit||void 0,attachments:k,flow:null}}function Pe(a){return{id:a.id,label:a.label,tone:a.tone,description:a.descricao,order:a.ordem,departmentId:a.departamento_id}}async function Me(){const a=await ue("/api/omega/init");if(a.success&&a.data){const m=a.data,l=m.users?m.users.map(Ne):[],h=m.statuses?m.statuses.map(Pe):[],n=m.tickets?m.tickets.map(k=>Ve(k,l)):[];return{structure:m.structure||[],statuses:h,users:l,tickets:n,mesu:m.mesu||[]}}return null}async function Ae(){const a=await ue("/api/omega/users");return a.success&&a.data?a.data.map(Ne):null}async function Le(){const a=await ue("/api/omega/tickets");if(a.success&&a.data){const l=await Ae()||[];return a.data.map(h=>Ve(h,l))}return null}async function Be(){const a=await ue("/api/omega/statuses");return a.success&&a.data?a.data.map(Pe):null}async function Re(){const a=await ue("/api/omega/structure");return a.success&&a.data?a.data:null}async function je(){const a=await ue("/api/omega/mesu");return a.success&&a.data?a.data:null}async function Ge(a){return pe("/api/omega/tickets",a)}async function Qe(a,m){return pe(`/api/omega/tickets/${a}`,m)}const nt=Object.freeze(Object.defineProperty({__proto__:null,createOmegaTicket:Ge,getOmegaInit:Me,getOmegaMesu:je,getOmegaStatuses:Be,getOmegaStructure:Re,getOmegaTickets:Le,getOmegaUsers:Ae,updateOmegaTicket:Qe},Symbol.toStringTag,{value:"Module"})),Oe={usuario:"Usuário",analista:"Analista",supervisor:"Supervisor",admin:"Administrador"},xe=[{id:"my",label:"Meus chamados",icon:"ti ti-user",roles:["usuario","analista","supervisor","admin"]},{id:"assigned",label:"Meus atendimentos",icon:"ti ti-clipboard-check",roles:["analista","supervisor","admin"]},{id:"queue",label:"Fila da equipe",icon:"ti ti-inbox",roles:["analista","supervisor","admin"]},{id:"team",label:"Visão da supervisão",icon:"ti ti-users",roles:["supervisor","admin"],children:[{id:"team-edit-analyst",label:"Gerenciar analistas",icon:"ti ti-user-cog",roles:[]},{id:"team-edit-status",label:"Editar status",icon:"ti ti-adjustments-alt",roles:[]},{id:"team-graphs",label:"Gráficos",icon:"ti ti-chart-arcs",roles:[]}]},{id:"admin",label:"Administração",icon:"ti ti-shield-lock",roles:["admin"]}],Ee={baixa:{label:"Baixa",tone:"neutral",icon:"ti ti-arrow-down"},media:{label:"Média",tone:"progress",icon:"ti ti-arrows-up-down"},alta:{label:"Alta",tone:"warning",icon:"ti ti-arrow-up"},critica:{label:"Crítica",tone:"danger",icon:"ti ti-alert-octagon"}},de=[{id:"aberto",label:"Aberto",tone:"neutral",order:1,departmentId:"0"},{id:"aguardando",label:"Aguardando",tone:"warning",order:2,departmentId:"0"},{id:"em_atendimento",label:"Em atendimento",tone:"progress",order:3,departmentId:"0"},{id:"resolvido",label:"Resolvido",tone:"success",order:4,departmentId:"0"},{id:"cancelado",label:"Cancelado",tone:"danger",order:5,departmentId:"0"}],He=["resolvido","cancelado","finalizado"];function ze(a){return He.includes(a.toLowerCase())}const Fe=O(null),ee=O([]),ve=O([]),le=O([]),Ie=O([]),Te=O([]),Q=O(!1),H=O(null),re=O(null),De=O("my");let be=null;function st(){const a=async()=>be||(Q.value=!0,H.value=null,be=Me().then(t=>(t&&(Fe.value=t,Array.isArray(t.structure)&&(Ie.value=t.structure),Array.isArray(t.statuses)?le.value=t.statuses.length>0?t.statuses:de:le.value=de,Array.isArray(t.users)&&(ee.value=t.users,ee.value.length>0&&!re.value&&(re.value=ee.value[0]?.id||null)),Array.isArray(t.tickets)&&(ve.value=t.tickets),Array.isArray(t.mesu)&&(Te.value=t.mesu)),t)).catch(t=>(H.value=t instanceof Error?t.message:"Erro ao carregar dados do Omega",console.error("❌ Erro ao carregar dados de inicialização do Omega:",t),null)).finally(()=>{Q.value=!1,be=null}),be),m=async()=>{Q.value=!0,H.value=null;try{const t=await Ae();return t?(ee.value=t,ee.value.length>0&&!re.value&&(re.value=ee.value[0]?.id||null),t):null}catch(t){return H.value=t instanceof Error?t.message:"Erro ao carregar usuários",console.error("Erro ao carregar usuários do Omega:",t),null}finally{Q.value=!1}},l=async()=>{Q.value=!0,H.value=null;try{const t=await Le();return t?(ve.value=t,t):null}catch(t){return H.value=t instanceof Error?t.message:"Erro ao carregar tickets",console.error("Erro ao carregar tickets do Omega:",t),null}finally{Q.value=!1}},h=async()=>{Q.value=!0,H.value=null;try{const t=await Be();return t?(le.value=t.length>0?t:de,le.value):(le.value=de,le.value)}catch(t){return H.value=t instanceof Error?t.message:"Erro ao carregar status",console.error("Erro ao carregar status do Omega:",t),le.value=de,le.value}finally{Q.value=!1}},n=async()=>{Q.value=!0,H.value=null;try{const t=await Re();return t?(Ie.value=t,t):null}catch(t){return H.value=t instanceof Error?t.message:"Erro ao carregar estrutura",console.error("Erro ao carregar estrutura do Omega:",t),null}finally{Q.value=!1}},k=async()=>{Q.value=!0,H.value=null;try{const t=await je();return t?(Te.value=t,t):null}catch(t){return H.value=t instanceof Error?t.message:"Erro ao carregar MESU",console.error("Erro ao carregar MESU do Omega:",t),null}finally{Q.value=!1}},z=async t=>{Q.value=!0,H.value=null;try{const s=await Ge(t);if(s.success&&s.data){const f=Array.isArray(s.data)?s.data[0]:s.data;if(f)return ve.value.unshift(f),f}throw new Error(s.error||"Erro ao criar ticket")}catch(s){return H.value=s instanceof Error?s.message:"Erro ao criar ticket",console.error("Erro ao criar ticket do Omega:",s),null}finally{Q.value=!1}},A=async(t,s)=>{Q.value=!0,H.value=null;try{const f=await Qe(t,s);if(f.success&&f.data)return await l(),ve.value.find(N=>N.id===t)||null;throw new Error(f.error||"Erro ao atualizar ticket")}catch(f){return H.value=f instanceof Error?f.message:"Erro ao atualizar ticket",console.error("Erro ao atualizar ticket do Omega:",f),null}finally{Q.value=!1}},v=F(()=>!ee.value.length||!re.value?null:ee.value.find(t=>t.id===re.value)||ee.value[0]||null),i=t=>xe.filter(s=>s.roles.includes(t)),c=t=>Oe[t]||t,d=t=>Ee[t]||Ee.media,b=t=>{re.value=t},r=t=>{De.value=t},o=t=>!ze(t.status);return{initData:F(()=>Fe.value),users:F(()=>ee.value),tickets:F(()=>ve.value),statuses:F(()=>le.value),structure:F(()=>Ie.value),mesu:F(()=>Te.value),isLoading:F(()=>Q.value),error:F(()=>H.value),currentUserId:F(()=>re.value),currentView:F(()=>De.value),currentUser:v,loadInit:a,loadUsers:m,loadTickets:l,loadStatuses:h,loadStructure:n,loadMesu:k,createTicket:z,updateTicket:A,getNavItemsForRole:i,getRoleLabel:c,getPriorityMeta:d,setCurrentUserId:b,setCurrentView:r,canUserReply:o,isFinalStatus:ze,constants:{ROLE_LABELS:Oe,NAV_ITEMS:xe,PRIORITY_META:Ee,DEFAULT_STATUSES:de,FINAL_STATUSES:He}}}function lt(){const a=O({id:"",requester:"",type:"",priority:"",statuses:[],departments:[],openedFrom:"",openedTo:""}),m=O(!1);function l(){a.value={id:"",requester:"",type:"",priority:"",statuses:[],departments:[],openedFrom:"",openedTo:""}}function h(){const i=a.value;return!!(i.id||i.requester||i.type||i.priority||i.statuses.length||i.openedFrom||i.openedTo||i.departments.length)}function n(i){let c=[...i];const d=a.value;if(d.id){const b=d.id.toLowerCase().trim();c=c.filter(r=>r.id.toLowerCase().includes(b))}if(d.departments.length&&(c=c.filter(b=>d.departments.includes(b.queue||""))),d.type&&(c=c.filter(b=>b.category===d.type)),d.priority&&(c=c.filter(b=>b.priority===d.priority)),d.statuses.length&&(c=c.filter(b=>d.statuses.includes(b.status))),d.requester){const b=d.requester.toLowerCase().trim();c=c.filter(r=>(r.requesterName?.toLowerCase()||"").includes(b))}return(d.openedFrom||d.openedTo)&&(c=c.filter(b=>{if(!b.opened)return!1;const r=new Date(b.opened);if(d.openedFrom){const o=new Date(d.openedFrom+"T00:00:00");if(r<o)return!1}if(d.openedTo){const o=new Date(d.openedTo+"T23:59:59");if(r>o)return!1}return!0})),c.sort((b,r)=>{const o=new Date(b.updated||b.opened||0).getTime();return new Date(r.updated||r.opened||0).getTime()-o}),c}function k(i){const c=i.querySelector("#omega-filter-form");if(!c)return;const d=c.querySelector("#omega-filter-id")?.value?.trim()||"",b=c.querySelector("#omega-filter-user")?.value?.trim()||"",r=c.querySelector("#omega-filter-type")?.value||"",o=c.querySelector("#omega-filter-priority")?.value||"",t=Array.from(c.querySelectorAll('#omega-filter-status input[type="checkbox"]:checked')).map(V=>V.value).filter(Boolean),s=c.querySelector("#omega-filter-department")?.value||"",f=s?[s]:[],y=c.querySelector("#omega-filter-from")?.value||"",N=c.querySelector("#omega-filter-to")?.value||"";a.value={id:d,requester:b,type:r,priority:o,statuses:t,departments:f,openedFrom:y,openedTo:N},m.value=!1}function z(i){a.value={...i},m.value=!1}function A(i){const c=i.querySelector("#omega-filter-form");if(!c)return;const d=c.querySelector("#omega-filter-id");d&&(d.value=a.value.id||"");const b=c.querySelector("#omega-filter-user");b&&(b.value=a.value.requester||"");const r=c.querySelector("#omega-filter-type");r&&(r.value=a.value.type||"");const o=c.querySelector("#omega-filter-priority");o&&(o.value=a.value.priority||"");const t=c.querySelector("#omega-filter-department");t&&(t.value=a.value.departments[0]||"");const s=c.querySelector("#omega-filter-from");s&&(s.value=a.value.openedFrom||"");const f=c.querySelector("#omega-filter-to");f&&(f.value=a.value.openedTo||"");const y=c.querySelector("#omega-filter-status");y&&y.querySelectorAll(".omega-filter-status__option").forEach(N=>{const V=N.querySelector('input[type="checkbox"]');if(!V)return;const g=a.value.statuses.includes(V.value);V.checked=g,N.setAttribute("data-checked",g?"true":"false")})}function v(i){m.value=typeof i=="boolean"?i:!m.value}return{filters:a,filterPanelOpen:m,resetFilters:l,hasActiveFilters:h,applyFilters:n,applyFiltersFromForm:k,applyFiltersFromFormValues:z,syncFilterFormState:A,toggleFilterPanel:v}}async function Ye(a,m){try{return await pe("/api/omega/notifications",{ticketId:a.id,ticketSubject:a.subject,date:m.date||new Date().toISOString(),actorId:m.actorId||"",action:m.action||"",comment:m.comment||"",status:m.status||a.status,type:"status_update"})}catch(l){return console.error("Erro ao criar notificação no Omega:",l),{success:!1,error:"Erro ao criar notificação"}}}async function Je(a,m){if(a.queue?.toLowerCase()!=="pobj")return{success:!0,data:null};try{return await pe("/api/pobj/notifications",{ticketId:a.id,ticketSubject:a.subject,date:m.date||new Date().toISOString(),actorId:m.actorId||"",action:m.action||"",comment:m.comment||"",status:m.status||a.status})}catch(l){return console.error("Erro ao criar notificação no POBJ:",l),{success:!1,error:"Erro ao criar notificação"}}}function rt(a){const m=O(new Set),l=O(!1),h=O(""),n=F(()=>a.statuses.value.map(i=>({value:i.id,label:i.label})));function k(i){const c=i.querySelector("#omega-bulk-status-select");if(!c)return;const d=a.statuses.value;for(;c.firstChild;)c.removeChild(c.firstChild);d.forEach(r=>{const o=document.createElement("option");o.value=r.id,o.textContent=r.label,c.appendChild(o)});const b=h.value&&d.some(r=>r.id===h.value)?h.value:d[0]?.id||"";c.value=b,h.value=b}async function z(i){const c=a.statuses.value.map(t=>t.id);if(!i||!c.includes(i))return;const d=Array.from(m.value);if(!d.length)return;const b=a.currentUser.value;if(!b)return;const r=new Date().toISOString(),o=a.statuses.value.find(t=>t.id===i)||{label:i};for(const t of d){const s=a.tickets.value.find(f=>f.id===t);if(s){s.status=i,s.updated=r,Array.isArray(s.history)&&s.history.push({date:r,actorId:b.id,action:`Status atualizado em lote para ${o.label}`,comment:"",status:i,attachments:[]}),await Ye(s,{date:r,actorId:b.id,action:`Status atualizado em lote para ${o.label}`,comment:"",status:i}),(s.queue==="pobj"||s.queue?.toLowerCase()==="pobj")&&await Je(s,{date:r,actorId:b.id,action:`Status atualizado em lote para ${o.label}`,comment:"",status:i});try{await a.updateTicket(t,{status:i,updated:r})}catch(f){console.error(`Erro ao atualizar ticket ${t}:`,f)}}}l.value=!1,m.value.clear()}function A(i){const c=i.querySelector("#omega-bulk-panel");if(!c)return;const d=m.value.size>0;c&&(c.hidden=!l.value||!d);const b=i.querySelector("#omega-bulk-status");if(b&&(b.disabled=!d),l.value&&d){k(i);const r=i.querySelector("#omega-bulk-hint");if(r){const o=m.value.size;r.textContent=o===1?"1 chamado selecionado":`${o} chamados selecionados`}}}function v(i,c){}return{selectedTicketIds:m,bulkPanelOpen:l,bulkStatus:h,bulkStatusOptions:n,populateBulkStatusOptions:k,handleBulkStatusSubmit:z,renderBulkPanel:A,setupBulkControls:v}}function it(a,m,l){function h(r){const o=r.querySelector("#omega-user-select");if(!o)return;const t=a.users.value;for(;o.firstChild;)o.removeChild(o.firstChild);t.forEach(s=>{const f=document.createElement("option");f.value=s.id,f.textContent=s.name,s.id===a.currentUserId.value&&(f.selected=!0),o.appendChild(f)}),o.onchange=s=>{const f=s.target;a.setCurrentUserId(f.value),n(r),d(r)}}function n(r){const o=a.currentUser.value;if(!o)return;const t=r.querySelector("#omega-avatar"),s=r.querySelector("#omega-user-name");t&&(o.avatar?(t.src=o.avatar,t.removeAttribute("hidden")):t.hidden=!0),s&&(s.textContent=o.name)}function k(r){const o=r.querySelector("#omega-nav");if(!o)return;const t=a.currentUser.value;if(!t)return;const s=a.getNavItemsForRole(t.role);for(;o.firstChild;)o.removeChild(o.firstChild);s.forEach(f=>{const y=document.createElement("button");y.className="omega-nav__item",y.type="button",y.setAttribute("data-omega-view",f.id);const N=document.createElement("i");N.className=f.icon;const V=document.createElement("span");V.textContent=f.label,y.appendChild(N),y.appendChild(V),f.id===a.currentView.value&&y.classList.add("omega-nav__item--active"),y.onclick=()=>{a.setCurrentView(f.id),d(r),o.querySelectorAll(".omega-nav__item").forEach(g=>{g.classList.remove("omega-nav__item--active")}),y.classList.add("omega-nav__item--active")},o.appendChild(y)})}function z(r){const o=a.structure.value;if(!o||o.length===0)return;const t=r.querySelector("#omega-filter-department");if(t){const f=t.value,y=t.cloneNode(!0);t.parentNode?.replaceChild(y,t);const N=new Map;for(o.forEach(g=>{g.departamento&&!N.has(g.departamento)&&N.set(g.departamento,g.departamento_id||g.departamento)});y.firstChild;)y.removeChild(y.firstChild);const V=document.createElement("option");V.value="",V.textContent="Selecione...",y.appendChild(V),N.forEach((g,C)=>{const q=document.createElement("option");q.value=g,q.textContent=C,g===f&&(q.selected=!0),y.appendChild(q)}),y.onchange=()=>{A(r,y.value)}}const s=r.querySelector("#omega-filter-department");A(r,s?.value||""),v(r),i(r)}function A(r,o=""){const t=a.structure.value;if(!t||t.length===0)return;const s=r.querySelector("#omega-filter-type");if(!s)return;const f=s.value,y=new Set;for(t.forEach(V=>{V.tipo&&(o?(V.departamento_id||V.departamento)===o&&y.add(V.tipo):y.add(V.tipo))});s.firstChild;)s.removeChild(s.firstChild);const N=document.createElement("option");N.value="",N.textContent="Todos os tipos",s.appendChild(N),Array.from(y).sort().forEach(V=>{const g=document.createElement("option");g.value=V,g.textContent=V,V===f&&(g.selected=!0),s.appendChild(g)})}function v(r){const o=a.statuses.value;if(!o||o.length===0)return;const t=r.querySelector("#omega-filter-status");if(!t)return;const s=m.filters.value.statuses||[];for(;t.firstChild;)t.removeChild(t.firstChild);o.forEach(f=>{const y=document.createElement("label");y.className="omega-filter-status__option";const N=s.includes(f.id);y.setAttribute("data-checked",N?"true":"false");const V=document.createElement("input");V.type="checkbox",V.value=f.id,V.checked=N;const g=document.createElement("span");g.textContent=f.label,y.appendChild(V),y.appendChild(g),V.onchange=()=>{y.setAttribute("data-checked",V.checked?"true":"false")},t.appendChild(y)})}function i(r){const o=r.querySelector("#omega-filter-priority");if(!o)return;const t=o.value,s=[{value:"",label:"Todas"},{value:"baixa",label:"Baixa"},{value:"media",label:"Média"},{value:"alta",label:"Alta"},{value:"critica",label:"Crítica"}];for(;o.firstChild;)o.removeChild(o.firstChild);s.forEach(f=>{const y=document.createElement("option");y.value=f.value,y.textContent=f.label,f.value===t&&(y.selected=!0),o.appendChild(y)})}function c(r){}function d(r){const o=r.querySelector("#omega-ticket-rows");if(!o||r.querySelector(".omega-table-container"))return;let s=a.tickets.value;const f=a.statuses.value,y=a.currentUser.value;if(!s||s.length===0){for(;o.firstChild;)o.removeChild(o.firstChild);const T=document.createElement("tr"),B=document.createElement("td");B.colSpan=12,B.className="omega-empty-state";const _=document.createElement("div");_.className="omega-empty-state__content";const u=document.createElement("i");u.className="ti ti-inbox",u.style.cssText="font-size: 64px; color: var(--brad-color-gray, #c7c7c7); margin-bottom: 20px; opacity: 0.6;";const $=document.createElement("h3");$.textContent="Nenhum chamado encontrado";const p=document.createElement("p");p.textContent="Não há chamados para exibir nesta visualização.";const D=document.createElement("button");D.className="omega-btn omega-btn--primary",D.id="omega-new-ticket-empty",D.style.cssText="margin-top: 20px;";const R=document.createElement("i");R.className="ti ti-plus";const se=document.createElement("span");se.textContent="Registrar novo chamado",D.appendChild(R),D.appendChild(se),D.onclick=()=>{const ce=r.querySelector("#omega-drawer");ce&&ce.removeAttribute("hidden")},_.appendChild(u),_.appendChild($),_.appendChild(p),_.appendChild(D),B.appendChild(_),T.appendChild(B),o.appendChild(T);return}let N=s;const V=a.currentView.value;for(V==="my"&&y?N=s.filter(T=>T.requesterId===y.id):V==="assigned"&&y?N=s.filter(T=>T.ownerId===y.id):V==="queue"&&y&&(y.queues&&y.queues.length>0?N=s.filter(T=>y.queues.includes(T.queue)):y.role!=="admin"&&(N=[])),N=m.applyFilters(N);o.firstChild;)o.removeChild(o.firstChild);N.forEach((T,B)=>{const _=document.createElement("tr");_.className="omega-table__row",_.setAttribute("data-ticket-id",T.id),_.style.opacity="0",_.style.transform="translateY(10px)",_.style.transition=`opacity 0.3s ease ${B*.03}s, transform 0.3s ease ${B*.03}s`;const u=f.find(J=>J.id===T.status)||f[0]||{label:"Desconhecido",tone:"neutral"},$=a.getPriorityMeta(T.priority),p=y&&["analista","supervisor","admin"].includes(y.role),D=y&&["analista","supervisor","admin"].includes(y.role),R=y&&["analista","supervisor","admin"].includes(y.role),se=T.ownerId?a.users.value.find(J=>J.id===T.ownerId)?.name||"—":"Sem responsável",ce=new Date(T.opened),ke=new Date(T.updated),we=l.selectedTicketIds.value.has(T.id),E=p?`
        <td class="col-select">
          <input type="checkbox" data-omega-select value="${T.id}" ${we?"checked":""} aria-label="Selecionar chamado ${T.id}"/>
        </td>
      `:"",U=D?`
        <td data-priority="${T.priority}">
          <span class="omega-badge omega-badge--${$.tone}">
            <i class="${$.icon}"></i>
            ${$.label}
          </span>
        </td>
      `:"",P=R?`
        <td>${se}</td>
      `:"";_.innerHTML=`
        ${E}
        <td>${T.id}</td>
        <td>
          <div class="omega-table__preview">
            <strong>${T.subject||"Sem assunto"}</strong>
            <small>${T.requesterName}</small>
          </div>
        </td>
        <td>${T.queue||"—"}</td>
        <td>${T.category||"—"}</td>
        <td>${T.requesterName||"—"}</td>
        ${U}
        ${P}
        <td>${T.product||"—"}</td>
        <td>${T.queue||"—"}</td>
        <td>${ce.toLocaleDateString("pt-BR")}</td>
        <td>${ke.toLocaleDateString("pt-BR")}</td>
        <td class="col-status">
          <span class="omega-badge omega-badge--${u.tone}">
            ${u.label}
          </span>
        </td>
      `;const Y=_.querySelector("input[data-omega-select]");Y&&Y.addEventListener("click",J=>{J.stopPropagation(),Y.checked?l.selectedTicketIds.value.add(T.id):l.selectedTicketIds.value.delete(T.id),l.renderBulkPanel(r)}),_.addEventListener("click",J=>{if(J.target.tagName==="INPUT"||J.target.closest("input"))return;const X=document.createElement("span"),fe=_.getBoundingClientRect(),Ce=J.clientX-fe.left,$e=J.clientY-fe.top;X.style.left=`${Ce}px`,X.style.top=`${$e}px`,X.className="omega-ripple",_.appendChild(X),setTimeout(()=>{X.remove(),T.id},300)}),_.addEventListener("mouseenter",()=>{_.style.transform="translateX(4px)"}),_.addEventListener("mouseleave",()=>{_.style.transform="translateX(0)"}),o.appendChild(_),setTimeout(()=>{_.style.opacity="1",_.style.transform="translateY(0)"},10)});const g=r.querySelector("#omega-summary");g&&(g.textContent=`${N.length} chamado${N.length!==1?"s":""} encontrado${N.length!==1?"s":""}`);const C=r.querySelector(".omega-table-footer");C&&C.removeAttribute("hidden");const q=r.querySelector("#omega-table-range");q&&N.length>0&&(q.textContent=`1-${N.length} de ${N.length}`)}function b(r){let o=r||null;o||(o=document.querySelector("#omega-page")||document.querySelector("#omega-modal"));const t=o?.id==="omega-modal"?o:null;if(!o||t&&t.hidden){console.warn("⚠️ Modal não encontrado ou está oculto");return}const f=!!o.querySelector(".omega-table-container");h(o),f||d(o),n(o),k(o),z(o),i(o),f||l.renderBulkPanel(o);const y=o.querySelector("#omega-filters-toggle");y&&y.setAttribute("data-active",m.hasActiveFilters()?"true":"false")}return{renderUsers:h,renderProfile:n,renderNavigation:k,renderStructure:z,renderTickets:d,renderOmegaData:b,renderTypeSelect:A,renderStatusOptions:v,renderPrioritySelect:i,openTicketDetails:c}}const ut={key:0,id:"omega-filter-panel-wrapper",class:"omega-filter-panel-wrapper"},ct={id:"omega-filter-panel",class:"omega-filter-panel",role:"dialog","aria-modal":"true","aria-labelledby":"omega-filter-panel-title"},dt={class:"omega-filter-panel__header"},mt={class:"omega-filter-form__grid"},pt={class:"omega-field",for:"omega-filter-id"},gt={class:"omega-field",for:"omega-filter-user"},ft={class:"omega-field",for:"omega-filter-department"},vt={class:"omega-field",for:"omega-filter-type"},bt={class:"omega-field",for:"omega-filter-priority"},_t={class:"omega-field omega-filter-form__status","aria-describedby":"omega-filter-status-hint"},ht={id:"omega-filter-status",class:"omega-filter-status"},yt=["data-checked"],kt=["value","checked","onChange"],wt={class:"omega-filter-form__dates"},Ct={class:"omega-field",for:"omega-filter-from"},$t={class:"omega-field",for:"omega-filter-to"},St={class:"omega-filter-form__actions"},qt={class:"omega-btn omega-btn--primary",type:"submit"},Et=oe({__name:"OmegaFilterPanel",props:{omega:{},filters:{},open:{type:Boolean}},emits:["update:open","apply","clear"],setup(a,{emit:m}){const l=a,h=m,n=F(()=>{const r=l.omega.structure.value;if(!r||r.length===0)return[];const o=new Map;return r.forEach(t=>{t.departamento&&!o.has(t.departamento)&&o.set(t.departamento,t.departamento_id||t.departamento)}),Array.from(o.entries()).map(([t,s])=>({id:s,nome:t}))}),k=F(()=>{const r=l.omega.structure.value,o=l.filters.filters.value.departments[0]||"";if(!r||r.length===0)return[];const t=new Set;return r.forEach(s=>{s.tipo&&(o?(s.departamento_id||s.departamento)===o&&t.add(s.tipo):t.add(s.tipo))}),Array.from(t).sort().map(s=>({id:s,nome:s}))}),z=[{id:"",nome:"Todas"},{id:"baixa",nome:"Baixa"},{id:"media",nome:"Média"},{id:"alta",nome:"Alta"},{id:"critica",nome:"Crítica"}],A=F(()=>l.omega.statuses.value.map(r=>({id:r.id,nome:r.label}))),v=O({id:"",requester:"",department:"",type:"",priority:"",statuses:[],openedFrom:"",openedTo:""});G(()=>l.filters.filters.value,r=>{v.value={id:r.id||"",requester:r.requester||"",department:r.departments[0]||"",type:r.type||"",priority:r.priority||"",statuses:[...r.statuses],openedFrom:r.openedFrom||"",openedTo:r.openedTo||""}},{immediate:!0}),G(()=>v.value.department,()=>{v.value.type=""});function i(){l.filters.applyFiltersFromFormValues&&l.filters.applyFiltersFromFormValues({id:v.value.id,requester:v.value.requester,type:v.value.type,priority:v.value.priority,statuses:v.value.statuses,departments:v.value.department?[v.value.department]:[],openedFrom:v.value.openedFrom,openedTo:v.value.openedTo}),h("apply"),h("update:open",!1)}function c(){v.value={id:"",requester:"",department:"",type:"",priority:"",statuses:[],openedFrom:"",openedTo:""},l.filters.resetFilters(),h("clear")}function d(){const r=l.filters.filters.value;v.value={id:r.id||"",requester:r.requester||"",department:r.departments[0]||"",type:r.type||"",priority:r.priority||"",statuses:[...r.statuses],openedFrom:r.openedFrom||"",openedTo:r.openedTo||""},h("update:open",!1)}function b(r){const o=v.value.statuses.indexOf(r);o>-1?v.value.statuses.splice(o,1):v.value.statuses.push(r)}return(r,o)=>(w(),_e(ye,{to:"body"},[a.open?(w(),S("div",ut,[e("div",{class:"omega-filter-panel__overlay",onClick:d}),e("div",ct,[e("header",dt,[o[7]||(o[7]=e("h3",{id:"omega-filter-panel-title"},"Filtros",-1)),e("button",{class:"omega-icon-btn",type:"button","aria-label":"Fechar filtros",onClick:d},[x(M,{name:"x",size:20})])]),e("form",{id:"omega-filter-form",class:"omega-filter-form",onSubmit:he(i,["prevent"])},[e("div",mt,[e("label",pt,[o[8]||(o[8]=e("span",{class:"omega-field__label"},"ID do chamado",-1)),K(e("input",{id:"omega-filter-id","onUpdate:modelValue":o[0]||(o[0]=t=>v.value.id=t),class:"omega-input",type:"text",placeholder:"Ex.: OME-2025-0001",autocomplete:"off"},null,512),[[W,v.value.id]])]),e("label",gt,[o[9]||(o[9]=e("span",{class:"omega-field__label"},"Usuário",-1)),K(e("input",{id:"omega-filter-user","onUpdate:modelValue":o[1]||(o[1]=t=>v.value.requester=t),class:"omega-input",type:"text",placeholder:"Digite um nome",autocomplete:"off"},null,512),[[W,v.value.requester]])]),e("label",ft,[o[10]||(o[10]=e("span",{class:"omega-field__label"},"Departamento",-1)),x(at,{id:"omega-filter-department",modelValue:v.value.department,"onUpdate:modelValue":o[2]||(o[2]=t=>v.value.department=t),options:n.value,placeholder:"Selecione...",label:"Departamento"},null,8,["modelValue","options"]),o[11]||(o[11]=e("small",{id:"omega-filter-department-hint",class:"omega-hint"},"Escolha a fila desejada",-1))]),e("label",vt,[o[12]||(o[12]=e("span",{class:"omega-field__label"},"Tipo de chamado",-1)),x(ge,{id:"omega-filter-type",modelValue:v.value.type,"onUpdate:modelValue":o[3]||(o[3]=t=>v.value.type=t),options:k.value,placeholder:"Todos os tipos",label:"Tipo de chamado"},null,8,["modelValue","options"])]),e("label",bt,[o[13]||(o[13]=e("span",{class:"omega-field__label"},"Prioridade",-1)),x(ge,{id:"omega-filter-priority",modelValue:v.value.priority,"onUpdate:modelValue":o[4]||(o[4]=t=>v.value.priority=t),options:z,placeholder:"Todas",label:"Prioridade"},null,8,["modelValue"])]),e("fieldset",_t,[o[14]||(o[14]=e("span",{class:"omega-field__label"},"Status do chamado",-1)),e("div",ht,[(w(!0),S(Z,null,ae(A.value,t=>(w(),S("label",{key:t.id,class:"omega-filter-status__option","data-checked":v.value.statuses.includes(t.id)},[e("input",{type:"checkbox",value:t.id,checked:v.value.statuses.includes(t.id),onChange:s=>b(t.id)},null,40,kt),e("span",null,I(t.nome),1)],8,yt))),128))]),o[15]||(o[15]=e("small",{id:"omega-filter-status-hint",class:"omega-hint"},"Selecione um ou mais status",-1))]),e("div",wt,[e("label",Ct,[o[16]||(o[16]=e("span",{class:"omega-field__label"},"Abertura desde",-1)),K(e("input",{id:"omega-filter-from","onUpdate:modelValue":o[5]||(o[5]=t=>v.value.openedFrom=t),class:"omega-input",type:"date"},null,512),[[W,v.value.openedFrom]])]),e("label",$t,[o[17]||(o[17]=e("span",{class:"omega-field__label"},"Até",-1)),K(e("input",{id:"omega-filter-to","onUpdate:modelValue":o[6]||(o[6]=t=>v.value.openedTo=t),class:"omega-input",type:"date"},null,512),[[W,v.value.openedTo]])])])]),e("footer",St,[e("button",{id:"omega-clear-filters",class:"omega-btn omega-btn--ghost",type:"button",onClick:c}," Limpar filtros "),e("button",qt,[x(M,{name:"check",size:18}),o[18]||(o[18]=e("span",null,"Aplicar",-1))])])],32)])])):L("",!0)]))}}),It=ne(Et,[["__scopeId","data-v-0b6475e2"]]),Tt={class:"omega-header"},At={class:"omega-header__actions"},Ot={class:"omega-notification-center"},xt=["aria-expanded"],zt={key:0,id:"omega-notification-badge",class:"omega-notification-badge"},Ft=["hidden"],Dt={class:"omega-notification-panel__header"},Ut={class:"omega-user-switch",for:"omega-user-select"},Nt=oe({__name:"OmegaHeader",props:{omega:{},showClose:{type:Boolean,default:!0}},emits:["close"],setup(a,{emit:m}){const l=a,h=m,n=O(!1),k=O(0),z=F(()=>{const c=l.omega.users.value;return!c||c.length===0?[]:c.map(d=>({id:d.id,nome:d.name}))}),A=F(()=>l.omega.currentUserId.value||"");G(()=>l.omega.users.value,c=>{if(c&&c.length>0&&!A.value){const d=c[0]?.id;d&&l.omega.setCurrentUserId(d)}},{immediate:!0,deep:!0});function v(c){l.omega.setCurrentUserId(c)}function i(){n.value=!n.value}return(c,d)=>(w(),S("header",Tt,[d[5]||(d[5]=e("div",{class:"omega-header__left"},[e("div",{class:"omega-header__titles"},[e("h2",{id:"omega-title"},"Central de chamados Omega"),e("p",{id:"omega-subtitle"},"Registre ocorrências e acompanhe atendimentos.")])],-1)),e("div",At,[a.showClose?(w(),S("button",{key:0,class:"omega-icon-btn omega-header__close",type:"button","aria-label":"Fechar central Omega",onClick:d[0]||(d[0]=b=>h("close"))},[x(M,{name:"x",size:20})])):L("",!0),e("div",Ot,[e("button",{id:"omega-notifications",class:"omega-icon-btn",type:"button",title:"Notificações","aria-expanded":n.value?"true":"false","aria-controls":"omega-notification-panel",onClick:i},[x(M,{name:"bell",size:20}),k.value>0?(w(),S("span",zt,I(k.value),1)):L("",!0)],8,xt),e("section",{id:"omega-notification-panel",class:"omega-notification-panel",role:"dialog","aria-modal":"false","aria-label":"Notificações",hidden:!n.value},[e("header",Dt,[d[2]||(d[2]=e("strong",null,"Notificações",-1)),e("button",{id:"omega-notification-close",class:"omega-icon-btn",type:"button","aria-label":"Fechar notificações",onClick:d[1]||(d[1]=b=>n.value=!1)},[x(M,{name:"x",size:20})])]),d[3]||(d[3]=e("div",{class:"omega-notification-panel__body"},[e("ul",{id:"omega-notification-list",class:"omega-notification-list"}),e("p",{id:"omega-notification-empty",class:"omega-notification-empty"}," Nenhuma notificação registrada. ")],-1))],8,Ft)]),e("label",Ut,[d[4]||(d[4]=e("span",{class:"sr-only"},"Trocar perfil",-1)),x(ge,{id:"omega-user-select","model-value":A.value,options:z.value,placeholder:"Selecione um usuário",label:"Trocar perfil","onUpdate:modelValue":v},null,8,["model-value","options"])])])]))}}),Vt=ne(Nt,[["__scopeId","data-v-61517f82"]]),Pt=["data-collapsed"],Mt=["aria-label","aria-pressed","aria-expanded","title"],Lt={class:"omega-profile","aria-label":"Perfil selecionado"},Bt={key:0,class:"omega-avatar","aria-hidden":"true"},Rt=["src","alt"],jt={class:"omega-profile__name"},Gt={class:"omega-nav","aria-label":"Menu Omega"},Qt=["onClick"],Ht={key:0},Yt=oe({__name:"OmegaSidebar",props:{omega:{},collapsed:{type:Boolean}},emits:["update:collapsed","nav-click"],setup(a,{emit:m}){const l=a,h=m,n=F(()=>l.omega.currentUser.value),k=F(()=>{const i=l.omega.currentUser.value;return i?l.omega.getNavItemsForRole(i.role):[]});G(()=>l.omega.currentUser.value,i=>{},{immediate:!0,deep:!0}),G(()=>l.omega.users.value,i=>{i&&i.length>0},{immediate:!0,deep:!0});function z(){h("update:collapsed",!l.collapsed)}function A(i){h("nav-click",i)}function v(i){return i?i.replace(/^ti ti-/,""):"circle"}return(i,c)=>(w(),S("aside",{class:"omega-sidebar","data-collapsed":a.collapsed?"true":"false"},[e("button",{class:"omega-sidebar__toggle",type:"button","aria-label":a.collapsed?"Expandir menu":"Recolher menu","aria-pressed":a.collapsed?"true":"false","aria-expanded":a.collapsed?"false":"true",title:a.collapsed?"Expandir menu":"Recolher menu",onClick:z},[c[0]||(c[0]=e("span",{class:"sr-only"},"Alternar menu",-1)),x(M,{name:a.collapsed?"chevron-right":"chevron-left",size:20,"aria-hidden":"true"},null,8,["name"])],8,Mt),e("section",Lt,[n.value?.avatar?(w(),S("figure",Bt,[e("img",{src:n.value.avatar,alt:n.value.name,loading:"lazy"},null,8,Rt)])):L("",!0),e("strong",jt,I(n.value?.name||"—"),1)]),e("nav",Gt,[(w(!0),S(Z,null,ae(k.value,d=>(w(),S("button",{key:d.id,class:ie(["omega-nav__item",{"is-active":a.omega.currentView.value===d.id}]),type:"button",onClick:b=>A(d.id)},[x(M,{name:v(d.icon),size:20,"aria-hidden":"true"},null,8,["name"]),a.collapsed?L("",!0):(w(),S("span",Ht,I(d.label),1))],10,Qt))),128))])],8,Pt))}}),Jt=ne(Yt,[["__scopeId","data-v-52989d54"]]),Xt={class:"omega-toolbar",role:"group","aria-label":"Filtros da central Omega"},Kt={class:"omega-search",for:"omega-search"},Wt={class:"omega-toolbar__actions"},Zt={class:"omega-toolbar__cluster"},ea={class:"omega-filters"},ta=["data-active","aria-expanded"],aa=["data-loading","disabled"],oa=["hidden","disabled"],na=oe({__name:"OmegaToolbar",props:{omega:{},filters:{},bulk:{}},emits:["search","filter-toggle","clear-filters","refresh","new-ticket","bulk-status"],setup(a,{emit:m}){const l=a,h=m,n=O(""),k=O(!1),z=F(()=>l.filters.hasActiveFilters()),A=F(()=>l.bulk.selectedTicketIds.value.size>0),v=F(()=>{const t=l.omega.currentUser.value;if(!t)return!1;const s=t.role;return["analista","supervisor","admin"].includes(s)});function i(t){n.value=t,h("search",t)}function c(){h("filter-toggle")}function d(){l.filters.resetFilters(),h("clear-filters")}async function b(){k.value=!0,h("refresh"),setTimeout(()=>{k.value=!1},500)}function r(){h("new-ticket")}function o(){h("bulk-status")}return G(()=>l.filters.filters.value,()=>{},{deep:!0}),(t,s)=>(w(),S("div",Xt,[e("label",Kt,[x(M,{name:"search",size:18}),K(e("input",{id:"omega-search","onUpdate:modelValue":s[0]||(s[0]=f=>n.value=f),type:"search",placeholder:"Buscar chamado ou usuário",autocomplete:"off",onInput:s[1]||(s[1]=f=>i(f.target.value))},null,544),[[W,n.value]])]),e("div",Wt,[e("div",Zt,[e("div",ea,[e("button",{id:"omega-filters-toggle",class:"omega-btn omega-btn--ghost",type:"button","data-active":z.value?"true":"false","aria-haspopup":"dialog","aria-expanded":a.filters.filterPanelOpen.value?"true":"false","aria-controls":"omega-filter-panel",onClick:c},[x(M,{name:"adjustments-horizontal",size:18}),s[2]||(s[2]=e("span",null,"Filtros",-1))],8,ta),z.value?(w(),S("button",{key:0,id:"omega-clear-filters-top",class:"omega-btn omega-btn--ghost",type:"button",onClick:d},[x(M,{name:"x",size:18}),s[3]||(s[3]=e("span",null,"Limpar filtros",-1))])):L("",!0),e("button",{id:"omega-refresh",class:"omega-btn omega-btn--ghost",type:"button","data-loading":k.value?"true":"false",disabled:k.value,onClick:b},[x(M,{name:k.value?"loader-2":"refresh",size:18},null,8,["name"]),s[4]||(s[4]=e("span",null,"Atualizar lista",-1))],8,aa)])]),v.value?(w(),S("button",{key:0,id:"omega-bulk-status",class:"omega-btn omega-btn--ghost",type:"button",hidden:!A.value,disabled:!A.value,onClick:o},[x(M,{name:"arrows-exchange",size:18}),s[5]||(s[5]=e("span",null,"Alterar status",-1))],8,oa)):L("",!0),e("button",{id:"omega-new-ticket",class:"omega-btn omega-btn--primary",type:"button",onClick:r},[x(M,{name:"plus",size:18,color:"white"}),s[6]||(s[6]=e("span",null,"Registrar chamado",-1))])])]))}}),sa=ne(na,[["__scopeId","data-v-fc319368"]]),la={class:"omega-table-container"},ra=["data-selection-enabled"],ia=["data-priority-visible"],ua={key:0,scope:"col",class:"col-select","aria-label":"Selecionar"},ca=["checked","indeterminate"],da={key:1,scope:"col","data-priority-column":""},ma={key:2,scope:"col"},pa={id:"omega-ticket-rows"},ga={key:0,class:"omega-empty-row"},fa=["colspan"],va={class:"omega-empty-state__content"},ba=["data-ticket-id","onClick"],_a=["checked","value","aria-label","onChange"],ha={class:"omega-ticket__id"},ya={class:"omega-table__preview"},ka=["data-priority"],wa={key:2},Ca={class:"col-status"},$a={key:0,class:"omega-table-footer","aria-live":"polite"},Sa={id:"omega-table-range",class:"omega-table-range"},qa={id:"omega-pagination",class:"omega-pagination","aria-label":"Paginação de chamados"},Ea=["disabled"],Ia=["aria-current","aria-label","onClick"],Ta={key:1,class:"omega-pagination__gap"},Aa=["disabled"],Oa=oe({__name:"OmegaTable",props:{omega:{},filters:{},bulk:{},searchQuery:{default:""}},emits:["ticket-click","select-all","new-ticket"],setup(a,{emit:m}){const l=a,h=m,n=O(1),k=O(15),z=F(()=>{let g=l.omega.tickets.value||[];const C=l.omega.currentUser.value,q=l.omega.currentView.value;if(!g||g.length===0)return[];if(q==="my"&&C?g=g.filter(T=>T.requesterId===C.id):q==="assigned"&&C?g=g.filter(T=>T.ownerId===C.id):q==="queue"&&C&&(C.queues&&C.queues.length>0?g=g.filter(T=>C.queues?.includes(T.queue||"")):C.role!=="admin"&&(g=[])),g=l.filters.applyFilters(g),l.searchQuery){const T=l.searchQuery.toLowerCase().trim();g=g.filter(B=>[B.id,B.subject,B.requesterName,B.product,B.queue,B.category].join(" ").toLowerCase().includes(T))}return g}),A=F(()=>{if(!z.value||z.value.length===0)return[];const g=(n.value-1)*k.value,C=g+k.value;return z.value.slice(g,C)}),v=F(()=>Math.max(1,Math.ceil(z.value.length/k.value))),i=F(()=>{const g=l.omega.currentUser.value;if(!g)return!1;const C=g.role;return["analista","supervisor","admin"].includes(C)}),c=F(()=>{const g=l.omega.currentUser.value;return g?["analista","supervisor","admin"].includes(g.role):!1}),d=F(()=>{const g=l.omega.currentUser.value;return g?["analista","supervisor","admin"].includes(g.role):!1}),b=F(()=>{let g=10;return i.value&&g++,c.value&&g++,d.value&&g++,g}),r=F(()=>!i.value||A.value.length===0?!1:A.value.every(g=>l.bulk.selectedTicketIds.value.has(g.id))),o=F(()=>{if(!i.value)return!1;const g=A.value.filter(C=>l.bulk.selectedTicketIds.value.has(C.id)).length;return g>0&&g<A.value.length});function t(g){if(!g)return"—";try{return new Date(g).toLocaleDateString("pt-BR")}catch{return"—"}}function s(g){return g?g.replace(/^ti ti-/,""):"circle"}function f(g){h("ticket-click",g)}function y(g){h("select-all",g)}function N(g,C){C?l.bulk.selectedTicketIds.value.add(g):l.bulk.selectedTicketIds.value.delete(g)}function V(g){g>=1&&g<=v.value&&(n.value=g)}return G([()=>l.filters.filters.value,()=>l.searchQuery],()=>{n.value=1},{deep:!0}),G(()=>l.omega.currentView.value,()=>{n.value=1}),(g,C)=>(w(),S("div",la,[e("div",{id:"omega-table-wrapper",class:"omega-table-wrapper",role:"region","aria-labelledby":"omega-table-caption","data-selection-enabled":i.value?"true":"false"},[e("table",{id:"omega-ticket-table",class:"omega-table","data-priority-visible":c.value?"true":"false"},[C[18]||(C[18]=e("caption",{id:"omega-table-caption",class:"sr-only"}," Chamados filtrados pela visão atual ",-1)),e("thead",null,[e("tr",null,[i.value?(w(),S("th",ua,[e("input",{id:"omega-select-all",type:"checkbox",checked:r.value,indeterminate:o.value,"aria-label":"Selecionar todos",onChange:C[0]||(C[0]=q=>y(q.target.checked))},null,40,ca)])):L("",!0),C[5]||(C[5]=e("th",{scope:"col"},"ID",-1)),C[6]||(C[6]=e("th",{scope:"col"},"Prévia",-1)),C[7]||(C[7]=e("th",{scope:"col"},"Departamento",-1)),C[8]||(C[8]=e("th",{scope:"col"},"Tipo",-1)),C[9]||(C[9]=e("th",{scope:"col"},"Usuário",-1)),c.value?(w(),S("th",da,"Prioridade")):L("",!0),d.value?(w(),S("th",ma,"Atendente")):L("",!0),C[10]||(C[10]=e("th",{scope:"col"},"Produto",-1)),C[11]||(C[11]=e("th",{scope:"col"},"Fila",-1)),C[12]||(C[12]=e("th",{scope:"col"},"Abertura",-1)),C[13]||(C[13]=e("th",{scope:"col"},"Atualização",-1)),C[14]||(C[14]=e("th",{scope:"col",class:"col-status"},"Status",-1))])]),e("tbody",pa,[z.value.length===0?(w(),S("tr",ga,[e("td",{colspan:b.value,class:"omega-empty-state"},[e("div",va,[x(M,{name:"inbox",size:48}),C[16]||(C[16]=e("h3",null,"Nenhum chamado encontrado",-1)),C[17]||(C[17]=e("p",null,"Não há chamados para exibir nesta visualização.",-1)),e("button",{class:"omega-btn omega-btn--primary",type:"button",onClick:C[1]||(C[1]=q=>g.$emit("new-ticket"))},[x(M,{name:"plus",size:18,color:"white"}),C[15]||(C[15]=e("span",{class:"omega-btn--primary-text"},"Registrar novo chamado",-1))])])],8,fa)])):(w(!0),S(Z,{key:1},ae(A.value,q=>(w(),S("tr",{key:q.id,class:"omega-table__row","data-ticket-id":q.id,onClick:T=>f(q.id)},[i.value?(w(),S("td",{key:0,class:"col-select",onClick:C[2]||(C[2]=he(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:a.bulk.selectedTicketIds.value.has(q.id),value:q.id,"aria-label":`Selecionar chamado ${q.id}`,onChange:T=>N(q.id,T.target.checked)},null,40,_a)])):L("",!0),e("td",null,[e("span",ha,[x(M,{name:"ticket",size:18}),me(" "+I(q.id),1)])]),e("td",null,[e("div",ya,[e("strong",null,I(q.subject||"Sem assunto"),1),e("small",null,I(q.requesterName||"—"),1)])]),e("td",null,I(q.queue||"—"),1),e("td",null,I(q.category||"—"),1),e("td",null,I(q.requesterName||"—"),1),c.value?(w(),S("td",{key:1,"data-priority":q.priority},[e("span",{class:ie(["omega-badge",`omega-badge--${l.omega.getPriorityMeta(q.priority).tone}`])},[x(M,{name:s(l.omega.getPriorityMeta(q.priority).icon),size:14},null,8,["name"]),me(" "+I(l.omega.getPriorityMeta(q.priority).label),1)],2)],8,ka)):L("",!0),d.value?(w(),S("td",wa,I(q.ownerId?l.omega.users.value.find(T=>T.id===q.ownerId)?.name||"—":"Sem responsável"),1)):L("",!0),e("td",null,I(q.product||"—"),1),e("td",null,I(q.queue||"—"),1),e("td",null,I(t(q.opened)),1),e("td",null,I(t(q.updated)),1),e("td",Ca,[e("span",{class:ie(["omega-badge omega-badge--status",`omega-badge--${(l.omega.statuses.value.find(T=>T.id===q.status)||{tone:"neutral"}).tone}`])},I((l.omega.statuses.value.find(T=>T.id===q.status)||{label:q.status}).label),3)])],8,ba))),128))])],8,ia)],8,ra),z.value.length>0?(w(),S("footer",$a,[e("span",Sa,I((n.value-1)*k.value+1)+" – "+I(Math.min(n.value*k.value,z.value.length))+" de "+I(z.value.length)+" chamados ",1),e("nav",qa,[e("button",{class:"omega-pagination__button",type:"button",disabled:n.value<=1,"aria-label":"Página anterior",onClick:C[3]||(C[3]=q=>V(n.value-1))}," Anterior ",8,Ea),(w(!0),S(Z,null,ae(v.value,q=>(w(),S(Z,{key:q},[q===1||q===v.value||q>=n.value-1&&q<=n.value+1?(w(),S("button",{key:0,class:ie(["omega-pagination__button",{"omega-pagination__button--current":q===n.value}]),type:"button","aria-current":q===n.value?"page":void 0,"aria-label":`Ir para a página ${q}`,onClick:T=>V(q)},I(q),11,Ia)):q===n.value-2||q===n.value+2?(w(),S("span",Ta," … ")):L("",!0)],64))),128)),e("button",{class:"omega-pagination__button",type:"button",disabled:n.value>=v.value,"aria-label":"Próxima página",onClick:C[4]||(C[4]=q=>V(n.value+1))}," Próxima ",8,Aa)])])):L("",!0)]))}}),xa=ne(Oa,[["__scopeId","data-v-0955c4ce"]]),za=["hidden"],Fa={class:"omega-bulk-form__header"},Da={id:"omega-bulk-hint",class:"omega-bulk-form__hint"},Ua={class:"omega-field",for:"omega-bulk-status-select"},Na={class:"omega-bulk-form__actions"},Va=["disabled"],Pa=oe({__name:"OmegaBulkPanel",props:{omega:{},bulk:{}},emits:["close","cancel","apply"],setup(a,{emit:m}){const l=a,h=m,n=O(""),k=F(()=>l.bulk.bulkPanelOpen.value&&l.bulk.selectedTicketIds.value.size>0),z=F(()=>l.bulk.selectedTicketIds.value.size),A=F(()=>l.omega.statuses.value.map(b=>({id:b.id,nome:b.label}))),v=F(()=>{const b=z.value;return b===1?"1 chamado selecionado":`${b} chamados selecionados`});function i(){l.bulk.bulkPanelOpen.value=!1,h("close")}function c(){l.bulk.bulkPanelOpen.value=!1,l.bulk.selectedTicketIds.value.clear(),n.value="",h("cancel")}function d(){n.value&&h("apply",n.value)}return G(()=>l.bulk.bulkPanelOpen.value,b=>{b?A.value.length>0&&!n.value&&(n.value=A.value[0]?.id||""):n.value=""}),G(k,b=>{b&&A.value.length>0&&!n.value&&(n.value=A.value[0]?.id||"")},{immediate:!0}),(b,r)=>(w(),S("div",{id:"omega-bulk-panel",class:"omega-bulk-panel",role:"dialog","aria-modal":"true",hidden:!k.value},[e("form",{id:"omega-bulk-form",class:"omega-bulk-form",onSubmit:he(d,["prevent"])},[e("header",Fa,[r[1]||(r[1]=e("strong",null,"Alterar status",-1)),e("button",{type:"button",class:"omega-icon-btn",id:"omega-bulk-close","aria-label":"Fechar",onClick:i},[x(M,{name:"x",size:20})])]),e("p",Da,I(v.value),1),e("label",Ua,[r[2]||(r[2]=e("span",{class:"omega-field__label"},"Novo status",-1)),x(ge,{id:"omega-bulk-status-select",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=o=>n.value=o),options:A.value,placeholder:"Selecione um status",label:"Novo status",required:""},null,8,["modelValue","options"])]),e("footer",Na,[e("button",{type:"button",class:"omega-btn omega-btn--ghost",id:"omega-bulk-cancel",onClick:c}," Cancelar "),e("button",{type:"submit",class:"omega-btn omega-btn--primary",disabled:!n.value},[x(M,{name:"check",size:18}),r[3]||(r[3]=e("span",null,"Aplicar",-1))],8,Va)])],32)],8,za))}}),Ma=ne(Pa,[["__scopeId","data-v-f49d1be0"]]),La={key:0,id:"omega-drawer",class:"omega-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"omega-drawer-title"},Ba={class:"omega-drawer__panel"},Ra={class:"omega-drawer__header"},ja={class:"omega-field omega-field--static","aria-live":"polite"},Ga={class:"omega-field__static"},Qa={class:"omega-form__grid"},Ha={class:"omega-field",for:"omega-form-department"},Ya={key:0,class:"omega-field",for:"omega-form-type"},Ja={class:"omega-field",for:"omega-form-observation"},Xa={key:0,id:"omega-form-flow",class:"omega-form-flow","aria-hidden":"false"},Ka={class:"omega-form-flow__approvals"},Wa={class:"omega-flow-approval"},Za={class:"omega-flow-approval__icon","aria-hidden":"true"},eo={class:"omega-flow-approval__body"},to={class:"omega-field",for:"omega-flow-requester-name"},ao={class:"omega-field",for:"omega-flow-requester-email"},oo={class:"omega-flow-approval"},no={class:"omega-flow-approval__icon","aria-hidden":"true"},so={class:"omega-flow-approval__body"},lo={class:"omega-field",for:"omega-flow-target-name"},ro={class:"omega-field",for:"omega-flow-target-email"},io={class:"omega-field omega-field--attachments"},uo={class:"omega-attachments"},co={class:"omega-attachments__actions"},mo={id:"omega-form-attachments",class:"omega-attachments__list","aria-live":"polite"},po={key:0,class:"omega-attachments__empty"},go=["data-attachment-id"],fo={class:"omega-attachments__meta"},vo={class:"omega-attachments__name"},bo={key:0,class:"omega-attachments__size"},_o=["aria-label","onClick"],ho={class:"omega-form__actions"},yo={class:"omega-btn omega-btn--primary",type:"submit"},ko=oe({__name:"OmegaDrawer",props:{omega:{},open:{type:Boolean},initialData:{default:()=>({})}},emits:["update:open","submit"],setup(a,{emit:m}){const l=a,h=m,n=O(null),k=O(null),z=O(""),A=O([]),v=O({message:"",tone:"info",visible:!1}),i=O(!1),c=O(""),d=O(""),b=O(""),r=O(""),o=F(()=>l.omega.currentUser.value),t=F(()=>o.value?.name||"—"),s=F(()=>[{id:"Matriz",nome:"Matriz"}]),f=F(()=>{if(!n.value)return[];const $=new Set;return l.omega.structure.value.forEach(p=>{p.departamento===n.value&&p.tipo&&$.add(p.tipo)}),Array.from($).sort().map(p=>({id:p,nome:p}))});G([n,k],()=>{const p=(k.value||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),D="transferencia - empresas para empresas".toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");i.value=p===D},{immediate:!0});function y($){if(!$)return!1;const p=$.toString().trim();return p?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p):!1}const N=O(null);function V(){N.value?.click()}function g($){const p=$.target;if(!p.files||p.files.length===0)return;const D=Array.from(p.files).map(R=>({id:`att-${Date.now()}-${Math.random().toString(36).slice(2)}`,name:R.name||"Arquivo sem nome",size:R.size,file:R}));if(A.value=[...A.value,...D],p)try{p.value=""}catch{}}function C($){A.value=A.value.filter(p=>p.id!==$)}function q($){if(!$||$<=0)return"";const p=["B","KB","MB","GB"];let D=$,R=0;for(;D>=1024&&R<p.length-1;)D/=1024,R+=1;return`${D.toFixed(D>=10||R===0?0:1)} ${p[R]}`}function T($){if($.preventDefault(),!n.value||!k.value||!z.value.trim()){B("Preencha todos os campos obrigatórios para registrar o chamado.","warning");return}if(i.value){if(!c.value.trim()||!d.value.trim()){B("Informe o nome e o e-mail do gerente da agência solicitante para concluir a transferência.","warning");return}if(!y(d.value)){B("Informe um e-mail corporativo válido para o gerente da agência solicitante.","warning");return}if(!b.value.trim()||!r.value.trim()){B("Informe o nome e o e-mail do gerente da agência cedente para concluir a transferência.","warning");return}if(!y(r.value)){B("Informe um e-mail corporativo válido para o gerente da agência cedente.","warning");return}}const p={department:n.value,type:k.value,observation:z.value.trim(),attachments:A.value,...i.value?{flow:{requesterName:c.value.trim(),requesterEmail:d.value.trim(),targetName:b.value.trim(),targetEmail:r.value.trim()}}:{}};h("submit",p)}function B($,p="info"){v.value={message:$,tone:p,visible:!0}}function _(){v.value={message:"",tone:"info",visible:!1}}function u(){h("update:open",!1)}return G(()=>l.open,$=>{$?te(()=>{n.value="Matriz",l.initialData&&(l.initialData.type&&te(()=>{k.value=l.initialData.type||null}),l.initialData.observation&&(z.value=l.initialData.observation))}):(n.value=null,k.value=null,z.value="",A.value=[],i.value=!1,c.value="",d.value="",b.value="",r.value="",_())},{immediate:!0}),G(n,()=>{k.value=null}),($,p)=>(w(),_e(ye,{to:"body"},[a.open?(w(),S("div",La,[e("div",{class:"omega-drawer__overlay",onClick:u}),e("section",Ba,[e("header",Ra,[p[7]||(p[7]=e("div",null,[e("h3",{id:"omega-drawer-title"},"Novo chamado"),e("p",{id:"omega-drawer-desc"},"Preencha os campos abaixo para registrar o chamado com agilidade.")],-1)),e("button",{class:"omega-icon-btn",type:"button","aria-label":"Fechar formulário",onClick:u},[x(M,{name:"x",size:20})])]),v.value.visible?(w(),S("div",{key:0,id:"omega-form-feedback",class:ie(["omega-feedback",`omega-feedback--${v.value.tone}`]),role:"alert"},I(v.value.message),3)):L("",!0),e("form",{id:"omega-form",class:"omega-form",onSubmit:T},[e("div",ja,[p[8]||(p[8]=e("span",{class:"omega-field__label"},"Solicitante",-1)),e("div",Ga,I(t.value),1)]),e("div",Qa,[e("label",Ha,[p[9]||(p[9]=e("span",{class:"omega-field__label"},"Departamento",-1)),x(ge,{id:"omega-form-department","model-value":n.value,options:s.value,placeholder:"Selecione um departamento",disabled:!0,"onUpdate:modelValue":p[0]||(p[0]=D=>n.value=D)},null,8,["model-value","options"])]),n.value==="Matriz"?(w(),S("label",Ya,[p[10]||(p[10]=e("span",{class:"omega-field__label"},"Categoria",-1)),x(ge,{id:"omega-form-type","model-value":k.value,options:f.value,placeholder:"Selecione a categoria (relatórios, dashboard, bases, etc.)",disabled:!n.value||f.value.length===0,"onUpdate:modelValue":p[1]||(p[1]=D=>k.value=D)},null,8,["model-value","options","disabled"])])):L("",!0)]),e("label",Ja,[p[11]||(p[11]=e("span",{class:"omega-field__label"},"Observação",-1)),K(e("textarea",{id:"omega-form-observation","onUpdate:modelValue":p[2]||(p[2]=D=>z.value=D),class:"omega-textarea",rows:"6",placeholder:"Descreva a demanda",required:""},null,512),[[W,z.value]])]),i.value?(w(),S("section",Xa,[p[18]||(p[18]=e("header",{class:"omega-form-flow__header"},[e("h4",null,"Fluxo de aprovações"),e("p",null,"Esta transferência exige os de acordo dos gerentes listados abaixo.")],-1)),e("div",Ka,[e("article",Wa,[e("div",Za,[x(M,{name:"user-check",size:18})]),e("div",eo,[p[14]||(p[14]=e("span",{class:"omega-flow-approval__label"},"Gerente da agência solicitante",-1)),e("label",to,[p[12]||(p[12]=e("span",{class:"omega-field__label"},"Nome completo",-1)),K(e("input",{id:"omega-flow-requester-name","onUpdate:modelValue":p[3]||(p[3]=D=>c.value=D),class:"omega-input",type:"text",placeholder:"Informe o gerente responsável",required:""},null,512),[[W,c.value]])]),e("label",ao,[p[13]||(p[13]=e("span",{class:"omega-field__label"},"E-mail corporativo",-1)),K(e("input",{id:"omega-flow-requester-email","onUpdate:modelValue":p[4]||(p[4]=D=>d.value=D),class:"omega-input",type:"email",placeholder:"nome.sobrenome@empresa.com",required:""},null,512),[[W,d.value]])])])]),e("article",oo,[e("div",no,[x(M,{name:"building-bank",size:18})]),e("div",so,[p[17]||(p[17]=e("span",{class:"omega-flow-approval__label"},"Gerente da agência cedente",-1)),e("label",lo,[p[15]||(p[15]=e("span",{class:"omega-field__label"},"Nome completo",-1)),K(e("input",{id:"omega-flow-target-name","onUpdate:modelValue":p[5]||(p[5]=D=>b.value=D),class:"omega-input",type:"text",placeholder:"Informe o gerente responsável",required:""},null,512),[[W,b.value]])]),e("label",ro,[p[16]||(p[16]=e("span",{class:"omega-field__label"},"E-mail corporativo",-1)),K(e("input",{id:"omega-flow-target-email","onUpdate:modelValue":p[6]||(p[6]=D=>r.value=D),class:"omega-input",type:"email",placeholder:"nome.sobrenome@empresa.com",required:""},null,512),[[W,r.value]])])])])]),p[19]||(p[19]=e("p",{class:"omega-form-flow__hint"}," Após os dois de acordo, o chamado entra automaticamente na fila de Encarteiramento. ",-1))])):L("",!0),e("div",io,[p[21]||(p[21]=e("span",{class:"omega-field__label",id:"omega-form-file-label"},"Arquivos",-1)),e("input",{ref_key:"fileInputRef",ref:N,id:"omega-form-file",class:"sr-only",type:"file",multiple:"","aria-labelledby":"omega-form-file-label",onChange:g},null,544),e("div",uo,[e("div",co,[e("button",{class:"omega-btn",type:"button",onClick:V},[x(M,{name:"paperclip",size:18}),p[20]||(p[20]=e("span",null,"Adicionar arquivo",-1))])]),e("ul",mo,[A.value.length===0?(w(),S("li",po," Nenhum arquivo adicionado ")):L("",!0),(w(!0),S(Z,null,ae(A.value,D=>(w(),S("li",{key:D.id,class:"omega-attachments__item","data-attachment-id":D.id},[e("div",fo,[x(M,{name:"paperclip",size:18,"aria-hidden":"true"}),e("span",vo,I(D.name),1),D.size?(w(),S("span",bo,I(q(D.size)),1)):L("",!0)]),e("button",{type:"button",class:"omega-attachments__remove","aria-label":`Remover ${D.name}`,onClick:R=>C(D.id)},[x(M,{name:"x",size:18,"aria-hidden":"true"})],8,_o)],8,go))),128))])])]),e("footer",ho,[e("button",{class:"omega-btn",type:"button",onClick:u}," Cancelar "),e("button",yo,[x(M,{name:"device-floppy",size:18}),p[22]||(p[22]=e("span",null,"Salvar",-1))])])],32)])])):L("",!0)]))}}),wo=ne(ko,[["__scopeId","data-v-a1ea4630"]]),Co={class:"omega-ticket-modal__header"},$o={class:"omega-ticket-modal__titles"},So={id:"omega-ticket-modal-title"},qo={id:"omega-ticket-modal-meta"},Eo={class:"omega-ticket-modal__body"},Io={class:"omega-ticket-overview","aria-labelledby":"omega-ticket-overview-title"},To={class:"omega-ticket-overview__grid"},Ao={class:"omega-ticket-card"},Oo={id:"omega-ticket-requester"},xo={id:"omega-ticket-requester-meta"},zo={class:"omega-ticket-card"},Fo={id:"omega-ticket-owner"},Do={id:"omega-ticket-owner-meta"},Uo={class:"omega-ticket-card"},No={id:"omega-ticket-product"},Vo={id:"omega-ticket-queue"},Po={class:"omega-ticket-card"},Mo={id:"omega-ticket-opened"},Lo={id:"omega-ticket-opened-time"},Bo={class:"omega-ticket-card"},Ro={id:"omega-ticket-status"},jo={id:"omega-ticket-updated"},Go={class:"omega-ticket-card"},Qo={id:"omega-ticket-priority"},Ho={id:"omega-ticket-due"},Yo={class:"omega-ticket-description","aria-labelledby":"omega-ticket-description-title"},Jo={class:"omega-ticket-description__header"},Xo={id:"omega-ticket-id",class:"omega-ticket-description__id"},Ko={id:"omega-ticket-description",class:"omega-ticket-description__content"},Wo={key:1,class:"omega-ticket-description__empty"},Zo={class:"omega-ticket-timeline","aria-labelledby":"omega-ticket-timeline-title"},en={key:0,id:"omega-ticket-timeline",class:"omega-timeline"},tn={class:"omega-timeline__marker-wrapper"},an={class:"omega-timeline__content"},on={class:"omega-timeline__card"},nn={class:"omega-timeline__header"},sn={class:"omega-timeline__header-left"},ln={class:"omega-timeline__action"},rn={key:0,class:"omega-timeline__actor"},un={class:"omega-timeline__actor-avatar"},cn={class:"omega-timeline__actor-name"},dn={class:"omega-timeline__date"},mn={key:0,class:"omega-timeline__comment"},pn={key:1,class:"omega-timeline__meta"},gn={class:"omega-timeline__status-badge"},fn={key:1,class:"omega-timeline-empty"},vn={key:0,class:"omega-ticket-update","aria-labelledby":"omega-ticket-update-title"},bn={key:0,class:"omega-ticket-update__error",role:"alert"},_n={class:"omega-field",for:"omega-ticket-update-comment"},hn=["disabled"],yn={class:"omega-ticket-update__actions"},kn=["disabled"],wn={key:1,class:"omega-ticket-update omega-ticket-update--blocked"},Cn={class:"omega-ticket-update__blocked-message"},$n=oe({__name:"OmegaTicketModal",props:{omega:{},open:{type:Boolean},ticketId:{}},emits:["update:open"],setup(a,{emit:m}){const l=a,h=m,n=F(()=>l.ticketId&&l.omega.tickets.value.find(_=>_.id===l.ticketId)||null),k=F(()=>l.omega.currentUser.value),z=F(()=>!n.value||!k.value?!1:k.value.role==="usuario"?l.omega.canUserReply(n.value):!0),A=O(""),v=O(!1),i=O(null);function c(){h("update:open",!1)}function d(_){if(!_)return"—";try{return new Date(_).toLocaleDateString("pt-BR")}catch{return"—"}}function b(_){if(!_)return"—";try{return new Date(_).toLocaleString("pt-BR")}catch{return"—"}}const r=F(()=>n.value?l.omega.statuses.value.find(u=>u.id===n.value?.status)||{label:n.value.status||"—",tone:"neutral"}:{label:"—",tone:"neutral"});function o(_){return _?_.replace(/^ti ti-/,""):"circle"}const t=F(()=>{if(!n.value)return{label:"—",tone:"neutral",icon:"circle"};const _=l.omega.getPriorityMeta(n.value.priority||"media");return{..._,icon:o(_.icon)}}),s=F(()=>n.value&&n.value.requesterName||"—"),f=F(()=>!n.value||!n.value.ownerId?"Sem responsável":l.omega.users.value.find(u=>u.id===n.value?.ownerId)?.name||"Sem responsável"),y=F(()=>{if(!n.value)return"Sem observações registradas.";const _=n.value.history;if(Array.isArray(_)&&_.length>0){const u=_[0];if(!u)return"Sem observações registradas.";const $=[];return u.action&&$.push(u.action),u.comment&&u.comment!==u.action&&$.push(u.comment),$.length?$.join(`

`):"Sem observações registradas."}return"Sem observações registradas."}),N=F(()=>{if(!n.value)return[];const _=n.value.history;if(Array.isArray(_))return[..._].sort((u,$)=>{const p=new Date(u.date||"").getTime(),D=new Date($.date||"").getTime();return p-D});if(_&&typeof _=="string"&&_.trim().startsWith("["))try{const $=JSON.parse(_);if(Array.isArray($))return $.sort((p,D)=>{const R=new Date(p.date||"").getTime(),se=new Date(D.date||"").getTime();return R-se})}catch{}return[]});function V(_){_.stopPropagation()}function g(_){const u=(_.action||"").toLowerCase();return u.includes("abertura")||u.includes("criado")?"plus":u.includes("comentário")||u.includes("comentario")?"message":u.includes("status")||u.includes("atualizado")?"refresh":u.includes("atribuído")||u.includes("atribuido")?"user-check":u.includes("cancelado")?"x":u.includes("resolvido")?"check":"circle"}function C(_){const u=(_.action||"").toLowerCase();return u.includes("abertura")||u.includes("criado")?"omega-timeline__marker--created":u.includes("comentário")||u.includes("comentario")?"omega-timeline__marker--comment":u.includes("status")||u.includes("atualizado")?"omega-timeline__marker--updated":u.includes("atribuído")||u.includes("atribuido")?"omega-timeline__marker--assigned":u.includes("cancelado")?"omega-timeline__marker--cancelled":u.includes("resolvido")?"omega-timeline__marker--resolved":"omega-timeline__marker--default"}function q(_){return _?l.omega.users.value.find($=>$.id===_)?.name||"Usuário desconhecido":"Sistema"}function T(_){return _?q(_).charAt(0).toUpperCase():"S"}async function B(_){if(_.preventDefault(),!(!n.value||!k.value||!z.value)){if(!A.value.trim()){i.value="Por favor, adicione um comentário";return}v.value=!0,i.value=null;try{const u=new Date().toISOString(),$={date:u,actorId:k.value.id,action:"Comentário adicionado",comment:A.value.trim(),status:n.value.status,attachments:[]},p=Array.isArray(n.value.history)?[...n.value.history]:[];if(p.push($),!await l.omega.updateTicket(n.value.id,{updated:u,history:p}))throw new Error("Falha ao atualizar ticket");await l.omega.loadTickets();try{await Ye(n.value,$),n.value.queue?.toLowerCase()==="pobj"&&await Je(n.value,$)}catch(R){console.warn("Erro ao criar notificação:",R)}A.value="",i.value=null}catch(u){i.value=u instanceof Error?u.message:"Erro ao registrar atualização. Tente novamente.",console.error("Erro ao atualizar ticket:",u)}finally{v.value=!1}}}return(_,u)=>(w(),_e(ye,{to:"body"},[a.open&&n.value?(w(),S("div",{key:0,id:"omega-ticket-modal",class:"omega-ticket-modal",onClick:c},[u[16]||(u[16]=e("div",{class:"omega-ticket-modal__overlay"},null,-1)),e("section",{class:"omega-ticket-modal__panel",role:"dialog","aria-modal":"true","aria-labelledby":"omega-ticket-modal-title",onClick:V},[e("header",Co,[e("div",$o,[e("h3",So,"Detalhe do chamado "+I(n.value.id),1),e("p",qo,I(n.value.subject||"Sem assunto"),1)]),e("button",{class:"omega-icon-btn",type:"button",title:"Fechar detalhamento",onClick:c},[x(M,{name:"x",size:20})])]),e("div",Eo,[e("section",Io,[u[7]||(u[7]=e("h4",{id:"omega-ticket-overview-title"},"Informações do chamado",-1)),e("div",To,[e("article",Ao,[u[1]||(u[1]=e("span",{class:"omega-ticket-card__label"},"Solicitante",-1)),e("strong",Oo,I(s.value),1),e("small",xo,I(s.value),1)]),e("article",zo,[u[2]||(u[2]=e("span",{class:"omega-ticket-card__label"},"Responsável",-1)),e("strong",Fo,I(f.value),1),e("small",Do,I(f.value),1)]),e("article",Uo,[u[3]||(u[3]=e("span",{class:"omega-ticket-card__label"},"Produto",-1)),e("strong",No,I(n.value.product||"—"),1),e("small",Vo,"Fila "+I(n.value.queue||"—"),1)]),e("article",Po,[u[4]||(u[4]=e("span",{class:"omega-ticket-card__label"},"Abertura",-1)),e("strong",Mo,I(d(n.value.opened)),1),e("small",Lo,I(b(n.value.opened)),1)]),e("article",Bo,[u[5]||(u[5]=e("span",{class:"omega-ticket-card__label"},"Status",-1)),e("strong",Ro,I(r.value.label),1),e("small",jo," Última atualização em "+I(b(n.value.updated)),1)]),e("article",Go,[u[6]||(u[6]=e("span",{class:"omega-ticket-card__label"},"Prioridade",-1)),e("strong",Qo,I(t.value.label),1),e("small",Ho,I(n.value.dueDate?d(n.value.dueDate):"Sem prazo definido"),1)])])]),e("section",Yo,[e("div",Jo,[u[8]||(u[8]=e("div",null,[e("h4",{id:"omega-ticket-description-title"},"Descrição do Chamado"),e("small",{class:"omega-ticket-description__subtitle"},"Informações detalhadas sobre a solicitação")],-1)),e("span",Xo,I(n.value.id),1)]),e("div",Ko,[y.value&&y.value!=="Sem observações registradas."?(w(!0),S(Z,{key:0},ae(y.value.split(`

`),($,p)=>(w(),S("p",{key:p},I($),1))),128)):(w(),S("p",Wo," Sem observações registradas. "))])]),e("section",Zo,[u[11]||(u[11]=e("h4",{id:"omega-ticket-timeline-title"},"Linha do tempo",-1)),N.value.length>0?(w(),S("ol",en,[(w(!0),S(Z,null,ae(N.value,($,p)=>(w(),S("li",{key:p,class:"omega-timeline__item"},[e("div",tn,[e("div",{class:ie(["omega-timeline__marker",C($)])},[x(M,{name:g($),size:16},null,8,["name"])],2)]),e("div",an,[e("div",on,[e("div",nn,[e("div",sn,[e("strong",ln,I($.action||"Atualização"),1),$.actorId?(w(),S("div",rn,[e("span",un,I(T($.actorId)),1),e("span",cn,I(q($.actorId)),1)])):L("",!0)]),e("time",dn,I(b($.date)),1)]),$.comment?(w(),S("div",mn,I($.comment),1)):L("",!0),$.status?(w(),S("div",pn,[e("span",gn,[x(M,{name:"info-circle",size:16}),u[9]||(u[9]=me(" Status alterado para: ",-1)),e("strong",null,I(l.omega.statuses.value.find(D=>D.id===$.status)?.label||$.status),1)])])):L("",!0)])])]))),128))])):(w(),S("div",fn,[x(M,{name:"clock",size:48}),u[10]||(u[10]=e("p",null,"Nenhuma atualização registrada ainda.",-1))]))]),z.value?(w(),S("section",vn,[u[13]||(u[13]=e("h4",{id:"omega-ticket-update-title"},"Adicionar comentário",-1)),e("form",{class:"omega-ticket-update__form",onSubmit:B},[i.value?(w(),S("div",bn,I(i.value),1)):L("",!0),e("label",_n,[u[12]||(u[12]=e("span",{class:"omega-field__label"},"Comentário",-1)),K(e("textarea",{id:"omega-ticket-update-comment","onUpdate:modelValue":u[0]||(u[0]=$=>A.value=$),class:"omega-textarea",rows:"4",placeholder:"Adicione um comentário ou atualização sobre este chamado",required:"",disabled:v.value},null,8,hn),[[W,A.value]])]),e("footer",yn,[e("button",{type:"submit",class:"omega-btn omega-btn--primary",disabled:v.value||!A.value.trim()},[x(M,{name:"message-plus",size:18}),e("span",null,I(v.value?"Enviando...":"Enviar comentário"),1)],8,kn)])],32)])):k.value?.role==="usuario"&&n.value?(w(),S("section",wn,[e("div",Cn,[x(M,{name:"lock",size:24}),e("p",null,[e("strong",null,"Este chamado está "+I(r.value.label.toLowerCase())+".",1),u[14]||(u[14]=e("br",null,null,-1)),u[15]||(u[15]=me(" Chamados com status final não permitem novas réplicas. ",-1))])])])):L("",!0)])])])):L("",!0)]))}}),Sn=ne($n,[["__scopeId","data-v-60635942"]]),qn={class:"omega-team-manager__panel"},En={class:"omega-team-manager__header"},In={key:0,class:"omega-team-manager__error"},Tn={class:"omega-team-manager__body"},An={class:"omega-team-manager__section"},On={key:0,class:"omega-team-manager__loading"},xn={key:1,class:"omega-team-manager__list"},zn={class:"omega-team-manager__item-info"},Fn=["onClick"],Dn={key:2,class:"omega-team-manager__empty"},Un={class:"omega-team-manager__section"},Nn={key:0,class:"omega-team-manager__list"},Vn={class:"omega-team-manager__item-info"},Pn=["onClick"],Mn={key:1,class:"omega-team-manager__empty"},Ln=oe({__name:"OmegaTeamManager",props:{omega:{},open:{type:Boolean}},emits:["update:open"],setup(a,{emit:m}){const l=a,h=m,n=F(()=>l.omega.currentUser.value),k=F(()=>n.value?.role==="supervisor"||n.value?.role==="admin"),z=O([]),A=O([]),v=O(!1),i=O(null);async function c(){if(!(!n.value||!k.value)){v.value=!0,i.value=null;try{const t=await ue(`/api/omega/teams/${n.value.id}/analysts`);t.success&&t.data&&(z.value=t.data)}catch(t){i.value="Erro ao carregar analistas do time",console.error("Erro ao carregar analistas:",t)}finally{v.value=!1}}}async function d(){if(!(!n.value||!k.value))try{const t=await ue("/api/omega/analysts/available");if(t.success&&t.data){const s=new Set(z.value.map(f=>f.id));A.value=t.data.filter(f=>!s.has(f.id))}}catch(t){console.error("Erro ao carregar analistas disponíveis:",t)}}async function b(t){if(!(!n.value||!k.value)){v.value=!0,i.value=null;try{const s=await pe(`/api/omega/teams/${n.value.id}/analysts`,{analystId:t});s.success&&s.data?(z.value.push(s.data),await d()):i.value=s.error||"Erro ao adicionar analista"}catch(s){i.value="Erro ao adicionar analista ao time",console.error("Erro ao adicionar analista:",s)}finally{v.value=!1}}}async function r(t){if(!(!n.value||!k.value)){v.value=!0,i.value=null;try{const s=await pe(`/api/omega/teams/${n.value.id}/analysts/${t}/remove`,{});s.success?(z.value=z.value.filter(f=>f.id!==t),await d()):i.value=s.error||"Erro ao remover analista"}catch(s){i.value="Erro ao remover analista do time",console.error("Erro ao remover analista:",s)}finally{v.value=!1}}}function o(){h("update:open",!1)}return Ue(()=>{l.open&&k.value&&(c(),d())}),G(()=>l.open,t=>{t&&k.value&&(c(),d())}),(t,s)=>(w(),_e(ye,{to:"body"},[a.open&&k.value?(w(),S("div",{key:0,class:"omega-team-manager",onClick:he(o,["self"])},[s[5]||(s[5]=e("div",{class:"omega-team-manager__overlay"},null,-1)),e("section",qn,[e("header",En,[s[0]||(s[0]=e("h3",null,"Gerenciar Analistas do Time",-1)),e("button",{class:"omega-icon-btn",type:"button","aria-label":"Fechar",onClick:o},[x(M,{name:"x",size:20})])]),i.value?(w(),S("div",In,I(i.value),1)):L("",!0),e("div",Tn,[e("section",An,[s[2]||(s[2]=e("h4",null,"Analistas do Time",-1)),v.value?(w(),S("div",On," Carregando... ")):z.value.length>0?(w(),S("ul",xn,[(w(!0),S(Z,null,ae(z.value,f=>(w(),S("li",{key:f.id,class:"omega-team-manager__item"},[e("div",zn,[e("strong",null,I(f.name),1),e("small",null,I(f.position||"Analista"),1)]),e("button",{class:"omega-btn omega-btn--danger",type:"button",onClick:y=>r(f.id)},[x(M,{name:"user-minus",size:18}),s[1]||(s[1]=me(" Remover ",-1))],8,Fn)]))),128))])):(w(),S("p",Dn," Nenhum analista no time ainda. "))]),e("section",Un,[s[4]||(s[4]=e("h4",null,"Adicionar Analista",-1)),A.value.length>0?(w(),S("ul",Nn,[(w(!0),S(Z,null,ae(A.value,f=>(w(),S("li",{key:f.id,class:"omega-team-manager__item"},[e("div",Vn,[e("strong",null,I(f.name),1),e("small",null,I(f.position||"Analista"),1)]),e("button",{class:"omega-btn omega-btn--primary",type:"button",onClick:y=>b(f.id)},[x(M,{name:"user-plus",size:18}),s[3]||(s[3]=me(" Adicionar ",-1))],8,Pn)]))),128))])):(w(),S("p",Mn," Nenhum analista disponível para adicionar. "))])])])])):L("",!0)]))}}),Bn=ne(Ln,[["__scopeId","data-v-5b3c789a"]]),Rn={class:"omega-toast-stack","aria-live":"polite","aria-atomic":"true"},jn=["data-visible"],Gn=["data-sidebar-collapsed"],Qn={class:"omega-main"},Hn=oe({__name:"Omega",setup(a){tt();const m=st(),l=lt(),h=rt(m),n=it(m,l,h),k=O(null),z=O(null),A=O(!1),v=O("");async function i(){const E=k.value,P=!!E?.querySelector(".omega-table-container");E&&!P&&d(E);try{if(!await m.loadInit()){P||b(E);return}te(()=>{setTimeout(()=>{P?c.value=!1:(b(E),t())},100)})}catch{P||(b(E),o(E))}}const c=O(!1);function d(E){if(!E||E.querySelector(".omega-table-container"))return;c.value=!0;const P=E.querySelector(".omega-main__content");P&&P.classList.add("omega-loading")}function b(E){if(!E)return;const U=E.querySelector(".omega-main__content")||z.value?.querySelector(".omega-main__content");U&&U.classList.remove("omega-loading")}const r=O(!1);function o(E){E&&(r.value=!0,c.value=!1)}function t(){!!!k.value?.querySelector(".omega-table-container")&&k.value&&n.renderOmegaData()}function s(E){if(E==="team-edit-analyst"){B.value=!0;return}m.setCurrentView(E),te(()=>{t()})}function f(E){v.value=E,t()}function y(){l.toggleFilterPanel()}function N(){l.resetFilters(),t()}function V(){m.loadInit().then(()=>{t()})}const g=O(!1),C=O(void 0),q=O(!1),T=O(null),B=O(!1);function _(E){C.value=E,g.value=!0}const u=O([]);function $(E,U="success"){if(!E)return;const P=`toast-${Date.now()}-${Math.random()}`,Y={id:P,message:E,tone:U,visible:!1};u.value.push(Y),u.value.length>3&&u.value.shift(),te(()=>{Y.visible=!0}),setTimeout(()=>{Y.visible=!1,setTimeout(()=>{const X=u.value.findIndex(fe=>fe.id===P);X>-1&&u.value.splice(X,1)},220)},3600)}async function p(E){const U=m.currentUser.value;if(!U){$("Usuário não encontrado.","danger");return}const P=U.name?.trim()||"",Y=[];E.type&&Y.push(E.type),P&&Y.push(P);const J=Y.length?Y.join(" • "):"Chamado Omega";try{const X=new Date().toISOString(),Ce=E.department==="Matriz"?null:["analista","supervisor","admin"].includes(U.role)?U.id:null,$e={subject:J,company:P,requesterName:P,productId:"",product:E.type||"",family:"",section:"",queue:E.department||"Matriz",status:"aberto",category:E.type,priority:"media",opened:X,updated:X,dueDate:null,requesterId:U.id,ownerId:Ce,teamId:U.teamId||null,context:{diretoria:"",gerencia:"",agencia:"",ggestao:"",gerente:"",familia:"",secao:"",prodsub:E.type||""},history:[{date:X,actorId:U.id,action:"Abertura do chamado",comment:E.observation,status:"aberto"}],attachments:E.attachments?.map(qe=>qe.name)||[],flow:E.flow||null},{createOmegaTicket:Xe}=await Ke(async()=>{const{createOmegaTicket:qe}=await Promise.resolve().then(()=>nt);return{createOmegaTicket:qe}},void 0),Se=await Xe($e);Se.success&&Se.data?(await m.loadInit(),g.value=!1,$("Chamado registrado com sucesso.","success"),t()):$(Se.error||"Não foi possível registrar o chamado.","danger")}catch{$("Erro ao registrar o chamado. Tente novamente.","danger")}}function D(){h.bulkPanelOpen.value=!h.bulkPanelOpen.value}function R(E){T.value=E,q.value=!0}function se(E){E?m.tickets.value.forEach(P=>{h.selectedTicketIds.value.add(P.id)}):h.selectedTicketIds.value.clear()}function ce(E){h.handleBulkStatusSubmit(E),t()}function ke(){t()}function we(){t()}return G(()=>m.tickets.value,()=>{te(()=>{!!k.value?.querySelector(".omega-table-container")||t()})},{deep:!0}),G(()=>m.users.value,()=>{te(()=>{!!k.value?.querySelector(".omega-table-container")||t()})},{deep:!0}),G(()=>m.currentUserId.value,()=>{te(()=>{!!k.value?.querySelector(".omega-table-container")||t()})}),G(()=>m.currentView.value,()=>{te(()=>{!!k.value?.querySelector(".omega-table-container")||t()})}),Ue(()=>{i();const E=new URLSearchParams(window.location.search),U=E.get("openDrawer")==="true"||E.get("intent")==="new-ticket",P=E.get("queue")||E.get("preferredQueue")||"POBJ",Y=E.get("observation")||"";U&&te(()=>{_({department:P,observation:Y})})}),We(()=>{}),(E,U)=>(w(),S("div",{ref_key:"pageRoot",ref:k,id:"omega-page",class:"omega-page","data-omega-standalone":""},[e("div",Rn,[x(et,{name:"toast",tag:"div"},{default:Ze(()=>[(w(!0),S(Z,null,ae(u.value,P=>(w(),S("div",{key:P.id,class:ie(["omega-toast",`omega-toast--${P.tone}`]),"data-visible":P.visible,role:"status"},[e("i",{class:ie({"ti ti-check":P.tone==="success","ti ti-info-circle":P.tone==="info","ti ti-alert-triangle":P.tone==="warning","ti ti-alert-circle":P.tone==="danger"}),"aria-hidden":"true"},null,2),e("span",null,I(P.message),1)],10,jn))),128))]),_:1})]),x(Vt,{omega:j(m),"show-close":!1},null,8,["omega"]),e("div",{class:"omega-body","data-sidebar-collapsed":A.value?"true":"false"},[x(Jt,{omega:j(m),collapsed:A.value,"onUpdate:collapsed":U[0]||(U[0]=P=>A.value=P),onNavClick:s},null,8,["omega","collapsed"]),e("section",Qn,[U[8]||(U[8]=e("div",{id:"omega-breadcrumb",class:"omega-breadcrumb"},null,-1)),U[9]||(U[9]=e("div",{id:"omega-context",class:"omega-context",hidden:""},null,-1)),x(sa,{omega:j(m),filters:j(l),bulk:j(h),onSearch:f,onFilterToggle:y,onClearFilters:N,onRefresh:V,onNewTicket:_,onBulkStatus:D},null,8,["omega","filters","bulk"]),U[10]||(U[10]=e("div",{id:"omega-summary",class:"omega-summary","aria-live":"polite"},null,-1)),e("div",{ref_key:"mainContentRef",ref:z,class:"omega-main__content"},[U[7]||(U[7]=e("div",{id:"omega-dashboard",class:"omega-dashboard",hidden:"","aria-live":"polite"},null,-1)),x(xa,{omega:j(m),filters:j(l),bulk:j(h),"search-query":v.value,onTicketClick:R,onSelectAll:se,onNewTicket:_},null,8,["omega","filters","bulk","search-query"])],512)])],8,Gn),x(wo,{omega:j(m),open:g.value,"initial-data":C.value,"onUpdate:open":U[1]||(U[1]=P=>g.value=P),onSubmit:p},null,8,["omega","open","initial-data"]),x(It,{omega:j(m),filters:j(l),open:j(l).filterPanelOpen.value,"onUpdate:open":U[2]||(U[2]=P=>j(l).toggleFilterPanel(P)),onApply:ke,onClear:we},null,8,["omega","filters","open"]),x(Sn,{omega:j(m),open:q.value,"ticket-id":T.value,"onUpdate:open":U[3]||(U[3]=P=>q.value=P)},null,8,["omega","open","ticket-id"]),x(Bn,{omega:j(m),open:B.value,"onUpdate:open":U[4]||(U[4]=P=>B.value=P)},null,8,["omega","open"]),x(Ma,{omega:j(m),bulk:j(h),onClose:U[5]||(U[5]=P=>j(h).bulkPanelOpen.value=!1),onCancel:U[6]||(U[6]=P=>se(!1)),onApply:ce},null,8,["omega","bulk"])],512))}}),ts=ne(Hn,[["__scopeId","data-v-fc78eb44"]]);export{ts as default};
