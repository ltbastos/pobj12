import{a as E,A as S}from"./index.DL3ItD9e.js";import{u as G}from"./useGlobalFilters.D9l6LYTg.js";import{w as I,e as r,r as v,n as C}from"./vendor.iNPlSTaR.js";async function D(a){const e={};a&&(a.segmento&&(e.segmento=a.segmento),a.diretoria&&(e.diretoria=a.diretoria),a.regional&&(e.regional=a.regional),a.agencia&&(e.agencia=a.agencia),a.gerenteGestao&&(e.gerenteGestao=a.gerenteGestao),a.gerente&&(e.gerente=a.gerente),a.familia&&(e.familia=a.familia),a.indicador&&(e.indicador=a.indicador),a.subindicador&&(e.subindicador=a.subindicador),a.dataInicio&&(e.dataInicio=a.dataInicio),a.dataFim&&(e.dataFim=a.dataFim),a.status&&(e.status=a.status));const o=await E(S.RESUMO,e);return o.success&&o.data?o.data:(console.error("Erro ao buscar resumo:",o.error),null)}const n=v(null),g=v(!1),s=v(null),f=v(null);let y=!1;const x={total:0,elapsed:0,remaining:0,monthStart:"",monthEnd:"",today:""};function i(a){if(!a)return;const e=a.trim();if(!e)return;const o=e.toLowerCase();if(!(o==="todos"||o==="todas"))return e}function b(a,e){const o={};if(a){const u=i(a.segmento),t=i(a.diretoria),c=i(a.gerencia),l=i(a.agencia),d=i(a.ggestao),p=i(a.gerente),h=i(a.familia),F=i(a.indicador),w=i(a.subindicador);let m;a.status&&a.status!=="todos"&&(a.status==="atingidos"?m="01":a.status==="nao"&&(m="02")),u&&(o.segmento=u),t&&(o.diretoria=t),c&&(o.regional=c),l&&(o.agencia=l),d&&(o.gerenteGestao=d),p&&(o.gerente=p),h&&(o.familia=h),F&&(o.indicador=F),w&&(o.subindicador=w),m&&(o.status=m)}return e?.start&&(o.dataInicio=e.start),e?.end&&(o.dataFim=e.end),o}async function R(a){if(!g.value){f.value=a,g.value=!0,s.value=null;try{const e=await D(a);e?n.value=e:s.value="Não foi possível carregar o resumo"}catch(e){console.error("Erro ao carregar resumo:",e),s.value=e instanceof Error?e.message:"Erro desconhecido"}finally{g.value=!1}}}function P(){n.value=null,s.value=null,f.value=null}function T(a,e){if(!y){y=!0;const{filterTrigger:t,filterState:c,period:l}=G();I(t,async()=>{await C();const d=b(c.value,l.value);R(d)},{immediate:!0})}const o=async()=>{const t=f.value??b(a.value,e.value);await R(t)},u=()=>{n.value=null,s.value=null,f.value=null};return{resumo:r(()=>n.value),produtos:r(()=>n.value?.cards??[]),produtosMensais:r(()=>n.value?.classifiedCards??[]),variavel:r(()=>n.value?.variableCard??[]),businessSnapshot:r(()=>n.value?.businessSnapshot??x),loading:r(()=>g.value),error:r(()=>s.value),loadResumo:o,clearData:u,buildFilters:()=>b(a.value,e.value)}}export{P as c,T as u};
