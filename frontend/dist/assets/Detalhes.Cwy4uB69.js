import{w as _e,e as L,r as T,b as X,J as He,m as r,o as l,F as E,q as e,j,k as G,t as z,E as p,D as N,B as ne,u as B,g as ve,v as $e,G as Re,H as Ae,N as Ke,y as We,M as Qe,C as Ce}from"./vendor.Mb-DmQZ9.js";import{a as Ye}from"./vue-router.BEbJbLaE.js";import{a as Xe,A as Ze,I as D,_ as Z}from"./index.Dr26WDVJ.js";import{u as pe}from"./useGlobalFilters.DPHmOsAT.js";import{u as ea}from"./usePeriodManager.7GB6tYuu.js";import{i as W,f as Q,b as ce,g as Y,h as ee,j as xe}from"./formatUtils.SsKD9Isb.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./calendarioService.B6FHbTv3.js";import"./useCalendarioCache.BpeOTXeR.js";async function aa(n){const o={};n&&(n.segmento&&(o.segmento=n.segmento),n.diretoria&&(o.diretoria=n.diretoria),n.regional&&(o.regional=n.regional),n.agencia&&(o.agencia=n.agencia),n.gerente&&(o.gerente=n.gerente),n.gerenteGestao&&(o.gerenteGestao=n.gerenteGestao),n.familia&&(o.familia=n.familia),n.indicador&&(o.indicador=n.indicador),n.subindicador&&(o.subindicador=n.subindicador),n.dataInicio&&(o.dataInicio=n.dataInicio),n.dataFim&&(o.dataFim=n.dataFim));const _=await Xe(Ze.DETALHES,o);return _.success&&_.data?_.data:(console.error("Erro ao buscar detalhes:",_.error),null)}const me=T(null),ie=T(!1),oe=T(null),ze=T(null);let Ve=!1;function J(n){if(!n)return;const o=n.trim();if(!o)return;const _=o.toLowerCase();if(!(_==="todos"||_==="todas"))return o}function ue(n,o){const _={};if(n){const b=J(n.segmento),C=J(n.diretoria),h=J(n.gerencia),y=J(n.agencia),m=J(n.gerente),w=J(n.ggestao),M=J(n.familia),k=J(n.indicador),d=J(n.subindicador);b&&(_.segmento=b),C&&(_.diretoria=C),h&&(_.regional=h),y&&(_.agencia=y),m&&(_.gerente=m),w&&(_.gerenteGestao=w),M&&(_.familia=M),k&&(_.indicador=k),d&&(_.subindicador=d)}return o?.start&&(_.dataInicio=o.start),o?.end&&(_.dataFim=o.end),_}async function Se(n){if(!ie.value){ze.value=n,ie.value=!0,oe.value=null;try{const o=await aa(n);o?me.value=o:(oe.value="Não foi possível carregar os dados de detalhes",me.value=[])}catch(o){console.error("Erro ao carregar detalhes:",o),oe.value=o instanceof Error?o.message:"Erro desconhecido"}finally{ie.value=!1}}}function ta(n,o){if(!Ve){Ve=!0;const{filterTrigger:b}=pe();_e(b,()=>{const C=ue(n.value,o.value);Se(C)},{immediate:!0})}const _=async()=>{const b=ze.value??ue(n.value,o.value);await Se(b)};return{detalhes:L(()=>me.value??[]),loading:L(()=>ie.value),error:L(()=>oe.value),loadDetalhes:_,buildFilters:()=>ue(n.value,o.value)}}const na={class:"tree-cell"},ia={key:1,class:"toggle toggle--placeholder","aria-hidden":"true"},oa={class:"label-strong"},sa={key:0,class:"col-number"},la=["title"],ra=["title"],da={key:1,class:"cell-content"},ca={class:"actions-cell"},ua={class:"actions-group"},_a={key:0,class:"tree-row tree-detail-row"},ma=["colspan"],va={class:"contract-detail-card"},pa={class:"contract-detail-card__actions"},ga={key:0,class:"contract-detail-card__warning"},ba={class:"contract-detail-card__warning-content"},ha={class:"contract-detail-card__warning-text"},fa={class:"contract-detail-card__warning-details"},ya={class:"contract-detail-card__table-wrapper"},wa={class:"contract-detail-card__table"},ka=X({__name:"TreeTableRow",props:{node:{},level:{},expanded:{type:Boolean},expandedRows:{default:()=>new Set},detailOpen:{type:Boolean,default:!1},activeColumns:{default:()=>[]}},emits:["toggle","action"],setup(n,{emit:o}){const _=n,b=o,C=L(()=>_.node.children.length>0),h=L(()=>_.node.summary.atingimento_p||0),y=L(()=>{const k=h.value;return k>=100?"text-success":k>=80?"text-warning":"text-danger"});function m(k){const d=_.node.summary;switch(k){case"realizado":return Q(d.valor_realizado);case"meta":return Q(d.valor_meta);case"atingimento_p":return`${ce(d.atingimento_p)}%`;case"meta_diaria":return Q(d.meta_diaria);case"referencia_hoje":return Q(d.referencia_hoje);case"pontos":return`${ce(d.pontos)} pts`;case"meta_diaria_necessaria":return Q(d.meta_diaria_necessaria);case"peso":return`${ce(d.peso)} pts`;case"projecao":return Q(d.projecao);case"data":return W(d.data);default:return"—"}}function w(k){const d=_.node.summary;switch(k){case"realizado":return Y(d.valor_realizado);case"meta":return Y(d.valor_meta);case"atingimento_p":return`${ee(d.atingimento_p)}%`;case"meta_diaria":return Y(d.meta_diaria);case"referencia_hoje":return Y(d.referencia_hoje);case"pontos":return`${ee(d.pontos)} pts`;case"meta_diaria_necessaria":return Y(d.meta_diaria_necessaria);case"peso":return`${ee(d.peso)} pts`;case"projecao":return Y(d.projecao);case"data":return W(d.data);default:return""}}const M=L(()=>!!_.node.detail?.dt_cancelamento);return(k,d)=>{const x=He("TreeTableRow",!0);return l(),r(E,null,[e("tr",{class:G(["tree-row","lvl-"+n.level,{"tree-row--expanded":n.expanded}])},[e("td",null,[e("div",na,[C.value||n.node.level==="contrato"?(l(),r("button",{key:0,type:"button",class:G(["toggle",{"is-expanded":n.expanded||n.node.level==="contrato"&&n.expanded}]),onClick:d[0]||(d[0]=A=>b("toggle",n.node.id))},[z(D,{name:n.expanded||n.node.level==="contrato"&&n.expanded?"chevron-down":"chevron-right",size:16},null,8,["name"])],2)):(l(),r("span",ia)),e("span",oa,p(n.node.label||"—"),1)])]),(l(!0),r(E,null,N(n.activeColumns,A=>(l(),r(E,{key:A},[A==="atingimento_p"?(l(),r("td",sa,[e("span",{class:G([y.value,"cell-content"]),title:w(A)},p(m(A)),11,la)])):(l(),r("td",{key:1,class:G(A==="data"?"col-number col-date":"col-number")},[A!=="data"?(l(),r("span",{key:0,title:w(A),class:"cell-content"},p(m(A)),9,ra)):(l(),r("span",da,p(m(A)),1))],2))],64))),128)),e("td",ca,[e("span",ua,[e("button",{type:"button",class:"icon-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:d[1]||(d[1]=ne(A=>b("action",{type:"ticket",node:n.node}),["stop"]))},[z(D,{name:"ticket",size:16})]),n.node.level!=="contrato"?(l(),r("button",{key:0,type:"button",class:"icon-btn",title:"Ver oportunidades","aria-label":"Ver oportunidades",onClick:d[2]||(d[2]=ne(A=>b("action",{type:"opportunities",node:n.node}),["stop"]))},[z(D,{name:"bulb",size:16})])):j("",!0)])])],2),n.node.level==="contrato"&&n.expanded?(l(),r("tr",_a,[e("td",{colspan:n.activeColumns.length+2,class:"tree-detail-cell"},[e("div",va,[e("div",pa,[e("button",{type:"button",class:"contract-detail-card__action-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:d[3]||(d[3]=ne(A=>b("action",{type:"ticket",node:n.node}),["stop"]))},[z(D,{name:"ticket",size:18}),d[6]||(d[6]=e("span",null,"Abrir chamado",-1))])]),M.value?(l(),r("div",ga,[e("div",ba,[z(D,{name:"alert-triangle",class:"contract-detail-card__warning-icon",size:20}),e("div",ha,[d[7]||(d[7]=e("strong",{class:"contract-detail-card__warning-title"},"Venda cancelada",-1)),e("p",fa," Cancelado em "+p(B(W)(n.node.detail?.dt_cancelamento||""))+". "+p(n.node.detail?.motivo_cancelamento||"Solicitação do cliente"),1)])])])):j("",!0),e("div",ya,[e("table",wa,[d[8]||(d[8]=e("thead",null,[e("tr",null,[e("th",null,"Canal da venda"),e("th",null,"Tipo da venda"),e("th",null,"Gerente"),e("th",null,"Condição de pagamento"),e("th",null,"Data de vencimento"),e("th",null,"Data de cancelamento"),e("th",null,"Motivo do cancelamento")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,p(n.node.detail?.canal_venda||"—"),1),e("td",null,p(n.node.detail?.tipo_venda||"—"),1),e("td",null,p(n.node.detail?.gerente||"—"),1),e("td",null,p(n.node.detail?.modalidade_pagamento||"—"),1),e("td",null,p(n.node.detail?.dt_vencimento?B(W)(n.node.detail.dt_vencimento):"—"),1),e("td",null,p(n.node.detail?.dt_cancelamento?B(W)(n.node.detail.dt_cancelamento):"—"),1),e("td",null,p(n.node.detail?.motivo_cancelamento||"—"),1)])])])])])],8,ma)])):j("",!0),n.expanded&&C.value?(l(!0),r(E,{key:1},N(n.node.children,A=>(l(),ve(x,{key:A.id,node:A,level:n.level+1,expanded:n.expandedRows?.has(A.id)||!1,"expanded-rows":n.expandedRows,"detail-open":!1,"active-columns":n.activeColumns,onToggle:d[4]||(d[4]=O=>b("toggle",O)),onAction:d[5]||(d[5]=O=>b("action",O))},null,8,["node","level","expanded","expanded-rows","active-columns"]))),128)):j("",!0)],64)}}}),$a=Z(ka,[["__scopeId","data-v-ee95ffe0"]]),Ca={class:"chipbar"},xa=["data-view","onClick"],Va=X({__name:"TableViewChips",props:{views:{},activeView:{}},emits:["viewChange"],setup(n,{emit:o}){const _=n,b=o,C=h=>{h!==_.activeView&&b("viewChange",h)};return(h,y)=>(l(),r("div",Ca,[(l(!0),r(E,null,N(n.views,m=>(l(),r("button",{key:m.id,type:"button",class:G(["chip",{"is-active":m.id===n.activeView}]),"data-view":m.id,onClick:w=>C(m.id)},p(m.label),11,xa))),128))]))}}),Sa=Z(Va,[["__scopeId","data-v-d6322d2c"]]),Ra={class:"detail-view-bar"},Aa={class:"detail-view-bar__left"},za={class:"detail-view-chips"},Da=["onClick"],Ta=X({__name:"DetailViewBar",props:{views:{},activeViewId:{}},emits:["viewChange"],setup(n,{emit:o}){const _=n,b=o,C=h=>{h!==_.activeViewId&&b("viewChange",h)};return(h,y)=>(l(),r("div",Ra,[e("div",Aa,[y[0]||(y[0]=e("span",{class:"detail-view-bar__label"},"Visões da tabela",-1)),e("div",za,[(l(!0),r(E,null,N(n.views,m=>(l(),r("button",{key:m.id,type:"button",class:G(["detail-chip",{"is-active":m.id===n.activeViewId}]),onClick:w=>C(m.id)},[e("span",null,p(m.name),1)],10,Da))),128))])])]))}}),ja=Z(Ta,[["__scopeId","data-v-52dcd004"]]),La={key:0,class:"applied-bar"},Ea={class:"k"},Ma={class:"v"},Fa=["aria-label","onClick"],Ba=X({__name:"AppliedFiltersBar",setup(n){const{filterState:o,clearFilter:_}=pe(),b=L(()=>{const h=[];return o.value.segmento&&o.value.segmento!=="Todos"&&h.push({key:"segmento",label:"Segmento",value:o.value.segmento}),o.value.diretoria&&o.value.diretoria!=="Todas"&&h.push({key:"diretoria",label:"Diretoria",value:o.value.diretoria}),o.value.gerencia&&o.value.gerencia!=="Todas"&&h.push({key:"gerencia",label:"Gerência",value:o.value.gerencia}),o.value.agencia&&o.value.agencia!=="Todas"&&h.push({key:"agencia",label:"Agência",value:o.value.agencia}),o.value.ggestao&&o.value.ggestao!=="Todos"&&h.push({key:"ggestao",label:"Gerente de gestão",value:o.value.ggestao}),o.value.gerente&&o.value.gerente!=="Todos"&&h.push({key:"gerente",label:"Gerente",value:o.value.gerente}),o.value.familia&&o.value.familia!=="Todas"&&h.push({key:"familia",label:"Família",value:o.value.familia}),o.value.indicador&&o.value.indicador!=="Todos"&&h.push({key:"indicador",label:"Indicador",value:o.value.indicador}),o.value.subindicador&&o.value.subindicador!=="Todos"&&h.push({key:"subindicador",label:"Subindicador",value:o.value.subindicador}),h}),C=h=>{_(h)};return(h,y)=>b.value.length>0?(l(),r("div",La,[(l(!0),r(E,null,N(b.value,m=>(l(),r("div",{key:m.key,class:"applied-chip"},[e("span",Ea,p(m.label),1),e("span",Ma,p(m.value),1),e("button",{type:"button",title:"Limpar",class:"applied-x","aria-label":`Remover ${m.label}`,onClick:w=>C(m.key)},[z(D,{name:"x",size:14})],8,Fa)]))),128))])):j("",!0)}}),Ga=Z(Ba,[["__scopeId","data-v-dba2fb80"]]),Na={class:"detail-designer__panel",role:"dialog","aria-modal":"true","aria-labelledby":"detail-designer-title"},Oa={class:"detail-designer__head"},Pa={key:0,class:"detail-designer__feedback",role:"alert"},Ia={key:1,class:"detail-designer__views"},Ua={class:"detail-designer__views-list"},Ja=["onClick"],qa=["aria-label","onClick"],Ha={class:"detail-designer__lists"},Ka={class:"detail-designer__list detail-designer__list--available"},Wa={class:"detail-designer__items"},Qa={class:"detail-item__handle","aria-hidden":"true"},Ya={class:"detail-item__label"},Xa=["aria-label","onClick"],Za={key:0,class:"detail-designer__empty"},et={class:"detail-designer__list detail-designer__list--selected"},at={class:"detail-designer__items"},tt={class:"detail-item__handle","aria-hidden":"true"},nt={class:"detail-item__label"},it=["disabled","aria-label","onClick"],ot={key:0,class:"detail-designer__empty"},st={class:"detail-designer__foot"},lt={class:"detail-designer__save"},rt={class:"detail-designer__input-wrapper"},dt=["disabled"],ct={class:"detail-designer__actions"},ut=["disabled"],_t=X({__name:"DetailColumnDesigner",props:{modelValue:{type:Boolean},selectedColumns:{},views:{},activeViewId:{}},emits:["update:modelValue","apply","save","load-view","delete-view"],setup(n,{emit:o}){const _=[{id:"realizado",label:"Realizado no período (R$)"},{id:"meta",label:"Meta no período (R$)"},{id:"atingimento_p",label:"Atingimento (%)"},{id:"meta_diaria",label:"Meta diária total (R$)"},{id:"referencia_hoje",label:"Referência para hoje (R$)"},{id:"pontos",label:"Pontos no período (pts)"},{id:"meta_diaria_necessaria",label:"Meta diária necessária (R$)"},{id:"peso",label:"Peso (pts)"},{id:"projecao",label:"Projeção (R$)"},{id:"data",label:"Data"}],b=n,C=o,h=L({get:()=>b.modelValue,set:v=>C("update:modelValue",v)}),y=T([...b.selectedColumns]),m=T(""),w=T(""),M=L(()=>_.filter(v=>!y.value.includes(v.id))),k=L(()=>y.value.length>1),d=v=>{y.value.includes(v)||(y.value.push(v),w.value="")},x=v=>{if(y.value.length<=1){w.value="Mantenha pelo menos uma coluna visível.";return}y.value=y.value.filter(S=>S!==v),w.value=""},A=()=>{if(y.value.length===0){w.value="Adicione ao menos uma coluna.";return}C("apply",[...y.value]),h.value=!1,w.value=""},O=()=>{const v=m.value.trim();if(y.value.length===0){w.value="Adicione ao menos uma coluna antes de salvar.";return}if(v.length<3){w.value="Use um nome com pelo menos 3 caracteres.";return}C("save",v,[...y.value]),m.value="",w.value="Visão salva com sucesso."},P=v=>{const S=b.views?.find($=>$.id===v);S&&(y.value=[...S.columns],w.value=""),C("load-view",v)},I=v=>{v!=="default"&&C("delete-view",v)},H=()=>{h.value=!1,y.value=[...b.selectedColumns],m.value="",w.value=""};return _e(()=>b.selectedColumns,v=>{y.value=[...v]},{immediate:!0}),_e(()=>b.modelValue,v=>{v&&(y.value=[...b.selectedColumns],m.value="",w.value="")}),(v,S)=>(l(),ve(Ke,{to:"body"},[h.value?(l(),r("div",{key:0,class:G(["detail-designer",{"is-open":h.value}]),onKeydown:$e(H,["escape"])},[e("div",{class:"detail-designer__overlay",onClick:H}),e("div",Na,[e("header",Oa,[S[1]||(S[1]=e("div",null,[e("h4",{id:"detail-designer-title"},"Personalizar colunas"),e("p",{class:"detail-designer__subtitle"}," Arraste as colunas para montar a visão da tabela e salve até 5 configurações preferidas. A coluna de ações continua fixa no final da grade. ")],-1)),e("button",{type:"button",class:"icon-btn detail-designer__close","aria-label":"Fechar personalização",onClick:H},[z(D,{name:"x",size:18})])]),w.value?(l(),r("div",Pa,p(w.value),1)):j("",!0),b.views&&b.views.length>0?(l(),r("section",Ia,[S[2]||(S[2]=e("div",{class:"detail-designer__views-head"},[e("span",null,"VISÕES SALVAS"),e("span",{class:"detail-designer__views-hint"},"Carregue para ajustar ou excluir.")],-1)),e("div",Ua,[(l(!0),r(E,null,N(b.views,$=>(l(),r("div",{key:$.id,class:"detail-view-chip-wrapper"},[e("button",{type:"button",class:G(["detail-view-chip",{"is-active":b.activeViewId===$.id}]),onClick:U=>P($.id)},p($.name),11,Ja),$.id!=="default"?(l(),r("button",{key:0,type:"button",class:"detail-view-chip__delete","aria-label":`Remover visão ${$.name}`,onClick:ne(U=>I($.id),["stop"])},[z(D,{name:"trash",size:16})],8,qa)):j("",!0)]))),128))])])):j("",!0),e("section",Ha,[e("div",Ka,[S[3]||(S[3]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas disponíveis"),e("p",null,"Arraste para incluir ou clique para adicionar.")],-1)),e("div",Wa,[(l(!0),r(E,null,N(M.value,$=>(l(),r("div",{key:$.id,class:"detail-item detail-item--available"},[e("span",Qa,[z(D,{name:"grip-vertical",size:16})]),e("span",Ya,p($.label),1),e("button",{type:"button",class:"detail-item__add","aria-label":`Adicionar ${$.label}`,onClick:U=>d($.id)},[z(D,{name:"plus",size:16})],8,Xa)]))),128)),M.value.length===0?(l(),r("p",Za," Todas as colunas já estão na tabela. ")):j("",!0)])]),e("div",et,[S[4]||(S[4]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas na tabela"),e("p",null,"Arraste para reorganizar ou clique para remover.")],-1)),e("div",at,[(l(!0),r(E,null,N(y.value,$=>(l(),r("div",{key:$,class:G(["detail-item",{"is-disabled":!k.value}])},[e("span",tt,[z(D,{name:"grip-vertical",size:16})]),e("span",nt,p(_.find(U=>U.id===$)?.label||$),1),e("button",{type:"button",class:G(["detail-item__remove",{"is-disabled":!k.value}]),disabled:!k.value,"aria-label":`Remover ${_.find(U=>U.id===$)?.label||$}`,onClick:U=>x($)},[z(D,{name:"x",size:18})],10,it)],2))),128)),y.value.length===0?(l(),r("p",ot," Escolha ao menos uma coluna. ")):j("",!0)])])]),e("footer",st,[e("div",lt,[S[5]||(S[5]=e("label",{for:"detail-view-name",class:"detail-designer__save-label"}," SALVAR NOVA VISÃO ",-1)),e("div",rt,[Re(e("input",{id:"detail-view-name","onUpdate:modelValue":S[0]||(S[0]=$=>m.value=$),type:"text",class:"input input--sm detail-designer__input",maxlength:"48",placeholder:"Ex.: Indicadores priorizados",onKeyup:$e(O,["enter"])},null,544),[[Ae,m.value]]),e("button",{type:"button",class:"btn btn--primary detail-designer__save-btn",disabled:!m.value.trim()||m.value.trim().length<3,onClick:O}," Salvar visão ",8,dt)]),S[6]||(S[6]=e("small",{class:"detail-designer__save-hint"}," Você pode guardar até 5 visões personalizadas. ",-1))]),e("div",ct,[e("button",{type:"button",class:"btn btn--secondary detail-designer__action-btn",onClick:H}," Cancelar "),e("button",{type:"button",class:"btn btn--primary detail-designer__action-btn",disabled:y.value.length===0,onClick:A}," Aplicar ",8,ut)])])])],34)):j("",!0)]))}}),mt=Z(_t,[["__scopeId","data-v-97d15039"]]),vt={class:"detalhes-wrapper"},pt={class:"detalhes-view"},gt={class:"card card--detalhes"},bt={class:"card__header"},ht={class:"card__actions"},ft={class:"search-box"},yt={class:"table-controls"},wt={class:"table-controls__main"},kt={class:"table-controls__chips"},$t={class:"table-toolbar-wrapper"},Ct={class:"table-toolbar"},xt={class:"table-toolbar__icon"},Vt={class:"table-toolbar__icon"},St={class:"table-toolbar__icon"},Rt={key:0,class:"detalhes-skeleton"},At={key:0,class:"error-state"},zt={key:1,class:"empty-state"},Dt={key:2,class:"empty-state"},Tt={key:3,class:"contratos-grid"},jt={class:"contrato-card__header"},Lt={class:"contrato-card__title"},Et={class:"contrato-card__body"},Mt={class:"contrato-card__info"},Ft={class:"contrato-card__info-item"},Bt={class:"contrato-card__value"},Gt={key:0,class:"contrato-card__info-item"},Nt={class:"contrato-card__value"},Ot={class:"contrato-card__info-item"},Pt={class:"contrato-card__value"},It={class:"contrato-card__info-item"},Ut={class:"contrato-card__value"},Jt={class:"contrato-card__info-item"},qt={class:"contrato-card__value"},Ht={class:"contrato-card__metrics"},Kt={class:"contrato-card__metric"},Wt={class:"contrato-card__metric-value"},Qt={class:"contrato-card__metric"},Yt={class:"contrato-card__metric-value"},Xt={class:"contrato-card__metric"},Zt={class:"contrato-card__metric-value"},en={class:"contrato-card__metric"},an={class:"contrato-card__metric-value"},tn={key:0,class:"contrato-card__dates"},nn={class:"contrato-card__date-item"},on={class:"contrato-card__date-value"},sn={key:0,class:"contrato-card__date-item"},ln={class:"contrato-card__date-value"},rn={key:1,class:"contrato-card__cancelamento"},dn={class:"contrato-card__cancelamento-value"},cn={key:4,class:"table-wrapper"},un={class:"tree-table"},_n=["aria-pressed"],mn={class:"tree-sort__icon"},vn=["aria-pressed","onClick"],pn={class:"tree-sort__icon"},gn=X({__name:"Detalhes",setup(n){const o=Ye(),{filterState:_}=pe(),{period:b}=ea(),{detalhes:C,loading:h,error:y}=ta(_,b),m=T(new Set),w=T(""),M=T("diretoria"),k=T("default"),d=T(!1),x=T({id:null,direction:null}),A=["realizado","meta","atingimento_p","meta_diaria","referencia_hoje","pontos","meta_diaria_necessaria","peso","projecao","data"],O=[...A];function P(i){const t=new Set,a=i.filter(s=>!A.includes(s)||t.has(s)?!1:(t.add(s),!0));return a.length?a:[...O]}const I=T(P(O)),H=[{id:"diretoria",label:"Diretoria",key:"diretoria"},{id:"gerencia",label:"Regional",key:"gerenciaRegional"},{id:"agencia",label:"Agência",key:"agencia"},{id:"gGestao",label:"Gerente de gestão",key:"gerenteGestao"},{id:"gerente",label:"Gerente",key:"gerente"},{id:"secao",label:"Família",key:"secao"},{id:"familia",label:"Indicador",key:"familia"},{id:"prodsub",label:"Subindicador",key:"prodOrSub"},{id:"contrato",label:"Contratos",key:"contrato"}],v=T([{id:"default",name:"Visão padrão",columns:P(O)}]),S={diretoria:["diretoria","regional","agencia","gerente","familia","indicador","subindicador","contrato"],gerencia:["regional","agencia","gerente","familia","indicador","subindicador","contrato"],agencia:["agencia","gerente","familia","indicador","subindicador","contrato"],gGestao:["gGestao","gerente","familia","indicador","subindicador","contrato"],gerente:["gerente","familia","indicador","subindicador","contrato"],secao:["familia","indicador","subindicador","contrato"],familia:["indicador","subindicador","contrato"],prodsub:["subindicador","contrato"],contrato:["contrato"]};function $(i,t){if(t==="__label__")return i.label||"";const a=i.summary;switch(t){case"realizado":return a.valor_realizado||0;case"meta":return a.valor_meta||0;case"atingimento_v":return a.atingimento_v||0;case"atingimento_p":return a.atingimento_p||0;case"meta_diaria":return a.meta_diaria||0;case"referencia_hoje":return a.referencia_hoje||0;case"pontos":return a.pontos||0;case"meta_diaria_necessaria":return a.meta_diaria_necessaria||0;case"peso":return a.peso||0;case"projecao":return a.projecao||0;case"data":return a.data||"";default:return 0}}function U(i){return!x.value.id||!x.value.direction?i:[...i].sort((a,s)=>{const c=$(a,x.value.id),u=$(s,x.value.id);let f=0;return typeof c=="number"&&typeof u=="number"?f=c-u:f=String(c).localeCompare(String(u),"pt-BR"),x.value.direction==="asc"?f:-f}).map(a=>({...a,children:U(a.children)}))}const ge=L(()=>{if(!w.value.trim()||!C.value.length)return[];const i=w.value.toLowerCase().trim(),t=C.value.filter(c=>c.id_contrato?.toLowerCase().includes(i)||c.registro_id?.toLowerCase().includes(i)||c.gerente_nome?.toLowerCase().includes(i)||c.familia_nome?.toLowerCase().includes(i)||c.ds_indicador?.toLowerCase().includes(i)),a=new Map;t.forEach(c=>{const u=c.id_contrato||c.registro_id||"sem-contrato";a.has(u)||a.set(u,[]),a.get(u).push(c)});const s=[];return a.forEach((c,u)=>{const f=c[0];f&&s.push({id:`contrato-${u}`,contratoId:u,items:c,summary:le(c),detail:{canal_venda:f.canal_venda,tipo_venda:f.tipo_venda,gerente:f.gerente_nome,gerente_gestao:f.gerente_gestao_nome,modalidade_pagamento:f.modalidade_pagamento,dt_vencimento:f.dt_vencimento,dt_cancelamento:f.dt_cancelamento,motivo_cancelamento:f.motivo_cancelamento}})}),x.value.id&&x.value.direction&&s.sort((c,u)=>{let f=0,g=0;if(x.value.id==="__label__")f=c.contratoId,g=u.contratoId;else{const V=x.value.id;f=c.summary[V]??0,g=u.summary[V]??0}let R=0;return typeof f=="number"&&typeof g=="number"?R=f-g:R=String(f).localeCompare(String(g),"pt-BR"),x.value.direction==="asc"?R:-R}),s}),ae=L(()=>{if(!C.value.length||w.value.trim())return[];const i=S[M.value]||S.diretoria;let t=[];if(M.value==="contrato"){const a=new Map;C.value.forEach(s=>{const c=s.id_contrato||s.registro_id||"sem-contrato";a.has(c)||a.set(c,[]),a.get(c).push(s)}),a.forEach((s,c)=>{const u=s[0];u&&t.push({id:`contrato-${c}`,label:c,level:"contrato",children:[],data:s,summary:le(s),detail:{canal_venda:u.canal_venda,tipo_venda:u.tipo_venda,gerente:u.gerente_nome,gerente_gestao:u.gerente_gestao_nome,modalidade_pagamento:u.modalidade_pagamento,dt_vencimento:u.dt_vencimento,dt_cancelamento:u.dt_cancelamento,motivo_cancelamento:u.motivo_cancelamento}})})}else{const a=i||S.diretoria;t=he(C.value,a,0)}return U(t)}),se=L(()=>w.value.trim().length>0);function be(i){if(i.children.forEach(t=>be(t)),i.children.length>0){const t=i.children.reduce((s,c)=>s+(c.summary.pontos||0),0),a=i.children.reduce((s,c)=>s+(c.summary.peso||0),0);i.summary.pontos=t,i.summary.peso=a}}function he(i,t,a){if(a>=t.length||i.length===0)return[];const s=t[a],c=t[a+1],u=new Map;i.forEach(g=>{let R;switch(s){case"diretoria":R=g.diretoria_id||"sem-diretoria",g.diretoria_nome;break;case"regional":R=g.gerencia_id||"sem-regional",g.gerencia_nome;break;case"agencia":R=g.agencia_id||"sem-agencia",g.agencia_nome;break;case"gGestao":R=g.gerente_gestao_id||"sem-gerente-gestao",g.gerente_gestao_nome;break;case"gerente":R=g.gerente_id||"sem-gerente",g.gerente_nome;break;case"familia":R=g.familia_id||"sem-familia",g.familia_nome;break;case"indicador":R=g.id_indicador||"sem-indicador",g.ds_indicador;break;case"subindicador":R=g.id_subindicador||"sem-subindicador",g.subindicador;break;case"contrato":R=g.id_contrato||g.registro_id||"sem-contrato";break;default:R="unknown"}u.has(R)||u.set(R,[]),u.get(R).push(g)});const f=[];return u.forEach((g,R)=>{const V=g[0];if(!V)return;let F=V.diretoria_nome||"Sem label";switch(s){case"diretoria":F=V.diretoria_nome||"Sem diretoria";break;case"regional":F=V.gerencia_nome||"Sem regional";break;case"agencia":F=V.agencia_nome||"Sem agência";break;case"gGestao":F=V.gerente_gestao_nome||"Sem gerente de gestão";break;case"gerente":F=V.gerente_nome||"Sem gerente";break;case"familia":F=V.familia_nome||"Sem família";break;case"indicador":F=V.ds_indicador||"Sem indicador";break;case"subindicador":F=V.subindicador||"Sem subindicador";break;case"contrato":F=V.id_contrato||V.registro_id||"Sem contrato";break}const te={id:`${s}-${R}`,label:F,level:s,children:c?he(g,t,a+1):[],data:g,summary:le(g)};s==="contrato"&&(te.detail={canal_venda:V.canal_venda||void 0,tipo_venda:V.tipo_venda||void 0,gerente:V.gerente_nome||void 0,modalidade_pagamento:V.modalidade_pagamento||void 0,dt_vencimento:V.dt_vencimento||void 0,dt_cancelamento:V.dt_cancelamento||void 0,motivo_cancelamento:V.motivo_cancelamento||void 0}),f.push(te)}),f.forEach(g=>be(g)),f}function le(i){const t=i.reduce((K,q)=>K+(q.valor_realizado||0),0),a=i.reduce((K,q)=>K+(q.valor_meta||q.meta_mensal||0),0),s=i.reduce((K,q)=>K+(q.peso||0),0),c=i.reduce((K,q)=>K+(q.peso||0),0),u=30,f=new Date().getDate(),g=Math.max(1,u-f),R=a/u,V=f>0?Math.min(a,R*f):0,F=g>0?Math.max(0,(a-t)/g):0,te=f>0?t/Math.max(f,1)*u:t,Ue=t-a,Je=a>0?t/a*100:0,de=i.length>0?i[0]:null,qe=de&&(de.data||de.competencia)||"";return{valor_realizado:t,valor_meta:a,atingimento_v:Ue,atingimento_p:Je,meta_diaria:R,referencia_hoje:V,pontos:s,meta_diaria_necessaria:F,peso:c,projecao:te,data:qe}}const re=T(new Set);function De(i){if(i.type==="ticket"){const t=Te(i.node),a=new URLSearchParams({openDrawer:"true",intent:"new-ticket",preferredQueue:"POBJ",queue:"POBJ",observation:t}),s=o.resolve({name:"Omega",query:Object.fromEntries(a)});window.open(s.href,"_blank")}else i.type==="opportunities"&&console.log("Abrir oportunidades para:",i.node)}function Te(i){const t=[];if(i.label&&t.push(`Item: ${i.label}`),i.level&&t.push(`Nível: ${i.level}`),i.summary){const a=i.summary;a.valor_realizado&&t.push(`Realizado: R$ ${a.valor_realizado.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.valor_meta&&t.push(`Meta: R$ ${a.valor_meta.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.atingimento_p!==void 0&&t.push(`Atingimento: ${a.atingimento_p.toFixed(1)}%`)}if(i.detail){const a=i.detail;a.gerente&&t.push(`Gerente: ${a.gerente}`),a.canal_venda&&t.push(`Canal: ${a.canal_venda}`),a.tipo_venda&&t.push(`Tipo de venda: ${a.tipo_venda}`)}return t.join(`
`)}function je(i){const a=fe(ae.value,i)?.level==="contrato";m.value.has(i)?(m.value.delete(i),a&&re.value.delete(i)):(m.value.add(i),a&&re.value.add(i))}function fe(i,t){for(const a of i){if(a.id===t)return a;const s=fe(a.children,t);if(s)return s}return null}const Le=L(()=>{const i=H.find(t=>t.id===M.value);return i?i.label:"Item"});function Ee(i){return{realizado:"Realizado no período (R$)",meta:"Meta no período (R$)",atingimento_p:"Atingimento (%)",meta_diaria:"Meta diária total (R$)",referencia_hoje:"Referência para hoje (R$)",pontos:"Pontos no período (pts)",meta_diaria_necessaria:"Meta diária necessária (R$)",peso:"Peso (pts)",projecao:"Projeção (R$)",data:"Data"}[i]||i}function ye(i){return x.value.id!==i||!x.value.direction?"arrows-up-down":x.value.direction==="asc"?"arrow-up":"arrow-down"}function we(i){const t=x.value,s=i==="__label__"?"asc":"desc",c=s==="asc"?"desc":"asc";let u;t.id!==i||!t.direction?u=s:t.direction===s?u=c:u=null,u?x.value={id:i,direction:u}:x.value={id:null,direction:null}}function Me(i){return m.value.has(i)}function Fe(){const i=[];function t(a){a.forEach(s=>{s.children.length>0&&(i.push(s.id),t(s.children))})}t(ae.value),m.value=new Set(i)}function Be(){m.value.clear()}function Ge(i){M.value=i}function ke(i){k.value=i;const t=v.value.find(a=>a.id===i);if(t){const a=P(t.columns);t.columns=a,I.value=[...a]}}function Ne(){d.value=!0}function Oe(i,t){const a=P(t),s=v.value.find(c=>c.name.toLowerCase()===i.toLowerCase()&&c.id!=="default");if(s)s.columns=[...a],k.value=s.id;else{if(v.value.filter(f=>f.id!=="default").length>=5){alert("Você já possui 5 visões personalizadas. Exclua uma antes de criar outra.");return}const u={id:`custom-${Date.now()}`,name:i,columns:[...a]};v.value.push(u),k.value=u.id}I.value=[...a],localStorage.setItem("pobj3:detailViews",JSON.stringify(v.value.filter(c=>c.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",k.value)}function Pe(i){if(i==="default")return;const t=v.value.findIndex(a=>a.id===i);if(t>-1){if(v.value.splice(t,1),k.value===i){k.value="default";const a=v.value.find(s=>s.id==="default");if(a){const s=P(a.columns);a.columns=s,I.value=[...s]}}localStorage.setItem("pobj3:detailViews",JSON.stringify(v.value.filter(a=>a.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",k.value)}}function Ie(i){const t=P(i);if(I.value=[...t],k.value==="__custom__"||k.value.startsWith("custom-")){const a=v.value.find(s=>s.id===k.value);a&&(a.columns=[...t],localStorage.setItem("pobj3:detailViews",JSON.stringify(v.value.filter(s=>s.id!=="default"))))}localStorage.setItem("pobj3:detailActiveView",k.value)}return We(()=>{try{const i=localStorage.getItem("pobj3:detailViews");if(i){const a=JSON.parse(i);Array.isArray(a)&&(v.value=[...v.value,...a.map(s=>({id:s.id||`custom-${Date.now()}`,name:s.name||"Visão personalizada",columns:P(Array.isArray(s.columns)?s.columns:[])}))])}const t=localStorage.getItem("pobj3:detailActiveView");if(t){const a=v.value.find(s=>s.id===t);if(a){k.value=t;const s=P(a.columns);a.columns=s,I.value=[...s]}}}catch(i){console.error("Erro ao carregar visões salvas:",i)}}),(i,t)=>(l(),r("div",vt,[e("div",pt,[e("div",gt,[e("header",bt,[t[4]||(t[4]=e("div",{class:"title-subtitle"},[e("h3",null,"Detalhamento"),e("p",{class:"muted"},"Visualize os contratos em uma estrutura hierárquica")],-1)),e("div",ht,[e("div",ft,[Re(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),type:"text",placeholder:"Contrato (Ex.: 999999)",class:"input input--search"},null,512),[[Ae,w.value]])])])]),z(Ga),e("div",yt,[e("div",wt,[e("div",kt,[z(Sa,{views:H,"active-view":M.value,onViewChange:Ge},null,8,["active-view"])]),t[5]||(t[5]=e("div",{class:"table-controls__search"},null,-1))])]),z(ja,{views:v.value,"active-view-id":k.value,onViewChange:ke},null,8,["views","active-view-id"]),e("div",$t,[e("div",Ct,[e("button",{type:"button",class:"table-toolbar__btn",onClick:Fe},[e("span",xt,[z(D,{name:"chevrons-down",size:16})]),t[6]||(t[6]=e("span",{class:"table-toolbar__text"},"Expandir tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn",onClick:Be},[e("span",Vt,[z(D,{name:"chevrons-up",size:16})]),t[7]||(t[7]=e("span",{class:"table-toolbar__text"},"Recolher tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn detail-view-manage",title:"Personalizar colunas da tabela",onClick:Ne},[e("span",St,[z(D,{name:"columns",size:16})]),t[8]||(t[8]=e("span",{class:"table-toolbar__text"},"Personalizar colunas",-1))])])]),B(h)?(l(),r("div",Rt,[...t[9]||(t[9]=[Qe('<div class="skeleton skeleton--table-header" style="height:40px;width:100%;margin-bottom:12px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div>',10)])])):(l(),r(E,{key:1},[B(y)?(l(),r("div",At,[e("p",null,p(B(y)),1)])):se.value&&ge.value.length===0?(l(),r("div",zt,[...t[10]||(t[10]=[e("p",null,"Nenhum contrato encontrado para a busca.",-1)])])):!se.value&&ae.value.length===0?(l(),r("div",Dt,[...t[11]||(t[11]=[e("p",null,"Nenhum dado encontrado para os filtros selecionados.",-1)])])):se.value?(l(),r("div",Tt,[(l(!0),r(E,null,N(ge.value,a=>(l(),r("div",{key:a.id,class:"contrato-card"},[e("div",jt,[e("h4",Lt,p(a.contratoId),1),e("div",{class:G(["contrato-card__badge",{"is-success":a.summary.atingimento_p>=100,"is-warning":a.summary.atingimento_p>=50&&a.summary.atingimento_p<100,"is-danger":a.summary.atingimento_p<50}])},p(a.summary.atingimento_p.toFixed(1))+"% ",3)]),e("div",Et,[e("div",Mt,[e("div",Ft,[t[12]||(t[12]=e("span",{class:"contrato-card__label"},"Gerente:",-1)),e("span",Bt,p(a.detail.gerente||"—"),1)]),a.detail.gerente_gestao?(l(),r("div",Gt,[t[13]||(t[13]=e("span",{class:"contrato-card__label"},"Gerente de gestão:",-1)),e("span",Nt,p(a.detail.gerente_gestao),1)])):j("",!0),e("div",Ot,[t[14]||(t[14]=e("span",{class:"contrato-card__label"},"Canal:",-1)),e("span",Pt,p(a.detail.canal_venda||"—"),1)]),e("div",It,[t[15]||(t[15]=e("span",{class:"contrato-card__label"},"Tipo:",-1)),e("span",Ut,p(a.detail.tipo_venda||"—"),1)]),e("div",Jt,[t[16]||(t[16]=e("span",{class:"contrato-card__label"},"Modalidade:",-1)),e("span",qt,p(a.detail.modalidade_pagamento||"—"),1)])]),e("div",Ht,[e("div",Kt,[t[17]||(t[17]=e("span",{class:"contrato-card__metric-label"},"Realizado",-1)),e("span",Wt,p(B(xe)(a.summary.valor_realizado)),1)]),e("div",Qt,[t[18]||(t[18]=e("span",{class:"contrato-card__metric-label"},"Meta",-1)),e("span",Yt,p(B(xe)(a.summary.valor_meta)),1)]),e("div",Xt,[t[19]||(t[19]=e("span",{class:"contrato-card__metric-label"},"Pontos",-1)),e("span",Zt,p(B(ee)(a.summary.pontos)),1)]),e("div",en,[t[20]||(t[20]=e("span",{class:"contrato-card__metric-label"},"Peso",-1)),e("span",an,p(B(ee)(a.summary.peso)),1)])]),a.detail.dt_vencimento?(l(),r("div",tn,[e("div",nn,[t[21]||(t[21]=e("span",{class:"contrato-card__date-label"},"Vencimento:",-1)),e("span",on,p(B(W)(a.detail.dt_vencimento)),1)]),a.detail.dt_cancelamento?(l(),r("div",sn,[t[22]||(t[22]=e("span",{class:"contrato-card__date-label"},"Cancelamento:",-1)),e("span",ln,p(B(W)(a.detail.dt_cancelamento)),1)])):j("",!0)])):j("",!0),a.detail.motivo_cancelamento?(l(),r("div",rn,[t[23]||(t[23]=e("span",{class:"contrato-card__cancelamento-label"},"Motivo:",-1)),e("span",dn,p(a.detail.motivo_cancelamento),1)])):j("",!0)])]))),128))])):(l(),r("div",cn,[e("table",un,[e("thead",null,[e("tr",null,[e("th",null,[e("button",{type:"button",class:"tree-sort","aria-pressed":x.value.id==="__label__"&&x.value.direction?"true":"false",onClick:t[1]||(t[1]=a=>we("__label__"))},[Ce(p(Le.value)+" ",1),e("span",mn,[z(D,{name:ye("__label__"),size:16},null,8,["name"])])],8,_n)]),(l(!0),r(E,null,N(I.value,a=>(l(),r("th",{key:a,class:"col-number"},[e("button",{type:"button",class:"tree-sort","aria-pressed":x.value.id===a&&x.value.direction?"true":"false",onClick:s=>we(a)},[Ce(p(Ee(a))+" ",1),e("span",pn,[z(D,{name:ye(a),size:16},null,8,["name"])])],8,vn)]))),128))])]),e("tbody",null,[(l(!0),r(E,null,N(ae.value,a=>(l(),ve($a,{key:a.id,node:a,level:0,expanded:Me(a.id),"expanded-rows":m.value,"detail-open":re.value.has(a.id),"active-columns":I.value,onToggle:t[2]||(t[2]=s=>je(s)),onAction:De},null,8,["node","expanded","expanded-rows","detail-open","active-columns"]))),128))])])]))],64))])]),z(mt,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=a=>d.value=a),"selected-columns":I.value,views:v.value,"active-view-id":k.value,onApply:Ie,onSave:Oe,onLoadView:ke,onDeleteView:Pe},null,8,["modelValue","selected-columns","views","active-view-id"])]))}}),Sn=Z(gn,[["__scopeId","data-v-478861a1"]]);export{Sn as default};
