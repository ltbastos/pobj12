import{b as Y,e as B,J as Fe,m as s,o,F as T,q as e,j,k as N,t as R,E as _,D as F,B as te,u as M,g as re,r as E,w as ge,v as be,G as ye,H as we,N as Oe,y as Ge,M as Pe,C as he}from"./vendor.Mb-DmQZ9.js";import{a as Ie}from"./vue-router.BEbJbLaE.js";import{I as D,_ as X}from"./index.BTfDv-kk.js";import{u as ke}from"./useGlobalFilters.DVWt81fx.js";import{u as Ue}from"./usePeriodManager.DXeKFEmp.js";import{u as Je}from"./useDetalhesData.BHA8-3fN.js";import{i as K,f as W,b as le,g as Q,h as Z,j as fe}from"./formatUtils.SsKD9Isb.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./calendarioService.YABvM0Wu.js";import"./useCalendarioCache.vNbdq2fG.js";const qe={class:"tree-cell"},He={key:1,class:"toggle toggle--placeholder","aria-hidden":"true"},Ke={class:"label-strong"},We={key:0,class:"col-number"},Qe=["title"],Ye=["title"],Xe={key:1,class:"cell-content"},Ze={class:"actions-cell"},ea={class:"actions-group"},aa={key:0,class:"tree-row tree-detail-row"},ta=["colspan"],na={class:"contract-detail-card"},ia={class:"contract-detail-card__actions"},oa={key:0,class:"contract-detail-card__warning"},sa={class:"contract-detail-card__warning-content"},la={class:"contract-detail-card__warning-text"},ra={class:"contract-detail-card__warning-details"},da={class:"contract-detail-card__table-wrapper"},ca={class:"contract-detail-card__table"},ua=Y({__name:"TreeTableRow",props:{node:{},level:{},expanded:{type:Boolean},expandedRows:{default:()=>new Set},detailOpen:{type:Boolean,default:!1},activeColumns:{default:()=>[]}},emits:["toggle","action"],setup(l,{emit:m}){const A=l,f=m,z=B(()=>A.node.children.length>0),b=B(()=>A.node.summary.atingimento_p||0),h=B(()=>{const w=b.value;return w>=100?"text-success":w>=80?"text-warning":"text-danger"});function v(w){const r=A.node.summary;switch(w){case"realizado":return W(r.valor_realizado);case"meta":return W(r.valor_meta);case"atingimento_p":return`${le(r.atingimento_p)}%`;case"meta_diaria":return W(r.meta_diaria);case"referencia_hoje":return W(r.referencia_hoje);case"pontos":return`${le(r.pontos)} pts`;case"meta_diaria_necessaria":return W(r.meta_diaria_necessaria);case"peso":return`${le(r.peso)} pts`;case"projecao":return W(r.projecao);case"data":return K(r.data);default:return"—"}}function y(w){const r=A.node.summary;switch(w){case"realizado":return Q(r.valor_realizado);case"meta":return Q(r.valor_meta);case"atingimento_p":return`${Z(r.atingimento_p)}%`;case"meta_diaria":return Q(r.meta_diaria);case"referencia_hoje":return Q(r.referencia_hoje);case"pontos":return`${Z(r.pontos)} pts`;case"meta_diaria_necessaria":return Q(r.meta_diaria_necessaria);case"peso":return`${Z(r.peso)} pts`;case"projecao":return Q(r.projecao);case"data":return K(r.data);default:return""}}const O=B(()=>!!A.node.detail?.dt_cancelamento);return(w,r)=>{const $=Fe("TreeTableRow",!0);return o(),s(T,null,[e("tr",{class:N(["tree-row","lvl-"+l.level,{"tree-row--expanded":l.expanded}])},[e("td",null,[e("div",qe,[z.value||l.node.level==="contrato"?(o(),s("button",{key:0,type:"button",class:N(["toggle",{"is-expanded":l.expanded||l.node.level==="contrato"&&l.expanded}]),onClick:r[0]||(r[0]=S=>f("toggle",l.node.id))},[R(D,{name:l.expanded||l.node.level==="contrato"&&l.expanded?"chevron-down":"chevron-right",size:16},null,8,["name"])],2)):(o(),s("span",He)),e("span",Ke,_(l.node.label||"—"),1)])]),(o(!0),s(T,null,F(l.activeColumns,S=>(o(),s(T,{key:S},[S==="atingimento_p"?(o(),s("td",We,[e("span",{class:N([h.value,"cell-content"]),title:y(S)},_(v(S)),11,Qe)])):(o(),s("td",{key:1,class:N(S==="data"?"col-number col-date":"col-number")},[S!=="data"?(o(),s("span",{key:0,title:y(S),class:"cell-content"},_(v(S)),9,Ye)):(o(),s("span",Xe,_(v(S)),1))],2))],64))),128)),e("td",Ze,[e("span",ea,[e("button",{type:"button",class:"icon-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:r[1]||(r[1]=te(S=>f("action",{type:"ticket",node:l.node}),["stop"]))},[R(D,{name:"ticket",size:16})]),l.node.level!=="contrato"?(o(),s("button",{key:0,type:"button",class:"icon-btn",title:"Ver oportunidades","aria-label":"Ver oportunidades",onClick:r[2]||(r[2]=te(S=>f("action",{type:"opportunities",node:l.node}),["stop"]))},[R(D,{name:"bulb",size:16})])):j("",!0)])])],2),l.node.level==="contrato"&&l.expanded?(o(),s("tr",aa,[e("td",{colspan:l.activeColumns.length+2,class:"tree-detail-cell"},[e("div",na,[e("div",ia,[e("button",{type:"button",class:"contract-detail-card__action-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:r[3]||(r[3]=te(S=>f("action",{type:"ticket",node:l.node}),["stop"]))},[R(D,{name:"ticket",size:18}),r[6]||(r[6]=e("span",null,"Abrir chamado",-1))])]),O.value?(o(),s("div",oa,[e("div",sa,[R(D,{name:"alert-triangle",class:"contract-detail-card__warning-icon",size:20}),e("div",la,[r[7]||(r[7]=e("strong",{class:"contract-detail-card__warning-title"},"Venda cancelada",-1)),e("p",ra," Cancelado em "+_(M(K)(l.node.detail?.dt_cancelamento||""))+". "+_(l.node.detail?.motivo_cancelamento||"Solicitação do cliente"),1)])])])):j("",!0),e("div",da,[e("table",ca,[r[8]||(r[8]=e("thead",null,[e("tr",null,[e("th",null,"Canal da venda"),e("th",null,"Tipo da venda"),e("th",null,"Gerente"),e("th",null,"Condição de pagamento"),e("th",null,"Data de vencimento"),e("th",null,"Data de cancelamento"),e("th",null,"Motivo do cancelamento")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,_(l.node.detail?.canal_venda||"—"),1),e("td",null,_(l.node.detail?.tipo_venda||"—"),1),e("td",null,_(l.node.detail?.gerente||"—"),1),e("td",null,_(l.node.detail?.modalidade_pagamento||"—"),1),e("td",null,_(l.node.detail?.dt_vencimento?M(K)(l.node.detail.dt_vencimento):"—"),1),e("td",null,_(l.node.detail?.dt_cancelamento?M(K)(l.node.detail.dt_cancelamento):"—"),1),e("td",null,_(l.node.detail?.motivo_cancelamento||"—"),1)])])])])])],8,ta)])):j("",!0),l.expanded&&z.value?(o(!0),s(T,{key:1},F(l.node.children,S=>(o(),re($,{key:S.id,node:S,level:l.level+1,expanded:l.expandedRows?.has(S.id)||!1,"expanded-rows":l.expandedRows,"detail-open":!1,"active-columns":l.activeColumns,onToggle:r[4]||(r[4]=G=>f("toggle",G)),onAction:r[5]||(r[5]=G=>f("action",G))},null,8,["node","level","expanded","expanded-rows","active-columns"]))),128)):j("",!0)],64)}}}),_a=X(ua,[["__scopeId","data-v-ee95ffe0"]]),ma={class:"chipbar"},va=["data-view","onClick"],pa=Y({__name:"TableViewChips",props:{views:{},activeView:{}},emits:["viewChange"],setup(l,{emit:m}){const A=l,f=m,z=b=>{b!==A.activeView&&f("viewChange",b)};return(b,h)=>(o(),s("div",ma,[(o(!0),s(T,null,F(l.views,v=>(o(),s("button",{key:v.id,type:"button",class:N(["chip",{"is-active":v.id===l.activeView}]),"data-view":v.id,onClick:y=>z(v.id)},_(v.label),11,va))),128))]))}}),ga=X(pa,[["__scopeId","data-v-d6322d2c"]]),ba={class:"detail-view-bar"},ha={class:"detail-view-bar__left"},fa={class:"detail-view-chips"},ya=["onClick"],wa=Y({__name:"DetailViewBar",props:{views:{},activeViewId:{}},emits:["viewChange"],setup(l,{emit:m}){const A=l,f=m,z=b=>{b!==A.activeViewId&&f("viewChange",b)};return(b,h)=>(o(),s("div",ba,[e("div",ha,[h[0]||(h[0]=e("span",{class:"detail-view-bar__label"},"Visões da tabela",-1)),e("div",fa,[(o(!0),s(T,null,F(l.views,v=>(o(),s("button",{key:v.id,type:"button",class:N(["detail-chip",{"is-active":v.id===l.activeViewId}]),onClick:y=>z(v.id)},[e("span",null,_(v.name),1)],10,ya))),128))])])]))}}),ka=X(wa,[["__scopeId","data-v-52dcd004"]]),$a={key:0,class:"applied-bar"},Ca={class:"k"},xa={class:"v"},Va=["aria-label","onClick"],Sa=Y({__name:"AppliedFiltersBar",setup(l){const{filterState:m,clearFilter:A}=ke(),f=B(()=>{const b=[];return m.value.segmento&&m.value.segmento!=="Todos"&&b.push({key:"segmento",label:"Segmento",value:m.value.segmento}),m.value.diretoria&&m.value.diretoria!=="Todas"&&b.push({key:"diretoria",label:"Diretoria",value:m.value.diretoria}),m.value.gerencia&&m.value.gerencia!=="Todas"&&b.push({key:"gerencia",label:"Gerência",value:m.value.gerencia}),m.value.agencia&&m.value.agencia!=="Todas"&&b.push({key:"agencia",label:"Agência",value:m.value.agencia}),m.value.ggestao&&m.value.ggestao!=="Todos"&&b.push({key:"ggestao",label:"Gerente de gestão",value:m.value.ggestao}),m.value.gerente&&m.value.gerente!=="Todos"&&b.push({key:"gerente",label:"Gerente",value:m.value.gerente}),m.value.familia&&m.value.familia!=="Todas"&&b.push({key:"familia",label:"Família",value:m.value.familia}),m.value.indicador&&m.value.indicador!=="Todos"&&b.push({key:"indicador",label:"Indicador",value:m.value.indicador}),m.value.subindicador&&m.value.subindicador!=="Todos"&&b.push({key:"subindicador",label:"Subindicador",value:m.value.subindicador}),b}),z=b=>{A(b)};return(b,h)=>f.value.length>0?(o(),s("div",$a,[(o(!0),s(T,null,F(f.value,v=>(o(),s("div",{key:v.key,class:"applied-chip"},[e("span",Ca,_(v.label),1),e("span",xa,_(v.value),1),e("button",{type:"button",title:"Limpar",class:"applied-x","aria-label":`Remover ${v.label}`,onClick:y=>z(v.key)},[R(D,{name:"x",size:14})],8,Va)]))),128))])):j("",!0)}}),Ra=X(Sa,[["__scopeId","data-v-dba2fb80"]]),za={class:"detail-designer__panel",role:"dialog","aria-modal":"true","aria-labelledby":"detail-designer-title"},Aa={class:"detail-designer__head"},Da={key:0,class:"detail-designer__feedback",role:"alert"},ja={key:1,class:"detail-designer__views"},Ta={class:"detail-designer__views-list"},La=["onClick"],Ma=["aria-label","onClick"],Ea={class:"detail-designer__lists"},Ba={class:"detail-designer__list detail-designer__list--available"},Na={class:"detail-designer__items"},Fa={class:"detail-item__handle","aria-hidden":"true"},Oa={class:"detail-item__label"},Ga=["aria-label","onClick"],Pa={key:0,class:"detail-designer__empty"},Ia={class:"detail-designer__list detail-designer__list--selected"},Ua={class:"detail-designer__items"},Ja={class:"detail-item__handle","aria-hidden":"true"},qa={class:"detail-item__label"},Ha=["disabled","aria-label","onClick"],Ka={key:0,class:"detail-designer__empty"},Wa={class:"detail-designer__foot"},Qa={class:"detail-designer__save"},Ya={class:"detail-designer__input-wrapper"},Xa=["disabled"],Za={class:"detail-designer__actions"},et=["disabled"],at=Y({__name:"DetailColumnDesigner",props:{modelValue:{type:Boolean},selectedColumns:{},views:{},activeViewId:{}},emits:["update:modelValue","apply","save","load-view","delete-view"],setup(l,{emit:m}){const A=[{id:"realizado",label:"Realizado no período (R$)"},{id:"meta",label:"Meta no período (R$)"},{id:"atingimento_p",label:"Atingimento (%)"},{id:"meta_diaria",label:"Meta diária total (R$)"},{id:"referencia_hoje",label:"Referência para hoje (R$)"},{id:"pontos",label:"Pontos no período (pts)"},{id:"meta_diaria_necessaria",label:"Meta diária necessária (R$)"},{id:"peso",label:"Peso (pts)"},{id:"projecao",label:"Projeção (R$)"},{id:"data",label:"Data"}],f=l,z=m,b=B({get:()=>f.modelValue,set:u=>z("update:modelValue",u)}),h=E([...f.selectedColumns]),v=E(""),y=E(""),O=B(()=>A.filter(u=>!h.value.includes(u.id))),w=B(()=>h.value.length>1),r=u=>{h.value.includes(u)||(h.value.push(u),y.value="")},$=u=>{if(h.value.length<=1){y.value="Mantenha pelo menos uma coluna visível.";return}h.value=h.value.filter(x=>x!==u),y.value=""},S=()=>{if(h.value.length===0){y.value="Adicione ao menos uma coluna.";return}z("apply",[...h.value]),b.value=!1,y.value=""},G=()=>{const u=v.value.trim();if(h.value.length===0){y.value="Adicione ao menos uma coluna antes de salvar.";return}if(u.length<3){y.value="Use um nome com pelo menos 3 caracteres.";return}z("save",u,[...h.value]),v.value="",y.value="Visão salva com sucesso."},P=u=>{const x=f.views?.find(k=>k.id===u);x&&(h.value=[...x.columns],y.value=""),z("load-view",u)},I=u=>{u!=="default"&&z("delete-view",u)},q=()=>{b.value=!1,h.value=[...f.selectedColumns],v.value="",y.value=""};return ge(()=>f.selectedColumns,u=>{h.value=[...u]},{immediate:!0}),ge(()=>f.modelValue,u=>{u&&(h.value=[...f.selectedColumns],v.value="",y.value="")}),(u,x)=>(o(),re(Oe,{to:"body"},[b.value?(o(),s("div",{key:0,class:N(["detail-designer",{"is-open":b.value}]),onKeydown:be(q,["escape"])},[e("div",{class:"detail-designer__overlay",onClick:q}),e("div",za,[e("header",Aa,[x[1]||(x[1]=e("div",null,[e("h4",{id:"detail-designer-title"},"Personalizar colunas"),e("p",{class:"detail-designer__subtitle"}," Arraste as colunas para montar a visão da tabela e salve até 5 configurações preferidas. A coluna de ações continua fixa no final da grade. ")],-1)),e("button",{type:"button",class:"icon-btn detail-designer__close","aria-label":"Fechar personalização",onClick:q},[R(D,{name:"x",size:18})])]),y.value?(o(),s("div",Da,_(y.value),1)):j("",!0),f.views&&f.views.length>0?(o(),s("section",ja,[x[2]||(x[2]=e("div",{class:"detail-designer__views-head"},[e("span",null,"VISÕES SALVAS"),e("span",{class:"detail-designer__views-hint"},"Carregue para ajustar ou excluir.")],-1)),e("div",Ta,[(o(!0),s(T,null,F(f.views,k=>(o(),s("div",{key:k.id,class:"detail-view-chip-wrapper"},[e("button",{type:"button",class:N(["detail-view-chip",{"is-active":f.activeViewId===k.id}]),onClick:U=>P(k.id)},_(k.name),11,La),k.id!=="default"?(o(),s("button",{key:0,type:"button",class:"detail-view-chip__delete","aria-label":`Remover visão ${k.name}`,onClick:te(U=>I(k.id),["stop"])},[R(D,{name:"trash",size:16})],8,Ma)):j("",!0)]))),128))])])):j("",!0),e("section",Ea,[e("div",Ba,[x[3]||(x[3]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas disponíveis"),e("p",null,"Arraste para incluir ou clique para adicionar.")],-1)),e("div",Na,[(o(!0),s(T,null,F(O.value,k=>(o(),s("div",{key:k.id,class:"detail-item detail-item--available"},[e("span",Fa,[R(D,{name:"grip-vertical",size:16})]),e("span",Oa,_(k.label),1),e("button",{type:"button",class:"detail-item__add","aria-label":`Adicionar ${k.label}`,onClick:U=>r(k.id)},[R(D,{name:"plus",size:16})],8,Ga)]))),128)),O.value.length===0?(o(),s("p",Pa," Todas as colunas já estão na tabela. ")):j("",!0)])]),e("div",Ia,[x[4]||(x[4]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas na tabela"),e("p",null,"Arraste para reorganizar ou clique para remover.")],-1)),e("div",Ua,[(o(!0),s(T,null,F(h.value,k=>(o(),s("div",{key:k,class:N(["detail-item",{"is-disabled":!w.value}])},[e("span",Ja,[R(D,{name:"grip-vertical",size:16})]),e("span",qa,_(A.find(U=>U.id===k)?.label||k),1),e("button",{type:"button",class:N(["detail-item__remove",{"is-disabled":!w.value}]),disabled:!w.value,"aria-label":`Remover ${A.find(U=>U.id===k)?.label||k}`,onClick:U=>$(k)},[R(D,{name:"x",size:18})],10,Ha)],2))),128)),h.value.length===0?(o(),s("p",Ka," Escolha ao menos uma coluna. ")):j("",!0)])])]),e("footer",Wa,[e("div",Qa,[x[5]||(x[5]=e("label",{for:"detail-view-name",class:"detail-designer__save-label"}," SALVAR NOVA VISÃO ",-1)),e("div",Ya,[ye(e("input",{id:"detail-view-name","onUpdate:modelValue":x[0]||(x[0]=k=>v.value=k),type:"text",class:"input input--sm detail-designer__input",maxlength:"48",placeholder:"Ex.: Indicadores priorizados",onKeyup:be(G,["enter"])},null,544),[[we,v.value]]),e("button",{type:"button",class:"btn btn--primary detail-designer__save-btn",disabled:!v.value.trim()||v.value.trim().length<3,onClick:G}," Salvar visão ",8,Xa)]),x[6]||(x[6]=e("small",{class:"detail-designer__save-hint"}," Você pode guardar até 5 visões personalizadas. ",-1))]),e("div",Za,[e("button",{type:"button",class:"btn btn--secondary detail-designer__action-btn",onClick:q}," Cancelar "),e("button",{type:"button",class:"btn btn--primary detail-designer__action-btn",disabled:h.value.length===0,onClick:S}," Aplicar ",8,et)])])])],34)):j("",!0)]))}}),tt=X(at,[["__scopeId","data-v-97d15039"]]),nt={class:"detalhes-wrapper"},it={class:"detalhes-view"},ot={class:"card card--detalhes"},st={class:"card__header"},lt={class:"card__actions"},rt={class:"search-box"},dt={class:"table-controls"},ct={class:"table-controls__main"},ut={class:"table-controls__chips"},_t={class:"table-toolbar-wrapper"},mt={class:"table-toolbar"},vt={class:"table-toolbar__icon"},pt={class:"table-toolbar__icon"},gt={class:"table-toolbar__icon"},bt={key:0,class:"detalhes-skeleton"},ht={key:0,class:"error-state"},ft={key:1,class:"empty-state"},yt={key:2,class:"empty-state"},wt={key:3,class:"contratos-grid"},kt={class:"contrato-card__header"},$t={class:"contrato-card__title"},Ct={class:"contrato-card__body"},xt={class:"contrato-card__info"},Vt={class:"contrato-card__info-item"},St={class:"contrato-card__value"},Rt={key:0,class:"contrato-card__info-item"},zt={class:"contrato-card__value"},At={class:"contrato-card__info-item"},Dt={class:"contrato-card__value"},jt={class:"contrato-card__info-item"},Tt={class:"contrato-card__value"},Lt={class:"contrato-card__info-item"},Mt={class:"contrato-card__value"},Et={class:"contrato-card__metrics"},Bt={class:"contrato-card__metric"},Nt={class:"contrato-card__metric-value"},Ft={class:"contrato-card__metric"},Ot={class:"contrato-card__metric-value"},Gt={class:"contrato-card__metric"},Pt={class:"contrato-card__metric-value"},It={class:"contrato-card__metric"},Ut={class:"contrato-card__metric-value"},Jt={key:0,class:"contrato-card__dates"},qt={class:"contrato-card__date-item"},Ht={class:"contrato-card__date-value"},Kt={key:0,class:"contrato-card__date-item"},Wt={class:"contrato-card__date-value"},Qt={key:1,class:"contrato-card__cancelamento"},Yt={class:"contrato-card__cancelamento-value"},Xt={key:4,class:"table-wrapper"},Zt={class:"tree-table"},en=["aria-pressed"],an={class:"tree-sort__icon"},tn=["aria-pressed","onClick"],nn={class:"tree-sort__icon"},on=Y({__name:"Detalhes",setup(l){const m=Ie(),{filterState:A}=ke(),{period:f}=Ue(),{detalhes:z,loading:b,error:h}=Je(A,f),v=E(new Set),y=E(""),O=E("diretoria"),w=E("default"),r=E(!1),$=E({id:null,direction:null}),S=["realizado","meta","atingimento_p","meta_diaria","referencia_hoje","pontos","meta_diaria_necessaria","peso","projecao","data"],G=[...S];function P(n){const t=new Set,a=n.filter(i=>!S.includes(i)||t.has(i)?!1:(t.add(i),!0));return a.length?a:[...G]}const I=E(P(G)),q=[{id:"diretoria",label:"Diretoria",key:"diretoria"},{id:"gerencia",label:"Regional",key:"gerenciaRegional"},{id:"agencia",label:"Agência",key:"agencia"},{id:"gGestao",label:"Gerente de gestão",key:"gerenteGestao"},{id:"gerente",label:"Gerente",key:"gerente"},{id:"secao",label:"Família",key:"secao"},{id:"familia",label:"Indicador",key:"familia"},{id:"prodsub",label:"Subindicador",key:"prodOrSub"},{id:"contrato",label:"Contratos",key:"contrato"}],u=E([{id:"default",name:"Visão padrão",columns:P(G)}]),x={diretoria:["diretoria","regional","agencia","gerente","familia","indicador","subindicador","contrato"],gerencia:["regional","agencia","gerente","familia","indicador","subindicador","contrato"],agencia:["agencia","gerente","familia","indicador","subindicador","contrato"],gGestao:["gGestao","gerente","familia","indicador","subindicador","contrato"],gerente:["gerente","familia","indicador","subindicador","contrato"],secao:["familia","indicador","subindicador","contrato"],familia:["indicador","subindicador","contrato"],prodsub:["subindicador","contrato"],contrato:["contrato"]};function k(n,t){if(t==="__label__")return n.label||"";const a=n.summary;switch(t){case"realizado":return a.valor_realizado||0;case"meta":return a.valor_meta||0;case"atingimento_v":return a.atingimento_v||0;case"atingimento_p":return a.atingimento_p||0;case"meta_diaria":return a.meta_diaria||0;case"referencia_hoje":return a.referencia_hoje||0;case"pontos":return a.pontos||0;case"meta_diaria_necessaria":return a.meta_diaria_necessaria||0;case"peso":return a.peso||0;case"projecao":return a.projecao||0;case"data":return a.data||"";default:return 0}}function U(n){return!$.value.id||!$.value.direction?n:[...n].sort((a,i)=>{const d=k(a,$.value.id),c=k(i,$.value.id);let g=0;return typeof d=="number"&&typeof c=="number"?g=d-c:g=String(d).localeCompare(String(c),"pt-BR"),$.value.direction==="asc"?g:-g}).map(a=>({...a,children:U(a.children)}))}const de=B(()=>{if(!y.value.trim()||!z.value.length)return[];const n=y.value.toLowerCase().trim(),t=z.value.filter(d=>d.id_contrato?.toLowerCase().includes(n)||d.registro_id?.toLowerCase().includes(n)||d.gerente_nome?.toLowerCase().includes(n)||d.familia_nome?.toLowerCase().includes(n)||d.ds_indicador?.toLowerCase().includes(n)),a=new Map;t.forEach(d=>{const c=d.id_contrato||d.registro_id||"sem-contrato";a.has(c)||a.set(c,[]),a.get(c).push(d)});const i=[];return a.forEach((d,c)=>{const g=d[0];g&&i.push({id:`contrato-${c}`,contratoId:c,items:d,summary:ie(d),detail:{canal_venda:g.canal_venda,tipo_venda:g.tipo_venda,gerente:g.gerente_nome,gerente_gestao:g.gerente_gestao_nome,modalidade_pagamento:g.modalidade_pagamento,dt_vencimento:g.dt_vencimento,dt_cancelamento:g.dt_cancelamento,motivo_cancelamento:g.motivo_cancelamento}})}),$.value.id&&$.value.direction&&i.sort((d,c)=>{let g=0,p=0;if($.value.id==="__label__")g=d.contratoId,p=c.contratoId;else{const C=$.value.id;g=d.summary[C]??0,p=c.summary[C]??0}let V=0;return typeof g=="number"&&typeof p=="number"?V=g-p:V=String(g).localeCompare(String(p),"pt-BR"),$.value.direction==="asc"?V:-V}),i}),ee=B(()=>{if(!z.value.length||y.value.trim())return[];const n=x[O.value]||x.diretoria;let t=[];if(O.value==="contrato"){const a=new Map;z.value.forEach(i=>{const d=i.id_contrato||i.registro_id||"sem-contrato";a.has(d)||a.set(d,[]),a.get(d).push(i)}),a.forEach((i,d)=>{const c=i[0];c&&t.push({id:`contrato-${d}`,label:d,level:"contrato",children:[],data:i,summary:ie(i),detail:{canal_venda:c.canal_venda,tipo_venda:c.tipo_venda,gerente:c.gerente_nome,gerente_gestao:c.gerente_gestao_nome,modalidade_pagamento:c.modalidade_pagamento,dt_vencimento:c.dt_vencimento,dt_cancelamento:c.dt_cancelamento,motivo_cancelamento:c.motivo_cancelamento}})})}else{const a=n||x.diretoria;t=ue(z.value,a,0)}return U(t)}),ne=B(()=>y.value.trim().length>0);function ce(n){if(n.children.forEach(t=>ce(t)),n.children.length>0){const t=n.children.reduce((i,d)=>i+(d.summary.pontos||0),0),a=n.children.reduce((i,d)=>i+(d.summary.peso||0),0);n.summary.pontos=t,n.summary.peso=a}}function ue(n,t,a){if(a>=t.length||n.length===0)return[];const i=t[a],d=t[a+1],c=new Map;n.forEach(p=>{let V;switch(i){case"diretoria":V=p.diretoria_id||"sem-diretoria",p.diretoria_nome;break;case"regional":V=p.gerencia_id||"sem-regional",p.gerencia_nome;break;case"agencia":V=p.agencia_id||"sem-agencia",p.agencia_nome;break;case"gGestao":V=p.gerente_gestao_id||"sem-gerente-gestao",p.gerente_gestao_nome;break;case"gerente":V=p.gerente_id||"sem-gerente",p.gerente_nome;break;case"familia":V=p.familia_id||"sem-familia",p.familia_nome;break;case"indicador":V=p.id_indicador||"sem-indicador",p.ds_indicador;break;case"subindicador":V=p.id_subindicador||"sem-subindicador",p.subindicador;break;case"contrato":V=p.id_contrato||p.registro_id||"sem-contrato";break;default:V="unknown"}c.has(V)||c.set(V,[]),c.get(V).push(p)});const g=[];return c.forEach((p,V)=>{const C=p[0];if(!C)return;let L=C.diretoria_nome||"Sem label";switch(i){case"diretoria":L=C.diretoria_nome||"Sem diretoria";break;case"regional":L=C.gerencia_nome||"Sem regional";break;case"agencia":L=C.agencia_nome||"Sem agência";break;case"gGestao":L=C.gerente_gestao_nome||"Sem gerente de gestão";break;case"gerente":L=C.gerente_nome||"Sem gerente";break;case"familia":L=C.familia_nome||"Sem família";break;case"indicador":L=C.ds_indicador||"Sem indicador";break;case"subindicador":L=C.subindicador||"Sem subindicador";break;case"contrato":L=C.id_contrato||C.registro_id||"Sem contrato";break}const ae={id:`${i}-${V}`,label:L,level:i,children:d?ue(p,t,a+1):[],data:p,summary:ie(p)};i==="contrato"&&(ae.detail={canal_venda:C.canal_venda||void 0,tipo_venda:C.tipo_venda||void 0,gerente:C.gerente_nome||void 0,modalidade_pagamento:C.modalidade_pagamento||void 0,dt_vencimento:C.dt_vencimento||void 0,dt_cancelamento:C.dt_cancelamento||void 0,motivo_cancelamento:C.motivo_cancelamento||void 0}),g.push(ae)}),g.forEach(p=>ce(p)),g}function ie(n){const t=n.reduce((H,J)=>H+(J.valor_realizado||0),0),a=n.reduce((H,J)=>H+(J.valor_meta||J.meta_mensal||0),0),i=n.reduce((H,J)=>H+(J.peso||0),0),d=n.reduce((H,J)=>H+(J.peso||0),0),c=30,g=new Date().getDate(),p=Math.max(1,c-g),V=a/c,C=g>0?Math.min(a,V*g):0,L=p>0?Math.max(0,(a-t)/p):0,ae=g>0?t/Math.max(g,1)*c:t,Ee=t-a,Be=a>0?t/a*100:0,se=n.length>0?n[0]:null,Ne=se&&(se.data||se.competencia)||"";return{valor_realizado:t,valor_meta:a,atingimento_v:Ee,atingimento_p:Be,meta_diaria:V,referencia_hoje:C,pontos:i,meta_diaria_necessaria:L,peso:d,projecao:ae,data:Ne}}const oe=E(new Set);function $e(n){if(n.type==="ticket"){const t=Ce(n.node),a=new URLSearchParams({openDrawer:"true",intent:"new-ticket",preferredQueue:"POBJ",queue:"POBJ",observation:t}),i=m.resolve({name:"Omega",query:Object.fromEntries(a)});window.open(i.href,"_blank")}else n.type==="opportunities"&&console.log("Abrir oportunidades para:",n.node)}function Ce(n){const t=[];if(n.label&&t.push(`Item: ${n.label}`),n.level&&t.push(`Nível: ${n.level}`),n.summary){const a=n.summary;a.valor_realizado&&t.push(`Realizado: R$ ${a.valor_realizado.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.valor_meta&&t.push(`Meta: R$ ${a.valor_meta.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.atingimento_p!==void 0&&t.push(`Atingimento: ${a.atingimento_p.toFixed(1)}%`)}if(n.detail){const a=n.detail;a.gerente&&t.push(`Gerente: ${a.gerente}`),a.canal_venda&&t.push(`Canal: ${a.canal_venda}`),a.tipo_venda&&t.push(`Tipo de venda: ${a.tipo_venda}`)}return t.join(`
`)}function xe(n){const a=_e(ee.value,n)?.level==="contrato";v.value.has(n)?(v.value.delete(n),a&&oe.value.delete(n)):(v.value.add(n),a&&oe.value.add(n))}function _e(n,t){for(const a of n){if(a.id===t)return a;const i=_e(a.children,t);if(i)return i}return null}const Ve=B(()=>{const n=q.find(t=>t.id===O.value);return n?n.label:"Item"});function Se(n){return{realizado:"Realizado no período (R$)",meta:"Meta no período (R$)",atingimento_p:"Atingimento (%)",meta_diaria:"Meta diária total (R$)",referencia_hoje:"Referência para hoje (R$)",pontos:"Pontos no período (pts)",meta_diaria_necessaria:"Meta diária necessária (R$)",peso:"Peso (pts)",projecao:"Projeção (R$)",data:"Data"}[n]||n}function me(n){return $.value.id!==n||!$.value.direction?"arrows-up-down":$.value.direction==="asc"?"arrow-up":"arrow-down"}function ve(n){const t=$.value,i=n==="__label__"?"asc":"desc",d=i==="asc"?"desc":"asc";let c;t.id!==n||!t.direction?c=i:t.direction===i?c=d:c=null,c?$.value={id:n,direction:c}:$.value={id:null,direction:null}}function Re(n){return v.value.has(n)}function ze(){const n=[];function t(a){a.forEach(i=>{i.children.length>0&&(n.push(i.id),t(i.children))})}t(ee.value),v.value=new Set(n)}function Ae(){v.value.clear()}function De(n){O.value=n}function pe(n){w.value=n;const t=u.value.find(a=>a.id===n);if(t){const a=P(t.columns);t.columns=a,I.value=[...a]}}function je(){r.value=!0}function Te(n,t){const a=P(t),i=u.value.find(d=>d.name.toLowerCase()===n.toLowerCase()&&d.id!=="default");if(i)i.columns=[...a],w.value=i.id;else{if(u.value.filter(g=>g.id!=="default").length>=5){alert("Você já possui 5 visões personalizadas. Exclua uma antes de criar outra.");return}const c={id:`custom-${Date.now()}`,name:n,columns:[...a]};u.value.push(c),w.value=c.id}I.value=[...a],localStorage.setItem("pobj3:detailViews",JSON.stringify(u.value.filter(d=>d.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",w.value)}function Le(n){if(n==="default")return;const t=u.value.findIndex(a=>a.id===n);if(t>-1){if(u.value.splice(t,1),w.value===n){w.value="default";const a=u.value.find(i=>i.id==="default");if(a){const i=P(a.columns);a.columns=i,I.value=[...i]}}localStorage.setItem("pobj3:detailViews",JSON.stringify(u.value.filter(a=>a.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",w.value)}}function Me(n){const t=P(n);if(I.value=[...t],w.value==="__custom__"||w.value.startsWith("custom-")){const a=u.value.find(i=>i.id===w.value);a&&(a.columns=[...t],localStorage.setItem("pobj3:detailViews",JSON.stringify(u.value.filter(i=>i.id!=="default"))))}localStorage.setItem("pobj3:detailActiveView",w.value)}return Ge(()=>{try{const n=localStorage.getItem("pobj3:detailViews");if(n){const a=JSON.parse(n);Array.isArray(a)&&(u.value=[...u.value,...a.map(i=>({id:i.id||`custom-${Date.now()}`,name:i.name||"Visão personalizada",columns:P(Array.isArray(i.columns)?i.columns:[])}))])}const t=localStorage.getItem("pobj3:detailActiveView");if(t){const a=u.value.find(i=>i.id===t);if(a){w.value=t;const i=P(a.columns);a.columns=i,I.value=[...i]}}}catch(n){console.error("Erro ao carregar visões salvas:",n)}}),(n,t)=>(o(),s("div",nt,[e("div",it,[e("div",ot,[e("header",st,[t[4]||(t[4]=e("div",{class:"title-subtitle"},[e("h3",null,"Detalhamento"),e("p",{class:"muted"},"Visualize os contratos em uma estrutura hierárquica")],-1)),e("div",lt,[e("div",rt,[ye(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),type:"text",placeholder:"Contrato (Ex.: 999999)",class:"input input--search"},null,512),[[we,y.value]])])])]),R(Ra),e("div",dt,[e("div",ct,[e("div",ut,[R(ga,{views:q,"active-view":O.value,onViewChange:De},null,8,["active-view"])]),t[5]||(t[5]=e("div",{class:"table-controls__search"},null,-1))])]),R(ka,{views:u.value,"active-view-id":w.value,onViewChange:pe},null,8,["views","active-view-id"]),e("div",_t,[e("div",mt,[e("button",{type:"button",class:"table-toolbar__btn",onClick:ze},[e("span",vt,[R(D,{name:"chevrons-down",size:16})]),t[6]||(t[6]=e("span",{class:"table-toolbar__text"},"Expandir tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn",onClick:Ae},[e("span",pt,[R(D,{name:"chevrons-up",size:16})]),t[7]||(t[7]=e("span",{class:"table-toolbar__text"},"Recolher tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn detail-view-manage",title:"Personalizar colunas da tabela",onClick:je},[e("span",gt,[R(D,{name:"columns",size:16})]),t[8]||(t[8]=e("span",{class:"table-toolbar__text"},"Personalizar colunas",-1))])])]),M(b)?(o(),s("div",bt,[...t[9]||(t[9]=[Pe('<div class="skeleton skeleton--table-header" style="height:40px;width:100%;margin-bottom:12px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-478861a1></div>',10)])])):(o(),s(T,{key:1},[M(h)?(o(),s("div",ht,[e("p",null,_(M(h)),1)])):ne.value&&de.value.length===0?(o(),s("div",ft,[...t[10]||(t[10]=[e("p",null,"Nenhum contrato encontrado para a busca.",-1)])])):!ne.value&&ee.value.length===0?(o(),s("div",yt,[...t[11]||(t[11]=[e("p",null,"Nenhum dado encontrado para os filtros selecionados.",-1)])])):ne.value?(o(),s("div",wt,[(o(!0),s(T,null,F(de.value,a=>(o(),s("div",{key:a.id,class:"contrato-card"},[e("div",kt,[e("h4",$t,_(a.contratoId),1),e("div",{class:N(["contrato-card__badge",{"is-success":a.summary.atingimento_p>=100,"is-warning":a.summary.atingimento_p>=50&&a.summary.atingimento_p<100,"is-danger":a.summary.atingimento_p<50}])},_(a.summary.atingimento_p.toFixed(1))+"% ",3)]),e("div",Ct,[e("div",xt,[e("div",Vt,[t[12]||(t[12]=e("span",{class:"contrato-card__label"},"Gerente:",-1)),e("span",St,_(a.detail.gerente||"—"),1)]),a.detail.gerente_gestao?(o(),s("div",Rt,[t[13]||(t[13]=e("span",{class:"contrato-card__label"},"Gerente de gestão:",-1)),e("span",zt,_(a.detail.gerente_gestao),1)])):j("",!0),e("div",At,[t[14]||(t[14]=e("span",{class:"contrato-card__label"},"Canal:",-1)),e("span",Dt,_(a.detail.canal_venda||"—"),1)]),e("div",jt,[t[15]||(t[15]=e("span",{class:"contrato-card__label"},"Tipo:",-1)),e("span",Tt,_(a.detail.tipo_venda||"—"),1)]),e("div",Lt,[t[16]||(t[16]=e("span",{class:"contrato-card__label"},"Modalidade:",-1)),e("span",Mt,_(a.detail.modalidade_pagamento||"—"),1)])]),e("div",Et,[e("div",Bt,[t[17]||(t[17]=e("span",{class:"contrato-card__metric-label"},"Realizado",-1)),e("span",Nt,_(M(fe)(a.summary.valor_realizado)),1)]),e("div",Ft,[t[18]||(t[18]=e("span",{class:"contrato-card__metric-label"},"Meta",-1)),e("span",Ot,_(M(fe)(a.summary.valor_meta)),1)]),e("div",Gt,[t[19]||(t[19]=e("span",{class:"contrato-card__metric-label"},"Pontos",-1)),e("span",Pt,_(M(Z)(a.summary.pontos)),1)]),e("div",It,[t[20]||(t[20]=e("span",{class:"contrato-card__metric-label"},"Peso",-1)),e("span",Ut,_(M(Z)(a.summary.peso)),1)])]),a.detail.dt_vencimento?(o(),s("div",Jt,[e("div",qt,[t[21]||(t[21]=e("span",{class:"contrato-card__date-label"},"Vencimento:",-1)),e("span",Ht,_(M(K)(a.detail.dt_vencimento)),1)]),a.detail.dt_cancelamento?(o(),s("div",Kt,[t[22]||(t[22]=e("span",{class:"contrato-card__date-label"},"Cancelamento:",-1)),e("span",Wt,_(M(K)(a.detail.dt_cancelamento)),1)])):j("",!0)])):j("",!0),a.detail.motivo_cancelamento?(o(),s("div",Qt,[t[23]||(t[23]=e("span",{class:"contrato-card__cancelamento-label"},"Motivo:",-1)),e("span",Yt,_(a.detail.motivo_cancelamento),1)])):j("",!0)])]))),128))])):(o(),s("div",Xt,[e("table",Zt,[e("thead",null,[e("tr",null,[e("th",null,[e("button",{type:"button",class:"tree-sort","aria-pressed":$.value.id==="__label__"&&$.value.direction?"true":"false",onClick:t[1]||(t[1]=a=>ve("__label__"))},[he(_(Ve.value)+" ",1),e("span",an,[R(D,{name:me("__label__"),size:16},null,8,["name"])])],8,en)]),(o(!0),s(T,null,F(I.value,a=>(o(),s("th",{key:a,class:"col-number"},[e("button",{type:"button",class:"tree-sort","aria-pressed":$.value.id===a&&$.value.direction?"true":"false",onClick:i=>ve(a)},[he(_(Se(a))+" ",1),e("span",nn,[R(D,{name:me(a),size:16},null,8,["name"])])],8,tn)]))),128))])]),e("tbody",null,[(o(!0),s(T,null,F(ee.value,a=>(o(),re(_a,{key:a.id,node:a,level:0,expanded:Re(a.id),"expanded-rows":v.value,"detail-open":oe.value.has(a.id),"active-columns":I.value,onToggle:t[2]||(t[2]=i=>xe(i)),onAction:$e},null,8,["node","expanded","expanded-rows","detail-open","active-columns"]))),128))])])]))],64))])]),R(tt,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=a=>r.value=a),"selected-columns":I.value,views:u.value,"active-view-id":w.value,onApply:Me,onSave:Te,onLoadView:pe,onDeleteView:Le},null,8,["modelValue","selected-columns","views","active-view-id"])]))}}),bn=X(on,[["__scopeId","data-v-478861a1"]]);export{bn as default};
