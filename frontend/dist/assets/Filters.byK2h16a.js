import{R as ue,r as m,e as h,b as fe,m as O,o as V,S as Le,v as W,B as Z,j as te,g as Ye,k as oe,U as ce,y as He,w as je,q as l,t as f,u as o,x as ae,C as ge,E as We}from"./vendor.Mb-DmQZ9.js";import{u as Ze}from"./vue-router.BEbJbLaE.js";import{a as qe,A as Je,I as j,_ as pe}from"./index.Dr26WDVJ.js";import{u as Xe}from"./usePeriodManager.7GB6tYuu.js";import{u as Qe}from"./useGlobalFilters.DPHmOsAT.js";import{S as U}from"./SelectSearch.Bunzz3_B.js";import{S as me}from"./SelectInput.CNcITHn6.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./calendarioService.B6FHbTv3.js";import"./useCalendarioCache.BpeOTXeR.js";async function ea(){return(await qe(Je.INIT)).data??null}const ve=m(null),ie=m(!1);let E=null;function aa(){const e=async()=>E||(ie.value=!0,E=ea().then(t=>(t&&(ve.value=t),t)).finally(()=>{ie.value=!1,E=null}),E);return{initData:ue(ve),isLoading:ue(ie),loadInit:e}}const I=e=>e==null||e===""?"":String(e).trim(),ia=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,na=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,x=(e,t)=>{const r=String(e.nome??e.label??"").trim();let u="",g;return t==="ggestao"||t==="gerente"?(g=I(e.funcional??""),u=I(e.id??"")):(u=I(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),g=e.funcional?I(e.funcional):void 0),{id:u,nome:t==="ggestao"||t==="gerente"?na(g||u,r):ia(u,r),id_segmento:I(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:I(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:I(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:I(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:I(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:g}};function ta(e){const t={segmento:m(""),diretoria:m(""),gerencia:m(""),agencia:m(""),ggestao:m(""),gerente:m("")},r=h(()=>e.value?{segmentos:(e.value.segmentos??[]).map(n=>x(n,"segmento")),diretorias:(e.value.diretorias??[]).map(n=>x(n,"diretoria")),regionais:(e.value.regionais??[]).map(n=>x(n,"regional")),agencias:(e.value.agencias??[]).map(n=>x(n,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(n=>x(n,"ggestao")),gerentes:(e.value.gerentes??[]).map(n=>x(n,"gerente"))}:null),u=h(()=>{if(!r.value)return null;const n=_=>Object.fromEntries((_??[]).map(p=>[I(p.id),p]));return{segmento:n(r.value.segmentos),diretoria:n(r.value.diretorias),gerencia:n(r.value.regionais),agencia:n(r.value.agencias),ggestao:n(r.value.ggestoes),gerente:n(r.value.gerentes)}}),g={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},d={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function c(n,_){if(!_)return;const p=d[n],M=g[n];if(!p||!M)return;const G=u.value?.[n]?.[I(_)];if(!G)return;const D=I(G[M]??"");if(!D)return;const $=u.value?.[p]?.[D];$&&(t[p].value=$.id,console.debug("[hierarchy] autoFillParent:",{childField:n,childValue:_,parentField:p,parentId:D}),c(p,$.id))}const C=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function v(n){let _=!1;for(const p of C)_&&(t[p].value=""),p===n&&(_=!0)}function s(n,_){t[n].value=I(_),v(n),c(n,t[n].value)}const y=h(()=>r.value?.segmentos??[]),q=h(()=>r.value?.diretorias??[]),N=h(()=>r.value?.regionais??[]),P=h(()=>r.value?.agencias??[]),z=h(()=>r.value?.ggestoes??[]),R=h(()=>r.value?.gerentes??[]);return{...t,segmentos:y,diretorias:q,regionais:N,agencias:P,gerentesGestao:z,gerentes:R,handleSegmentoChange:n=>s("segmento",n),handleDiretoriaChange:n=>s("diretoria",n),handleGerenciaChange:n=>s("gerencia",n),handleAgenciaChange:n=>s("agencia",n),handleGerenteGestaoChange:n=>s("ggestao",n),handleGerenteChange:n=>s("gerente",n),clearAll:()=>{for(const n of C)t[n].value=""}}}const be=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function oa(e,t){const u=new Date().toISOString().split("T")[0],g=t||u,d=new Date(g+"T00:00:00Z");if(isNaN(d.getTime())){const s=new Date,y=s.toISOString().split("T")[0];return{start:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`,end:y||`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}}let c;if(e==="anual")c=new Date(Date.UTC(d.getUTCFullYear(),0,1));else if(e==="mensal")c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),1));else{const s=be.find(y=>y.value===e)?.monthsBack||5;c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth()-s,1))}const C=c.toISOString().split("T")[0]||"",v=d.toISOString().split("T")[0]||"";return{start:C,end:v}}function he(e,t,r){if(e==="mensal"){const u=new Date().toISOString().split("T")[0]||"",d=r||t.end||u||u,c=new Date(d+"T00:00:00Z");return{start:new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:d}}return oa(e,t.end)}function la(e,t){const r=m("mensal");return{accumulatedView:r,handleViewChange:g=>{r.value=g;const d=he(g,e.value);t(d)},options:be}}const sa=["type","disabled","aria-busy","aria-disabled"],da={key:0,class:"btn__spinner","aria-hidden":"true"},ra={key:3},ua={key:4,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},ca=fe({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},iconName:{},loading:{type:Boolean,default:!1}},setup(e){const t=e,r=m(null),u=g=>{if(t.disabled||t.loading)return;const d=g.currentTarget,c=document.createElement("span"),C=Math.max(d.clientWidth,d.clientHeight),v=C/2,s=d.getBoundingClientRect();c.style.width=c.style.height=`${C}px`,c.style.left=`${g.clientX-s.left-v}px`,c.style.top=`${g.clientY-s.top-v}px`,c.classList.add("ripple");const y=d.getElementsByClassName("ripple")[0];y&&y.remove(),d.appendChild(c),setTimeout(()=>{c.remove()},600)};return(g,d)=>(V(),O("button",Le({ref_key:"buttonRef",ref:r,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},g.$attrs,{onClick:u,onKeydown:[d[0]||(d[0]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["enter"])),d[1]||(d[1]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["space"]))]}),[e.loading?(V(),O("span",da)):te("",!0),e.icon&&!e.loading?(V(),O("i",{key:1,class:oe(e.icon),"aria-hidden":"true"},null,2)):e.iconName&&!e.loading?(V(),Ye(j,{key:2,name:e.iconName,size:16,"aria-hidden":"true"},null,8,["name"])):te("",!0),e.loading?(V(),O("span",ua,[ce(g.$slots,"default",{},void 0)])):(V(),O("span",ra,[ce(g.$slots,"default",{},void 0)]))],16,sa))}}),ne=pe(ca,[["__scopeId","data-v-2eacfed4"]]),ga={class:"card card--filters"},ma={class:"filters"},va={class:"filters__group"},fa={class:"filters__group"},pa={class:"filters__group"},ba={class:"filters__actions"},ha={key:0,class:"filters__more filters__more--center"},_a=["aria-hidden"],Sa={class:"adv__grid"},Ia={class:"filters__group"},ya={class:"filters__group"},Ca={class:"filters__group"},Ta={class:"filters__group"},Aa={class:"filters__group"},Fa={class:"filters__group"},Ua={class:"filters__group"},Va={class:"filters__group"},wa=fe({__name:"Filters",setup(e){const t=Ze(),r=h(()=>t.name==="Simuladores"),u=m(!1),g=m(!0),{initData:d,isLoading:c,loadInit:C}=aa(),v=c,{updateFilter:s,updatePeriod:y,clearFilters:q,triggerFilter:N}=Qe(),{segmento:P,diretoria:z,gerencia:R,agencia:J,ggestao:n,gerente:_,segmentos:p,diretorias:M,regionais:G,agencias:D,gerentesGestao:$,gerentes:le,handleSegmentoChange:_e,handleDiretoriaChange:Se,handleGerenciaChange:Ie,handleAgenciaChange:ye,handleGerenteGestaoChange:Ce,handleGerenteChange:Te,clearAll:Ae}=ta(d),K=m([]),w=m([]),X=m([]),Fe=m([]),T=m(""),S=m(""),A=m(""),L=m("todos"),Ue=h(()=>{if(!T.value)return w.value;const a=String(T.value).trim();return w.value.filter(i=>(i.id_familia?String(i.id_familia).trim():"")===a)}),se=h(()=>{if(!S.value)return[];const a=String(S.value).trim();return X.value.filter(i=>(i.id_indicador?String(i.id_indicador).trim():"")===a)}),Ve=h(()=>se.value.length>0),Y=(a,i)=>{if(!a)return null;const b=String(a).trim();return i.find(k=>String(k.id).trim()===b)||null},we=a=>{if(T.value=a,!a)S.value="",A.value="";else if(S.value){const i=Y(S.value,w.value),b=String(a).trim();(i?.id_familia?String(i.id_familia).trim():"")!==b&&(S.value="",A.value="")}},ke=a=>{if(S.value=a,A.value="",a){const i=Y(a,w.value);if(i?.id_familia){const b=String(i.id_familia).trim();K.value.some(F=>String(F.id).trim()===b)&&(T.value=b)}}else S.value="",A.value=""},Oe=a=>{if(A.value=a,a){const i=Y(a,X.value);if(i?.id_indicador){const b=String(i.id_indicador).trim();if(w.value.some(F=>String(F.id).trim()===b)){S.value=b;const F=Y(b,w.value);if(F?.id_familia){const ee=String(F.id_familia).trim();K.value.some(Ke=>String(Ke.id).trim()===ee)&&(T.value=ee)}}}}else A.value=""},De=a=>{const i=String(a.id||a.codigo||a.id_diretoria||a.id_regional||a.id_agencia||a.funcional||a.subId||a.subindicadorId||"").trim(),b=String(a.label||a.nome||i).trim(),k=a.id_familia??a.idFamilia??a.familia_id??a.familiaId,F=a.id_indicador??a.idIndicador??a.indicador_id??a.indicadorId??a.produtoId??a.produto_id;return{id:i,nome:b,id_familia:k?String(k).trim():void 0,id_indicador:F?String(F).trim():void 0}},H=a=>Array.isArray(a)?a.map(De).filter(i=>i.id):[],$e=async()=>{try{const a=await C();a&&(K.value=H(a.familias||[]),w.value=H(a.indicadores||[]),X.value=H(a.subindicadores||[]),Fe.value=H(a.status_indicadores||[]))}catch(a){console.error("Erro ao carregar estrutura:",a)}},{period:B,updatePeriod:Be}=Xe(),{accumulatedView:de,handleViewChange:xe,options:Me}=la(B,Be),Ge=h(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),Ee=h(()=>Me.map(a=>({id:a.value,nome:a.label}))),Ne=a=>{L.value=a},Pe=a=>{xe(a)};He(()=>{$e(),re(),N()});const Q=()=>{u.value=!u.value},ze=()=>{re(),N()},re=()=>{s("segmento",P.value),s("diretoria",z.value),s("gerencia",R.value),s("agencia",J.value),s("ggestao",n.value),s("gerente",_.value),s("familia",T.value),s("indicador",S.value),s("subindicador",A.value),s("status",L.value),y(B.value)},Re=()=>{Ae(),T.value="",S.value="",A.value="",L.value="todos",de.value="mensal",B.value=he("mensal",B.value),q(),y(B.value)};return je(()=>B.value,a=>{y(a)},{deep:!0}),(a,i)=>(V(),O("section",ga,[i[13]||(i[13]=l("header",{class:"card__header"},[l("div",{class:"filters-hero"},[l("div",{class:"title-subtitle"},[l("h2",null,"POBJ Produções"),l("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),l("div",ma,[l("div",va,[i[0]||(i[0]=l("label",null,"Segmento",-1)),f(U,{id:"f-segmento","model-value":o(P),options:[{id:"",nome:"Todos"},...Array.isArray(o(p))?o(p):[]],placeholder:"Todos",label:"Segmento",disabled:o(v),"onUpdate:modelValue":o(_e)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",fa,[i[1]||(i[1]=l("label",null,"Diretoria",-1)),f(U,{id:"f-diretoria","model-value":o(z),options:[{id:"",nome:"Todas"},...Array.isArray(o(M))?o(M):[]],placeholder:"Todas",label:"Diretoria",disabled:o(v),"onUpdate:modelValue":o(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",pa,[i[2]||(i[2]=l("label",null,"Regional",-1)),f(U,{id:"f-gerencia","model-value":o(R),options:[{id:"",nome:"Todas"},...Array.isArray(o(G))?o(G):[]],placeholder:"Todas",label:"Regional",disabled:o(v),"onUpdate:modelValue":o(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ba,[f(ne,{id:"btn-filtrar",variant:"primary",disabled:r.value,onClick:ze},{default:ae(()=>[f(j,{name:"search",size:16,color:"white"}),i[3]||(i[3]=ge(" Filtrar ",-1))]),_:1},8,["disabled"]),f(ne,{id:"btn-limpar",variant:"secondary",onClick:Re},{default:ae(()=>[f(j,{name:"x",size:16}),i[4]||(i[4]=ge(" Limpar filtros ",-1))]),_:1})])]),g.value?(V(),O("div",ha,[f(ne,{id:"btn-abrir-filtros",variant:"info","aria-expanded":u.value,"aria-controls":"advanced-filters",onClick:Q,onKeydown:[W(Z(Q,["prevent"]),["enter"]),W(Z(Q,["prevent"]),["space"])]},{default:ae(()=>[f(j,{name:"chevron-down",size:16,class:oe({rotated:u.value})},null,8,["class"]),l("span",null,We(u.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):te("",!0),l("section",{id:"advanced-filters",class:oe(["adv",{"is-open":u.value}]),"aria-hidden":!u.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[l("div",Sa,[l("div",Ia,[i[5]||(i[5]=l("label",null,"Agência",-1)),f(U,{id:"f-agencia","model-value":o(J),options:[{id:"",nome:"Todas"},...Array.isArray(o(D))?o(D):[]],placeholder:"Todas",label:"Agência",disabled:o(v),"onUpdate:modelValue":o(ye)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ya,[i[6]||(i[6]=l("label",null,"Gerente de gestão",-1)),f(U,{id:"f-gerente-gestao","model-value":o(n),options:[{id:"",nome:"Todos"},...Array.isArray(o($))?o($):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:o(v),"onUpdate:modelValue":o(Ce)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",Ca,[i[7]||(i[7]=l("label",null,"Gerente",-1)),f(U,{id:"f-gerente","model-value":o(_),options:[{id:"",nome:"Todos"},...Array.isArray(o(le))?o(le):[]],placeholder:"Todos",label:"Gerente",disabled:o(v),"onUpdate:modelValue":o(Te)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",Ta,[i[8]||(i[8]=l("label",null,"Família",-1)),f(U,{id:"f-secao","model-value":T.value,options:[{id:"",nome:"Selecione..."},...K.value],placeholder:"Selecione...",label:"Família",disabled:o(v),"onUpdate:modelValue":we},null,8,["model-value","options","disabled"])]),l("div",Aa,[i[9]||(i[9]=l("label",null,"Indicadores",-1)),f(U,{id:"f-familia","model-value":S.value,options:[{id:"",nome:"Selecione..."},...Ue.value],placeholder:"Selecione...",label:"Indicadores",disabled:o(v)||!T.value,"onUpdate:modelValue":ke},null,8,["model-value","options","disabled"])]),l("div",Fa,[i[10]||(i[10]=l("label",null,"Subindicador",-1)),f(U,{id:"f-produto","model-value":A.value,options:[{id:"",nome:"Selecione..."},...se.value],placeholder:"Selecione...",label:"Subindicador",disabled:o(v)||!S.value||!Ve.value,"onUpdate:modelValue":Oe},null,8,["model-value","options","disabled"])]),l("div",Ua,[i[11]||(i[11]=l("label",null,"Status dos indicadores",-1)),f(me,{id:"f-status-kpi","model-value":L.value,options:Ge.value,placeholder:"Todos",label:"Status dos indicadores",disabled:o(v),"onUpdate:modelValue":Ne},null,8,["model-value","options","disabled"])]),l("div",Va,[i[12]||(i[12]=l("label",null,"Visão acumulada",-1)),f(me,{id:"f-visao","model-value":o(de),options:Ee.value,placeholder:"Mensal",label:"Visão acumulada",disabled:o(v),"onUpdate:modelValue":Pe},null,8,["model-value","options","disabled"])])])],10,_a)]))}}),Ka=pe(wa,[["__scopeId","data-v-43d73ce0"]]);export{Ka as default};
