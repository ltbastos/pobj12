import{a as $,A as j,_ as q}from"./index.oIu47dWK.js";import{u as K}from"./useGlobalFilters.DGbadgZS.js";import{u as Q}from"./useInitCache.c9IJUsbI.js";import{E as H,h as I}from"./EmptyState.vue_vue_type_style_index_0_scoped_69c25b95_lang.CnZ9MCc5.js";import{E as J}from"./EmptyState.Ur2b3Asz.js";import{S as W}from"./SelectSearch.BR0CuZUt.js";import{b as X,r as m,e as f,y as Y,w as Z,m as d,q as a,M as ee,F as _,D as R,g as A,u as y,C as D,E as k,t as ae,o as i,k as V}from"./vendor.iNPlSTaR.js";import"./pdf-vendor.jXUlHPMi.js";import"./icons-vendor.pg7b-e9c.js";import"./vue-router.BQVFLPdy.js";async function te(o,s,v){const n={};o&&(o.segmento&&(n.segmento=o.segmento),o.diretoria&&(n.diretoria=o.diretoria),o.regional&&(n.regional=o.regional),o.agencia&&(n.agencia=o.agencia),o.gerenteGestao&&(n.gerenteGestao=o.gerenteGestao),o.gerente&&(n.gerente=o.gerente),o.grupo&&(n.grupo=o.grupo),o.dataInicio&&(n.dataInicio=o.dataInicio),o.dataFim&&(n.dataFim=o.dataFim)),s&&(n.nivel=s);const u=await $(j.RANKING,n);return u.success&&u.data?u.data:(console.error("Erro ao buscar ranking:",u.error),null)}const se={class:"ranking-wrapper"},oe={class:"ranking-view"},re={key:0,class:"ranking-content"},ne={class:"card card--ranking"},ie={class:"ranking-table-wrapper"},le={class:"rk-table"},de={key:2,class:"ranking-content"},ue={class:"card card--ranking"},ce={class:"rk-summary",id:"rk-summary"},ge={class:"rk-badges"},pe={class:"rk-badge"},ve={class:"rk-badge"},me={class:"rk-badge rk-badge--filter"},ke={class:"ranking-table-wrapper",id:"rk-table"},he={class:"rk-table"},fe={class:"pos-col"},be={class:"unit-col rk-name"},_e={class:"points-col"},ye=X({__name:"Ranking",setup(o){const{filterState:s,period:v,filterTrigger:n,updateFilter:u}=K(),{loadInit:B}=Q(),c=m([]),h=m(!1),g=m(null),w=m([]),b=m(""),T=e=>{const t=String(e.id||"").trim(),r=String(e.nome||e.label||t).trim();return{id:t,nome:r}},z=e=>Array.isArray(e)?e.map(T).filter(t=>t.id):[],l=e=>{if(!e)return;const t=e.trim();if(!t)return;const r=t.toLowerCase();if(!(r==="todos"||r==="todas"||r===""))return t},x=f(()=>{const e={},t=l(s.value.segmento),r=l(s.value.diretoria),p=l(s.value.gerencia),N=l(s.value.agencia),S=l(s.value.ggestao),L=l(s.value.gerente),E=l(s.value.grupo);return t&&(e.segmento=t),r&&(e.diretoria=r),p&&(e.regional=p),N&&(e.agencia=N),S&&(e.gerenteGestao=S),L&&(e.gerente=L),E&&(e.grupo=E),v.value?.start&&(e.dataInicio=v.value.start),v.value?.end&&(e.dataFim=v.value.end),e}),G=f(()=>s.value.gerente&&s.value.gerente.toLowerCase()!=="todos"?"gerente":s.value.ggestao&&s.value.ggestao.toLowerCase()!=="todos"?"gerenteGestao":s.value.agencia&&s.value.agencia.toLowerCase()!=="todas"?"agencia":s.value.gerencia&&s.value.gerencia.toLowerCase()!=="todas"?"gerencia":s.value.diretoria&&s.value.diretoria.toLowerCase()!=="todas"?"diretoria":s.value.segmento&&s.value.segmento.toLowerCase()!=="todos"?"segmento":"gerenteGestao"),O=f(()=>({segmento:"Segmento",diretoria:"Diretoria",gerencia:"Regional",agencia:"Agência",gerenteGestao:"Gerente de gestão",gerente:"Gerente"})[G.value]||"Gerente de gestão"),F=async()=>{h.value=!0,g.value=null;try{const e=await te(x.value,G.value);e?c.value=e:(g.value="Não foi possível carregar os dados de ranking",c.value=[])}catch(e){g.value=e instanceof Error?e.message:"Erro ao carregar ranking",c.value=[]}finally{h.value=!1}},P=async()=>{try{const e=await B();e&&e.grupos&&(w.value=z(e.grupos))}catch(e){console.error("Erro ao carregar grupos:",e)}},U=e=>{b.value=e,u("grupo",e===""||e.toLowerCase()==="todos"?void 0:e)};Y(()=>{P(),F(),s.value.grupo&&(b.value=s.value.grupo)}),Z([s,n],()=>{Object.keys(x.value).length>0||(c.value=[],g.value=null),F()},{deep:!0});const C=f(()=>c.value),M=e=>e==null||isNaN(e)?"—":new Intl.NumberFormat("pt-BR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return(e,t)=>(i(),d("div",se,[a("div",oe,[h.value?(i(),d("div",re,[a("div",ne,[t[2]||(t[2]=ee('<header class="card__header rk-head" data-v-712813a8><div class="skeleton skeleton--title" style="height:24px;width:150px;margin-bottom:8px;" data-v-712813a8></div><div class="skeleton skeleton--subtitle" style="height:16px;width:300px;" data-v-712813a8></div></header><div class="rk-summary" data-v-712813a8><div class="rk-badges" data-v-712813a8><div class="skeleton skeleton--badge" style="height:32px;width:120px;border-radius:6px;" data-v-712813a8></div><div class="skeleton skeleton--badge" style="height:32px;width:140px;border-radius:6px;" data-v-712813a8></div><div class="skeleton skeleton--badge" style="height:32px;width:180px;border-radius:6px;" data-v-712813a8></div></div></div>',2)),a("div",ie,[a("table",le,[t[1]||(t[1]=a("thead",null,[a("tr",null,[a("th",{class:"pos-col"},"#"),a("th",{class:"unit-col"},"Unidade"),a("th",{class:"points-col"},"Pontos")])],-1)),a("tbody",null,[(i(),d(_,null,R(10,r=>a("tr",{key:r,class:V(["rk-row",{"rk-row--odd":r%2===1}])},[...t[0]||(t[0]=[a("td",{class:"pos-col"},[a("div",{class:"skeleton skeleton--text",style:{height:"14px",width:"24px",margin:"0 auto"}})],-1),a("td",{class:"unit-col"},[a("div",{class:"skeleton skeleton--text",style:{height:"14px",width:"80%"}})],-1),a("td",{class:"points-col"},[a("div",{class:"skeleton skeleton--text",style:{height:"14px",width:"70px","margin-left":"auto"}})],-1)])],2)),64))])])])])])):(i(),d(_,{key:1},[g.value?(i(),A(H,{key:0,message:g.value},null,8,["message"])):c.value.length===0?(i(),A(J,{key:1,title:"Nenhum ranking disponível",message:y(s).ggestao?"Sem dados de ranking disponíveis para o gerente de gestão selecionado.":"Selecione um gerente de gestão nos filtros para visualizar o ranking."},null,8,["message"])):(i(),d("div",de,[a("div",ue,[t[7]||(t[7]=a("header",{class:"card__header rk-head"},[a("div",{class:"title-subtitle"},[a("h3",null,"Rankings"),a("p",{class:"muted"},"Compare diferentes visões respeitando os filtros aplicados.")])],-1)),a("div",ce,[a("div",ge,[a("span",pe,[t[3]||(t[3]=a("strong",null,"Nível de agrupamento:",-1)),D(" "+k(O.value),1)]),a("span",ve,[t[4]||(t[4]=a("strong",null,"Quantidade de participantes:",-1)),D(" "+k(y(I)(C.value.length)),1)]),a("span",me,[t[5]||(t[5]=a("label",{for:"f-grupo-ranking",style:{"margin-right":"8px","font-weight":"600"}},"Grupo:",-1)),ae(W,{id:"f-grupo-ranking","model-value":b.value,options:[{id:"",nome:"Todos"},...w.value],placeholder:"Todos",label:"Grupo",disabled:h.value,"onUpdate:modelValue":U},null,8,["model-value","options","disabled"])])])]),a("div",ke,[a("table",he,[t[6]||(t[6]=a("thead",null,[a("tr",null,[a("th",{class:"pos-col"},"#"),a("th",{class:"unit-col"},"Unidade"),a("th",{class:"points-col"},"Pontos")])],-1)),a("tbody",null,[(i(!0),d(_,null,R(C.value,(r,p)=>(i(),d("tr",{key:`${r.unidade}-${p}`,class:V(["rk-row",{"rk-row--top":p===0}])},[a("td",fe,k(y(I)(r.position??p+1)),1),a("td",be,k(r.displayLabel??r.label??"—"),1),a("td",_e,k(M(r.pontos)),1)],2))),128))])])])])]))],64))])]))}}),Re=q(ye,[["__scopeId","data-v-712813a8"]]);export{Re as default};
