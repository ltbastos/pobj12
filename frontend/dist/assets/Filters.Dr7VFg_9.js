import{r as v,e as h,b as me,m as D,o as U,R as Pe,v as W,B as Z,j as ne,g as Re,k as te,S as re,y as Ke,w as Ye,q as l,t as f,u as t,x as ae,C as ue,E as Le}from"./vendor.iNPlSTaR.js";import{u as He}from"./vue-router.BQVFLPdy.js";import{I as j,_ as ve}from"./index.CzyV3kJY.js";import{u as je}from"./useInitCache.Dbyvo6ro.js";import{u as ce}from"./useGlobalFilters.BzbMdXpC.js";import{c as We}from"./useResumoData.CqGGzpQw.js";import{c as Ze}from"./useDetalhesData.ChSbahqO.js";import{S as V}from"./SelectSearch.ZVvfhMoV.js";import{S as ge}from"./SelectInput.Bglu9gMT.js";import"./pdf-vendor.jXUlHPMi.js";import"./icons-vendor.pg7b-e9c.js";const I=e=>e==null||e===""?"":String(e).trim(),qe=(e,o)=>!e&&!o?"":e?!o||o===e?e:`${e} - ${o}`:o,Je=(e,o)=>!e&&!o?"":e?!o||o===e?e:`${e} - ${o}`:o,$=(e,o)=>{const d=String(e.nome??e.label??"").trim();let u="",g;return o==="ggestao"||o==="gerente"?(g=I(e.funcional??""),u=I(e.id??"")):(u=I(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),g=e.funcional?I(e.funcional):void 0),{id:u,nome:o==="ggestao"||o==="gerente"?Je(g||u,d):qe(u,d),id_segmento:I(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:I(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:I(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:I(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:I(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:g}};function Xe(e){const o={segmento:v(""),diretoria:v(""),gerencia:v(""),agencia:v(""),ggestao:v(""),gerente:v("")},d=h(()=>e.value?{segmentos:(e.value.segmentos??[]).map(n=>$(n,"segmento")),diretorias:(e.value.diretorias??[]).map(n=>$(n,"diretoria")),regionais:(e.value.regionais??[]).map(n=>$(n,"regional")),agencias:(e.value.agencias??[]).map(n=>$(n,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(n=>$(n,"ggestao")),gerentes:(e.value.gerentes??[]).map(n=>$(n,"gerente"))}:null),u=h(()=>{if(!d.value)return null;const n=_=>Object.fromEntries((_??[]).map(p=>[I(p.id),p]));return{segmento:n(d.value.segmentos),diretoria:n(d.value.diretorias),gerencia:n(d.value.regionais),agencia:n(d.value.agencias),ggestao:n(d.value.ggestoes),gerente:n(d.value.gerentes)}}),g={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},r={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function c(n,_){if(!_)return;const p=r[n],B=g[n];if(!p||!B)return;const G=u.value?.[n]?.[I(_)];if(!G)return;const O=I(G[B]??"");if(!O)return;const M=u.value?.[p]?.[O];M&&(o[p].value=M.id,console.debug("[hierarchy] autoFillParent:",{childField:n,childValue:_,parentField:p,parentId:O}),c(p,M.id))}const y=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function m(n){let _=!1;for(const p of y)_&&(o[p].value=""),p===n&&(_=!0)}function s(n,_){o[n].value=I(_),m(n),c(n,o[n].value)}const C=h(()=>d.value?.segmentos??[]),x=h(()=>d.value?.diretorias??[]),E=h(()=>d.value?.regionais??[]),N=h(()=>d.value?.agencias??[]),z=h(()=>d.value?.ggestoes??[]),P=h(()=>d.value?.gerentes??[]);return{...o,segmentos:C,diretorias:x,regionais:E,agencias:N,gerentesGestao:z,gerentes:P,handleSegmentoChange:n=>s("segmento",n),handleDiretoriaChange:n=>s("diretoria",n),handleGerenciaChange:n=>s("gerencia",n),handleAgenciaChange:n=>s("agencia",n),handleGerenteGestaoChange:n=>s("ggestao",n),handleGerenteChange:n=>s("gerente",n),clearAll:()=>{for(const n of y)o[n].value=""}}}const fe=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function Qe(e,o){const u=new Date().toISOString().split("T")[0],g=o||u,r=new Date(g+"T00:00:00Z");if(isNaN(r.getTime())){const s=new Date,C=s.toISOString().split("T")[0];return{start:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`,end:C||`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}}let c;if(e==="anual")c=new Date(Date.UTC(r.getUTCFullYear(),0,1));else if(e==="mensal")c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1));else{const s=fe.find(C=>C.value===e)?.monthsBack||5;c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth()-s,1))}const y=c.toISOString().split("T")[0]||"",m=r.toISOString().split("T")[0]||"";return{start:y,end:m}}function oe(e,o,d){if(e==="mensal"){const u=new Date().toISOString().split("T")[0]||"",r=d||o.end||u||u,c=new Date(r+"T00:00:00Z");return{start:new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:r}}return Qe(e,d||o.end)}function ea(e,o){const d=v("mensal");return{accumulatedView:d,handleViewChange:r=>{d.value=r;const c=oe(r,e.value);o(c)},resetToMensal:()=>{d.value="mensal"},options:fe}}const aa=["type","disabled","aria-busy","aria-disabled"],ia={key:0,class:"btn__spinner","aria-hidden":"true"},na={key:3},ta={key:4,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},oa=me({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},iconName:{},loading:{type:Boolean,default:!1}},setup(e){const o=e,d=v(null),u=g=>{if(o.disabled||o.loading)return;const r=g.currentTarget,c=document.createElement("span"),y=Math.max(r.clientWidth,r.clientHeight),m=y/2,s=r.getBoundingClientRect();c.style.width=c.style.height=`${y}px`,c.style.left=`${g.clientX-s.left-m}px`,c.style.top=`${g.clientY-s.top-m}px`,c.classList.add("ripple");const C=r.getElementsByClassName("ripple")[0];C&&C.remove(),r.appendChild(c),setTimeout(()=>{c.remove()},600)};return(g,r)=>(U(),D("button",Pe({ref_key:"buttonRef",ref:d,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},g.$attrs,{onClick:u,onKeydown:[r[0]||(r[0]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["enter"])),r[1]||(r[1]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["space"]))]}),[e.loading?(U(),D("span",ia)):ne("",!0),e.icon&&!e.loading?(U(),D("i",{key:1,class:te(e.icon),"aria-hidden":"true"},null,2)):e.iconName&&!e.loading?(U(),Re(j,{key:2,name:e.iconName,size:16,"aria-hidden":"true"},null,8,["name"])):ne("",!0),e.loading?(U(),D("span",ta,[re(g.$slots,"default",{},void 0)])):(U(),D("span",na,[re(g.$slots,"default",{},void 0)]))],16,aa))}}),ie=ve(oa,[["__scopeId","data-v-2eacfed4"]]),la={class:"card card--filters"},sa={class:"filters"},da={class:"filters__group"},ra={class:"filters__group"},ua={class:"filters__group"},ca={class:"filters__actions"},ga={key:0,class:"filters__more filters__more--center"},ma=["aria-hidden"],va={class:"adv__grid"},fa={class:"filters__group"},pa={class:"filters__group"},ba={class:"filters__group"},ha={class:"filters__group"},_a={class:"filters__group"},Sa={class:"filters__group"},Ia={class:"filters__group"},ya={class:"filters__group"},Ca=me({__name:"Filters",setup(e){const o=He(),d=h(()=>o.name==="Simuladores"),u=v(!1),g=v(!0),{initData:r,isLoading:c,loadInit:y}=je(),m=c,{updateFilter:s,clearFilters:C,triggerFilter:x}=ce(),{segmento:E,diretoria:N,gerencia:z,agencia:P,ggestao:q,gerente:n,segmentos:_,diretorias:p,regionais:B,agencias:G,gerentesGestao:O,gerentes:M,handleSegmentoChange:pe,handleDiretoriaChange:be,handleGerenciaChange:he,handleAgenciaChange:_e,handleGerenteGestaoChange:Se,handleGerenteChange:Ie,clearAll:ye}=Xe(r),R=v([]),k=v([]),J=v([]),Ce=v([]),T=v(""),S=v(""),A=v(""),K=v("todos"),Te=h(()=>{if(!T.value)return k.value;const a=String(T.value).trim();return k.value.filter(i=>(i.id_familia?String(i.id_familia).trim():"")===a)}),le=h(()=>{if(!S.value)return[];const a=String(S.value).trim();return J.value.filter(i=>(i.id_indicador?String(i.id_indicador).trim():"")===a)}),Ae=h(()=>le.value.length>0),Y=(a,i)=>{if(!a)return null;const b=String(a).trim();return i.find(w=>String(w.id).trim()===b)||null},Fe=a=>{if(T.value=a,!a)S.value="",A.value="";else if(S.value){const i=Y(S.value,k.value),b=String(a).trim();(i?.id_familia?String(i.id_familia).trim():"")!==b&&(S.value="",A.value="")}},Ve=a=>{if(S.value=a,A.value="",a){const i=Y(a,k.value);if(i?.id_familia){const b=String(i.id_familia).trim();R.value.some(F=>String(F.id).trim()===b)&&(T.value=b)}}else S.value="",A.value=""},Ue=a=>{if(A.value=a,a){const i=Y(a,J.value);if(i?.id_indicador){const b=String(i.id_indicador).trim();if(k.value.some(F=>String(F.id).trim()===b)){S.value=b;const F=Y(b,k.value);if(F?.id_familia){const ee=String(F.id_familia).trim();R.value.some(ze=>String(ze.id).trim()===ee)&&(T.value=ee)}}}}else A.value=""},ke=a=>{const i=String(a.id||a.codigo||a.id_diretoria||a.id_regional||a.id_agencia||a.funcional||a.subId||a.subindicadorId||"").trim(),b=String(a.label||a.nome||i).trim(),w=a.id_familia??a.idFamilia??a.familia_id??a.familiaId,F=a.id_indicador??a.idIndicador??a.indicador_id??a.indicadorId??a.produtoId??a.produto_id;return{id:i,nome:b,id_familia:w?String(w).trim():void 0,id_indicador:F?String(F).trim():void 0}},L=a=>Array.isArray(a)?a.map(ke).filter(i=>i.id):[],we=async()=>{try{const a=await y();a&&(R.value=L(a.familias||[]),k.value=L(a.indicadores||[]),J.value=L(a.subindicadores||[]),Ce.value=L(a.status_indicadores||[]))}catch(a){console.error("Erro ao carregar estrutura:",a)}},{period:X,updatePeriod:se}=ce(),{accumulatedView:H,handleViewChange:De,resetToMensal:Oe,options:Me}=ea(X,se),$e=h(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),xe=h(()=>Me.map(a=>({id:a.value,nome:a.label}))),Be=a=>{K.value=a},Ge=a=>{De(a)};Ke(()=>{we(),de(),x()}),Ye(()=>X.value,a=>{if(H.value!=="mensal"){const i=oe(H.value,a,a.end);(i.start!==a.start||i.end!==a.end)&&Oe()}},{deep:!0});const Q=()=>{u.value=!u.value},Ee=()=>{de(),x()},de=()=>{s("segmento",E.value),s("diretoria",N.value),s("gerencia",z.value),s("agencia",P.value),s("ggestao",q.value),s("gerente",n.value),s("familia",T.value),s("indicador",S.value),s("subindicador",A.value),s("status",K.value)},Ne=()=>{ye(),T.value="",S.value="",A.value="",K.value="todos",H.value="mensal";const a=oe("mensal",X.value);C(),We(),Ze(),se(a),x()};return(a,i)=>(U(),D("section",la,[i[13]||(i[13]=l("header",{class:"card__header"},[l("div",{class:"filters-hero"},[l("div",{class:"title-subtitle"},[l("h2",null,"POBJ Produções"),l("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),l("div",sa,[l("div",da,[i[0]||(i[0]=l("label",null,"Segmento",-1)),f(V,{id:"f-segmento","model-value":t(E),options:[{id:"",nome:"Todos"},...Array.isArray(t(_))?t(_):[]],placeholder:"Todos",label:"Segmento",disabled:t(m),"onUpdate:modelValue":t(pe)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ra,[i[1]||(i[1]=l("label",null,"Diretoria",-1)),f(V,{id:"f-diretoria","model-value":t(N),options:[{id:"",nome:"Todas"},...Array.isArray(t(p))?t(p):[]],placeholder:"Todas",label:"Diretoria",disabled:t(m),"onUpdate:modelValue":t(be)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ua,[i[2]||(i[2]=l("label",null,"Regional",-1)),f(V,{id:"f-gerencia","model-value":t(z),options:[{id:"",nome:"Todas"},...Array.isArray(t(B))?t(B):[]],placeholder:"Todas",label:"Regional",disabled:t(m),"onUpdate:modelValue":t(he)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ca,[f(ie,{id:"btn-filtrar",variant:"primary",disabled:d.value,onClick:Ee},{default:ae(()=>[f(j,{name:"search",size:16,color:"white"}),i[3]||(i[3]=ue(" Filtrar ",-1))]),_:1},8,["disabled"]),f(ie,{id:"btn-limpar",variant:"secondary",onClick:Ne},{default:ae(()=>[f(j,{name:"x",size:16}),i[4]||(i[4]=ue(" Limpar filtros ",-1))]),_:1})])]),g.value?(U(),D("div",ga,[f(ie,{id:"btn-abrir-filtros",variant:"info","aria-expanded":u.value,"aria-controls":"advanced-filters",onClick:Q,onKeydown:[W(Z(Q,["prevent"]),["enter"]),W(Z(Q,["prevent"]),["space"])]},{default:ae(()=>[f(j,{name:"chevron-down",size:16,class:te({rotated:u.value})},null,8,["class"]),l("span",null,Le(u.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):ne("",!0),l("section",{id:"advanced-filters",class:te(["adv",{"is-open":u.value}]),"aria-hidden":!u.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[l("div",va,[l("div",fa,[i[5]||(i[5]=l("label",null,"Agência",-1)),f(V,{id:"f-agencia","model-value":t(P),options:[{id:"",nome:"Todas"},...Array.isArray(t(G))?t(G):[]],placeholder:"Todas",label:"Agência",disabled:t(m),"onUpdate:modelValue":t(_e)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",pa,[i[6]||(i[6]=l("label",null,"Gerente de gestão",-1)),f(V,{id:"f-gerente-gestao","model-value":t(q),options:[{id:"",nome:"Todos"},...Array.isArray(t(O))?t(O):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:t(m),"onUpdate:modelValue":t(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ba,[i[7]||(i[7]=l("label",null,"Gerente",-1)),f(V,{id:"f-gerente","model-value":t(n),options:[{id:"",nome:"Todos"},...Array.isArray(t(M))?t(M):[]],placeholder:"Todos",label:"Gerente",disabled:t(m),"onUpdate:modelValue":t(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ha,[i[8]||(i[8]=l("label",null,"Família",-1)),f(V,{id:"f-secao","model-value":T.value,options:[{id:"",nome:"Selecione..."},...R.value],placeholder:"Selecione...",label:"Família",disabled:t(m),"onUpdate:modelValue":Fe},null,8,["model-value","options","disabled"])]),l("div",_a,[i[9]||(i[9]=l("label",null,"Indicadores",-1)),f(V,{id:"f-familia","model-value":S.value,options:[{id:"",nome:"Selecione..."},...Te.value],placeholder:"Selecione...",label:"Indicadores",disabled:t(m)||!T.value,"onUpdate:modelValue":Ve},null,8,["model-value","options","disabled"])]),l("div",Sa,[i[10]||(i[10]=l("label",null,"Subindicador",-1)),f(V,{id:"f-produto","model-value":A.value,options:[{id:"",nome:"Selecione..."},...le.value],placeholder:"Selecione...",label:"Subindicador",disabled:t(m)||!S.value||!Ae.value,"onUpdate:modelValue":Ue},null,8,["model-value","options","disabled"])]),l("div",Ia,[i[11]||(i[11]=l("label",null,"Status dos indicadores",-1)),f(ge,{id:"f-status-kpi","model-value":K.value,options:$e.value,placeholder:"Todos",label:"Status dos indicadores",disabled:t(m),"onUpdate:modelValue":Be},null,8,["model-value","options","disabled"])]),l("div",ya,[i[12]||(i[12]=l("label",null,"Visão acumulada",-1)),f(ge,{id:"f-visao","model-value":t(H),options:xe.value,placeholder:"Mensal",label:"Visão acumulada",disabled:t(m),"onUpdate:modelValue":Ge},null,8,["model-value","options","disabled"])])])],10,ma)]))}}),Ga=ve(Ca,[["__scopeId","data-v-9947db72"]]);export{Ga as default};
