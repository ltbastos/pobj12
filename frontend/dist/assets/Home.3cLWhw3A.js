import{b as Q,r as K,w as ua,y as sa,m as f,q as a,k as P,o as y,e as I,j as H,u as l,t as N,C as B,E as n,L as U,M as ia,F as D,D as Y,A as na,v as oa,B as ra}from"./vendor.Mb-DmQZ9.js";import{_ as O,I as L}from"./index.BTfDv-kk.js";import{u as Z}from"./useResumoData.CSJmM5WX.js";import{u as W}from"./useGlobalFilters.DVWt81fx.js";import{f as _a,a as F,b as ma,c as pa,d as E,e as C,g as va,h as X}from"./formatUtils.SsKD9Isb.js";import{u as ga}from"./useCalendarioCache.vNbdq2fG.js";import{f as da}from"./calendarioService.YABvM0Wu.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./vue-router.BEbJbLaE.js";const ha={class:"resumo-mode"},fa={class:"resumo-mode__toggle",role:"group","aria-label":"Alterar visão do resumo"},ya={class:"segmented"},ba=["aria-pressed"],$a=["aria-pressed"],ka=Q({__name:"ResumoModeToggle",props:{modelValue:{}},emits:["update:modelValue"],setup(R,{emit:w}){const b=R,p=w,$=K(b.modelValue||"cards");ua(()=>b.modelValue,o=>{o&&(o==="cards"||o==="legacy")&&($.value=o)});const z=o=>{$.value=o,p("update:modelValue",o),typeof window<"u"&&localStorage.setItem("resumo-mode",o)};return sa(()=>{if(typeof window<"u"&&!b.modelValue){const o=localStorage.getItem("resumo-mode");o&&(o==="cards"||o==="legacy")&&($.value=o,p("update:modelValue",o))}else b.modelValue&&($.value=b.modelValue)}),(o,v)=>(y(),f("div",ha,[a("div",fa,[a("div",ya,[a("button",{type:"button",class:P(["seg-btn",{"is-active":$.value==="cards"}]),"aria-pressed":$.value==="cards",onClick:v[0]||(v[0]=g=>z("cards"))}," Visão por cards ",10,ba),a("button",{type:"button",class:P(["seg-btn",{"is-active":$.value==="legacy"}]),"aria-pressed":$.value==="legacy",onClick:v[1]||(v[1]=g=>z("legacy"))}," Visão clássica ",10,$a)])])]))}}),ca=O(ka,[["__scopeId","data-v-446d22e4"]]);function la(R,w){const b=Z(R,w),p=I(()=>b.buildFilters()),$=I(()=>{const z=new Map;return b.produtos.value.forEach(o=>{const v=o.id_familia||"sem-familia",g=o.familia||"Sem Família",h=o.id_indicador||o.id;if(!h)return;z.has(v)||z.set(v,new Map);const c=z.get(v);if(c.has(h)){const _=c.get(h);_.meta=(_.meta||0)+(o.meta||0),_.realizado=(_.realizado||0)+(o.realizado||0),_.pontos=(_.pontos||0)+(o.pontos||0),_.pontosMeta=(_.pontosMeta||0)+(o.pontos_meta||o.peso||0),o.ultima_atualizacao&&(!_.ultimaAtualizacao||o.ultima_atualizacao>_.ultimaAtualizacao)&&(_.ultimaAtualizacao=o.ultima_atualizacao);const r=_.meta||0,m=_.realizado||0;_.ating=r>0?m/r:0,_.atingido=r>0?m/r>=1:!1}else{const _=o.meta||0,r=o.realizado||0,m={id:h,nome:o.indicador||"Indicador",familiaId:v,familiaNome:g,indicadorId:h,indicadorNome:o.indicador||"Indicador",metrica:o.metrica||"valor",peso:o.peso||0,pontosMeta:o.pontos_meta||o.peso||0,meta:_,realizado:r,pontos:o.pontos||0,atingido:_>0?r/_>=1:!1,ating:_>0?r/_:0,ultimaAtualizacao:o.ultima_atualizacao};c.set(h,m)}}),Array.from(z.entries()).map(([o,v])=>{const g=Array.from(v.values()),h=g.reduce((t,s)=>t+(s.pontosMeta||0),0),c=g.reduce((t,s)=>t+Math.max(0,s.pontos||0),0),_=g.reduce((t,s)=>t+(s.meta||0),0),r=g.reduce((t,s)=>t+(s.realizado||0),0),m=_>0?r/_*100:0;return{id:o,label:g[0]?.familiaNome||"Sem Família",items:g,totals:{pontosTotal:h,pontosHit:c,metaTotal:_,realizadoTotal:r,atingPct:m}}})});return{produtos:b.produtos,produtosPorFamilia:$,loading:b.loading,error:b.error,loadProdutos:b.loadResumo,produtoFilters:p}}function xa(R,w){const{produtosPorFamilia:b}=la(R,w),p=Z(R,w),$=I(()=>{const o=p.variavel.value||[];if(!o.length)return{varPossivel:null,varAtingido:null};const v=o.reduce((g,h)=>{const c=Number(h.variavel_meta)||0,_=Number(h.variavel_real)||0;return g.meta+=c,g.real+=_,g},{meta:0,real:0});return{varPossivel:v.meta,varAtingido:v.real}});return{summary:I(()=>{const o=b.value||[];let v=0,g=0,h=0,c=0;return o.forEach(_=>{_.items.forEach(r=>{g++,r.atingido&&v++;const m=r.pontosMeta||0,t=Math.max(0,r.pontos||0);c+=m,h+=Math.min(t,m)})}),{indicadoresAtingidos:v,indicadoresTotal:g,pontosAtingidos:h,pontosPossiveis:c,varPossivel:$.value.varPossivel,varAtingido:$.value.varAtingido}})}}const wa={id:"kpi-summary",class:"kpi-summary"},Ma={key:0,class:"kpi-pill"},za={class:"kpi-strip__main"},Aa={class:"kpi-icon"},Pa={class:"kpi-strip__text"},Fa={class:"kpi-strip__stats"},Ra={class:"kpi-stat"},Ta={class:"kpi-stat"},Na=["aria-valuenow","aria-label","aria-valuetext"],Va={class:"hitbar__thumb"},Sa={class:"hitbar__pct"},Ca={key:1,class:"kpi-pill"},Da={class:"kpi-strip__main"},Ia={class:"kpi-icon"},Ba={class:"kpi-strip__text"},Ea={class:"kpi-strip__stats"},ja={class:"kpi-stat"},Ha={class:"kpi-stat"},La=["aria-valuenow"],qa={class:"hitbar__thumb"},Ua={class:"hitbar__pct"},Ka={class:"kpi-pill"},Qa={class:"kpi-strip__main"},Oa={class:"kpi-icon"},Wa={class:"kpi-strip__text"},Ga={class:"kpi-strip__stats"},Ja={class:"kpi-stat"},Xa={class:"kpi-stat"},Ya=["aria-valuenow","aria-valuetext"],Za={class:"hitbar__thumb"},as={class:"hitbar__pct"},ss=Q({__name:"ResumoKPI",setup(R){const{filterState:w,period:b}=W(),{summary:p}=xa(w,b),$=(h,c)=>h==="brl"?_a(c):h==="pts"?F(c):ma(c),z=h=>h<50?"hitbar--low":h<100?"hitbar--warn":"hitbar--ok",o=I(()=>p.value.indicadoresTotal===0?0:p.value.indicadoresAtingidos/p.value.indicadoresTotal*100),v=I(()=>p.value.pontosPossiveis===0?0:p.value.pontosAtingidos/p.value.pontosPossiveis*100),g=I(()=>{const h=p.value.varPossivel??0,c=p.value.varAtingido??0;if(h===0||!Number.isFinite(h)||!Number.isFinite(c))return 0;const _=c/h*100;return Math.max(0,Math.min(100,_))});return(h,c)=>(y(),f("div",wa,[l(p).indicadoresTotal>0||l(p).pontosPossiveis>0?(y(),f("div",Ma,[a("div",za,[a("span",Aa,[N(L,{name:"list-check",size:22})]),a("div",Pa,[c[2]||(c[2]=a("span",{class:"kpi-strip__label"},"Indicadores",-1)),a("div",Fa,[a("span",Ra,[c[0]||(c[0]=B(" Atg: ",-1)),a("strong",null,n($("int",l(p).indicadoresAtingidos)),1)]),a("span",Ta,[c[1]||(c[1]=B(" Total: ",-1)),a("strong",null,n($("int",l(p).indicadoresTotal)),1)])])])]),a("div",{class:P(["hitbar",z(o.value)]),role:"progressbar","aria-valuenow":o.value,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Atingimento de indicadores: ${o.value.toFixed(1)}%`,"aria-valuetext":`${o.value.toFixed(1)}% (${l(p).indicadoresAtingidos} de ${l(p).indicadoresTotal} indicadores)`},[a("span",{class:"hitbar__track",style:U({"--target":`${o.value.toFixed(2)}%`,"--thumb":`${o.value.toFixed(2)}%`})},[c[3]||(c[3]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Va,[a("span",Sa,n(o.value.toFixed(1))+"%",1)])],4)],10,Na)])):H("",!0),l(p).pontosPossiveis>0?(y(),f("div",Ca,[a("div",Da,[a("span",Ia,[N(L,{name:"medal",size:22})]),a("div",Ba,[c[6]||(c[6]=a("span",{class:"kpi-strip__label"},"Pontos",-1)),a("div",Ea,[a("span",ja,[c[4]||(c[4]=B(" Atg: ",-1)),a("strong",null,n($("pts",l(p).pontosAtingidos)),1)]),a("span",Ha,[c[5]||(c[5]=B(" Total: ",-1)),a("strong",null,n($("pts",l(p).pontosPossiveis)),1)])])])]),a("div",{class:P(["hitbar",z(v.value)]),role:"progressbar","aria-valuenow":v.value,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${v.value.toFixed(2)}%`,"--thumb":`${v.value.toFixed(2)}%`})},[c[7]||(c[7]=a("span",{class:"hitbar__fill"},null,-1)),a("span",qa,[a("span",Ua,n(v.value.toFixed(1))+"%",1)])],4)],10,La)])):H("",!0),a("div",Ka,[a("div",Qa,[a("span",Oa,[N(L,{name:"cash",size:22})]),a("div",Wa,[c[10]||(c[10]=a("span",{class:"kpi-strip__label"},[B(" Variável "),a("span",{class:"kpi-label-emphasis"},"Estimada")],-1)),a("div",Ga,[a("span",Ja,[c[8]||(c[8]=B(" Atg: ",-1)),a("strong",null,n($("brl",l(p).varAtingido||0)),1)]),a("span",Xa,[c[9]||(c[9]=B(" Total: ",-1)),a("strong",null,n($("brl",l(p).varPossivel||0)),1)])])])]),a("div",{class:P(["hitbar",z(g.value)]),role:"progressbar","aria-valuenow":g.value,"aria-valuetext":`Variável Estimada: ${g.value.toFixed(1)}%`,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${Math.max(0,Math.min(100,g.value)).toFixed(2)}%`,"--thumb":`${Math.max(0,Math.min(100,g.value)).toFixed(2)}%`})},[c[11]||(c[11]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Za,[a("span",as,n(g.value.toFixed(1))+"%",1)])],4)],10,Ya)])]))}}),es=O(ss,[["__scopeId","data-v-c18e6632"]]);function ts(){const R=K([]),{filterState:w,period:b}=W(),p=Z(w,b),$=async()=>{await p.loadResumo()},z=I(()=>p.businessSnapshot.value);return{calendario:R,loading:p.loading,loadCalendario:$,getCurrentMonthBusinessSnapshot:z}}const os={id:"grid-familias"},is={key:0,class:"produtos-skeleton"},ls={key:0,class:"error-state"},ns={class:"fam-section__header"},rs={class:"fam-section__title"},ds={key:0,class:"fam-section__meta"},cs=["title"],us={class:"fam-section__grid"},_s=["data-prod-id","data-familia-id","data-familia-label","aria-label","onKeydown"],ms={class:"prod-card__title"},ps=["title"],vs=["aria-label","title","onMouseenter","onClick","onTouchstart"],gs={class:"prod-card__meta"},hs={class:"pill"},fs={class:"pill"},ys={class:"pill"},bs={class:"prod-card__kpis"},$s={class:"kv"},ks=["title"],xs={class:"kv"},ws=["title"],Ms={class:"prod-card__var"},zs={class:"prod-card__var-body"},As=["title"],Ps=["data-ratio","aria-valuenow","aria-label","aria-valuetext"],Fs=["title"],Rs={class:"prod-card__var-value"},Ts={class:"prod-card__foot"},Ns={key:0,class:"kpi-tip is-open",role:"dialog","aria-label":"Detalhes do indicador"},Vs={class:"row"},Ss={class:"row"},Cs={class:"row"},Ds={class:"row"},Is={class:"row"},Bs={class:"row"},Es={class:"row"},js={key:2,class:"empty-state"},Hs=Q({__name:"ProdutosCards",setup(R){const{filterState:w,period:b}=W(),{produtosPorFamilia:p,loading:$,error:z}=la(w,b),{getCurrentMonthBusinessSnapshot:o}=ts(),{loadCalendario:v}=ga(),g=K(null);sa(async()=>{await v()});const h=u=>{const e=d=>{d.target.closest(".prod-card")||u()};sa(()=>{document.addEventListener("click",e)}),na(()=>{document.removeEventListener("click",e)})},c=u=>{const e=d=>{d.key==="Escape"&&u()};sa(()=>{document.addEventListener("keydown",e)}),na(()=>{document.removeEventListener("keydown",e)})};h(()=>{g.value=null}),c(()=>{g.value=null});const _=(u,e)=>{Number.isFinite(e)||(e=0);const d=u?.toLowerCase()||"valor";return d==="perc"?`${e.toFixed(1)}%`:d==="qtd"?new Intl.NumberFormat("pt-BR",{maximumFractionDigits:0}).format(Math.round(e)):va(Math.round(e))},r=u=>{const e=o.value,{total:d,elapsed:i,remaining:k}=e;let j=u.meta||0;const G=u.realizado||0;u.metrica?.toLowerCase()==="perc"&&(j=100);const J=Math.max(0,j-G),ea=k>0?J/k:0,q=(i>0?G/i:0)*(d||0),aa=d>0?j/d*i:0;return{diasTotais:d,diasDecorridos:i,diasRestantes:k,faltaTotal:_(u.metrica||"valor",J),necessarioPorDia:k>0?_(u.metrica||"valor",ea):"—",referenciaHoje:i>0?_(u.metrica||"valor",aa):"—",projecaoRitmoAtual:_(u.metrica||"valor",q)}},m=(u,e)=>{const d=u.closest(".prod-card");if(!d)return;const i=u.getBoundingClientRect(),k=d.getBoundingClientRect(),j=e.offsetWidth||320,G=e.offsetHeight||200,J=window.innerWidth,ea=window.innerHeight;let ta=i.bottom-k.top+8;i.bottom+G+12>ea&&(ta=i.top-k.top-G-8);let q=k.width-j-12;const aa=k.left+q;aa<12&&(q=12),aa+j>J-12&&(q=Math.max(12,J-12-k.left-j)),e.style.top=`${ta}px`,e.style.left=`${q}px`},t=(u,e)=>{e.stopPropagation(),g.value=u,requestAnimationFrame(()=>{const d=document.querySelector(`[data-prod-id="${u}"]`);if(!d)return;const i=d.querySelector(".badge"),k=d.querySelector(".kpi-tip");i&&k&&m(i,k)})},s=()=>{g.value=null},T=(u,e)=>{e.stopPropagation(),g.value===u?s():t(u,e)},A=u=>u<50?"badge--low":u<100?"badge--warn":"badge--ok",S=u=>u<50?"var--low":u<100?"var--warn":"var--ok",x=u=>{const e=u.meta||0,d=u.realizado||0;return e<=0?0:d/e*100},M=u=>{const e=u.pontosMeta||0,d=u.pontos||0;return e>0?d/e*100:0},V=u=>{if(!u)return"Valor";const e=u.toLowerCase();return e==="valor"?"Valor":e==="qtd"||e==="quantidade"?"Quantidade":"Percentual"};return(u,e)=>(y(),f("div",os,[l($)?(y(),f("div",is,[...e[0]||(e[0]=[ia('<div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-0ec0f9e5></div><div class="cards-grid" data-v-0ec0f9e5><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div></div><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin:32px 0 16px;border-radius:6px;" data-v-0ec0f9e5></div><div class="cards-grid" data-v-0ec0f9e5><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div></div>',4)])])):(y(),f(D,{key:1},[l(z)?(y(),f("div",ls,[a("p",null,n(l(z)),1)])):l(p).length>0?(y(!0),f(D,{key:1},Y(l(p),d=>(y(),f("div",{key:d.id,class:"fam-section"},[a("header",ns,[a("div",rs,[a("span",null,n(d.label),1),d.totals?(y(),f("small",ds,[a("span",{class:"fam-section__meta-item",title:`Pontos: ${l(F)(d.totals.pontosHit,{withUnit:!0})} / ${l(F)(d.totals.pontosTotal,{withUnit:!0})}`}," Pontos: "+n(l(F)(d.totals.pontosHit))+" / "+n(l(F)(d.totals.pontosTotal)),9,cs)])):H("",!0)])]),a("div",us,[(y(!0),f(D,null,Y(d.items,i=>(y(),f("article",{key:i.id,class:P(["prod-card",{"is-tip-open":g.value===i.id}]),"data-prod-id":i.id,"data-familia-id":i.familiaId,"data-familia-label":i.familiaNome,role:"article","aria-label":`Produto: ${i.nome}`,tabindex:"0",onMouseleave:s,onKeydown:[oa(ra(k=>t(i.id,k),["prevent"]),["enter"]),oa(ra(k=>t(i.id,k),["prevent"]),["space"]),oa(s,["escape"])]},[a("div",ms,[N(L,{name:"chart-line",size:22,color:"#b30000",class:"prod-card__icon"}),a("span",{class:"prod-card__name has-ellipsis",title:i.nome},n(i.nome),9,ps),a("span",{class:P(["badge",A(x(i))]),"aria-label":`Atingimento: ${x(i).toFixed(1)}%`,title:`${x(i).toFixed(1)}%`,onMouseenter:k=>{k.stopPropagation(),t(i.id,k)},onClick:k=>{k.stopPropagation(),T(i.id,k)},onTouchstart:k=>{k.stopPropagation(),T(i.id,k)}},n(x(i)>=100?`${Math.round(x(i))}%`:`${x(i).toFixed(1)}%`),43,vs)]),a("div",gs,[a("span",hs," Pontos: "+n(l(F)(i.pontos||0))+" / "+n(l(F)(i.pontosMeta||0)),1),a("span",fs,"Peso: "+n(l(pa)(i.peso||0)),1),a("span",ys,n(V(i.metrica)),1)]),a("div",bs,[a("div",$s,[e[1]||(e[1]=a("small",null,"Meta",-1)),a("strong",{class:"has-ellipsis",title:l(E)(i.metrica,i.meta)},n(l(C)(i.metrica,i.meta)),9,ks)]),a("div",xs,[e[2]||(e[2]=a("small",null,"Realizado",-1)),a("strong",{class:"has-ellipsis",title:l(E)(i.metrica,i.realizado)},n(l(C)(i.metrica,i.realizado)),9,ws)])]),a("div",Ms,[e[3]||(e[3]=a("div",{class:"prod-card__var-head"},[a("small",null,"Atingimento de pontos")],-1)),a("div",zs,[a("span",{class:"prod-card__var-goal",title:l(F)(i.pontosMeta||0,{withUnit:!0})},n(l(F)(i.pontosMeta||0,{withUnit:!0})),9,As),a("div",{class:P(["prod-card__var-track",S(M(i))]),"data-ratio":M(i).toFixed(2),role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":Math.round(M(i)),"aria-label":`Atingimento de pontos: ${M(i).toFixed(1)}%`,"aria-valuetext":`${M(i).toFixed(1)}% (${l(F)(i.pontos||0)} de ${l(F)(i.pontosMeta||0)})`},[a("span",{class:"prod-card__var-fill",style:U({"--target":`${M(i)}%`})},null,4),a("span",{class:"prod-card__var-label",style:U({"--target":`${M(i)}%`}),title:`Atingido: ${l(F)(i.pontos||0,{withUnit:!0})} · ${M(i).toFixed(1)}%`},[a("span",Rs,n(M(i).toFixed(1))+"%",1)],12,Fs)],10,Ps)])]),a("div",Ts," Atualizado em "+n(i.ultimaAtualizacao||"N/A"),1),g.value===i.id?(y(),f("div",Ns,[r(i)?(y(),f(D,{key:0},[e[11]||(e[11]=a("h5",null,"Projeção e metas",-1)),a("div",Vs,[e[4]||(e[4]=a("span",null,"Quantidade de dias úteis no mês",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(i).diasTotais)),1)]),a("div",Ss,[e[5]||(e[5]=a("span",null,"Dias úteis trabalhados",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(i).diasDecorridos)),1)]),a("div",Cs,[e[6]||(e[6]=a("span",null,"Dias úteis que faltam",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(i).diasRestantes)),1)]),a("div",Ds,[e[7]||(e[7]=a("span",null,"Falta para a meta",-1)),a("span",null,n(r(i).faltaTotal),1)]),a("div",Is,[e[8]||(e[8]=a("span",null,"Referência para hoje",-1)),a("span",null,n(r(i).referenciaHoje),1)]),a("div",Bs,[e[9]||(e[9]=a("span",null,"Meta diária necessária",-1)),a("span",null,n(r(i).necessarioPorDia),1)]),a("div",Es,[e[10]||(e[10]=a("span",null,"Projeção (ritmo atual)",-1)),a("span",null,n(r(i).projecaoRitmoAtual),1)])],64)):H("",!0)])):H("",!0)],42,_s))),128))])]))),128)):(y(),f("div",js,[...e[12]||(e[12]=[a("p",null,"Nenhum produto encontrado",-1)])]))],64))]))}}),Ls=O(Hs,[["__scopeId","data-v-0ec0f9e5"]]);function qs(){const{filterState:R,period:w}=W(),b=Z(R,w),p=b.produtosMensais,$=b.loading,z=b.error,o=b.businessSnapshot,v=I(()=>{const g=new Map;p.value.forEach(s=>{const T=s.id_familia||"sem-familia",A=s.id_indicador||s.id;if(!A)return;g.has(T)||g.set(T,new Map);const S=g.get(T);if(S.has(A)){const x=S.get(A);!x.peso&&s.peso&&(x.peso=Number(s.peso)||0,x.pontosMeta=Number(s.pontos_meta??s.peso)||0),x.meta=(x.meta||0)+(s.meta||0),x.realizado=(x.realizado||0)+(s.realizado||0);const M=new Map;x.months.forEach(e=>{M.set(e.mes,{meta:e.meta,realizado:e.realizado})}),s.meses.forEach(e=>{const d=M.get(e.mes)||{meta:0,realizado:0};M.set(e.mes,{meta:d.meta+e.meta,realizado:d.realizado+e.realizado})}),x.months=Array.from(M.entries()).map(([e,d])=>({mes:e,meta:d.meta,realizado:d.realizado,atingimento:d.meta>0?d.realizado/d.meta*100:0}));const V=new Date().toISOString().slice(0,7),u=x.months.find(e=>e.mes===V);if(x.monthMeta=u?.meta||0,x.monthReal=u?.realizado||0,s.id_subindicador&&s.subindicador){x.children||(x.children=[]);const e={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:u?.meta||0,monthReal:u?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};x.children.push(e)}}else{const x=new Date().toISOString().slice(0,7),M=s.meses.find(u=>u.mes===x),V={id:A,nome:s.indicador||"Indicador",metrica:s.metrica||"valor",peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:M?.meta||0,monthReal:M?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses,children:[]};if(s.id_subindicador&&s.subindicador){const u={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:M?.meta||0,monthReal:M?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};V.children.push(u)}S.set(A,V)}});const h=new Map;p.value.forEach(s=>{s.id_familia&&!h.has(s.id_familia)&&h.set(s.id_familia,s.familia||"Sem Família")});const c=o.value,_=c.total||1,r=c.elapsed||0,m=c.remaining||0,t=s=>{const T=s.meta||0,A=s.realizado||0,S=s.pontosMeta||s.peso||0,x=_>0?T/_*r:0,M=Math.max(0,T-A),V=m>0?M/m:0,u=r>0?A/r*m+A:A;let e,d;s.pontosBackend!==void 0?(e=s.pontosBackend,d=e):(d=Math.min(S,A),e=Math.max(0,Math.min(S,d)));const i=T>0?A/T:0,k={...s,referenciaHoje:x,projecao:u,metaDiariaNecessaria:V,pontos:e,pontosBrutos:d,ating:i};return s.children&&s.children.length>0&&(k.children=s.children.map(t)),k};return Array.from(g.entries()).map(([s,T])=>{const A=Array.from(T.values()).map(t),S=A.reduce((e,d)=>e+(d.pontosMeta||0),0),x=A.reduce((e,d)=>e+(d.pontos||0),0),M=A.reduce((e,d)=>e+(d.meta||0),0),V=A.reduce((e,d)=>e+(d.realizado||0),0),u=M>0?V/M*100:0;return{id:s,label:h.get(s)||"Sem Família",items:A,totals:{pontosTotal:S,pontosHit:x,metaTotal:M,realizadoTotal:V,atingPct:u}}})});return{produtos:p,produtosPorFamilia:v,loading:$,error:z,loadProdutos:b.loadResumo}}const Us={class:"resumo-legacy"},Ks={key:0,class:"resumo-legacy__loading"},Qs={key:1,class:"resumo-legacy__error"},Os={key:2,class:"resumo-legacy__empty"},Ws={class:"resumo-legacy__head"},Gs={class:"resumo-legacy__heading"},Js={class:"resumo-legacy__title-row"},Xs={class:"resumo-legacy__name"},Ys={class:"resumo-legacy__section-actions"},Zs=["disabled","onClick"],ae={class:"resumo-legacy__section-toggle-label"},se={class:"resumo-legacy__chips"},ee={class:"resumo-legacy__chip"},te=["title"],oe={class:"resumo-legacy__stats"},ie={class:"resumo-legacy__stat"},le={class:"resumo-legacy__stat-value"},ne={key:0,class:"resumo-legacy__stat"},re={class:"resumo-legacy__stat-value"},de={class:"resumo-legacy__stat"},ce={class:"resumo-legacy__stat-value"},ue={class:"resumo-legacy__table-wrapper"},_e={class:"resumo-legacy__table"},me=["data-row-id"],pe={class:"resumo-legacy__col--prod"},ve={class:"resumo-legacy__prod"},ge=["aria-expanded","onClick"],he=["title"],fe={key:1,class:"resumo-legacy__prod-name-wrapper"},ye=["title"],be={class:"resumo-legacy__col--peso"},$e=["title"],ke=["title"],xe=["title"],we=["title"],Me=["title"],ze=["title"],Ae=["title"],Pe={class:"resumo-legacy__col--ating"},Fe={class:"resumo-legacy__ating",title:"Atingimento"},Re=["aria-valuenow"],Te={class:"resumo-legacy__ating-value"},Ne={class:"resumo-legacy__col--update"},Ve=["data-row-id"],Se={class:"resumo-legacy__col--prod"},Ce={class:"resumo-legacy__prod"},De=["title"],Ie=["title"],Be=["title"],Ee=["title"],je={class:"resumo-legacy__col--update"},He=Q({__name:"ResumoLegacy",setup(R){const{filterState:w,period:b}=W();la(w,b);const{produtosPorFamilia:p,loading:$,error:z}=qs(),o=K(new Set),v=K(new Set),g=_=>{o.value.has(_)?o.value.delete(_):o.value.add(_)},h=_=>{v.value.has(_)?v.value.delete(_):v.value.add(_)},c=_=>_.items.some(r=>r.children&&r.children.length>0);return(_,r)=>(y(),f("div",Us,[l($)?(y(),f("div",Ks," Carregando... ")):l(z)?(y(),f("div",Qs," Erro: "+n(l(z)),1)):!l(p)||l(p).length===0?(y(),f("div",Os," Nenhum dado disponível ")):(y(!0),f(D,{key:3},Y(l(p),m=>(y(),f("section",{key:m.id,class:"resumo-legacy__section resumo-legacy__section--annual card card--legacy"},[a("header",Ws,[a("div",Gs,[a("div",Js,[a("span",Xs,n(m.label),1),a("div",Ys,[a("button",{type:"button",class:P(["resumo-legacy__section-toggle",{"is-disabled":!c(m)},{"is-expanded":v.value.has(m.id)}]),disabled:!c(m),onClick:t=>h(m.id)},[N(L,{name:"filter",size:16}),a("span",ae,n(v.value.has(m.id)?"Recolher filtros":"Abrir todos os filtros"),1)],10,Zs)])]),a("div",se,[a("span",ee,[N(L,{name:"box-multiple",size:16}),B(" "+n(l(X)(m.items.length||0))+" indicadores ",1)]),a("span",{class:"resumo-legacy__chip",title:`Pontos: ${l(F)(m.totals.pontosHit,{withUnit:!0})} / ${l(F)(m.totals.pontosTotal,{withUnit:!0})}`}," Pontos "+n(l(X)(Math.round(m.totals.pontosHit)))+" / "+n(l(X)(Math.round(m.totals.pontosTotal))),9,te)])]),a("div",oe,[a("div",ie,[r[0]||(r[0]=a("span",{class:"resumo-legacy__stat-label"},"Peso total",-1)),a("strong",le,n(l(X)(Math.round(m.totals.pontosTotal))),1)]),m.totals.realizadoTotal>0?(y(),f("div",ne,[r[1]||(r[1]=a("span",{class:"resumo-legacy__stat-label"},"Realizado",-1)),a("strong",re,n(l(C)("valor",m.totals.realizadoTotal)),1)])):H("",!0),a("div",de,[r[2]||(r[2]=a("span",{class:"resumo-legacy__stat-label"},"Atingimento",-1)),a("strong",ce,n(m.totals.metaTotal>0?`${Math.max(0,Math.min(200,m.totals.atingPct)).toFixed(1)}%`:"—"),1)])])]),a("div",ue,[a("table",_e,[r[10]||(r[10]=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Subindicador"),a("th",{scope:"col",class:"resumo-legacy__col--peso"},"Peso"),a("th",{scope:"col"},"Métrica"),a("th",{scope:"col",class:"resumo-legacy__col--meta"},"Meta"),a("th",{scope:"col",class:"resumo-legacy__col--real"},"Realizado"),a("th",{scope:"col",class:"resumo-legacy__col--ref"},"Ref. do dia"),a("th",{scope:"col",class:"resumo-legacy__col--forecast"},"Forecast"),a("th",{scope:"col",class:"resumo-legacy__col--meta-dia"},"Meta diária nec."),a("th",{scope:"col",class:"resumo-legacy__col--pontos"},"Pontos"),a("th",{scope:"col",class:"resumo-legacy__col--ating"},"Ating."),a("th",{scope:"col",class:"resumo-legacy__col--update"},"Atualização")])],-1)),a("tbody",null,[(y(!0),f(D,null,Y(m.items,t=>(y(),f(D,{key:t.id},[a("tr",{class:P(["resumo-legacy__row",{"is-expanded":o.value.has(`${m.id}-${t.id}`)||v.value.has(m.id)}]),"data-row-id":`${m.id}-${t.id}`},[a("td",pe,[a("div",ve,[t.children&&t.children.length>0?(y(),f("button",{key:0,type:"button",class:"resumo-legacy__prod-toggle","aria-expanded":o.value.has(`${m.id}-${t.id}`)||v.value.has(m.id),onClick:s=>g(`${m.id}-${t.id}`)},[N(L,{name:"chevron-right",class:P(["resumo-legacy__prod-toggle-icon",{"is-expanded":o.value.has(`${m.id}-${t.id}`)||v.value.has(m.id)}]),size:16},null,8,["class"]),a("span",{class:"resumo-legacy__prod-name",title:t.nome},n(t.nome),9,he)],8,ge)):(y(),f("div",fe,[r[3]||(r[3]=a("span",{class:"resumo-legacy__prod-toggle-icon resumo-legacy__prod-toggle-icon--placeholder","aria-hidden":"true"},null,-1)),a("span",{class:"resumo-legacy__prod-name",title:t.nome},n(t.nome),9,ye)]))])]),a("td",be,n(l(X)(t.pontosMeta||t.peso||0)),1),a("td",null,[a("span",{class:P(["resumo-legacy__metric",`resumo-legacy__metric--${t.metrica==="valor"?"valor":t.metrica==="qtd"?"qtd":t.metrica==="perc"?"perc":""}`]),title:`Métrica: ${t.metrica}`},n(t.metrica==="valor"?"Valor":t.metrica==="qtd"?"Quantidade":t.metrica==="perc"?"Percentual":t.metrica),11,$e)]),a("td",{class:"resumo-legacy__col--meta",title:l(E)(t.metrica,t.meta)},n(l(C)(t.metrica,t.meta)),9,ke),a("td",{class:"resumo-legacy__col--real",title:l(E)(t.metrica,t.realizado)},n(l(C)(t.metrica,t.realizado)),9,xe),a("td",{class:"resumo-legacy__col--ref",title:l(E)(t.metrica,t.referenciaHoje)},n(t.referenciaHoje!=null?l(C)(t.metrica,t.referenciaHoje):"—"),9,we),a("td",{class:"resumo-legacy__col--forecast",title:l(E)(t.metrica,t.projecao)},n(t.projecao!=null?l(C)(t.metrica,t.projecao):"—"),9,Me),a("td",{class:"resumo-legacy__col--meta-dia",title:l(E)(t.metrica,t.metaDiariaNecessaria)},n(t.metaDiariaNecessaria!=null?l(C)(t.metrica,t.metaDiariaNecessaria):"—"),9,ze),a("td",{class:"resumo-legacy__col--pontos",title:l(F)(t.pontos,{withUnit:!0})},n(l(F)(t.pontos,{withUnit:!0})),9,Ae),a("td",Pe,[a("div",Fe,[a("div",{class:P(["resumo-legacy__ating-meter",(t.ating||0)>=1?"is-ok":(t.ating||0)>=.5?"is-warn":"is-low"]),style:U({"--fill":Math.max(0,Math.min(1,t.ating||0))}),role:"progressbar","aria-valuemin":0,"aria-valuemax":200,"aria-valuenow":Math.max(0,Math.min(200,(t.ating||0)*100))},[a("span",Te,n(t.meta>0?`${Math.max(0,Math.min(200,(t.ating||0)*100)).toFixed(1)}%`:"—"),1)],14,Re)])]),a("td",Ne,n(t.ultimaAtualizacao?t.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(da)(t.ultimaAtualizacao):t.ultimaAtualizacao:"—"),1)],10,me),t.children&&t.children.length>0?(y(!0),f(D,{key:0},Y(t.children,s=>(y(),f("tr",{key:s.id,class:P(["resumo-legacy__row resumo-legacy__row--child",{"is-visible":o.value.has(`${m.id}-${t.id}`)||v.value.has(m.id)}]),"data-row-id":`${m.id}-${t.id}-${s.id}`},[a("td",Se,[a("div",Ce,[a("span",{class:"resumo-legacy__prod-name resumo-legacy__prod-name--child",title:s.nome},n(s.nome),9,De)])]),r[4]||(r[4]=a("td",{class:"resumo-legacy__col--peso"}," — ",-1)),a("td",null,[a("span",{class:P(["resumo-legacy__metric",`resumo-legacy__metric--${s.metrica==="valor"?"valor":s.metrica==="qtd"?"qtd":s.metrica==="perc"?"perc":""}`]),title:`Métrica: ${s.metrica}`},n(s.metrica==="valor"?"Valor":s.metrica==="qtd"?"Quantidade":s.metrica==="perc"?"Percentual":s.metrica),11,Ie)]),r[5]||(r[5]=a("td",{class:"resumo-legacy__col--meta"}," — ",-1)),a("td",{class:"resumo-legacy__col--real",title:l(E)(s.metrica,s.realizado)},n(l(C)(s.metrica,s.realizado)),9,Be),r[6]||(r[6]=a("td",{class:"resumo-legacy__col--ref"}," — ",-1)),r[7]||(r[7]=a("td",{class:"resumo-legacy__col--forecast"}," — ",-1)),r[8]||(r[8]=a("td",{class:"resumo-legacy__col--meta-dia"}," — ",-1)),a("td",{class:"resumo-legacy__col--pontos",title:l(F)(s.pontos,{withUnit:!0})},n("-"),8,Ee),r[9]||(r[9]=a("td",{class:"resumo-legacy__col--ating"}," — ",-1)),a("td",je,n(s.ultimaAtualizacao?s.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(da)(s.ultimaAtualizacao):s.ultimaAtualizacao:"—"),1)],10,Ve))),128)):H("",!0)],64))),128))])])])]))),128))]))}}),Le=O(He,[["__scopeId","data-v-1d9b61e4"]]),qe={id:"view-cards",class:"view-section"},Ue={key:0,class:"resumo-skeleton"},Ke={id:"resumo-summary",class:"resumo-summary"},Qe=Q({__name:"ResumoView",setup(R){const w=K("cards"),{filterState:b,period:p}=W(),{loading:$}=Z(b,p);return(z,o)=>(y(),f("section",qe,[l($)?(y(),f("div",Ue,[N(ca,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=v=>w.value=v)},null,8,["modelValue"]),o[4]||(o[4]=ia('<div id="resumo-summary" class="resumo-summary" data-v-18d15f9e><div class="kpi-summary" data-v-18d15f9e><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--kpi-card" style="height:140px;border-radius:12px;" data-v-18d15f9e></div></div></div>',1)),a("div",{id:"resumo-cards",class:P(["resumo-mode__view",{hidden:w.value!=="cards"}])},[...o[2]||(o[2]=[ia('<div class="produtos-skeleton" data-v-18d15f9e><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-18d15f9e></div><div class="cards-grid" data-v-18d15f9e><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-18d15f9e></div></div></div>',1)])],2),a("div",{id:"resumo-legacy",class:P(["resumo-mode__view",{hidden:w.value!=="legacy"}])},[...o[3]||(o[3]=[a("div",{class:"skeleton skeleton--legacy",style:{height:"400px","border-radius":"12px"}},null,-1)])],2)])):(y(),f(D,{key:1},[N(ca,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=v=>w.value=v)},null,8,["modelValue"]),a("div",Ke,[N(es)]),a("div",{id:"resumo-cards",class:P(["resumo-mode__view",{hidden:w.value!=="cards"}])},[N(Ls)],2),a("div",{id:"resumo-legacy",class:P(["resumo-mode__view",{hidden:w.value!=="legacy"}]),"aria-live":"polite"},[N(Le)],2)],64))]))}}),Oe=O(Qe,[["__scopeId","data-v-18d15f9e"]]),We={class:"home-wrapper"},Ge=Q({__name:"Home",setup(R){return(w,b)=>(y(),f("div",We,[N(Oe)]))}}),lt=O(Ge,[["__scopeId","data-v-904e3431"]]);export{lt as default};
