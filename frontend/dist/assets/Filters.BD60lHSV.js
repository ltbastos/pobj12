import{a as Re,A as Ye,r as ce,b as v,c as S,d as pe,e as w,o as k,m as He,w as Z,f as q,g as se,n as de,h as ge,_ as be,u as je,i as We,j as Ze,k as qe,l as ve,p as l,q as p,s as o,S as A,t as ie,v as me,I as te,x as Je,y as fe}from"./index.CnKplZJr.js";async function Xe(){return(await Re(Ye.INIT)).data??null}const Y=v(null),oe=v(!1);let x=null;function Qe(){const e=async()=>Y.value?Y.value:x||(oe.value=!0,x=Xe().then(s=>(s&&(Y.value=s),s)).finally(()=>{oe.value=!1,x=null}),x),t=()=>{Y.value=null,x=null};return{initData:ce(Y),isLoading:ce(oe),loadInit:e,clearCache:t}}const _=e=>e==null||e===""?"":String(e).trim(),ea=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,aa=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,B=(e,t)=>{const s=String(e.nome??e.label??"").trim();let u="",g;return t==="ggestao"||t==="gerente"?(g=_(e.funcional??""),u=_(e.id??"")):(u=_(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),g=e.funcional?_(e.funcional):void 0),{id:u,nome:t==="ggestao"||t==="gerente"?aa(g||u,s):ea(u,s),id_segmento:_(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:_(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:_(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:_(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:_(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:g}};function na(e){const t={segmento:v(""),diretoria:v(""),gerencia:v(""),agencia:v(""),ggestao:v(""),gerente:v("")},s=S(()=>e.value?{segmentos:(e.value.segmentos??[]).map(n=>B(n,"segmento")),diretorias:(e.value.diretorias??[]).map(n=>B(n,"diretoria")),regionais:(e.value.regionais??[]).map(n=>B(n,"regional")),agencias:(e.value.agencias??[]).map(n=>B(n,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(n=>B(n,"ggestao")),gerentes:(e.value.gerentes??[]).map(n=>B(n,"gerente"))}:null),u=S(()=>{if(!s.value)return null;const n=h=>Object.fromEntries((h??[]).map(f=>[_(f.id),f]));return{segmento:n(s.value.segmentos),diretoria:n(s.value.diretorias),gerencia:n(s.value.regionais),agencia:n(s.value.agencias),ggestao:n(s.value.ggestoes),gerente:n(s.value.gerentes)}}),g={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},r={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function c(n,h){if(!h)return;const f=r[n],U=g[n];if(!f||!U)return;const z=u.value?.[n]?.[_(h)];if(!z)return;const O=_(z[U]??"");if(!O)return;const K=u.value?.[f]?.[O];K&&(t[f].value=K.id,console.debug("[hierarchy] autoFillParent:",{childField:n,childValue:h,parentField:f,parentId:O}),c(f,K.id))}const I=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function m(n){let h=!1;for(const f of I)h&&(t[f].value=""),f===n&&(h=!0)}function d(n,h){t[n].value=_(h),m(n),c(n,t[n].value)}const b=(n,h,f)=>n?f?n.filter(U=>_(U[h])===_(f)):n:[],J=S(()=>s.value?.segmentos??[]),G=S(()=>b(s.value?.diretorias,"id_segmento",t.segmento.value)),M=S(()=>b(s.value?.regionais,"id_diretoria",t.diretoria.value)),E=S(()=>b(s.value?.agencias,"id_regional",t.gerencia.value)),P=S(()=>b(s.value?.ggestoes,"id_agencia",t.agencia.value)),N=S(()=>b(s.value?.gerentes,"id_gestor",t.ggestao.value));return{...t,segmentos:J,diretorias:G,regionais:M,agencias:E,gerentesGestao:P,gerentes:N,handleSegmentoChange:n=>d("segmento",n),handleDiretoriaChange:n=>d("diretoria",n),handleGerenciaChange:n=>d("gerencia",n),handleAgenciaChange:n=>d("agencia",n),handleGerenteGestaoChange:n=>d("ggestao",n),handleGerenteChange:n=>d("gerente",n),clearAll:()=>{for(const n of I)t[n].value=""}}}const he=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function ia(e,t){const u=new Date().toISOString().split("T")[0],g=t||u,r=new Date(g+"T00:00:00Z");if(isNaN(r.getTime())){const d=new Date,b=d.toISOString().split("T")[0];return{start:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-01`,end:b||`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`}}let c;if(e==="anual")c=new Date(Date.UTC(r.getUTCFullYear(),0,1));else if(e==="mensal")c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1));else{const d=he.find(b=>b.value===e)?.monthsBack||5;c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth()-d,1))}const I=c.toISOString().split("T")[0]||"",m=r.toISOString().split("T")[0]||"";return{start:I,end:m}}function _e(e,t,s){if(e==="mensal"){const u=new Date().toISOString().split("T")[0]||"",r=s||t.end||u||u,c=new Date(r+"T00:00:00Z");return{start:new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:r}}return ia(e,t.end)}function ta(e,t){const s=v("mensal");return{accumulatedView:s,handleViewChange:g=>{s.value=g;const r=_e(g,e.value);t(r)},options:he}}const oa=["type","disabled","aria-busy","aria-disabled"],la={key:0,class:"btn__spinner","aria-hidden":"true"},sa={key:2},da={key:3,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},ra=pe({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},loading:{type:Boolean,default:!1}},setup(e){const t=e,s=v(null),u=g=>{if(t.disabled||t.loading)return;const r=g.currentTarget,c=document.createElement("span"),I=Math.max(r.clientWidth,r.clientHeight),m=I/2,d=r.getBoundingClientRect();c.style.width=c.style.height=`${I}px`,c.style.left=`${g.clientX-d.left-m}px`,c.style.top=`${g.clientY-d.top-m}px`,c.classList.add("ripple");const b=r.getElementsByClassName("ripple")[0];b&&b.remove(),r.appendChild(c),setTimeout(()=>{c.remove()},600)};return(g,r)=>(k(),w("button",He({ref_key:"buttonRef",ref:s,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},g.$attrs,{onClick:u,onKeydown:[r[0]||(r[0]=Z(q(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["enter"])),r[1]||(r[1]=Z(q(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["space"]))]}),[e.loading?(k(),w("span",la)):se("",!0),e.icon&&!e.loading?(k(),w("i",{key:1,class:de(e.icon),"aria-hidden":"true"},null,2)):se("",!0),e.loading?(k(),w("span",da,[ge(g.$slots,"default",{},void 0)])):(k(),w("span",sa,[ge(g.$slots,"default",{},void 0)]))],16,oa))}}),le=be(ra,[["__scopeId","data-v-a56e4887"]]),ua={class:"card card--filters"},ca={class:"filters"},ga={class:"filters__group"},va={class:"filters__group"},ma={class:"filters__group"},fa={class:"filters__actions"},pa={key:0,class:"filters__more filters__more--center"},ba=["aria-hidden"],ha={class:"adv__grid"},_a={class:"filters__group"},Sa={class:"filters__group"},ya={class:"filters__group"},Ia={class:"filters__group"},Ca={class:"filters__group"},Ta={class:"filters__group"},Aa={class:"filters__group"},Va={class:"filters__group"},Ua=pe({__name:"Filters",setup(e){const t=je(),s=S(()=>t.name==="Simuladores"),u=v(!1),g=v(!0),{initData:r,isLoading:c,loadInit:I}=Qe(),m=c,{updateFilter:d,updatePeriod:b,clearFilters:J}=We(),{segmento:G,diretoria:M,gerencia:E,agencia:P,ggestao:N,gerente:H,segmentos:n,diretorias:h,regionais:f,agencias:U,gerentesGestao:z,gerentes:O,handleSegmentoChange:K,handleDiretoriaChange:Se,handleGerenciaChange:ye,handleAgenciaChange:Ie,handleGerenteGestaoChange:Ce,handleGerenteChange:Te,clearAll:Ae}=na(r),j=v([]),L=v([]),X=v([]),Ve=v([]),F=v(""),C=v(""),V=v(""),R=v("todos"),re=S(()=>{if(!C.value)return[];const a=String(C.value).trim();return X.value.filter(i=>(i.id_indicador?String(i.id_indicador).trim():"")===a)}),Ue=S(()=>re.value.length>0),Q=(a,i)=>{if(!a)return null;const y=String(a).trim();return i.find($=>String($.id).trim()===y)||null},Fe=a=>{F.value=a,a||(C.value="",V.value="")},we=a=>{if(C.value=a,V.value="",a){const i=Q(a,L.value);if(i?.id_familia){const y=String(i.id_familia).trim();j.value.some(T=>String(T.id).trim()===y)&&(F.value=y)}}},ke=a=>{if(V.value=a,a){const i=Q(a,X.value);if(i?.id_indicador){const y=String(i.id_indicador).trim();if(L.value.some(T=>String(T.id).trim()===y)){C.value=y;const T=Q(y,L.value);if(T?.id_familia){const ne=String(T.id_familia).trim();j.value.some(Le=>String(Le.id).trim()===ne)&&(F.value=ne)}}}}else V.value=""},Oe=a=>{const i=String(a.id||a.codigo||a.id_diretoria||a.id_regional||a.id_agencia||a.funcional||a.subId||a.subindicadorId||"").trim(),y=String(a.label||a.nome||i).trim(),$=a.id_familia??a.idFamilia??a.familia_id??a.familiaId,T=a.id_indicador??a.idIndicador??a.indicador_id??a.indicadorId??a.produtoId??a.produto_id;return{id:i,nome:y,id_familia:$?String($).trim():void 0,id_indicador:T?String(T).trim():void 0}},W=a=>Array.isArray(a)?a.map(Oe).filter(i=>i.id):[],De=async()=>{try{const a=await I();a&&(j.value=W(a.familias||[]),L.value=W(a.indicadores||[]),X.value=W(a.subindicadores||[]),Ve.value=W(a.status_indicadores||[]))}catch(a){console.error("Erro ao carregar estrutura:",a)}},{period:D,updatePeriodLabels:$e,updatePeriod:xe}=Ze(),{accumulatedView:ue,handleViewChange:Be,options:Ge}=ta(D,xe),Me=S(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),Ee=S(()=>Ge.map(a=>({id:a.value,nome:a.label}))),Pe=a=>{R.value=a},Ne=a=>{Be(a)};qe(()=>{De(),ae()});const ee=()=>{u.value=!u.value},ze=()=>{ae()},ae=()=>{d("segmento",G.value),d("diretoria",M.value),d("gerencia",E.value),d("agencia",P.value),d("ggestao",N.value),d("gerente",H.value),d("familia",F.value),d("indicador",C.value),d("subindicador",V.value),d("status",R.value),b(D.value)},Ke=()=>{Ae(),F.value="",C.value="",V.value="",R.value="todos",ue.value="mensal",D.value=_e("mensal",D.value),$e(),J(),b(D.value)};return ve([G,M,E,P,N,H,F,C,V,R],()=>{ae()},{deep:!0}),ve(()=>D.value,a=>{b(a)},{deep:!0}),(a,i)=>(k(),w("section",ua,[i[13]||(i[13]=l("header",{class:"card__header"},[l("div",{class:"filters-hero"},[l("div",{class:"title-subtitle"},[l("h2",null,"POBJ Produções"),l("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),l("div",ca,[l("div",ga,[i[0]||(i[0]=l("label",null,"Segmento",-1)),p(A,{id:"f-segmento","model-value":o(G),options:[{id:"",nome:"Todos"},...Array.isArray(o(n))?o(n):[]],placeholder:"Todos",label:"Segmento",disabled:o(m),"onUpdate:modelValue":o(K)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",va,[i[1]||(i[1]=l("label",null,"Diretoria",-1)),p(A,{id:"f-diretoria","model-value":o(M),options:[{id:"",nome:"Todas"},...Array.isArray(o(h))?o(h):[]],placeholder:"Todas",label:"Diretoria",disabled:o(m),"onUpdate:modelValue":o(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ma,[i[2]||(i[2]=l("label",null,"Regional",-1)),p(A,{id:"f-gerencia","model-value":o(E),options:[{id:"",nome:"Todas"},...Array.isArray(o(f))?o(f):[]],placeholder:"Todas",label:"Regional",disabled:o(m),"onUpdate:modelValue":o(ye)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",fa,[p(le,{id:"btn-filtrar",variant:"primary",disabled:s.value,onClick:ze},{default:ie(()=>[p(te,{name:"search",size:16}),i[3]||(i[3]=me(" Filtrar ",-1))]),_:1},8,["disabled"]),p(le,{id:"btn-limpar",variant:"secondary",onClick:Ke},{default:ie(()=>[p(te,{name:"x",size:16}),i[4]||(i[4]=me(" Limpar filtros ",-1))]),_:1})])]),g.value?(k(),w("div",pa,[p(le,{id:"btn-abrir-filtros",variant:"info","aria-expanded":u.value,"aria-controls":"advanced-filters",onClick:ee,onKeydown:[Z(q(ee,["prevent"]),["enter"]),Z(q(ee,["prevent"]),["space"])]},{default:ie(()=>[p(te,{name:"chevron-down",size:16,class:de({rotated:u.value})},null,8,["class"]),l("span",null,Je(u.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):se("",!0),l("section",{id:"advanced-filters",class:de(["adv",{"is-open":u.value}]),"aria-hidden":!u.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[l("div",ha,[l("div",_a,[i[5]||(i[5]=l("label",null,"Agência",-1)),p(A,{id:"f-agencia","model-value":o(P),options:[{id:"",nome:"Todas"},...Array.isArray(o(U))?o(U):[]],placeholder:"Todas",label:"Agência",disabled:o(m),"onUpdate:modelValue":o(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",Sa,[i[6]||(i[6]=l("label",null,"Gerente de gestão",-1)),p(A,{id:"f-gerente-gestao","model-value":o(N),options:[{id:"",nome:"Todos"},...Array.isArray(o(z))?o(z):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:o(m),"onUpdate:modelValue":o(Ce)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",ya,[i[7]||(i[7]=l("label",null,"Gerente",-1)),p(A,{id:"f-gerente","model-value":o(H),options:[{id:"",nome:"Todos"},...Array.isArray(o(O))?o(O):[]],placeholder:"Todos",label:"Gerente",disabled:o(m),"onUpdate:modelValue":o(Te)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),l("div",Ia,[i[8]||(i[8]=l("label",null,"Família",-1)),p(A,{id:"f-secao","model-value":F.value,options:[{id:"",nome:"Selecione..."},...j.value],placeholder:"Selecione...",label:"Família",disabled:o(m),"onUpdate:modelValue":Fe},null,8,["model-value","options","disabled"])]),l("div",Ca,[i[9]||(i[9]=l("label",null,"Indicadores",-1)),p(A,{id:"f-familia","model-value":C.value,options:[{id:"",nome:"Selecione..."},...L.value],placeholder:"Selecione...",label:"Indicadores",disabled:o(m),"onUpdate:modelValue":we},null,8,["model-value","options","disabled"])]),l("div",Ta,[i[10]||(i[10]=l("label",null,"Subindicador",-1)),p(A,{id:"f-produto","model-value":V.value,options:[{id:"",nome:"Selecione..."},...re.value],placeholder:"Selecione...",label:"Subindicador",disabled:o(m)||!C.value||!Ue.value,"onUpdate:modelValue":ke},null,8,["model-value","options","disabled"])]),l("div",Aa,[i[11]||(i[11]=l("label",null,"Status dos indicadores",-1)),p(fe,{id:"f-status-kpi","model-value":R.value,options:Me.value,placeholder:"Todos",label:"Status dos indicadores",disabled:o(m),"onUpdate:modelValue":Pe},null,8,["model-value","options","disabled"])]),l("div",Va,[i[12]||(i[12]=l("label",null,"Visão acumulada",-1)),p(fe,{id:"f-visao","model-value":o(ue),options:Ee.value,placeholder:"Mensal",label:"Visão acumulada",disabled:o(m),"onUpdate:modelValue":Ne},null,8,["model-value","options","disabled"])])])],10,ba)]))}}),Oa=be(Ua,[["__scopeId","data-v-8bb0938c"]]);export{Oa as default};
